{"version":3,"mappings":"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","names":["registerSW","options","immediate","onNeedRefresh","onOfflineReady","onRegistered","onRegisteredSW","onRegisterError","wb","registerPromise","updateServiceWorker","_reloadPage","register","__vitePreload","n","Workbox","e","event","r","env","APP_VERSION","APP_API_BASE_URL","APP_PLAYER_ID","APP_FOOTER_TEXT","APP_DEFAULT_LANGUAGE","configureEnv","APP_DEFAULT_CONFIG_SOURCE","APP_PLAYER_LICENSE_KEY","APP_BODY_FONT","APP_BODY_ALT_FONT","PersonalShelf","ContinueWatching","Favorites","PersonalShelves","INTEGRATION","JWP","CLEENG","ACCESS_MODEL","AVOD","AUTHVOD","SVOD","VideoProgressMinMax","Min","Max","PLAYLIST_LIMIT","ADYEN_TEST_CLIENT_KEY","ADYEN_LIVE_CLIENT_KEY","LIVE_CHANNELS_REFETCH_INTERVAL","CONTENT_TYPE","series","episode","live","liveChannel","liveEvent","page","hub","OTT_GLOBAL_PLAYER_ID","CONFIG_QUERY_KEY","CONFIG_FILE_STORAGE_KEY","CACHE_TIME","STALE_TIME","CARD_ASPECT_RATIOS","MAX_WATCHLIST_ITEMS_COUNT","DEFAULT_FEATURES","canUpdateEmail","canSupportEmptyFullName","canChangePasswordWithOldPassword","canRenewSubscription","canExportAccountData","canDeleteAccount","canUpdatePaymentMethod","canShowReceipts","hasSocialURLs","hasNotifications","watchListSizeLimit","EPG_TYPE","jwp","viewNexa","debounce","callback","wait","timeout","args","clearTimeout","setTimeout","throttle","func","limit","lastFunc","lastRan","timeSinceLastRan","Date","now","apply","undefined","unicodeToChar","text","replace","match","String","fromCharCode","parseInt","hexToRgb","color","indexOf","slice","length","g","b","calculateContrastColor","rgb","IS_DEVELOPMENT_BUILD","__dev__","IS_PREVIEW_MODE","__mode__","logDev","message","optionalParams","isContentType","item","contentType","toLowerCase","isTruthyCustomParamValue","value","includes","isFalsyCustomParamValue","isTruthy","Boolean","container","Container","defaultScope","skipBaseClassChecks","getModule","constructorFunction","required","module","getAll","Error","getNamedModule","name","getAllNamed","err","assertModuleMethod","method","assertFeature","isEnabled","featureName","INTEGRATION_TYPE","Symbol","DETERMINE_INTEGRATION_TYPE","GET_CUSTOMER_IP","MediaStatus","LIVE","VOD","SCHEDULED","isLiveEvent","playlistItem","isScheduledOrLiveMedia","mediaStatus","getMediaStatusFromEventState","eventState","scheduledStart","scheduledEnd","EventState","isPlayable","PATH_MEDIA","PATH_PLAYLIST","PATH_LEGACY_SERIES","PATH_SEARCH","PATH_ABOUT","PATH_USER_BASE","PATH_USER","RELATIVE_PATH_USER_ACCOUNT","RELATIVE_PATH_USER_MY_PROFILE","RELATIVE_PATH_USER_FAVORITES","RELATIVE_PATH_USER_PAYMENTS","RELATIVE_PATH_USER_PROFILES","PATH_USER_ACCOUNT","PATH_USER_MY_PROFILE","PATH_USER_FAVORITES","PATH_USER_PAYMENTS","PATH_USER_PROFILES","getSeriesPlaylistIdFromCustomParams","seriesPlayListId","seriesPlaylistId","seriesId","isLegacySeriesFlow","isSeriesContentType","isSeries","isEpisode","episodeNumber","getLegacySeriesPlaylistIdFromEpisodeTags","seriesIdTag","tags","split","find","tag","test","isLiveChannel","createURL","url","queryParams","baseUrl","urlQueryString","urlSearchParams","URLSearchParams","entries","forEach","key","delete","formattedValue","Array","isArray","join","set","queryString","toString","createPath","originalPath","pathParams","path","map","segment","Object","filter","_","startsWith","isOptional","endsWith","paramName","paramValue","console","warn","slugify","whitespaceChar","mediaURL","media","playlistId","play","episodeId","id","mediaid","title","playlistURL","liveChannelsURL","channelId","channel","userProfileURL","profileId","nested","legacySeriesURL","buildLegacySeriesUrlFromMediaItem","legacyPlaylistIdFromTags","legacyPlaylistIdFromCustomParams","ApiError","constructor","code","getDataOrThrow","response","data","json","ok","status","apiMessage","isCommonError","error","isLocked","accessModel","isLoggedIn","hasSubscription","isItemFree","requiresSubscription","free","mediaOffers","some","offer","premier","filterMediaOffers","vendorPrefix","offerIds","reduce","offers","offerId","createStore","storeFn","store","subscribeWithSelector","create","useConfigStore","loaded","config","siteName","description","player","siteId","assets","content","menu","integrations","cleeng","useSandbox","clientId","assetId","styling","settings","additionalAllowedConfigSources","playerId","supportedLanguages","integrationType","PAGE_LIMIT","ApiService","_dec","injectable","_class","generateAlternateImageURL","label","playlistLabel","pathname","poster_fallback","fallback","parseDate","prop","date","isValid","parseISO","transformMediaItem","playlist","ConfigStore","getState","offerKeys","keys","imageLabel","transformedMediaItem","cardImage","ImageProperty","channelLogoImage","backgroundImage","productIds","transformPlaylist","relatedMediaId","transformEpisodes","episodesRes","seasonNumber","episodes","page_limit","total","el","media_item","season_number","episode_number","pagination","getPlaylistById","params","fetch","related_media_id","getMediaByWatchlist","mediaIds","token","media_ids","getMediaById","drmPolicyId","mediaItem","getSeries","getSeriesByMediaIds","getEpisodes","pageOffset","pageLimit","afterId","page_offset","after_id","episodesResponse","getSeasonWithEpisodes","getAdSchedule","credentials","getAppContentSearch","searchQuery","search_query","StorageService","AccountService","features","schema","array","object","shape","string","progress","number","WatchHistoryService","_dec2","target","inject","_dec3","Reflect","metadata","Function","_dec4","apiService","storageService","PERSIST_KEY_WATCH_HISTORY","accountService","getWatchHistoryItems","continueWatchingList","ids","watchHistoryItems","watchHistoryItemsDict","fromEntries","getWatchHistorySeriesItems","mediaWithSeries","seriesIds","series_id","uniqueSerieIds","Set","seriesItems","seriesItemsDict","acc","seriesItemId","getWatchHistory","user","savedItems","getWatchHistoryFromAccount","getWatchHistoryFromStorage","parentSeries","historyItem","createWatchHistoryItem","serializeWatchHistory","watchHistory","persistWatchHistory","_a","updateWatchHistory","history","setItem","JSON","stringify","videoProgress","duration","getMaxWatchHistoryCount","_b","saveItem","seriesItem","watchHistoryItem","updatedHistory","unshift","splice","validateWatchHistory","validateSync","getItem","GenericEntitlementService","getToken","body","jwt","headers","Authorization","getMediaToken","host","entitled","JWPEntitlementService","getJWPMediaToken","configId","mediaId","InPlayer","Asset","getSignedMediaToken","FavoriteService","PERSIST_KEY_FAVORITES","getFavorites","favoritesList","getFavoritesFromAccount","getFavoritesFromStorage","playlistItems","createFavorite","serializeFavorites","favorites","persistFavorites","updateFavorites","getMaxFavoritesCount","validateFavorites","contentSchema","contentId","notRequired","featured","boolean","backgroundColor","nullable","type","mixed","oneOf","defined","menuSchema","filterTags","featuresSchema","recommendationsPlaylist","searchPlaylist","cleengSchema","monthlyOffer","yearlyOffer","default","jwpSchema","stylingSchema","highlightColor","headerBackground","footerText","configSchema","analyticsToken","adSchedule","banner","of","adScheduleUrls","xml","custom","contentSigningService","contentProtection","drm","defaultPolicyId","AppError","payload","ConfigService","CONFIG_HOST","DEFAULT_CONFIG","enrichConfig","updatedContent","assign","i18next","t","getDefaultConfig","validateConfig","validate","strict","formatSourceLocation","source","loadAdSchedule","adScheduleId","loadConfig","configLocation","i18n","getI18n","errorPayload","helpLink","Accept","catch","SettingsService","isValidConfigSource","UNSAFE_allowAnyConfigSource","defaultConfigSource","initialize","then","result","ini","parse","iniString","playerLicenseKey","getConfigSource","configKey","get","removeItem","storedSource","useAccountStore","loading","subscription","transactions","activePayment","customerConsents","publisherConsents","publisherConsentsLoading","pendingOffer","setLoading","getAccountInfo","customerId","customer","useWatchHistoryStore","playlistItemsLoaded","continueWatchingPlaylistId","getPlaylist","feedid","getDictionaryWithEpisodes","dict","getDictionaryWithSeries","WatchHistoryController","watchHistoryService","restoreWatchHistory","setState","CheckoutService","SubscriptionService","useCheckoutStore","requestedMediaOffers","subscriptionOffers","switchSubscriptionOffers","selectedOffer","defaultOfferId","order","paymentMethods","setRequestedMediaOffers","setOrder","setPaymentMethods","FormValidationError","errors","values","flat","determineSwitchDirection","currentPeriod","period","CheckoutController","_dec5","IntegrationType","GetCustomerIP","getCustomerIP","checkoutService","subscriptionService","initialiseOffers","getOffers","svodOfferIds","subscriptionSwitches","getSubscriptionSwitches","getSubscriptionOfferIds","chooseOffer","initialiseOrder","paymentMethodId","getPaymentMethods","createOrderArgs","country","createOrder","responseData","updateOrder","couponCode","form","paymentWithoutDetails","orderId","rejectedReason","directPostCardPayment","cardPaymentPayload","referrer","returnUrl","createAdyenPaymentSession","isInitialPayment","initialAdyenPayment","paymentMethod","customerIP","finalizeAdyenPayment","details","paymentData","paypalPayment","successUrl","waitingUrl","cancelUrl","errorUrl","paymentWithPayPal","redirectUrl","getOffer","available","toOfferId","switchSubscription","switchDirection","switchSubscriptionPayload","changeSubscription","accessFeeId","subscriptionId","updatePayPalPaymentMethod","currentPaymentId","updatePaymentMethodWithPayPal","deletePaymentMethod","paymentDetailsId","addAdyenPaymentDetails","finalizeAdyenPaymentDetails","getEntitlements","defaultAvatar","useProfileStore","profile","selectingProfileAvatar","canManageProfiles","setProfile","avatar_url","ProfileService","PERSIST_PROFILE","profileSchema","yup","adult","access_token","expires","ProfileController","profileService","isValidProfile","listProfiles","createProfile","pin","updateProfile","enterProfile","initializeProfile","deleteProfile","getProfileDetails","persistProfile","unpersistProfile","loadPersistedProfile","useFavoritesStore","warning","favoritesPlaylistId","setWarning","clearWarning","hasItem","favoriteItem","FavoritesController","favoritesService","restoreFavorites","items","concat","toggleFavorite","maxCount","clear","AccountController","favoritesController","watchHistoryController","profileController","refreshEntitlements","loadUserData","getAuthData","getAccount","logout","updateUser","getFeatures","prototype","hasOwnProperty","call","validateInputLength","email","updatedUser","updateCustomer","getUser","afterLogin","login","password","clearLoginState","consentsValues","consents","errorMessage","updateConsents","updatedConsents","updateCustomerConsents","getCustomerConsents","getPublisherConsents","getCaptureStatus","updateCaptureAnswers","capture","updatedCustomer","resetPassword","resetUrl","customerEmail","changePasswordWithOldPassword","oldPassword","newPassword","newPasswordConfirmation","changePasswordWithToken","resetPasswordToken","changePasswordWithResetToken","updateSubscription","unsubscribeUrl","reloadSubscriptions","retry","updateCardDetails","cardName","cardNumber","cvc","expMonth","expYear","currency","getActivePayment","checkEntitlements","accessGranted","delay","Promise","resolve","finally","activeSubscription","all","getActiveSubscription","getAllTransactions","retryDelay","pendingSwitchId","getSubscriptionSwitch","switchOffer","switchId","exportAccountData","getSocialLoginUrls","getSocialUrls","deleteAccountData","deleteAccount","getReceipt","transactionId","fetchReceipt","subscribeToNotifications","uuid","onMessage","Number","firstName","push","lastName","getSandbox","sandbox","registration","allSettled","AppController","_dec6","configService","settingsService","loadAndValidateConfig","configSource","defaultConfig","s","merge","initializeApp","calculateIntegrationType","activatedIntegrationTypes","previousValue","getIntegrationType","configState","EpgService","isFulfilled","input","reason","EpgController","parseSchedule","demo","scheduleDemo","epgService","getEpgService","programs","transformProgram","program","generateDemoPrograms","getSchedule","schedule","fetchSchedule","catchupHours","scheduleType","toLocaleLowerCase","service","getSchedules","today","startDate","startTime","utcStartDate","UTC","getUTCFullYear","getUTCMonth","getUTCDate","daysDelta","differenceInDays","idx","addDays","toJSON","endTime","viewNexaEpgProgramSchema","desc","icon","src","start","stop","parseData","toISOString","ViewNexaEpgService","XMLParser","scheduleUrl","xmlParserOptions","ignoreAttributes","attributeNamePrefix","res","tv","programme","AUTHENTICATION_HEADER","jwEpgProgramSchema","chapterPointCustomProperties","JWEpgService","image","Headers","scheduleToken","PromiseQueue","queue","getLength","enqueue","reject","promises","AUTH_PERSIST_KEY","tokensSchema","accessToken","refreshToken","isValidTokens","candidate","isValidSync","getTokenExpiration","decodedToken","jwtDecode","exp","CleengService","isRefreshing","expiration","tokens","logoutCallback","getNewTokens","newTokens","post","handleBroadcastMessage","action","setTokens","sendBroadcastMessage","state","postMessage","getBaseUrl","performRequest","authenticate","getAccessTokenOrThrow","keepalive","restoreTokensFromStorage","maybeRefreshAccessToken","persistInStorage","clearTokens","tokensString","accessTokenIsExpired","hasTokens","refreshTokens","getAccessToken","getLocales","patch","put","remove","BroadcastChannel","addEventListener","formatCustomer","fullName","externalData","formatPublisherConsent","consent","defaultValue","placeholder","enabledByDefault","version","CleengAccountService","cleengService","publisherId","handleErrors","getCustomerIdFromAuthData","auth","getCustomer","_url","cleengConfig","localesResponse","locale","authData","rest","CleengCheckoutService","locales","ipAddress","createOrderPayload","getOrder","paypalPayload","attemptAuthentication","CleengSubscriptionService","getSubscriptions","getTransactions","getPaymentDetails","paymentDetails","active","offset","getFiltersFromConfig","menuItem","filterPlaylist","generatePlaylistPlaceholder","playlistLength","fill","_value","index","images","link","genre","pubdate","rating","sources","tracks","formatConsentValues","publisherConsent","customerConsent","isCustomRegisterField","formatConsents","extractConsentValues","formatConsentsFromValues","checkConsentsFromValues","consentsErrors","isNotEmptyConsent","formatConsentToRegisterField","collection","val","formatConsentsToRegisterFields","deepCopy","obj","parseAspectRatio","parseTilesDelta","posterAspect","parts","Math","floor","JW_TERMS_URL","JWPAccountService","parseJson","formatFavorite","favorite","media_id","formatHistoryItem","formatAccount","account","full_name","created_at","createdAt","regDate","toLocaleString","first_name","surname","lastUserIp","_logoutFn","jwpConfig","InPlayerEnv","setConfig","Account","setToken","isAuthenticated","toObject","getRegisterFields","terms","field","default_value","getTermsConsent","existingAccountData","formatUpdateAccount","updateAccount","newAnswers","changePassword","passwordConfirmation","requestNewPassword","merchantUuid","brandingId","signInV2","formatAuth","signUpV2","Notifications","isSubscribed","unsubscribe","signOut","trim","firstNameTrimmed","lastNameTrimmed","isCaptureEnabled","shouldCaptureBeDisplayed","answer","enabled","setNewPassword","termsUrl","termsLink","current","savedHistory","currentFavoriteIds","payloadFavoriteIds","addToFavorites","deleteFromFavorites","favoritesData","watchHistoryData","subscribe","onOpen","exportData","socialState","base64Encode","client_id","redirect","socialResponse","social_urls","formatDurationTag","seconds","ceil","formatDuration","hours","minutes","round","hoursString","minutesString","formatPrice","price","Intl","NumberFormat","style","format","formatSeriesMetaString","formatVideoSchedule","formatLocalizedDateTime","formatLocalizedTime","formatLocalizedDate","DateTimeFormat","day","month","year","hour","minute","separator","getOfferPrice","customerPriceInclTax","customerCurrency","customerCountry","isSVODOffer","JWPCheckoutService","cardPaymentProvider","formatPaymentMethod","methodName","method_name","provider","logoUrl","formatEntitlements","expiresAt","formatOffer","formatOfferId","offerCurrency","amount","offerTitle","access_type","quantity","freePeriods","trial_period","planSwitchEnabled","plan_switch_enabled","formatOrder","totalPrice","priceBreakdown","offerPrice","discountAmount","discountedPrice","paymentMethodFee","taxValue","taxRate","requiredPaymentDetails","success","getAssetAccessFees","parseOfferId","Payment","getPayPalParams","origin","voucherCode","endpoint","iFrameCardPayment","Voucher","getDiscount","updatedOrder","discount","applied","periods","discount_duration","checkAccessForAsset","expires_at","cardholderName","cardExpMonth","cardExpYear","cvv","cardCVC","accessFee","Subscription","createSubscription","createPayment","item_id","JWPSubscriptionService","named","formatCardDetails","card","exp_month","exp_year","card_name","card_type","account_id","zeroFillExpMonth","paymentGateway","paymentMethodSpecificParams","holderName","variant","lastCardFourDigits","cardExpirationDate","formatTransaction","transaction","purchasedAmount","charged_amount","transaction_token","transactionDate","trxToken","trx_token","offerType","item_type","item_title","offerPeriod","transactionPriceExclTax","transactionCurrency","currency_iso","discountedOfferPrice","offerPriceExclTax","applicableTax","transactionPriceInclTax","consumer_id","customerLocale","customerIpCountry","payment_method_name","formatActiveSubscription","action_type","subscription_id","access_fee_id","nextPaymentAt","next_rebill_date","nextPaymentPrice","subscription_price","nextPaymentCurrency","unsubscribe_url","formatGrantedSubscription","hasAccess","getPaymentHistory","getDefaultCreditCard","cards","cancelSubscription","changeSubscriptionPlan","inplayer_token","setDefaultCreditCard","getBillingReceipt","JWPProfileService","getProfiles","tokenData","context","isCleengIntegrationType","isJwpIntegrationType","bind","toSelf","to","whenTargetNamed","toDynamicValue","toConstantValue","LocalStorageService","prefix","getStorageKey","window","localStorage","usePrefix","btoa","base64Decode","atob","getOverrideIP","queryClient","QueryClient","defaultOptions","queries","staleTime","refetchOnWindowFocus","retryOnMount","QueryProvider","children","jsx","QueryClientProvider","ErrorPage","learnMoreLabel","useTranslation","ErrorPageWithoutTranslation","logo","styles","errorPage","jsxs","box","main","Spinner","size","className","classNames","buffer","small","large","LoadingOverlay","transparentBackground","inline","profileImageUrl","loadingOverlay","transparent","fixed","variantAriaMap","info","FormFeedback","visible","formFeedback","hidden","ariaLive","AriaAnnouncerContext","createContext","useAriaAnnouncer","announce","useContext","AriaAnnouncerProvider","announcement","setAnnouncement","useState","useCallback","secondsToMilliseconds","createPortal","document","filterSupportedLanguages","definedLanguages","enabledLanguages","languages","languageCode","foundLanguage","NAMESPACES","DEFINED_LANGUAGES","displayName","initI18n","import","defaultLanguage","use","I18NextHttpBackend","LanguageDetector","initReactI18next","init","supportedLngs","fallbackLng","returnEmptyString","ns","defaultNS","fallbackNS","interpolation","escapeValue","detection","caches","lookupLocalStorage","react","useSuspense","createURLFromLocation","location","search","modalURLFromLocation","u","modalURLFromWindowLocation","href","useEventCallback","fnRef","useRef","useLayoutEffect","useQueryParam","searchParams","useSearchParams","useCountdown","durationSeconds","intervalSeconds","completeHandler","timerRef","countdown","setCountdown","useEffect","count","Button","startIcon","fullWidth","disabled","busy","onClick","activeClassname","buttonClassName","isActive","button","centerAbsolute","NavLink","Welcome","onCloseButtonClick","onCountdownCompleted","welcome","PaymentFailed","Animation","createStyle","open","onOpenAnimationEnd","onCloseAnimationEnd","keepMounted","setStatus","hasOpenedBefore","setHasOpenedBefore","timeout2","openEvent","closeEvent","Grow","transition","transform","canUseDOM","createElement","scrollbarSize","recalc","scrollDiv","position","top","width","height","overflow","appendChild","offsetWidth","clientWidth","removeChild","addScript","script","async","onload","onerror","removeBodyScrolling","marginRight","overflowY","restoreBodyScrolling","from","querySelectorAll","dialog","removeProperty","originElement","useModal","restoreFocus","activeElement","focus","handleOpen","handleClose","Modal","onClose","centered","role","AnimationComponent","animationContainerClassName","ariaAttributes","modalRef","closeModalEvent","onAnimationEndHandler","classList","close","removeEventListener","add","openModalEvent","showModal","keyDownHandler","contains","preventDefault","closeHandler","closeAnimationEndHandler","clickHandler","ReactDOM","querySelector","Slide","direction","directions","left","right","bottom","opacity","zIndex","SvgClose","props","React.createElement","IconButton","ariaProps","iconButton","Icon","IconComponent","ModalCloseButton","modalCloseButton","Close","Dialog","testId","useForm","initialValues","validationSchema","validateOnBlur","onSubmit","onSubmitSuccess","onSubmitError","touched","setTouched","setValues","submitting","setSubmitting","setErrors","validationSchemaError","setValidationSchemaError","reset","validateField","formValues","validateSyncAt","ValidationError","setValue","handleChange","HTMLInputElement","checked","newValues","handleBlur","abortEarly","newErrors","inner","every","handleSubmit","resetValue","useToggle","initialState","forceValue","SvgVisibility","SvgVisibilityOff","generateId","suffix","randomId","random","useOpaqueId","override","setId","HelperText","helperId","helperText","FormField","renderInput","editing","formFieldClassName","formField","helperTextId","isTextArea","_props","multiline","Input","textAreaRef","inputRef","leftControl","rightControl","inputProps","inputType","containerClassName","commonProps","rows","readOnly","control","TextField","textField","fieldProps","PASSWORD_REGEX","PasswordStrength","strength","labels","passwordStrength","passwordStrengthBar","passwordStrengthFill","PasswordField","showToggleView","showHelperText","viewPassword","toggleViewPassword","React","Visibility","VisibilityOff","DeleteAccountModal","accountController","enteredPassword","setEnteredPassword","navigate","useNavigate","useLocation","resetForm","useMutation","onSuccess","onError","handleCancel","heading","disclaimer","warningBox","buttons","isLoading","mutate","paragraph","stacked","FinalizePayment","checkoutController","redirectResult","orderIdQueryParam","setErrorMessage","paymentSuccessUrl","useMemo","checkPaymentResult","decodeURI","Fragment","useCheckAccess","intervalRef","intervalCheckAccess","interval","iterations","setInterval","clearInterval","WaitingForPayment","center","UpgradeSubscription","typeToAnnounce","pending","DeleteAccountPasswordWarning","proceedToAddPasswordClickHandler","formContainer","passwordButtonsContainer","SvgCreditcard","SvgPaypal","PaymentMethodForm","onPaymentMethodChange","renderPaymentMethod","updateSuccess","cardPaymentMethod","paypalPaymentMethod","paymentMethodsInputs","radio","paymentMethodLabel","CreditCard","PayPal","payPal","Adyen","configuration","checkoutElementRef","checkoutRef","session","checkout","AdyenCheckout","mount","unmount","adyen","submit","AdyenPaymentDetails","setProcessing","setPaymentError","isSandbox","setSession","finalize","finalizePaymentDetails","handleAction","adyenConfiguration","showPayButton","environment","clientKey","paymentMethodsConfiguration","hasHolderName","holderNameRequired","onAdditionalDetails","component","UpdatePaymentMethod","paymentMethodIdQueryParam","parsedPaymentMethodId","paymentError","setPaymentMethodId","processing","handlePaymentMethodChange","toPaymentMethodId","handlePayPalSubmit","EditCardDetailsForm","onCancel","cancelButton","CreditCardCVCField","onChange","formatCVC","clearValue","CreditCardExpiryField","formatExpirationDate","cardIssuers","visa","mastercard","maestro","amex","discover","diners","dinersclub","unionpay","hiper","CreditCardNumberField","onBlur","cardIssuer","setCardIssuer","formatCreditCardNumber","issuer","fns","cardType","nextValue","cardTypeWrapper","EditCardPaymentForm","setUpdatingCardDetails","mutateCardDetails","shallow","cardExpiry","validateCardNumber","validateCardExpiry","validateCardCVC","onSettled","expiry","cardExpiryVal","paymentForm","columns","EditCardDetails","updatingCardDetails","EditPasswordForm","showOldPasswordField","showResetTokenField","validationError","onResendEmailClick","resendLink","ResetPassword","resetPasswordTokenParam","emailParam","passwordSubmitHandler","formData","resetToken","passwordForm","matches","resendEmailClickHandler","RenewSubscriptionForm","onConfirm","infoBox","language","confirmButton","SubscriptionRenewed","RenewSubscription","renewed","setRenewed","setError","renewSubscriptionConfirmHandler","CancelSubscriptionForm","SubscriptionCancelled","expiresDate","CancelSubscription","cancelled","setCancelled","expirationDateFormatted","cancelSubscriptionConfirmHandler","ResetPasswordForm","onReset","ForgotPasswordForm","ConfirmationForm","onBackToLogin","loggedIn","forgotPasswordForm","notSure","Link","resetPasswordSubmitting","setResetPasswordSubmitting","cancelClickHandler","backToLoginClickHandler","resetPasswordClickHandler","emailSubmitHandler","emailForm","useCheckout","onUpdateOrderSuccess","onSubmitPaymentWithoutDetailsSuccess","onSubmitPaypalPaymentSuccess","onSubmitStripePaymentSuccess","mutationKey","mutationFn","submitPaymentWithoutDetails","submitPaymentPaypal","submitPaymentStripe","isError","isSubmitting","SvgArrowLeft","DialogBackButton","dialogBackButton","ArrowLeft","CheckoutForm","onBackButtonClick","couponFormOpen","couponInputValue","couponFormError","couponFormApplied","couponFormSubmitting","onCouponInputChange","onCloseCouponFormClick","onCouponFormSubmit","onRedeemCouponButtonClick","getOfferPeriod","getFreeTrialText","freeDays","orderTitle","orderInfo","orderTitleMargin","orderBillingDate","orderPrice","couponForm","redeemCoupon","couponInput","orderTotals","couponCell","divider","NoPaymentRequired","noPaymentRequired","PaymentForm","onPaymentFormSubmit","parent","formError","AdyenInitialPayment","setUpdatingOrder","Checkout","adyenUpdating","setAdyenUpdating","setCouponFormOpen","showCouponCodeSuccess","setShowCouponCodeSuccess","chooseOfferUrl","welcomeUrl","closeModalUrl","backButtonClickHandler","mutateAsync","successUrlPaypal","isStripePayment","isAdyenPayment","isPayPalPayment","useOffers","isInitialisationLoading","useQuery","queryKey","queryFn","hasMediaOffers","hasSubscriptionOffers","hasPremierOffers","mediaOffer","hasMultipleOfferTypes","defaultOfferType","SvgCheckCircle","OfferBox","selected","renderListItem","renderOption","periodString","secondBenefit","offerDivider","offerBenefits","CheckCircle","isMonthly","durationPeriod","durationAmount","ChooseOfferForm","showOfferTypeSwitch","onBackButtonClickHandler","selectedOfferType","selectedOfferId","subtitle","offerGroupSwitch","offerGroupLabel","ChooseOffer","isSwitch","isPendingOffer","checkoutUrl","upgradePendingUrl","upgradeSuccessUrl","upgradeErrorUrl","visibleOffers","Select","defaultLabel","optionsStyle","select","option","Dropdown","lang","Checkbox","checkboxLabel","fieldClassName","checkbox","row","Radio","optionValue","optionLabel","parseDateString","dateString","isNaN","getTime","padLeft","clamp","min","max","parseBlurValue","parsed","parseInputValue","DateField","onFocus","parsedDate","getDate","getMonth","getFullYear","hiddenInputRef","dateFieldClassName","dateField","handleFocus","currentTarget","handleKeyDown","previousElementSibling","triggerChangeEvent","nativeInputValueSetter","getOwnPropertyDescriptor","newValue","inputEvent","Event","bubbles","dispatchEvent","nextSibling","nextElementSibling","hiddenInput","PersonalDetailsForm","fields","questions","onQuestionChange","questionValues","questionErrors","renderQuestion","question","firstNameLastName","companyName","address","address2","city","postCode","phoneNumber","birthDate","continue","yupConditional","PersonalDetails","setQuestionValues","setQuestionErrors","nextStep","hasOffers","questionChangeHandler","submitHandler","requiredMessage","address1","removeEmpty","customAnswers","questionId","useSocialLoginUrls","urls","CustomRegisterField","optionsList","getResourceBundle","linkClassName","RouterLink","RegistrationForm","consentValues","onConsentChange","consentErrors","ref","htmlLang","formatConsentLabel","sanitizedLabel","DOMPurify","sanitize","hasHrefOpenTag","hasHrefCloseTag","__html","scrollIntoView","behavior","block","customFields","consentError","Registration","setConsentValues","setConsentErrors","handleChangeConsent","socialLoginURLs","LoginForm","Login","PUBLIC_VIEWS","AccountModal","viewParam","viewParamRef","isPublicView","toLogin","view","renderForm","EditPassword","shouldShowBanner","dialogSize","testConfigs","jwpAuth","jwpSvod","jwpAuthNoWatchlist","basicNoAuth","noStyling","inlinePlayer","cleengAuthvod","cleengAuthvodNoWatchlist","svod","configs","applicationController","useBootstrapApp","onReady","useQueryClient","invalidateQueries","isSuccess","refetch","refetchInterval","query","cacheTime","setThemingVariables","root","bodyFont","bodyAltFont","setProperty","ConfirmationDialog","RootErrorPage","useRouteError","renderer","externalLink","targetAttr","relAttr","titleAttr","attributes","marked","MarkdownComponent","markdownString","sanitizedHTMLString","dirtyHTMLString","parseInline","ADD_ATTR","dangerouslySetInnerHTML","markdown","About","about","placeholderData","usePlaylists","rowsToLoad","playlistQueries","useQueries","pType","setQueryData","isPlaceholderData","SvgChevronLeft","SvgChevronRight","addMediaQueryListChangeListener","mediaQuery","addListener","removeMediaQueryListChangeListener","removeListener","XS_MATCH_MEDIA","matchMedia","SM_MATCH_MEDIA","MD_MATCH_MEDIA","LG_MATCH_MEDIA","Breakpoint","xs","sm","md","lg","xl","getScreenSize","useBreakpoint","breakpoint","setBreakpoint","changeEventHandler","makeTiles","originalList","slicedItems","itemIndices","sliceItems","isMultiPage","tilesToShow","cycleMode","sliceFrom","sliceTo","cycleModeEndlessCompensation","listStartClone","itemsSlice","TileDock","spacing","minimalTouchMovement","showControls","animationModeOverride","transitionTime","wrapWithEmptyTiles","showDots","renderTile","renderLeftControl","renderRightControl","renderPaginationDots","renderPageIndicator","setIndex","slideToIndex","setSlideToIndex","setTransform","isAnimated","isAnimationDone","setIsAnimationDone","isAnimationRunning","setIsAnimationRunning","frameRef","tileWidth","transformWithOffset","pages","tileList","transitionBasis","needControls","showLeftControl","showRightControl","slide","directionFactor","nextIndex","movement","abs","handleTouchStart","touchPosition","x","touches","clientX","y","clientY","handleTouchMove","newPosition","changedTouches","movementX","movementY","stopPropagation","handleTouchEnd","cleanup","handleTouchCancel","passive","postAnimationCleanup","resetIndex","handleTransitionEnd","ulStyle","marginLeft","slideOffset","paginationDots","dots","pageIndex","tileDock","emptyTile","paddingLeft","paddingRight","boxSizing","tile","listIndex","isInView","notInView","SvgLock","SvgToday","setWidth","Image","onLoad","alt","handleLoad","Image$1","memo","Card","onHover","isCurrent","currentLabel","headingLevel","tabIndex","imageLoaded","setImageLoaded","cardClassName","aspectRatioClass","posterClassNames","poster","posterImageClassNames","posterImage","isSeriesItem","isLive","isScheduled","renderTag","Today","scheduled","titleContainer","meta","lock","Lock","progressContainer","progressBar","tileBreakpoints","featuredTileBreakpoints","Shelf","onCardHover","visibleTilesDelta","didSlideBefore","setDidSlideBefore","doSlide","chevron","handleSlide","ChevronRight","ChevronLeft","dot","shelf","loadingTitle","InfiniteScrollLoader","infiniteScrollLoader","INITIAL_ROWS_TO_LOAD","ROWS_TO_LOAD_STEP","ShelfList","setRowsToLoad","watchHistoryDictionary","playlists","shelfList","InfiniteScroll","cardImageAspectRatio","shelfImageAspectRatio","shelfContainer","Home","useUIStore","searchActive","userMenuOpen","sideBarOpen","languageMenuOpen","useFirstRender","firstRenderRef","useDebounce","time","debounceRef","useSearchQueryUpdater","updateSearchPath","encodeURIComponent","updateSearchQuery","resetSearchQuery","returnPage","preSearchPage","usePlaylist","usePlaceholderData","useAppContentSearch","appContentSearchQuery","useSearch","hasAppContentSearch","appContentSearch","playlistQuery","isFetching","scrollIntoViewThrottled","focusedElement","LayoutGrid","columnCount","renderCell","currentRowIndex","setCurrentRowIndex","currentColumnIndex","setCurrentColumnIndex","gridRef","rowCount","focusGridCell","rowIndex","columnIndex","gridCell","getElementById","elementToFocus","preventScroll","ctrlKey","maxRow","isOnFirstColumn","isOnLastColumn","isOnFirstRow","isOnLastRow","maxRightLastRow","maxRight","nextRowIndex","previousRowIndex","cell","INITIAL_ROW_COUNT","LOAD_ROWS_COUNT","defaultCols","CardGrid","cols","currentCardItem","currentCardLabel","hasMore","getUrl","loadMore","visibleTiles","setRowCount","defaultLoadMore","defaultHasMore","Search","headingId","firstRender","useParams","getURL","subHeading","Helmet","header","useUpdateProfile","useProfiles","useDeleteProfile","isProfileFormSubmitError","useProfileErrorHandler","profilesEnabled","shouldManageProfiles","SvgAccountCircle","SvgBalanceWallet","SvgExit","SvgFavorite","Alert","actionsOverride","titleOverride","FormSection","panelHeaderClassName","editButton","saveButton","sectionId","formState","activeSectionId","formErrors","isBusy","setFormState","FormContext","isEditing","oldState","arr","onEdit","flexBox","controls","Form","isDirty","i","panelClassName","isAlertVisible","setIsAlertVisible","exportDataMessage","registerSource","register_source","isSocialLogin","shouldAddPassword","has_password","termsConsents","nonTermsConsents","nonTerms","confirmationPassword","translateErrors","flatMap","formSection","editPasswordClickHandler","section","textWithButtonContainer","Trans","onClearFavoritesClick","useSubscriptionChange","isUpgradeOffer","activeSubscriptionId","updateSubscriptionMetadata","SvgExternalLink","OfferSwitch","isCurrentOffer","pendingDowngradeOfferId","isPendingDowngrade","offerSwitchContainer","activeOfferSwitchContainer","offerSwitchInfoContainer","currentPlanHeading","activeCurrentPlanHeading","toUpperCase","offerSwitchPlanContainer","nextBillingDate","paymentFrequency","VISIBLE_TRANSACTIONS","activePaymentDetail","onShowAllTransactionsClick","showAllTransactions","onShowReceiptClick","onUpgradeSubscriptionClick","offerSwitchesAvailable","onChangePlanClick","setSelectedOfferId","setIsUpgradeOffer","isExternalPaymentProvider","paymentProvider","paymentProviderLink","subscriptionDetailsId","billingHistoryId","hiddenTransactionsCount","hasMoreTransactions","isGrantedSubscription","isMobile","isChangingOffer","setIsChangingOffer","onCompleteSubscriptionClick","onEditCardDetailsClick","onCancelSubscriptionClick","onRenewSubscriptionClick","getTitle","showChangeSubscriptionButton","pendingSwitch","explanation","upgradeSubscription","changePlanContainer","o","changePlanButtons","changePlanCancelButton","paypal","cardDetails","editCard","transactionItem","transactionDetails","transactionPrice","parseFloat","ExternalLink","processBillingReceipt","receipt","Blob","URL","createObjectURL","setAttribute","click","newWindow","htmlString","opener","write","EXTERNAL_PAYMENT_METHODS","STORE_LINKS","apple","google","roku","PaymentContainer","setShowAllTransactions","isLoadingReceipt","setIsLoadingReceipt","handleUpgradeSubscriptionClick","handleShowReceiptClick","panel","panelHeader","DeleteProfile","setView","isDeleting","setIsDeleting","onMutate","deleteHandler","deleteModal","deleteButtons","Navigate","SvgEdit","SvgCheck","ProfileBox","editMode","wrapper","overlay","Edit","checkmarkContainer","Check","checkmark","formHandler","selectedAvatar","showCancelButton","showContentRating","charactersCount","formLabel","profileStyles","profileInfo","formFields","noBottomBorder","avatarsContainer","AVATARS","avatarUrl","EditProfile","contained","profileDetails","setSelectedAvatar","updateProfileHandler","mainColumn","User","clearFavoritesOpen","setClearFavoritesOpen","isLargeScreen","profileAndFavoritesPage","onLogout","leftColumn","profileIcon","AccountCircle","Favorite","BalanceWallet","logoutLi","Exit","Routes","Route","AccountComponent","createVideoMetadata","episodesLabel","metaData","createPlaylistMetadata","createLiveEventMetadata","notifyOnChangeProps","useEntitlement","isPreEntitled","mediaEntitlementQueries","refetchOnMount","isMediaEntitled","isMediaEntitlementLoading","isEntitled","useMedia","SvgPlayTrailer","Filter","forceDropdown","showFilterRow","filterRow","filterDropDown","dropDown","TruncatedText","maximumLines","truncatedText","maxHeight","WebkitLineClamp","CollapsibleText","divRef","doesFlowOver","setDoesFlowOver","expanded","setExpanded","ariaLabel","clippablePixels","scrollHeight","offsetHeight","collapsibleText","textContainer","collapsed","VideoDetails","primaryMetadata","secondaryMetadata","startWatchingButton","shareButton","favoriteButton","trailerButton","video","mainPadding","posterFade","metaContainer","buttonBar","VideoDetailsInline","TitleComponent","inlinePlayerMetadata","VideoListItem","activeLabel","listItem","VideoList","onListItemHover","activeMediaId","list","VideoLayout","inlineLayout","relatedTitle","filters","setFilter","filterMetadata","currentFilter","defaultFilterLabel","isTablet","hasFilters","showFilters","renderFilters","filtersInline","renderRelatedVideos","grid","relatedVideosGrid","relatedVideosGridTitle","relatedVideosList","relatedVideosListHeader","relatedVideosListTitle","videoInlineLayout","videoDetailsInline","relatedVideos","Fade","willChange","PROGRESSIVE_SAVE_INTERVAL","useWatchHistoryListener","queuedWatchProgress","watchHistoryEnabled","maybeSaveWatchProgress","handleTimeUpdate","toFixed","isFinite","timestamp","on","off","visibilityListener","visibilityState","useWatchHistory","usePlaylistItemCallback","startDateTime","endDateTime","applyLiveStreamOffset","timeParam","allSources","file","useLegacyStandaloneAds","useAds","useAppBasedFlow","isAdScheduleLoading","adConfig","client","useContentProtection","genericEntitlementService","jwpEntitlementService","signingConfig","urlSigning","signingEnabled","keepPreviousData","queryResult","useProtectedMedia","isGeoBlocked","setIsGeoBlocked","contentProtectionQuery","m3u8","useOttAnalytics","feedId","oaid","oiid","av","setPlayer","jwpltx","timeHandler","seekHandler","seek","getDuration","seekedHandler","seeked","playlistItemHandler","ready","hostname","complete","adImpressionHandler","adImpression","attachAnalyticsParams","userId","isJwIntegration","sourceUrl","isVOD","isBCL","Player","adsData","onPlay","onPause","onComplete","onUserActive","onUserInActive","onBeforePlay","onFirstFrame","onRemove","onPlaylistItem","onPlaylistItemCallback","onNext","autostart","playerElementRef","playerRef","loadingRef","libLoaded","setLibLoaded","jwplayer","startTimeRef","handleBeforePlay","handlePlay","handlePause","handleComplete","handleUserActive","handleUserInactive","handleFirstFrame","playerContainer","getContainer","playPauseButton","handleRemove","handlePlaylistItem","handlePlaylistItemCallback","handleNextClick","handleReady","attachEvents","setPlaylistItemCallback","detachEvents","scriptUrl","loadPlaylist","currentItem","getPlaylistItem","load","starttime","initializePlayer","playerOptions","advertising","showCountdown","timeSlider","showAdMarkers","aspectratio","displaytitle","displayHeading","displaydescription","floating","mode","mute","playbackRateControls","pipIcon","repeat","cast","stretching","setup","PlayerErrorState","GEO_BLOCKED","PlayerError","PlayerContainer","liveEndDateTime","liveFromBeginning","liveStartDateTime","isAdsLoading","playableItem","playerInstance","setPlayerInstance","InlinePlayer","playable","loginButtonClickHandler","buyLabel","paywall","SvgPlay","StartWatchingButton","playUrl","startWatchingLabel","handleStartWatchingClick","Play","progressRail","Cinema","isPlaying","setIsPlaying","overlayHasFocus","setOverlayHasFocus","userActive","setUserActive","handleNext","cinemaContainer","cinema","overlayFade","playerOverlay","playerContent","backButton","TrailerModal","SvgShare","copyToClipboard","inputElement","execCommand","blur","ShareButton","hasShared","setHasShared","onShareClick","navigator","share","Share","SvgFavoriteBorder","FavoriteButton","isFavorite","onFavoriteButtonClick","FavoriteBorder","Loading","VideoMetaData","secondsToISO8601","timeOnly","getUTCHours","getUTCMinutes","getUTCSeconds","isoString","is12HourClock","toLocaleTimeString","getFiltersFromSeries","sort","filterSeries","getNextItem","seriesPlaylist","findIndex","getEpisodesInSeason","generateLegacySeriesMetadata","numberOfEpisodes","numberOfSeasons","generateLegacyEpisodeJSONLD","episodeMetadata","episodeCanonical","seriesMetadata","uploadDate","partOfSeries","LegacySeries","playTrailer","setPlayTrailer","isSeriesPlaylistLoading","isPlaylistError","isEpisodeLoading","isTrailerLoading","trailerItem","trailerId","selectedItem","selectedItemImage","isFavoritesEnabled","seasonFilter","setSeasonFilter","firstEpisode","filteredPlaylist","episodesInSeason","nextItem","goBack","toEpisode","scrollingElement","scroll","pageTitle","pageDescription","canonicalUrl","PlayTrailer","ScreenMap","defaultScreen","definitions","predicate","registerByContentType","registerDefault","getScreen","screen","MediaStaticPage","mediaStaticPage","generateMovieJSONLD","movieCanonical","thumbnailUrl","generateSeriesMetadata","episode_count","season_count","generateEpisodeJSONLD","MediaMovie","isPlaylistLoading","seasons","season","season_title","useSeries","failureCount","getNextPageParam","useEpisodes","fetchNextPage","hasNextPage","useInfiniteQuery","pageParam","lastPage","useSeriesLookup","firstSeries","useNextEpisode","MediaSeries","seriesMedia","setSearchParams","isSeriesDataLoading","seriesError","episodeInSeries","isSeriesDictionaryLoading","fetchNextEpisodes","hasNextEpisodesPage","watchHistoryArray","episodeInProgress","handleInlinePlay","MediaLiveChannel","liveChannelsId","MediaEpisode","isMediaLoading","isSeriesIdLoading","isSeriesMediaLoading","useLiveEvent","Tag","StatusIcon","MediaEvent","mediaScreenMap","MediaScreenRouter","MediaScreen","PlaylistGrid","categories","shouldShowFilter","programIsLive","isPast","isFuture","programIsVod","programIsFullyWatchable","liveStreamCatchupHours","maxStartTime","subHours","isAfter","getLiveProgram","useLiveChannels","initialChannelId","enableAutoUpdate","epgController","channels","autoUpdate","setAutoUpdate","setChannel","setProgram","intervalId","selectedChannel","updatedChannel","updatedProgram","setActiveChannel","programId","useLiveProgram","setIsLive","isVod","setIsVod","isWatchableFromBeginning","setIsWatchableFromBeginning","calculateStatus","isBaseTimeFormat","formatChannel","formatProgram","channelUuid","till","since","usePlanByEpg","sidebarWidth","itemHeight","epgChannels","epgPrograms","theme","makeTheme","startOfToday","endDate","startOfDay","startOfTomorrow","useEpg","epg","dayWidth","isSidebar","isTimeline","isLine","primaryColor","primary","grey","white","green","loader","teal","purple","pink","bg","scrollbar","border","thumb","gradient","blue","timeline","EpgChannelItem","channelItemWidth","epgChannelBox","epgChannel","epgChannelLogo","ProgramItem","compact","formatTime","set12HoursTimeFormat","isMinWidth","useProgram","sinceTime","tillTime","showImage","showLiveTagInImage","epgProgramBox","epgProgram","epgProgramImage","epgLiveTag","epgProgramContent","epgProgramTitle","epgProgramText","EpgTimeline","hourWidth","numberOfHoursInDay","offsetStartHoursRange","dividers","useTimeline","renderDividers","timelineDivider","renderTime","timelineBox","timelineTime","timelineDividers","timelineContainer","Epg","onChannelClick","onProgramClick","getEpgProps","getLayoutProps","onScrollToNow","onScrollLeft","onScrollRight","catchupHoursDict","titlesDict","timelineControl","timelineNowButton","EpgContainer","epgSpinner","Layout","toChannel","programItem","isBefore","EpgProgramItem","PlaylistLiveChannels","channelMediaItem","videoDetails","canWatch","canWatchFromBeginning","durationInSeconds","differenceInSeconds","handleProgramClick","handleChannelClick","end","catchupButton","beginning","epgContainer","playlistScreenMap","PlaylistScreenRouter","PlaylistScreen","Header","headerType","headerClassName","Footer","chunks","chuck","footerContent","footer","testFixMargin","SvgMenu","HeaderMenu","Menu","HeaderNavigation","navItems","nav","navButton","Logo","imgDimensions","updateImgDimensions","onLoadHandler","HeaderBrand","logoSrc","setLogoLoaded","brand","HeaderActions","actions","HeaderSkipLink","skipToContent","SlideLeft","Sidebar","isOpen","sidebar","group","MenuButton","getClassName","menuButton","UserMenuNav","showPaymentItems","onButtonClick","favoritesEnabled","focusable","titleId","sectionHeader","menuItems","SidebarUserActions","canLogin","onLoginClick","onSignUpClick","userMenuTitleId","buttonContainer","SidebarContainer","closeSideBar","signUpButtonClickHandler","SiteMetadata","metaDescription","SvgSearch","SvgCancel","SearchBar","onQueryChange","onClearButtonClick","searchBar","searchForm","clearButton","Cancel","HeaderActionButton","HeaderSearch","searchInputRef","searchEnabled","closeSearchButtonClickHandler","searchButtonClickHandler","searchContainer","CloseIcon","SearchIcon","SvgLanguage","Panel","DetectOutsideClick","elementRef","handleClick","Node","cloneElement","node","Popover","popover","LanguageMenu","currentLanguage","closeLanguageMenu","openLanguageMenu","handleLanguageSelect","handleMenuToggle","Language","menuItemClassname","menuItemActive","HeaderLanguageSwitcher","languageClickHandler","changeLanguage","ProfileCircle","UserMenu","onLoginButtonClick","onSignUpButtonClick","HeaderUserMenu","openUserPanel","closeUserPanel","configFooterText","openSideBar","containerProps","inert","layout","Outlet","useNotifications","navigateToModal","notification","NotificationsTypes","resource","redirect_to_url","RoutesContainer","userData","documentElement","hash","AppRoutes","Hero","hero","heroPadding","parsePlaylistIds","MediaHub","registerCustomScreens","useTrackConfigKeyChange","has","IS_DEMO_OR_PREVIEW","BootstrapError","DemoContentLoader","RootLoader","Root","analyticsLoadedRef","isReady","setIsReady","onReadyCallback","App","i18nState","seti18nState","BrowserRouter","attachAccessibilityListener","isTabbing","define_import_meta_env_default"],"sources":["../../../../../../../../../../../@vite-plugin-pwa/virtual:pwa-register","../../../../../packages/common/src/env.ts","../../../../../packages/common/src/constants.ts","../../../../../packages/common/src/utils/common.ts","../../../../../packages/common/src/modules/container.ts","../../../../../packages/common/src/modules/types.ts","../../../../../packages/common/src/utils/liveEvent.ts","../../../../../packages/common/src/paths.tsx","../../../../../packages/common/src/utils/media.ts","../../../../../packages/common/src/utils/urlFormatting.ts","../../../../../packages/common/src/utils/api.ts","../../../../../packages/common/src/utils/entitlements.ts","../../../../../packages/common/src/stores/utils.ts","../../../../../packages/common/src/stores/ConfigStore.ts","../../../../../packages/common/src/services/ApiService.ts","../../../../../packages/common/src/services/StorageService.ts","../../../../../packages/common/src/services/integrations/AccountService.ts","../../../../../packages/common/src/services/WatchHistoryService.ts","../../../../../packages/common/src/services/GenericEntitlementService.ts","../../../../../packages/common/src/services/JWPEntitlementService.ts","../../../../../packages/common/src/services/FavoriteService.ts","../../../../../packages/common/src/utils/configSchema.ts","../../../../../packages/common/src/utils/error.ts","../../../../../packages/common/src/services/ConfigService.ts","../../../../../packages/common/src/services/SettingsService.ts","../../../../../packages/common/src/stores/AccountStore.ts","../../../../../packages/common/src/stores/WatchHistoryStore.ts","../../../../../packages/common/src/controllers/WatchHistoryController.ts","../../../../../packages/common/src/services/integrations/CheckoutService.ts","../../../../../packages/common/src/services/integrations/SubscriptionService.ts","../../../../../packages/common/src/stores/CheckoutStore.ts","../../../../../packages/common/src/errors/FormValidationError.ts","../../../../../packages/common/src/utils/subscription.ts","../../../../../packages/common/src/controllers/CheckoutController.ts","../../../../../packages/theme/assets/profiles/default_avatar.png","../../../../../packages/common/src/stores/ProfileStore.ts","../../../../../packages/common/src/services/integrations/ProfileService.ts","../../../../../packages/common/src/controllers/ProfileController.ts","../../../../../packages/common/src/stores/FavoritesStore.ts","../../../../../packages/common/src/controllers/FavoritesController.ts","../../../../../packages/common/src/controllers/AccountController.ts","../../../../../packages/common/src/controllers/AppController.ts","../../../../../packages/common/src/services/EpgService.ts","../../../../../packages/common/src/controllers/EpgController.ts","../../../../../packages/common/src/services/epg/ViewNexaEpgService.ts","../../../../../packages/common/src/services/epg/JWEpgService.ts","../../../../../packages/common/src/utils/promiseQueue.ts","../../../../../packages/common/src/services/integrations/cleeng/CleengService.ts","../../../../../packages/common/src/services/integrations/cleeng/formatters/customer.ts","../../../../../packages/common/src/services/integrations/cleeng/formatters/consents.ts","../../../../../packages/common/src/services/integrations/cleeng/CleengAccountService.ts","../../../../../packages/common/src/services/integrations/cleeng/CleengCheckoutService.ts","../../../../../packages/common/src/services/integrations/cleeng/CleengSubscriptionService.ts","../../../../../packages/common/src/utils/collection.ts","../../../../../packages/common/src/services/integrations/jwp/JWPAccountService.ts","../../../../../packages/common/src/utils/formatting.ts","../../../../../packages/common/src/utils/offers.ts","../../../../../packages/common/src/services/integrations/jwp/JWPCheckoutService.ts","../../../../../packages/common/src/services/integrations/jwp/JWPSubscriptionService.ts","../../../../../packages/common/src/services/integrations/jwp/JWPProfileService.ts","../../../../../packages/common/src/modules/functions/getIntegrationType.ts","../../../../../packages/common/src/modules/functions/calculateIntegrationType.ts","../../../../../packages/common/src/modules/register.ts","../../../src/services/LocalStorageService.ts","../../../src/modules/register.ts","../../../../../packages/ui-react/src/containers/QueryProvider/QueryProvider.tsx","../../../../../packages/ui-react/src/components/ErrorPage/ErrorPage.tsx","../../../../../packages/ui-react/src/components/Spinner/Spinner.tsx","../../../../../packages/ui-react/src/components/LoadingOverlay/LoadingOverlay.tsx","../../../../../packages/ui-react/src/components/FormFeedback/FormFeedback.tsx","../../../../../packages/ui-react/src/containers/AnnouncementProvider/AnnoucementProvider.tsx","../../../../../packages/common/src/utils/i18n.ts","../../../src/i18n/resources.ts","../../../src/i18n/config.ts","../../../../../packages/ui-react/src/utils/location.ts","../../../../../packages/hooks-react/src/useEventCallback.ts","../../../../../packages/ui-react/src/hooks/useQueryParam.ts","../../../../../packages/hooks-react/src/useCountdown.ts","../../../../../packages/ui-react/src/components/Button/Button.tsx","../../../../../packages/ui-react/src/components/Welcome/Welcome.tsx","../../../../../packages/ui-react/src/components/PaymentFailed/PaymentFailed.tsx","../../../../../packages/ui-react/src/components/Animation/Animation.tsx","../../../../../packages/ui-react/src/components/Animation/Grow/Grow.tsx","../../../../../packages/ui-react/src/utils/dom.ts","../../../../../packages/ui-react/src/hooks/useModal.ts","../../../../../packages/ui-react/src/components/Modal/Modal.tsx","../../../../../packages/ui-react/src/components/Animation/Slide/Slide.tsx","../../../../../packages/theme/assets/icons/close.svg?react","../../../../../packages/ui-react/src/components/IconButton/IconButton.tsx","../../../../../packages/ui-react/src/components/Icon/Icon.tsx","../../../../../packages/ui-react/src/components/ModalCloseButton/ModalCloseButton.tsx","../../../../../packages/ui-react/src/components/Dialog/Dialog.tsx","../../../../../packages/hooks-react/src/useForm.ts","../../../../../packages/hooks-react/src/useToggle.ts","../../../../../packages/theme/assets/icons/visibility.svg?react","../../../../../packages/theme/assets/icons/visibility_off.svg?react","../../../../../packages/hooks-react/src/useOpaqueId.ts","../../../../../packages/ui-react/src/components/HelperText/HelperText.tsx","../../../../../packages/ui-react/src/components/FormField/FormField.tsx","../../../../../packages/ui-react/src/components/Input/Input.tsx","../../../../../packages/ui-react/src/components/form-fields/TextField/TextField.tsx","../../../../../packages/ui-react/src/components/PasswordStrength/PasswordStrength.tsx","../../../../../packages/ui-react/src/components/form-fields/PasswordField/PasswordField.tsx","../../../../../packages/ui-react/src/components/DeleteAccountModal/DeleteAccountModal.tsx","../../../../../packages/ui-react/src/components/FinalizePayment/FinalizePayment.tsx","../../../../../packages/hooks-react/src/useCheckAccess.ts","../../../../../packages/ui-react/src/components/WaitingForPayment/WaitingForPayment.tsx","../../../../../packages/ui-react/src/components/UpgradeSubscription/UpgradeSubscription.tsx","../../../../../packages/ui-react/src/components/DeleteAccountPasswordWarning/DeleteAccountPasswordWarning.tsx","../../../../../packages/theme/assets/icons/creditcard.svg?react","../../../../../packages/theme/assets/icons/paypal.svg?react","../../../../../packages/ui-react/src/components/PaymentMethodForm/PaymentMethodForm.tsx","../../../../../packages/ui-react/src/components/PayPal/PayPal.tsx","../../../../../packages/ui-react/src/components/Adyen/Adyen.tsx","../../../../../packages/ui-react/src/containers/AdyenPaymentDetails/AdyenPaymentDetails.tsx","../../../../../packages/ui-react/src/containers/UpdatePaymentMethod/UpdatePaymentMethod.tsx","../../../../../packages/ui-react/src/components/EditForm/EditCardDetailsForm.tsx","../../../../../packages/ui-react/src/components/form-fields/CreditCardCVCField/CreditCardCVCField.tsx","../../../../../packages/ui-react/src/components/form-fields/CreditCardExpiryField/CreditCardExpiryField.tsx","../../../../../packages/ui-react/src/components/form-fields/CreditCardNumberField/CreditCardNumberField.tsx","../../../../../packages/ui-react/src/components/EditCardPaymentForm/EditCardPaymentForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/EditCardDetails.tsx","../../../../../packages/ui-react/src/components/EditPasswordForm/EditPasswordForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/EditPassword.tsx","../../../../../packages/ui-react/src/components/RenewSubscriptionForm/RenewSubscriptionForm.tsx","../../../../../packages/ui-react/src/components/SubscriptionRenewed/SubscriptionRenewed.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/RenewSubscription.tsx","../../../../../packages/ui-react/src/components/CancelSubscriptionForm/CancelSubscriptionForm.tsx","../../../../../packages/ui-react/src/components/SubscriptionCancelled/SubscriptionCancelled.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/CancelSubscription.tsx","../../../../../packages/ui-react/src/components/ResetPasswordForm/ResetPasswordForm.tsx","../../../../../packages/ui-react/src/components/ForgotPasswordForm/ForgotPasswordForm.tsx","../../../../../packages/ui-react/src/components/ConfirmationForm/ConfirmationForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/ResetPassword.tsx","../../../../../packages/hooks-react/src/useCheckout.ts","../../../../../packages/theme/assets/icons/arrow_left.svg?react","../../../../../packages/ui-react/src/components/DialogBackButton/DialogBackButton.tsx","../../../../../packages/ui-react/src/components/CheckoutForm/CheckoutForm.tsx","../../../../../packages/ui-react/src/components/NoPaymentRequired/NoPaymentRequired.tsx","../../../../../packages/ui-react/src/components/PaymentForm/PaymentForm.tsx","../../../../../packages/ui-react/src/containers/AdyenInitialPayment/AdyenInitialPayment.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/Checkout.tsx","../../../../../packages/hooks-react/src/useOffers.ts","../../../../../packages/theme/assets/icons/check_circle.svg?react","../../../../../packages/ui-react/src/components/ChooseOfferForm/ChooseOfferForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/ChooseOffer.tsx","../../../../../packages/ui-react/src/components/Select/Select.tsx","../../../../../packages/ui-react/src/components/form-fields/Dropdown/Dropdown.tsx","../../../../../packages/ui-react/src/components/form-fields/Checkbox/Checkbox.tsx","../../../../../packages/ui-react/src/components/form-fields/Radio/Radio.tsx","../../../../../packages/ui-react/src/components/form-fields/DateField/DateField.tsx","../../../../../packages/ui-react/src/components/PersonalDetailsForm/PersonalDetailsForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/PersonalDetails.tsx","../../../../../packages/hooks-react/src/useSocialLoginUrls.ts","../../../../../packages/ui-react/src/components/CustomRegisterField/CustomRegisterField.tsx","../../../../../packages/ui-react/src/components/Link/Link.tsx","../../../../../packages/ui-react/src/components/RegistrationForm/RegistrationForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/Registration.tsx","../../../../../packages/ui-react/src/components/LoginForm/LoginForm.tsx","../../../../../packages/ui-react/src/containers/AccountModal/forms/Login.tsx","../../../../../packages/ui-react/src/containers/AccountModal/AccountModal.tsx","../../../../../packages/testing/constants.ts","../../../../../packages/ui-react/src/components/DevConfigSelector/DevConfigSelector.tsx","../../../../../packages/hooks-react/src/useBootstrapApp.ts","../../../../../packages/ui-react/src/utils/theming.ts","../../../../../packages/ui-react/src/components/ConfirmationDialog/ConfirmationDialog.tsx","../../../../../packages/ui-react/src/components/RootErrorPage/RootErrorPage.tsx","../../../../../packages/ui-react/src/components/MarkdownComponent/MarkdownComponent.tsx","../../../../../packages/ui-react/src/pages/About/About.tsx","../../../../../packages/hooks-react/src/usePlaylists.ts","../../../../../packages/theme/assets/icons/chevron_left.svg?react","../../../../../packages/theme/assets/icons/chevron_right.svg?react","../../../../../packages/ui-react/src/utils/matchMedia.ts","../../../../../packages/ui-react/src/hooks/useBreakpoint.ts","../../../../../packages/ui-react/src/components/TileDock/TileDock.tsx","../../../../../packages/theme/assets/icons/lock.svg?react","../../../../../packages/theme/assets/icons/today.svg?react","../../../../../packages/ui-react/src/components/Image/Image.tsx","../../../../../packages/ui-react/src/components/Card/Card.tsx","../../../../../packages/ui-react/src/components/Shelf/Shelf.tsx","../../../../../packages/ui-react/src/components/InfiniteScrollLoader/InfiniteScrollLoader.tsx","../../../../../packages/ui-react/src/containers/ShelfList/ShelfList.tsx","../../../../../packages/ui-react/src/pages/Home/Home.tsx","../../../../../packages/common/src/stores/UIStore.ts","../../../../../packages/hooks-react/src/useFirstRender.ts","../../../../../packages/hooks-react/src/useDebounce.ts","../../../../../packages/ui-react/src/hooks/useSearchQueryUpdater.ts","../../../../../packages/hooks-react/src/usePlaylist.ts","../../../../../packages/hooks-react/src/useSearch.ts","../../../../../packages/ui-react/src/components/LayoutGrid/LayoutGrid.tsx","../../../../../packages/ui-react/src/components/CardGrid/CardGrid.tsx","../../../../../packages/ui-react/src/pages/Search/Search.tsx","../../../../../packages/hooks-react/src/useProfiles.ts","../../../../../packages/theme/assets/icons/account_circle.svg?react","../../../../../packages/theme/assets/icons/balance_wallet.svg?react","../../../../../packages/theme/assets/icons/exit.svg?react","../../../../../packages/theme/assets/icons/favorite.svg?react","../../../../../packages/ui-react/src/components/Alert/Alert.tsx","../../../../../packages/ui-react/src/components/Form/FormSection.tsx","../../../../../packages/ui-react/src/components/Form/Form.tsx","../../../../../packages/ui-react/src/components/Account/Account.tsx","../../../../../packages/ui-react/src/components/Favorites/Favorites.tsx","../../../../../packages/hooks-react/src/useSubscriptionChange.ts","../../../../../packages/theme/assets/icons/external_link.svg?react","../../../../../packages/ui-react/src/components/OfferSwitch/OfferSwitch.tsx","../../../../../packages/ui-react/src/components/Payment/Payment.tsx","../../../../../packages/ui-react/src/containers/PaymentContainer/PaymentContainer.tsx","../../../../../packages/ui-react/src/containers/Profiles/DeleteProfile.tsx","../../../../../packages/theme/assets/icons/edit.svg?react","../../../../../packages/theme/assets/icons/check.svg?react","../../../../../packages/ui-react/src/components/ProfileBox/ProfileBox.tsx","../../../../../packages/ui-react/src/containers/Profiles/Form.tsx","../../../../../packages/ui-react/src/containers/Profiles/EditProfile.tsx","../../../../../packages/ui-react/src/pages/User/User.tsx","../../../../../packages/common/src/utils/metadata.ts","../../../../../packages/hooks-react/src/useEntitlement.ts","../../../../../packages/hooks-react/src/useMedia.ts","../../../../../packages/theme/assets/icons/play_trailer.svg?react","../../../../../packages/ui-react/src/components/Filter/Filter.tsx","../../../../../packages/ui-react/src/components/TruncatedText/TruncatedText.tsx","../../../../../packages/ui-react/src/components/CollapsibleText/CollapsibleText.tsx","../../../../../packages/ui-react/src/components/VideoDetails/VideoDetails.tsx","../../../../../packages/ui-react/src/components/VideoDetailsInline/VideoDetailsInline.tsx","../../../../../packages/ui-react/src/components/VideoListItem/VideoListItem.tsx","../../../../../packages/ui-react/src/components/VideoList/VideoList.tsx","../../../../../packages/ui-react/src/components/VideoLayout/VideoLayout.tsx","../../../../../packages/ui-react/src/components/Animation/Fade/Fade.tsx","../../../../../packages/hooks-react/src/useWatchHistoryListener.ts","../../../../../packages/hooks-react/src/useWatchHistory.ts","../../../../../packages/hooks-react/src/usePlaylistItemCallback.ts","../../../../../packages/hooks-react/src/useAds.ts","../../../../../packages/hooks-react/src/useContentProtection.ts","../../../../../packages/hooks-react/src/useProtectedMedia.ts","../../../../../packages/hooks-react/src/useOttAnalytics.ts","../../../../../packages/common/src/utils/analytics.ts","../../../../../packages/ui-react/src/components/Player/Player.tsx","../../../../../packages/ui-react/src/components/PlayerError/PlayerError.tsx","../../../../../packages/ui-react/src/containers/PlayerContainer/PlayerContainer.tsx","../../../../../packages/ui-react/src/containers/InlinePlayer/InlinePlayer.tsx","../../../../../packages/theme/assets/icons/play.svg?react","../../../../../packages/ui-react/src/containers/StartWatchingButton/StartWatchingButton.tsx","../../../../../packages/ui-react/src/containers/Cinema/Cinema.tsx","../../../../../packages/ui-react/src/containers/TrailerModal/TrailerModal.tsx","../../../../../packages/theme/assets/icons/share.svg?react","../../../../../packages/ui-react/src/utils/clipboard.ts","../../../../../packages/ui-react/src/components/ShareButton/ShareButton.tsx","../../../../../packages/theme/assets/icons/favorite_border.svg?react","../../../../../packages/ui-react/src/containers/FavoriteButton/FavoriteButton.tsx","../../../../../packages/ui-react/src/pages/Loading/Loading.tsx","../../../../../packages/ui-react/src/components/VideoMetaData/VideoMetaData.tsx","../../../../../packages/common/src/utils/datetime.ts","../../../../../packages/ui-react/src/pages/LegacySeries/utils.ts","../../../../../packages/ui-react/src/pages/LegacySeries/LegacySeries.tsx","../../../../../packages/common/src/utils/ScreenMap.ts","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaStaticPage/MediaStaticPage.tsx","../../../../../packages/common/src/utils/structuredData.ts","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaMovie/MediaMovie.tsx","../../../../../packages/common/src/utils/series.ts","../../../../../packages/hooks-react/src/series/useSeries.ts","../../../../../packages/hooks-react/src/series/useEpisodes.ts","../../../../../packages/hooks-react/src/series/useSeriesLookup.ts","../../../../../packages/hooks-react/src/series/useNextEpisode.ts","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaSeries/MediaSeries.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaLiveChannel/MediaLiveChannel.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaEpisode/MediaEpisode.tsx","../../../../../packages/hooks-react/src/useLiveEvent.ts","../../../../../packages/ui-react/src/components/Tag/Tag.tsx","../../../../../packages/ui-react/src/components/StatusIcon/StatusIcon.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaEvent/MediaEvent.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/MediaScreenRouter.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/playlistScreens/PlaylistGrid/PlaylistGrid.tsx","../../../../../packages/common/src/utils/epg.ts","../../../../../packages/hooks-react/src/useLiveChannels.ts","../../../../../packages/hooks-react/src/useLiveProgram.ts","../../../../../packages/hooks-react/src/usePlanByEpg.ts","../../../../../packages/ui-react/src/components/EpgChannel/EpgChannelItem.tsx","../../../../../packages/ui-react/src/components/EpgProgramItem/EpgProgramItem.tsx","../../../../../packages/ui-react/src/components/EpgTimeline/EpgTimeline.tsx","../../../../../packages/ui-react/src/components/Epg/Epg.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/playlistScreens/PlaylistLiveChannels/PlaylistLiveChannels.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/PlaylistScreenRouter.tsx","../../../../../packages/ui-react/src/components/Header/Header.tsx","../../../../../packages/ui-react/src/components/Footer/Footer.tsx","../../../../../packages/theme/assets/icons/menu.svg?react","../../../../../packages/ui-react/src/components/Header/HeaderMenu.tsx","../../../../../packages/ui-react/src/components/Header/HeaderNavigation.tsx","../../../../../packages/ui-react/src/components/Logo/Logo.tsx","../../../../../packages/ui-react/src/components/Header/HeaderBrand.tsx","../../../../../packages/ui-react/src/components/Header/HeaderActions.tsx","../../../../../packages/ui-react/src/components/Header/HeaderSkipLink.tsx","../../../../../packages/ui-react/src/components/Sidebar/Sidebar.tsx","../../../../../packages/ui-react/src/components/MenuButton/MenuButton.tsx","../../../../../packages/ui-react/src/components/UserMenuNav/UserMenuNav.tsx","../../../../../packages/ui-react/src/containers/SidebarContainer/SidebarContainer.tsx","../../../../../packages/ui-react/src/containers/SiteMetadata/SiteMetadata.tsx","../../../../../packages/theme/assets/icons/search.svg?react","../../../../../packages/theme/assets/icons/cancel.svg?react","../../../../../packages/ui-react/src/components/SearchBar/SearchBar.tsx","../../../../../packages/ui-react/src/components/Header/HeaderActionButton.tsx","../../../../../packages/ui-react/src/containers/HeaderSearch/HeaderSearch.tsx","../../../../../packages/theme/assets/icons/language.svg?react","../../../../../packages/ui-react/src/components/Panel/Panel.tsx","../../../../../packages/ui-react/src/components/DetectOutsideClick/DetectOutsideClick.tsx","../../../../../packages/ui-react/src/components/Popover/Popover.tsx","../../../../../packages/ui-react/src/components/LanguageMenu/LanguageMenu.tsx","../../../../../packages/ui-react/src/containers/HeaderLanguageSwitcher/HeaderLanguageSwitcher.tsx","../../../../../packages/ui-react/src/components/ProfileCircle/ProfileCircle.tsx","../../../../../packages/ui-react/src/components/UserMenu/UserMenu.tsx","../../../../../packages/ui-react/src/containers/HeaderUserMenu/HeaderUserMenu.tsx","../../../../../packages/ui-react/src/containers/Layout/Layout.tsx","../../../src/hooks/useNotifications.ts","../../../src/containers/RoutesContainer/RoutesContainer.tsx","../../../src/containers/AppRoutes/AppRoutes.tsx","../../../../../packages/ui-react/src/components/Hero/Hero.tsx","../../../../../packages/ui-react/src/pages/ScreenRouting/mediaScreens/MediaHub/MediaHub.tsx","../../../src/screenMapping.ts","../../../src/hooks/useTrackConfigKeyChange.ts","../../../src/containers/Root/Root.tsx","../../../src/App.tsx","../../../src/utils/accessibility.ts","../../../src/index.tsx"],"sourcesContent":["// src/client/build/register.ts\nvar autoUpdateMode = \"true\";\nvar selfDestroying = \"false\";\nvar auto = autoUpdateMode === \"true\";\nvar autoDestroy = selfDestroying === \"true\";\nfunction registerSW(options = {}) {\n  const {\n    immediate = false,\n    onNeedRefresh,\n    onOfflineReady,\n    onRegistered,\n    onRegisteredSW,\n    onRegisterError\n  } = options;\n  let wb;\n  let registerPromise;\n  let sendSkipWaitingMessage;\n  const updateServiceWorker = async (_reloadPage = true) => {\n    await registerPromise;\n    if (!auto) {\n      await sendSkipWaitingMessage?.();\n    }\n  };\n  async function register() {\n    if (\"serviceWorker\" in navigator) {\n      wb = await import(\"workbox-window\").then(({ Workbox }) => {\n        return new Workbox(\"/sw.js\", { scope: \"/\", type: \"classic\" });\n      }).catch((e) => {\n        onRegisterError?.(e);\n        return void 0;\n      });\n      if (!wb)\n        return;\n      sendSkipWaitingMessage = async () => {\n        await wb?.messageSkipWaiting();\n      };\n      if (!autoDestroy) {\n        if (auto) {\n          wb.addEventListener(\"activated\", (event) => {\n            if (event.isUpdate || event.isExternal)\n              window.location.reload();\n          });\n          wb.addEventListener(\"installed\", (event) => {\n            if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n        } else {\n          let onNeedRefreshCalled = false;\n          const showSkipWaitingPrompt = () => {\n            onNeedRefreshCalled = true;\n            wb?.addEventListener(\"controlling\", (event) => {\n              if (event.isUpdate)\n                window.location.reload();\n            });\n            onNeedRefresh?.();\n          };\n          wb.addEventListener(\"installed\", (event) => {\n            if (typeof event.isUpdate === \"undefined\") {\n              if (typeof event.isExternal !== \"undefined\") {\n                if (event.isExternal)\n                  showSkipWaitingPrompt();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              } else {\n                if (event.isExternal)\n                  window.location.reload();\n                else\n                  !onNeedRefreshCalled && onOfflineReady?.();\n              }\n            } else if (!event.isUpdate) {\n              onOfflineReady?.();\n            }\n          });\n          wb.addEventListener(\"waiting\", showSkipWaitingPrompt);\n          wb.addEventListener(\"externalwaiting\", showSkipWaitingPrompt);\n        }\n      }\n      wb.register({ immediate }).then((r) => {\n        if (onRegisteredSW)\n          onRegisteredSW(\"/sw.js\", r);\n        else\n          onRegistered?.(r);\n      }).catch((e) => {\n        onRegisterError?.(e);\n      });\n    }\n  }\n  registerPromise = register();\n  return updateServiceWorker;\n}\nexport {\n  registerSW\n};\n","export type Env = {\r\n  APP_VERSION: string;\r\n  APP_API_BASE_URL: string;\r\n  APP_PLAYER_ID: string;\r\n  APP_FOOTER_TEXT: string;\r\n  APP_DEFAULT_LANGUAGE: string;\r\n\r\n  APP_DEFAULT_CONFIG_SOURCE?: string;\r\n  APP_PLAYER_LICENSE_KEY?: string;\r\n\r\n  APP_BODY_FONT?: string;\r\n  APP_BODY_ALT_FONT?: string;\r\n};\r\n\r\nconst env: Env = {\r\n  APP_VERSION: '',\r\n  APP_API_BASE_URL: 'https://cdn.jwplayer.com',\r\n  APP_PLAYER_ID: 'M4qoGvUk',\r\n  APP_FOOTER_TEXT: '',\r\n  APP_DEFAULT_LANGUAGE: 'en',\r\n};\r\n\r\nexport const configureEnv = (options: Partial<Env>) => {\r\n  env.APP_VERSION = options.APP_VERSION || env.APP_VERSION;\r\n  env.APP_API_BASE_URL = options.APP_API_BASE_URL || env.APP_API_BASE_URL;\r\n  env.APP_PLAYER_ID = options.APP_PLAYER_ID || env.APP_PLAYER_ID;\r\n  env.APP_FOOTER_TEXT = options.APP_FOOTER_TEXT || env.APP_FOOTER_TEXT;\r\n  env.APP_DEFAULT_LANGUAGE = options.APP_DEFAULT_LANGUAGE || env.APP_DEFAULT_LANGUAGE;\r\n\r\n  env.APP_DEFAULT_CONFIG_SOURCE ||= options.APP_DEFAULT_CONFIG_SOURCE;\r\n  env.APP_PLAYER_LICENSE_KEY ||= options.APP_PLAYER_LICENSE_KEY;\r\n\r\n  env.APP_BODY_FONT = options.APP_BODY_FONT || env.APP_BODY_FONT;\r\n  env.APP_BODY_ALT_FONT = options.APP_BODY_ALT_FONT || env.APP_BODY_ALT_FONT;\r\n};\r\n\r\nexport default env;\r\n","export enum PersonalShelf {\r\n  ContinueWatching = 'continue_watching',\r\n  Favorites = 'favorites',\r\n}\r\n\r\nexport const PersonalShelves = [PersonalShelf.Favorites, PersonalShelf.ContinueWatching];\r\n\r\nexport const INTEGRATION = {\r\n  JWP: 'JWP',\r\n  CLEENG: 'CLEENG',\r\n} as const;\r\n\r\nexport const ACCESS_MODEL = {\r\n  AVOD: 'AVOD',\r\n  AUTHVOD: 'AUTHVOD',\r\n  SVOD: 'SVOD',\r\n} as const;\r\n\r\nexport const VideoProgressMinMax = {\r\n  Min: 0.05,\r\n  Max: 0.95,\r\n};\r\n\r\nexport const PLAYLIST_LIMIT = 25;\r\n\r\nexport const ADYEN_TEST_CLIENT_KEY = 'test_I4OFGUUCEVB5TI222AS3N2Y2LY6PJM3K';\r\n\r\nexport const ADYEN_LIVE_CLIENT_KEY = 'live_BQDOFBYTGZB3XKF62GBYSLPUJ4YW2TPL';\r\n\r\n// how often the live channel schedule is refetched in ms\r\nexport const LIVE_CHANNELS_REFETCH_INTERVAL = 15 * 60_000;\r\n\r\n// Some predefined types of JW\r\nexport const CONTENT_TYPE = {\r\n  // Series page with seasons / episodes\r\n  series: 'series',\r\n  // Separate episode page\r\n  episode: 'episode',\r\n  // Page with a list of live channels\r\n  live: 'live',\r\n  // Live channel (24x7)\r\n  liveChannel: 'livechannel',\r\n  // Temporary live stream that starts at a specific time\r\n  liveEvent: 'liveevent',\r\n  // Static page with markdown\r\n  page: 'page',\r\n  // Page with shelves list\r\n  hub: 'hub',\r\n} as const;\r\n\r\n// OTT shared player\r\nexport const OTT_GLOBAL_PLAYER_ID = 'M4qoGvUk';\r\n\r\nexport const CONFIG_QUERY_KEY = 'app-config';\r\n\r\nexport const CONFIG_FILE_STORAGE_KEY = 'config-file-override';\r\n\r\nexport const CACHE_TIME = 60 * 1000 * 20; // 20 minutes\r\n\r\nexport const STALE_TIME = 60 * 1000 * 20;\r\n\r\nexport const CARD_ASPECT_RATIOS = ['1:1', '2:1', '2:3', '4:3', '5:3', '16:9', '9:13', '9:16'] as const;\r\n\r\nexport const MAX_WATCHLIST_ITEMS_COUNT = 48; // Default value\r\n\r\nexport const DEFAULT_FEATURES = {\r\n  canUpdateEmail: false,\r\n  canSupportEmptyFullName: false,\r\n  canChangePasswordWithOldPassword: false,\r\n  canRenewSubscription: false,\r\n  canExportAccountData: false,\r\n  canDeleteAccount: false,\r\n  canUpdatePaymentMethod: false,\r\n  canShowReceipts: false,\r\n  hasSocialURLs: false,\r\n  hasNotifications: false,\r\n  watchListSizeLimit: MAX_WATCHLIST_ITEMS_COUNT,\r\n};\r\n\r\nexport const EPG_TYPE = {\r\n  jwp: 'jwp',\r\n  viewNexa: 'viewnexa',\r\n} as const;\r\n","import type { Playlist, PlaylistItem } from '../../types/playlist';\r\n\r\nexport function debounce<T extends (...args: any[]) => void>(callback: T, wait = 200) {\r\n  let timeout: NodeJS.Timeout | null;\r\n  return (...args: unknown[]) => {\r\n    if (timeout) clearTimeout(timeout);\r\n    timeout = setTimeout(() => callback(...args), wait);\r\n  };\r\n}\r\nexport function throttle<T extends (...args: any[]) => unknown>(func: T, limit: number): (...args: Parameters<T>) => void {\r\n  let lastFunc: NodeJS.Timeout | undefined;\r\n  let lastRan: number | undefined;\r\n\r\n  return function (this: ThisParameterType<T>, ...args: Parameters<T>): void {\r\n    const timeSinceLastRan = lastRan ? Date.now() - lastRan : limit;\r\n\r\n    if (timeSinceLastRan >= limit) {\r\n      func.apply(this, args);\r\n      lastRan = Date.now();\r\n    } else if (!lastFunc) {\r\n      lastFunc = setTimeout(() => {\r\n        if (lastRan) {\r\n          const timeSinceLastRan = Date.now() - lastRan;\r\n          if (timeSinceLastRan >= limit) {\r\n            func.apply(this, args);\r\n            lastRan = Date.now();\r\n          }\r\n        }\r\n        lastFunc = undefined;\r\n      }, limit - timeSinceLastRan);\r\n    }\r\n  };\r\n}\r\n\r\nexport const unicodeToChar = (text: string) => {\r\n  return text.replace(/\\\\u[\\dA-F]{4}/gi, (match) => {\r\n    return String.fromCharCode(parseInt(match.replace(/\\\\u/g, ''), 16));\r\n  });\r\n};\r\n\r\n/**\r\n * Parse hex color and return the RGB colors\r\n * @param color\r\n * @return {{r: number, b: number, g: number}|undefined}\r\n */\r\nexport function hexToRgb(color: string) {\r\n  if (color.indexOf('#') === 0) {\r\n    color = color.slice(1);\r\n  }\r\n\r\n  // convert 3-digit hex to 6-digits.\r\n  if (color.length === 3) {\r\n    color = color[0] + color[0] + color[1] + color[1] + color[2] + color[2];\r\n  }\r\n\r\n  if (color.length !== 6) {\r\n    return undefined;\r\n  }\r\n\r\n  return {\r\n    r: parseInt(color.slice(0, 2), 16),\r\n    g: parseInt(color.slice(2, 4), 16),\r\n    b: parseInt(color.slice(4, 6), 16),\r\n  };\r\n}\r\n\r\n/**\r\n * Get the contrast color based on the given color\r\n * @param {string} color Hex or RGBA color string\r\n * @link {https://stackoverflow.com/a/35970186/1790728}\r\n * @return {string}\r\n */\r\nexport function calculateContrastColor(color: string) {\r\n  const rgb = hexToRgb(color);\r\n\r\n  if (!rgb) {\r\n    return '';\r\n  }\r\n\r\n  // http://stackoverflow.com/a/3943023/112731\r\n  return rgb.r * 0.299 + rgb.g * 0.587 + rgb.b * 0.114 > 186 ? '#000000' : '#FFFFFF';\r\n}\r\n\r\n// Build is either Development or Production\r\n// Mode can be dev, jwdev, demo, test, prod, etc.\r\nexport const IS_DEVELOPMENT_BUILD = __dev__;\r\n// Demo mode is used to run our firebase demo instance\r\nexport const IS_DEMO_MODE = __mode__ === 'demo';\r\n// Test mode is used for e2e and unit tests\r\nexport const IS_TEST_MODE = __mode__ === 'test';\r\n\r\n// Preview mode is used for previewing Pull Requests on GitHub\r\nexport const IS_PREVIEW_MODE = __mode__ === 'preview';\r\n// Production mode\r\nexport const IS_PROD_MODE = __mode__ === 'prod';\r\n\r\nexport function logDev(message: unknown, ...optionalParams: unknown[]) {\r\n  if ((IS_DEVELOPMENT_BUILD || IS_PREVIEW_MODE) && !IS_TEST_MODE) {\r\n    if (optionalParams.length > 0) {\r\n      console.info(message, optionalParams);\r\n    } else {\r\n      console.info(message);\r\n    }\r\n  }\r\n}\r\n\r\nexport const isContentType = (item: PlaylistItem | Playlist, contentType: string) => item.contentType?.toLowerCase() === contentType.toLowerCase();\r\n\r\nexport const isTruthyCustomParamValue = (value: unknown): boolean => ['true', '1', 'yes', 'on'].includes(String(value)?.toLowerCase());\r\n\r\nexport const isFalsyCustomParamValue = (value: unknown): boolean => ['false', '0', 'no', 'off'].includes(String(value)?.toLowerCase());\r\n\r\nexport function testId(value: string | undefined) {\r\n  return IS_DEVELOPMENT_BUILD || IS_TEST_MODE || IS_PREVIEW_MODE ? value : undefined;\r\n}\r\n\r\ntype Truthy<T> = T extends false | '' | 0 | null | undefined ? never : T;\r\nexport const isTruthy = <T>(value: T | true): value is Truthy<T> => Boolean(value);\r\n","import { Container, injectable, type interfaces, inject } from 'inversify';\r\n\r\nimport { logDev } from '../utils/common';\r\n\r\nexport const container = new Container({ defaultScope: 'Singleton', skipBaseClassChecks: true });\r\n\r\nexport { injectable, inject };\r\n\r\nexport function getModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, required: false): T | undefined;\r\nexport function getModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, required: true): T;\r\nexport function getModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>): T;\r\nexport function getModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, required = true): T | undefined {\r\n  const module = container.getAll(constructorFunction)[0];\r\n\r\n  if (required && !module) throw new Error(`Service / Controller '${String(constructorFunction)}' not found`);\r\n\r\n  return module;\r\n}\r\n\r\nexport function getNamedModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, name: string | null, required: false): T | undefined;\r\nexport function getNamedModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, name: string | null, required: true): T;\r\nexport function getNamedModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, name: string | null): T;\r\nexport function getNamedModule<T>(constructorFunction: interfaces.ServiceIdentifier<T>, name: string | null, required = true): T | undefined {\r\n  if (!name) {\r\n    return;\r\n  }\r\n\r\n  let module;\r\n\r\n  try {\r\n    module = container.getAllNamed(constructorFunction, name)[0];\r\n\r\n    return module;\r\n  } catch (err: unknown) {\r\n    if (err instanceof Error && err.message.includes('No matching bindings found')) {\r\n      if (required) {\r\n        throw new Error(`Service not found '${String(constructorFunction)}' with name '${name}'`);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    logDev('Error caught while initializing service', err);\r\n  }\r\n}\r\n\r\nexport function assertModuleMethod<T>(method: T, message: string): asserts method is NonNullable<T> {\r\n  if (!method) throw new Error(message);\r\n}\r\n\r\nexport function assertFeature(isEnabled: boolean, featureName: string): asserts isEnabled is true {\r\n  if (!isEnabled) throw new Error(`${featureName} feature is not enabled`);\r\n}\r\n","export const INTEGRATION_TYPE = Symbol('INTEGRATION_TYPE');\r\n\r\nexport const DETERMINE_INTEGRATION_TYPE = Symbol('DETERMINE_INTEGRATION_TYPE');\r\n\r\nexport const GET_CUSTOMER_IP = Symbol('GET_CUSTOMER_IP');\r\n","import type { PlaylistItem } from '../../types/playlist';\r\nimport { CONTENT_TYPE } from '../constants';\r\n\r\nimport { isContentType } from './common';\r\n\r\nexport enum EventState {\r\n  PRE_LIVE = 'PRE_LIVE',\r\n  LIVE_UNPUBLISHED = 'LIVE_UNPUBLISHED',\r\n  LIVE_PUBLISHED = 'LIVE_PUBLISHED',\r\n  INSTANT_VOD = 'INSTANT_VOD',\r\n  VOD_PUBLIC = 'VOD_PUBLIC',\r\n}\r\n\r\nexport const enum MediaStatus {\r\n  LIVE = 'LIVE',\r\n  VOD = 'VOD',\r\n  SCHEDULED = 'SCHEDULED',\r\n}\r\n\r\nexport const isLiveEvent = (playlistItem?: PlaylistItem) => {\r\n  return !!playlistItem && isContentType(playlistItem, CONTENT_TYPE.liveEvent);\r\n};\r\n\r\nexport const isScheduledOrLiveMedia = (playlistItem: PlaylistItem) => {\r\n  return playlistItem.mediaStatus === MediaStatus.SCHEDULED || playlistItem.mediaStatus === MediaStatus.LIVE;\r\n};\r\n\r\nexport const getMediaStatusFromEventState = (playlistItem: PlaylistItem) => {\r\n  const eventState = playlistItem['VCH.EventState'];\r\n  const { scheduledStart, scheduledEnd } = playlistItem;\r\n\r\n  const now = new Date();\r\n  const started = eventState === EventState.LIVE_PUBLISHED || (scheduledStart && scheduledStart < now);\r\n  const live = started && scheduledEnd && scheduledEnd > now;\r\n\r\n  if (live) {\r\n    return MediaStatus.LIVE;\r\n  }\r\n\r\n  if (!eventState) {\r\n    return MediaStatus.VOD;\r\n  }\r\n\r\n  switch (eventState) {\r\n    case EventState.PRE_LIVE:\r\n    case EventState.LIVE_UNPUBLISHED:\r\n      return MediaStatus.SCHEDULED;\r\n    case EventState.LIVE_PUBLISHED:\r\n      return MediaStatus.LIVE;\r\n    case EventState.INSTANT_VOD:\r\n    case EventState.VOD_PUBLIC:\r\n      return MediaStatus.VOD;\r\n  }\r\n};\r\n\r\nexport const isPlayable = (playlistItem: PlaylistItem) => {\r\n  return playlistItem.mediaStatus === MediaStatus.LIVE || playlistItem.mediaStatus === MediaStatus.VOD;\r\n};\r\n","export const PATH_HOME = '/';\r\n\r\nexport const PATH_MEDIA = '/m/:id/*';\r\nexport const PATH_PLAYLIST = '/p/:id/*';\r\nexport const PATH_LEGACY_SERIES = '/s/:id/*';\r\n\r\nexport const PATH_SEARCH = '/q/*';\r\nexport const PATH_ABOUT = '/o/about';\r\n\r\nexport const PATH_USER_BASE = '/u';\r\nexport const PATH_USER = `${PATH_USER_BASE}/*`;\r\n\r\nexport const RELATIVE_PATH_USER_ACCOUNT = 'my-account';\r\nexport const RELATIVE_PATH_USER_MY_PROFILE = 'my-profile/:id';\r\nexport const RELATIVE_PATH_USER_FAVORITES = 'favorites';\r\nexport const RELATIVE_PATH_USER_PAYMENTS = 'payments';\r\nexport const RELATIVE_PATH_USER_PROFILES = 'profiles';\r\n\r\nexport const PATH_USER_ACCOUNT = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_ACCOUNT}`;\r\nexport const PATH_USER_MY_PROFILE = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_MY_PROFILE}`;\r\nexport const PATH_USER_FAVORITES = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_FAVORITES}`;\r\nexport const PATH_USER_PAYMENTS = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_PAYMENTS}`;\r\nexport const PATH_USER_PROFILES = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_PROFILES}`;\r\nexport const PATH_USER_PROFILES_CREATE = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_PROFILES}/create`;\r\nexport const PATH_USER_PROFILES_EDIT = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_PROFILES}/edit`;\r\nexport const PATH_USER_PROFILES_EDIT_PROFILE = `${PATH_USER_BASE}/${RELATIVE_PATH_USER_PROFILES}/edit/:id`;\r\n","import type { PlaylistItem } from '../../types/playlist';\r\nimport { CONTENT_TYPE } from '../constants';\r\n\r\nimport { isContentType } from './common';\r\n\r\ntype RequiredProperties<T, P extends keyof T> = T & Required<Pick<T, P>>;\r\n\r\ntype DeprecatedPlaylistItem = {\r\n  seriesPlayListId?: string;\r\n  seriesPlaylistId?: string;\r\n};\r\n\r\n// For the deprecated series flow we store seriesId in custom params\r\nexport const getSeriesPlaylistIdFromCustomParams = (item: (PlaylistItem & DeprecatedPlaylistItem) | undefined) =>\r\n  item ? item.seriesPlayListId || item.seriesPlaylistId || item.seriesId : undefined;\r\n\r\n// For the deprecated flow we store seriesId in the media custom params\r\nexport const isLegacySeriesFlow = (item: PlaylistItem) => {\r\n  return typeof getSeriesPlaylistIdFromCustomParams(item) !== 'undefined';\r\n};\r\n\r\n// For the new series flow we use contentType custom param to define media item to be series\r\n// In this case media item and series item have the same id\r\nexport const isSeriesContentType = (item: PlaylistItem) => isContentType(item, CONTENT_TYPE.series);\r\n\r\nexport const isSeries = (item: PlaylistItem) => isLegacySeriesFlow(item) || isSeriesContentType(item);\r\n\r\nexport const isEpisode = (item: PlaylistItem) => {\r\n  return typeof item?.episodeNumber !== 'undefined' || isContentType(item, CONTENT_TYPE.episode);\r\n};\r\n\r\nexport const getLegacySeriesPlaylistIdFromEpisodeTags = (item: PlaylistItem | undefined) => {\r\n  if (!item || !isEpisode(item)) {\r\n    return;\r\n  }\r\n\r\n  const tags = item.tags ? item.tags.split(',') : [];\r\n  const seriesIdTag = tags.find(function (tag) {\r\n    return /seriesid_([\\w\\d]+)/i.test(tag);\r\n  });\r\n\r\n  if (seriesIdTag) {\r\n    return seriesIdTag.split('_')[1];\r\n  }\r\n\r\n  return;\r\n};\r\n\r\nexport const isLiveChannel = (item: PlaylistItem): item is RequiredProperties<PlaylistItem, 'contentType'> => isContentType(item, CONTENT_TYPE.liveChannel);\r\n","import type { PlaylistItem } from '../../types/playlist';\r\nimport { RELATIVE_PATH_USER_MY_PROFILE, PATH_MEDIA, PATH_PLAYLIST, PATH_USER_MY_PROFILE } from '../paths';\r\n\r\nimport { getLegacySeriesPlaylistIdFromEpisodeTags, getSeriesPlaylistIdFromCustomParams } from './media';\r\n\r\nexport type QueryParamsArg = { [key: string]: string | number | string[] | undefined | null };\r\n\r\n/**\r\n * Creates a new URL from an url string (preserving the search params) and an object to add and remove query params\r\n *\r\n * @example\r\n * createURL('/m/123456?play=1', { foo: 'bar' }) === '/m/123456?play=6&foo=bar'\r\n * createURL('/m/123456?play=1', { play: null }) === '/m/123456'\r\n *\r\n * // works with absolute URLs\r\n * createURL('https://jwplayer.com/m/123456?play=1', { play: null }) === 'https://jwplayer.com/m/123456'\r\n */\r\nexport const createURL = (url: string, queryParams: QueryParamsArg) => {\r\n  const [baseUrl, urlQueryString = ''] = url.split('?');\r\n  const urlSearchParams = new URLSearchParams(urlQueryString);\r\n\r\n  Object.entries(queryParams).forEach(([key, value]) => {\r\n    if (value === null || value === undefined) {\r\n      return urlSearchParams.delete(key);\r\n    }\r\n\r\n    const formattedValue = Array.isArray(value) ? value.join(',') : value;\r\n\r\n    urlSearchParams.set(key, String(formattedValue));\r\n  });\r\n\r\n  const queryString = urlSearchParams.toString();\r\n\r\n  return `${baseUrl}${queryString ? `?${queryString}` : ''}`;\r\n};\r\n\r\ntype ExtractRouteParams<T extends string> = T extends `${infer _Start}:${infer Param}/${infer Rest}`\r\n  ? { [K in Param | keyof ExtractRouteParams<Rest>]: string }\r\n  : T extends `${infer _Start}:${infer Param}`\r\n  ? { [K in Param]: string }\r\n  : object;\r\n\r\ntype PathParams<T extends string> = T extends `${infer _Start}*` ? ExtractRouteParams<T> & Record<string, string | undefined> : ExtractRouteParams<T>;\r\n\r\n// Creates a route path from a path string and params object\r\nexport const createPath = <Path extends string>(originalPath: Path, pathParams?: PathParams<Path>, queryParams?: QueryParamsArg): string => {\r\n  const path = originalPath\r\n    .split('/')\r\n    .map((segment) => {\r\n      if (segment === '*') {\r\n        // Wild card for optional segments: add all params that are not already in the path\r\n        if (!pathParams) return segment;\r\n\r\n        return Object.entries(pathParams)\r\n          .filter(([key]) => !originalPath.includes(key))\r\n          .map(([_, value]) => value)\r\n          .join('/');\r\n      }\r\n      if (!segment.startsWith(':') || !pathParams) return segment;\r\n\r\n      // Check if param is optional, and show a warning if it's not optional and missing\r\n      // Then remove all special characters to get the actual param name\r\n      const isOptional = segment.endsWith('?');\r\n      const paramName = segment.replace(':', '').replace('?', '');\r\n      const paramValue = pathParams[paramName as keyof typeof pathParams];\r\n\r\n      if (!paramValue) {\r\n        if (!isOptional) console.warn('Missing param in path creation.', { path: originalPath, paramName });\r\n\r\n        return '';\r\n      }\r\n\r\n      return paramValue;\r\n    })\r\n    .join('/');\r\n\r\n  // Optionally add the query params\r\n  return queryParams ? createURL(path, queryParams) : path;\r\n};\r\n\r\nexport const slugify = (text: string, whitespaceChar: string = '-') =>\r\n  text\r\n    .toString()\r\n    .toLowerCase()\r\n    .replace(/\\s+/g, '-')\r\n    .replace(/[^\\w-]+/g, '')\r\n    .replace(/--+/g, '-')\r\n    .replace(/^-+/, '')\r\n    .replace(/-+$/, '')\r\n    .replace(/-/g, whitespaceChar);\r\n\r\nexport const mediaURL = ({\r\n  media,\r\n  playlistId,\r\n  play = false,\r\n  episodeId,\r\n}: {\r\n  media: PlaylistItem;\r\n  playlistId?: string | null;\r\n  play?: boolean;\r\n  episodeId?: string;\r\n}) => {\r\n  return createPath(PATH_MEDIA, { id: media.mediaid, title: slugify(media.title) }, { r: playlistId, play: play ? '1' : null, e: episodeId });\r\n};\r\n\r\nexport const playlistURL = (id: string, title?: string) => {\r\n  return createPath(PATH_PLAYLIST, { id, title: title ? slugify(title) : undefined });\r\n};\r\n\r\nexport const liveChannelsURL = (playlistId: string, channelId?: string, play = false) => {\r\n  return createPath(\r\n    PATH_PLAYLIST,\r\n    { id: playlistId },\r\n    {\r\n      channel: channelId,\r\n      play: play ? '1' : null,\r\n    },\r\n  );\r\n};\r\n\r\nexport const userProfileURL = (profileId: string, nested = false) => {\r\n  const path = nested ? RELATIVE_PATH_USER_MY_PROFILE : PATH_USER_MY_PROFILE;\r\n\r\n  return createPath(path, { id: profileId });\r\n};\r\n\r\n// Legacy URLs\r\nexport const legacySeriesURL = ({\r\n  seriesId,\r\n  episodeId,\r\n  play,\r\n  playlistId,\r\n}: {\r\n  seriesId: string;\r\n  episodeId?: string;\r\n  play?: boolean;\r\n  playlistId?: string | null;\r\n}) => createURL(`/s/${seriesId}`, { r: playlistId, e: episodeId, play: play ? '1' : null });\r\n\r\nexport const buildLegacySeriesUrlFromMediaItem = (media: PlaylistItem, play: boolean, playlistId: string | null) => {\r\n  const legacyPlaylistIdFromTags = getLegacySeriesPlaylistIdFromEpisodeTags(media);\r\n  const legacyPlaylistIdFromCustomParams = getSeriesPlaylistIdFromCustomParams(media);\r\n\r\n  return legacySeriesURL({\r\n    // Use the id grabbed from either custom params for series or tags for an episode\r\n    seriesId: legacyPlaylistIdFromCustomParams || legacyPlaylistIdFromTags || '',\r\n    play,\r\n    playlistId,\r\n    // Add episode id only if series id can be retrieved from tags\r\n    episodeId: legacyPlaylistIdFromTags && media.mediaid,\r\n  });\r\n};\r\n","import type { CommonResponse } from '@inplayer-org/inplayer.js';\r\n\r\nimport type { InPlayerError } from '../../types/inplayer';\r\n\r\nexport class ApiError extends Error {\r\n  code: number;\r\n  message: string;\r\n\r\n  constructor(message = '', code: number) {\r\n    super(message);\r\n    this.name = 'ApiError';\r\n    this.message = message;\r\n    this.code = code;\r\n  }\r\n}\r\n\r\n/**\r\n * Get data\r\n * @param response\r\n */\r\nexport const getDataOrThrow = async (response: Response) => {\r\n  const data = await response.json();\r\n\r\n  if (!response.ok) {\r\n    const message = `Request '${response.url}' failed with ${response.status}`;\r\n    const apiMessage = data && typeof data === 'object' && 'message' in data && typeof data.message === 'string' ? data.message : undefined;\r\n\r\n    throw new ApiError(apiMessage || message, response.status || 500);\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\nexport const getCommonResponseData = (response: { data: CommonResponse }) => {\r\n  const { code, message } = response.data;\r\n  if (code !== 200) {\r\n    throw new Error(message);\r\n  }\r\n  return {\r\n    errors: [],\r\n    responseData: {\r\n      message,\r\n      code,\r\n    },\r\n  };\r\n};\r\n\r\nexport const isCommonError = (error: unknown): error is InPlayerError => {\r\n  return (\r\n    typeof error === 'object' &&\r\n    error !== null &&\r\n    'response' in error &&\r\n    typeof (error as InPlayerError).response?.data?.code === 'number' &&\r\n    typeof (error as InPlayerError).response?.data?.message === 'string'\r\n  );\r\n};\r\n","import { ACCESS_MODEL } from '../constants';\r\nimport type { AccessModel } from '../../types/config';\r\nimport type { MediaOffer } from '../../types/media';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\n\r\nimport { isFalsyCustomParamValue, isTruthyCustomParamValue } from './common';\r\n\r\n/**\r\n * The appearance of the lock icon, depending on the access model\r\n *\r\n * @param accessModel Platform AccessModel, excluding TVOD, which can only be applied per item\r\n * @param isLoggedIn\r\n * @param hasSubscription\r\n * @param playlistItem Used to define if the item is 'free' or has mediaOffers\r\n * @returns\r\n */\r\nexport const isLocked = (accessModel: AccessModel, isLoggedIn: boolean, hasSubscription: boolean, playlistItem: PlaylistItem): boolean => {\r\n  const isItemFree = isFalsyCustomParamValue(playlistItem?.requiresSubscription) || isTruthyCustomParamValue(playlistItem?.free);\r\n  const mediaOffers = playlistItem?.mediaOffers;\r\n\r\n  if (isItemFree) return false;\r\n  if (accessModel === ACCESS_MODEL.AVOD && !mediaOffers) return false;\r\n  if (accessModel === ACCESS_MODEL.AUTHVOD && isLoggedIn && !mediaOffers) return false;\r\n  if (accessModel === ACCESS_MODEL.SVOD && hasSubscription && !mediaOffers?.some((offer) => offer.premier)) return false;\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Filters MediaOffers from offers string\r\n *\r\n * @param offerIds String of comma separated key/value pairs, i.e. \"cleeng:S916977979_NL, !cleeng:S91633379_NL, other_vendor:xyz123\"\r\n * Key is vendor, value is the offerId.\r\n * Vendor keys starting with an exclamation mark represent a 'Premier Access' offer (TVOD only)\r\n *\r\n * @returns An array of MediaOffer { offerId, premier }\r\n */\r\nexport const filterMediaOffers = (vendorPrefix: string, offerIds?: string): MediaOffer[] | null => {\r\n  if (!offerIds) return null;\r\n\r\n  return offerIds\r\n    .replace(/\\s/g, '')\r\n    .split(',')\r\n    .reduce<MediaOffer[]>(\r\n      (offers, offerId) =>\r\n        offerId.indexOf(`${vendorPrefix}:`) === 0 || offerId.indexOf(`!${vendorPrefix}:`) === 0\r\n          ? [...offers, { offerId: offerId.slice(offerId.indexOf(':') + 1), premier: offerId[0] === '!' }]\r\n          : offers,\r\n      [],\r\n    );\r\n};\r\n","import type { State, StateCreator } from 'zustand';\r\nimport create from 'zustand';\r\nimport { devtools, subscribeWithSelector } from 'zustand/middleware';\r\n\r\nimport { IS_DEVELOPMENT_BUILD, IS_TEST_MODE } from '../utils/common';\r\n\r\nexport const createStore = <T extends State>(name: string, storeFn: StateCreator<T>) => {\r\n  const store = subscribeWithSelector(storeFn);\r\n\r\n  // https://github.com/pmndrs/zustand/issues/852#issuecomment-1059783350\r\n  if (IS_DEVELOPMENT_BUILD && !IS_TEST_MODE) {\r\n    return create(\r\n      devtools(store, {\r\n        name,\r\n        anonymousActionType: `${name}/Action`,\r\n      }),\r\n    );\r\n  }\r\n\r\n  return create(store);\r\n};\r\n","import { ACCESS_MODEL, OTT_GLOBAL_PLAYER_ID } from '../constants';\r\nimport type { AccessModel, Config } from '../../types/config';\r\nimport type { Settings } from '../../types/settings';\r\nimport type { LanguageDefinition } from '../../types/i18n';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype ConfigState = {\r\n  loaded: boolean;\r\n  config: Config;\r\n  accessModel: AccessModel;\r\n  settings: Settings;\r\n  integrationType: string | null;\r\n  supportedLanguages: LanguageDefinition[];\r\n};\r\n\r\nexport const useConfigStore = createStore<ConfigState>('ConfigStore', () => ({\r\n  loaded: false,\r\n  config: {\r\n    id: '',\r\n    siteName: '',\r\n    description: '',\r\n    player: '',\r\n    siteId: '',\r\n    assets: {},\r\n    content: [],\r\n    menu: [],\r\n    integrations: {\r\n      cleeng: {\r\n        useSandbox: true,\r\n      },\r\n      jwp: {\r\n        clientId: null,\r\n        assetId: null,\r\n        useSandbox: true,\r\n      },\r\n    },\r\n    styling: {},\r\n  },\r\n  settings: {\r\n    additionalAllowedConfigSources: [],\r\n    playerId: OTT_GLOBAL_PLAYER_ID,\r\n  },\r\n  supportedLanguages: [],\r\n  accessModel: ACCESS_MODEL.AVOD,\r\n  integrationType: null,\r\n}));\r\n","import { isValid, parseISO } from 'date-fns';\r\nimport { injectable } from 'inversify';\r\n\r\nimport { getMediaStatusFromEventState } from '../utils/liveEvent';\r\nimport { createURL } from '../utils/urlFormatting';\r\nimport { getDataOrThrow } from '../utils/api';\r\nimport { filterMediaOffers } from '../utils/entitlements';\r\nimport { useConfigStore as ConfigStore } from '../stores/ConfigStore';\r\nimport type { GetPlaylistParams, Playlist, PlaylistItem } from '../../types/playlist';\r\nimport type { AdSchedule } from '../../types/ad-schedule';\r\nimport type { EpisodeInSeries, EpisodesRes, EpisodesWithPagination, GetSeriesParams, Series } from '../../types/series';\r\nimport env from '../env';\r\n\r\n// change the values below to change the property used to look up the alternate image\r\nenum ImageProperty {\r\n  CARD = 'card',\r\n  BACKGROUND = 'background',\r\n  CHANNEL_LOGO = 'channel_logo',\r\n}\r\n\r\nconst PAGE_LIMIT = 20;\r\n\r\n@injectable()\r\nexport default class ApiService {\r\n  /**\r\n   * We use playlistLabel prop to define the label used for all media items inside.\r\n   * That way we can change the behavior of the same media items being in different playlists\r\n   */\r\n  private generateAlternateImageURL = ({ item, label, playlistLabel }: { item: PlaylistItem; label: string; playlistLabel?: string }) => {\r\n    const pathname = `/v2/media/${item.mediaid}/images/${playlistLabel || label}.webp`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, { poster_fallback: 1, fallback: playlistLabel ? label : null });\r\n\r\n    return url;\r\n  };\r\n\r\n  private parseDate = (item: PlaylistItem, prop: string) => {\r\n    const date = item[prop] as string | undefined;\r\n\r\n    if (date && !isValid(new Date(date))) {\r\n      console.error(`Invalid \"${prop}\" date provided for the \"${item.title}\" media item`);\r\n      return undefined;\r\n    }\r\n\r\n    return date ? parseISO(date) : undefined;\r\n  };\r\n\r\n  /**\r\n   * Transform incoming media items\r\n   * - Parses productId into MediaOffer[] for all cleeng offers\r\n   */\r\n  private transformMediaItem = (item: PlaylistItem, playlist?: Playlist) => {\r\n    const config = ConfigStore.getState().config;\r\n    const offerKeys = Object.keys(config?.integrations)[0];\r\n    const playlistLabel = playlist?.imageLabel;\r\n\r\n    const transformedMediaItem = {\r\n      ...item,\r\n      cardImage: this.generateAlternateImageURL({ item, label: ImageProperty.CARD, playlistLabel }),\r\n      channelLogoImage: this.generateAlternateImageURL({ item, label: ImageProperty.CHANNEL_LOGO, playlistLabel }),\r\n      backgroundImage: this.generateAlternateImageURL({ item, label: ImageProperty.BACKGROUND }),\r\n      mediaOffers: item.productIds ? filterMediaOffers(offerKeys, item.productIds) : undefined,\r\n      scheduledStart: this.parseDate(item, 'VCH.ScheduledStart'),\r\n      scheduledEnd: this.parseDate(item, 'VCH.ScheduledEnd'),\r\n    };\r\n\r\n    // add the media status to the media item after the transformation because the live media status depends on the scheduledStart and scheduledEnd\r\n    transformedMediaItem.mediaStatus = getMediaStatusFromEventState(transformedMediaItem);\r\n\r\n    return transformedMediaItem;\r\n  };\r\n\r\n  /**\r\n   * Transform incoming playlists\r\n   */\r\n  private transformPlaylist = (playlist: Playlist, relatedMediaId?: string) => {\r\n    playlist.playlist = playlist.playlist.map((item) => this.transformMediaItem(item, playlist));\r\n\r\n    // remove the related media item (when this is a recommendations playlist)\r\n    if (relatedMediaId) playlist.playlist.filter((item) => item.mediaid !== relatedMediaId);\r\n\r\n    return playlist;\r\n  };\r\n\r\n  private transformEpisodes = (episodesRes: EpisodesRes, seasonNumber?: number) => {\r\n    const { episodes, page, page_limit, total } = episodesRes;\r\n\r\n    // Adding images and keys for media items\r\n    return {\r\n      episodes: episodes\r\n        .filter((el) => el.media_item)\r\n        .map((el) => ({\r\n          ...this.transformMediaItem(el.media_item as PlaylistItem),\r\n          seasonNumber: seasonNumber?.toString() || el.season_number?.toString() || '',\r\n          episodeNumber: String(el.episode_number),\r\n        })),\r\n      pagination: { page, page_limit, total },\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Get playlist by id\r\n   */\r\n  getPlaylistById = async (id?: string, params: GetPlaylistParams = {}): Promise<Playlist | undefined> => {\r\n    if (!id) {\r\n      return undefined;\r\n    }\r\n\r\n    const pathname = `/v2/playlists/${id}`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, params);\r\n    const response = await fetch(url);\r\n    const data = (await getDataOrThrow(response)) as Playlist;\r\n\r\n    return this.transformPlaylist(data, params.related_media_id);\r\n  };\r\n\r\n  /**\r\n   * Get watchlist by playlistId\r\n   */\r\n  getMediaByWatchlist = async (playlistId: string, mediaIds: string[], token?: string): Promise<PlaylistItem[] | undefined> => {\r\n    if (!mediaIds?.length) {\r\n      return [];\r\n    }\r\n\r\n    const pathname = `/apps/watchlists/${playlistId}`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, { token, media_ids: mediaIds });\r\n    const response = await fetch(url);\r\n    const data = (await getDataOrThrow(response)) as Playlist;\r\n\r\n    if (!data) throw new Error(`The data was not found using the watchlist ${playlistId}`);\r\n\r\n    return (data.playlist || []).map((item) => this.transformMediaItem(item));\r\n  };\r\n\r\n  /**\r\n   * Get media by id\r\n   * @param {string} id\r\n   * @param {string} [token]\r\n   * @param {string} [drmPolicyId]\r\n   */\r\n  getMediaById = async (id: string, token?: string, drmPolicyId?: string): Promise<PlaylistItem | undefined> => {\r\n    const pathname = drmPolicyId ? `/v2/media/${id}/drm/${drmPolicyId}` : `/v2/media/${id}`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, { token });\r\n    const response = await fetch(url);\r\n    const data = (await getDataOrThrow(response)) as Playlist;\r\n    const mediaItem = data.playlist[0];\r\n\r\n    if (!mediaItem) throw new Error('MediaItem not found');\r\n\r\n    return this.transformMediaItem(mediaItem);\r\n  };\r\n\r\n  /**\r\n   * Get series by id\r\n   * @param {string} id\r\n   * @param params\r\n   */\r\n  getSeries = async (id: string, params: GetSeriesParams = {}): Promise<Series | undefined> => {\r\n    if (!id) {\r\n      throw new Error('Series ID is required');\r\n    }\r\n\r\n    const pathname = `/apps/series/${id}`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, params);\r\n    const response = await fetch(url);\r\n\r\n    return (await getDataOrThrow(response)) as Series;\r\n  };\r\n\r\n  /**\r\n   * Get all series for the given media_ids\r\n   */\r\n  getSeriesByMediaIds = async (mediaIds: string[]): Promise<Record<string, EpisodeInSeries[]> | undefined> => {\r\n    const pathname = `/apps/series`;\r\n    const url = `${env.APP_API_BASE_URL}${pathname}?media_ids=${mediaIds.join(',')}`;\r\n    const response = await fetch(url);\r\n\r\n    return (await getDataOrThrow(response)) as Record<string, EpisodeInSeries[]>;\r\n  };\r\n\r\n  /**\r\n   * Get all episodes of the selected series (when no particular season is selected or when episodes are attached to series)\r\n   */\r\n  getEpisodes = async ({\r\n    seriesId,\r\n    pageOffset,\r\n    pageLimit = PAGE_LIMIT,\r\n    afterId,\r\n  }: {\r\n    seriesId: string | undefined;\r\n    pageOffset?: number;\r\n    pageLimit?: number;\r\n    afterId?: string;\r\n  }): Promise<EpisodesWithPagination> => {\r\n    if (!seriesId) {\r\n      throw new Error('Series ID is required');\r\n    }\r\n\r\n    const pathname = `/apps/series/${seriesId}/episodes`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, {\r\n      page_offset: pageOffset,\r\n      page_limit: pageLimit,\r\n      after_id: afterId,\r\n    });\r\n\r\n    const response = await fetch(url);\r\n    const episodesResponse = (await getDataOrThrow(response)) as EpisodesRes;\r\n\r\n    return this.transformEpisodes(episodesResponse);\r\n  };\r\n\r\n  /**\r\n   * Get season of the selected series\r\n   */\r\n  getSeasonWithEpisodes = async ({\r\n    seriesId,\r\n    seasonNumber,\r\n    pageOffset,\r\n    pageLimit = PAGE_LIMIT,\r\n  }: {\r\n    seriesId: string | undefined;\r\n    seasonNumber: number;\r\n    pageOffset?: number;\r\n    pageLimit?: number;\r\n  }): Promise<EpisodesWithPagination> => {\r\n    if (!seriesId) {\r\n      throw new Error('Series ID is required');\r\n    }\r\n\r\n    const pathname = `/apps/series/${seriesId}/seasons/${seasonNumber}/episodes`;\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, { page_offset: pageOffset, page_limit: pageLimit });\r\n\r\n    const response = await fetch(url);\r\n    const episodesRes = (await getDataOrThrow(response)) as EpisodesRes;\r\n\r\n    return this.transformEpisodes(episodesRes, seasonNumber);\r\n  };\r\n\r\n  getAdSchedule = async (id: string | undefined | null): Promise<AdSchedule | undefined> => {\r\n    if (!id) {\r\n      throw new Error('Ad Schedule ID is required');\r\n    }\r\n\r\n    const url = env.APP_API_BASE_URL + `/v2/advertising/schedules/${id}.json`;\r\n    const response = await fetch(url, { credentials: 'omit' });\r\n\r\n    return (await getDataOrThrow(response)) as AdSchedule;\r\n  };\r\n\r\n  getAppContentSearch = async (siteId: string, searchQuery: string | undefined) => {\r\n    const pathname = `/v2/sites/${siteId}/app_content/media/search`;\r\n\r\n    const url = createURL(`${env.APP_API_BASE_URL}${pathname}`, {\r\n      search_query: searchQuery,\r\n    });\r\n\r\n    const response = await fetch(url);\r\n    const data = (await getDataOrThrow(response)) as Playlist;\r\n\r\n    return this.transformPlaylist(data);\r\n  };\r\n}\r\n","export default abstract class StorageService {\r\n  abstract initialize(prefix: string): void;\r\n\r\n  abstract getItem<T>(key: string, parse: boolean): Promise<T | null>;\r\n\r\n  abstract setItem(key: string, value: string, usePrefix?: boolean): Promise<void>;\r\n\r\n  abstract removeItem(key: string): Promise<void>;\r\n\r\n  abstract base64Decode(input: string): string;\r\n\r\n  abstract base64Encode(input: string): string;\r\n}\r\n","import type { AccessModel, Config } from '../../../types/config';\r\nimport type {\r\n  ChangePassword,\r\n  ChangePasswordWithOldPassword,\r\n  DeleteAccount,\r\n  ExportAccountData,\r\n  GetCaptureStatus,\r\n  GetCustomerConsents,\r\n  GetPublisherConsents,\r\n  Login,\r\n  NotificationsData,\r\n  Register,\r\n  ResetPassword,\r\n  GetSocialURLs,\r\n  UpdateCaptureAnswers,\r\n  UpdateCustomerConsents,\r\n  Logout,\r\n  GetAuthData,\r\n  UpdateCustomer,\r\n  UpdateWatchHistory,\r\n  UpdateFavorites,\r\n  GetWatchHistory,\r\n  GetFavorites,\r\n  GetUser,\r\n} from '../../../types/account';\r\n\r\nexport type AccountServiceFeatures = {\r\n  readonly canUpdateEmail: boolean;\r\n  readonly canSupportEmptyFullName: boolean;\r\n  readonly canChangePasswordWithOldPassword: boolean;\r\n  readonly canRenewSubscription: boolean;\r\n  readonly canExportAccountData: boolean;\r\n  readonly canDeleteAccount: boolean;\r\n  readonly canUpdatePaymentMethod: boolean;\r\n  readonly canShowReceipts: boolean;\r\n  readonly hasSocialURLs: boolean;\r\n  readonly hasNotifications: boolean;\r\n  readonly watchListSizeLimit: number;\r\n};\r\n\r\nexport default abstract class AccountService {\r\n  readonly features: AccountServiceFeatures;\r\n\r\n  abstract accessModel: AccessModel;\r\n  abstract svodOfferIds: string[];\r\n  abstract sandbox: boolean;\r\n\r\n  protected constructor(features: AccountServiceFeatures) {\r\n    this.features = features;\r\n  }\r\n\r\n  abstract initialize: (config: Config, url: string, logoutCallback: () => Promise<void>) => Promise<void>;\r\n\r\n  abstract getAuthData: GetAuthData;\r\n\r\n  abstract login: Login;\r\n\r\n  abstract register: Register;\r\n\r\n  abstract logout: Logout;\r\n\r\n  abstract getUser: GetUser;\r\n\r\n  abstract getPublisherConsents: GetPublisherConsents;\r\n\r\n  abstract getCustomerConsents: GetCustomerConsents;\r\n\r\n  abstract updateCustomerConsents: UpdateCustomerConsents;\r\n\r\n  abstract getCaptureStatus: GetCaptureStatus;\r\n\r\n  abstract updateCaptureAnswers: UpdateCaptureAnswers;\r\n\r\n  abstract resetPassword: ResetPassword;\r\n\r\n  abstract changePasswordWithResetToken: ChangePassword;\r\n\r\n  abstract changePasswordWithOldPassword: ChangePasswordWithOldPassword;\r\n\r\n  abstract updateCustomer: UpdateCustomer;\r\n\r\n  abstract updateWatchHistory: UpdateWatchHistory;\r\n\r\n  abstract updateFavorites: UpdateFavorites;\r\n\r\n  abstract getWatchHistory: GetWatchHistory;\r\n\r\n  abstract getFavorites: GetFavorites;\r\n\r\n  abstract subscribeToNotifications: NotificationsData;\r\n\r\n  abstract getSocialUrls?: GetSocialURLs;\r\n\r\n  abstract exportAccountData?: ExportAccountData;\r\n\r\n  abstract deleteAccount?: DeleteAccount;\r\n}\r\n","import { inject, injectable } from 'inversify';\r\nimport { array, number, object, string } from 'yup';\r\n\r\nimport type { PlaylistItem } from '../../types/playlist';\r\nimport type { SerializedWatchHistoryItem, WatchHistoryItem } from '../../types/watchHistory';\r\nimport type { Customer } from '../../types/account';\r\nimport { getNamedModule } from '../modules/container';\r\nimport { INTEGRATION_TYPE } from '../modules/types';\r\nimport { logDev } from '../utils/common';\r\nimport { MAX_WATCHLIST_ITEMS_COUNT } from '../constants';\r\n\r\nimport ApiService from './ApiService';\r\nimport StorageService from './StorageService';\r\nimport AccountService from './integrations/AccountService';\r\n\r\nconst schema = array(\r\n  object().shape({\r\n    mediaid: string(),\r\n    progress: number(),\r\n  }),\r\n);\r\n\r\n@injectable()\r\nexport default class WatchHistoryService {\r\n  private PERSIST_KEY_WATCH_HISTORY = 'history';\r\n\r\n  private readonly apiService;\r\n  private readonly storageService;\r\n  private readonly accountService;\r\n\r\n  constructor(@inject(INTEGRATION_TYPE) integrationType: string, apiService: ApiService, storageService: StorageService) {\r\n    this.apiService = apiService;\r\n    this.storageService = storageService;\r\n    this.accountService = getNamedModule(AccountService, integrationType);\r\n  }\r\n\r\n  // Retrieve watch history media items info using a provided watch list\r\n  private getWatchHistoryItems = async (continueWatchingList: string, ids: string[]): Promise<Record<string, PlaylistItem>> => {\r\n    const watchHistoryItems = await this.apiService.getMediaByWatchlist(continueWatchingList, ids);\r\n    const watchHistoryItemsDict = Object.fromEntries((watchHistoryItems || []).map((item) => [item.mediaid, item]));\r\n\r\n    return watchHistoryItemsDict;\r\n  };\r\n\r\n  // We store separate episodes in the watch history and to show series card in the Continue Watching shelf we need to get their parent media items\r\n  private getWatchHistorySeriesItems = async (continueWatchingList: string, ids: string[]): Promise<Record<string, PlaylistItem | undefined>> => {\r\n    const mediaWithSeries = await this.apiService.getSeriesByMediaIds(ids);\r\n    const seriesIds = Object.keys(mediaWithSeries || {})\r\n      .map((key) => mediaWithSeries?.[key]?.[0]?.series_id)\r\n      .filter(Boolean) as string[];\r\n    const uniqueSerieIds = [...new Set(seriesIds)];\r\n\r\n    const seriesItems = await this.apiService.getMediaByWatchlist(continueWatchingList, uniqueSerieIds);\r\n    const seriesItemsDict = Object.keys(mediaWithSeries || {}).reduce((acc, key) => {\r\n      const seriesItemId = mediaWithSeries?.[key]?.[0]?.series_id;\r\n      if (seriesItemId) {\r\n        acc[key] = seriesItems?.find((el) => el.mediaid === seriesItemId);\r\n      }\r\n      return acc;\r\n    }, {} as Record<string, PlaylistItem | undefined>);\r\n\r\n    return seriesItemsDict;\r\n  };\r\n\r\n  private validateWatchHistory(history: unknown) {\r\n    if (history && schema.validateSync(history)) {\r\n      return history as SerializedWatchHistoryItem[];\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  private async getWatchHistoryFromAccount(user: Customer) {\r\n    const history = await this.accountService.getWatchHistory({ user });\r\n\r\n    return this.validateWatchHistory(history);\r\n  }\r\n\r\n  private async getWatchHistoryFromStorage() {\r\n    const history = await this.storageService.getItem(this.PERSIST_KEY_WATCH_HISTORY, true);\r\n\r\n    return this.validateWatchHistory(history);\r\n  }\r\n\r\n  getWatchHistory = async (user: Customer | null, continueWatchingList: string) => {\r\n    const savedItems = user ? await this.getWatchHistoryFromAccount(user) : await this.getWatchHistoryFromStorage();\r\n\r\n    // When item is an episode of the new flow -> show the card as a series one, but keep episode to redirect in a right way\r\n    const ids = savedItems.map(({ mediaid }) => mediaid);\r\n\r\n    if (!ids.length) {\r\n      return [];\r\n    }\r\n\r\n    try {\r\n      const watchHistoryItems = await this.getWatchHistoryItems(continueWatchingList, ids);\r\n      const seriesItems = await this.getWatchHistorySeriesItems(continueWatchingList, ids);\r\n\r\n      return savedItems\r\n        .map((item) => {\r\n          const parentSeries = seriesItems?.[item.mediaid];\r\n          const historyItem = watchHistoryItems[item.mediaid];\r\n\r\n          if (historyItem) {\r\n            return this.createWatchHistoryItem(parentSeries || historyItem, item.mediaid, parentSeries?.mediaid, item.progress);\r\n          }\r\n        })\r\n        .filter((item): item is WatchHistoryItem => Boolean(item));\r\n    } catch (error: unknown) {\r\n      logDev('Failed to get watch history items', error);\r\n    }\r\n\r\n    return [];\r\n  };\r\n\r\n  serializeWatchHistory = (watchHistory: WatchHistoryItem[]): SerializedWatchHistoryItem[] =>\r\n    watchHistory.map(({ mediaid, progress }) => ({\r\n      mediaid,\r\n      progress,\r\n    }));\r\n\r\n  persistWatchHistory = async (watchHistory: WatchHistoryItem[], user: Customer | null) => {\r\n    if (user) {\r\n      await this.accountService?.updateWatchHistory({\r\n        history: this.serializeWatchHistory(watchHistory),\r\n        user,\r\n      });\r\n    } else {\r\n      await this.storageService.setItem(this.PERSIST_KEY_WATCH_HISTORY, JSON.stringify(this.serializeWatchHistory(watchHistory)));\r\n    }\r\n  };\r\n\r\n  /** Use mediaid of originally watched movie / episode.\r\n   * A playlistItem can be either a series item (to show series card) or media item\r\n   * */\r\n  createWatchHistoryItem = (item: PlaylistItem, mediaid: string, seriesId: string | undefined, videoProgress: number): WatchHistoryItem => {\r\n    return {\r\n      mediaid,\r\n      seriesId,\r\n      title: item.title,\r\n      tags: item.tags,\r\n      duration: item.duration,\r\n      progress: videoProgress,\r\n      playlistItem: item,\r\n    } as WatchHistoryItem;\r\n  };\r\n\r\n  getMaxWatchHistoryCount = () => {\r\n    return this.accountService?.features?.watchListSizeLimit || MAX_WATCHLIST_ITEMS_COUNT;\r\n  };\r\n\r\n  /**\r\n   *  If we already have an element with continue watching state, we:\r\n   *    1. Update the progress\r\n   *    2. Move the element to the continue watching list start\r\n   *  Otherwise:\r\n   *    1. Move the element to the continue watching list start\r\n   *    2. If there are many elements in continue watching state we remove the oldest one\r\n   */\r\n  saveItem = async (item: PlaylistItem, seriesItem: PlaylistItem | undefined, videoProgress: number | null, watchHistory: WatchHistoryItem[]) => {\r\n    if (!videoProgress) return;\r\n\r\n    const watchHistoryItem = this.createWatchHistoryItem(seriesItem || item, item.mediaid, seriesItem?.mediaid, videoProgress);\r\n    // filter out the existing watch history item, so we can add it to the beginning of the list\r\n    const updatedHistory = watchHistory.filter(({ mediaid, seriesId }) => {\r\n      return mediaid !== watchHistoryItem.mediaid && (!seriesId || seriesId !== watchHistoryItem.seriesId);\r\n    });\r\n\r\n    updatedHistory.unshift(watchHistoryItem);\r\n    updatedHistory.splice(this.getMaxWatchHistoryCount());\r\n\r\n    return updatedHistory;\r\n  };\r\n}\r\n","import { injectable } from 'inversify';\r\n\r\nimport type { GetMediaParams } from '../../types/media';\r\nimport type { GetTokenResponse } from '../../types/entitlement';\r\n\r\n@injectable()\r\nexport default class GenericEntitlementService {\r\n  private getToken = async <T>(url: string, body: unknown = {}, jwt?: string): Promise<T> => {\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        Authorization: jwt ? `Bearer ${jwt}` : '',\r\n      },\r\n      body: JSON.stringify(body),\r\n    });\r\n\r\n    return (await response.json()) as T;\r\n  };\r\n\r\n  getMediaToken = async (host: string, id: string, jwt?: string, params?: GetMediaParams, drmPolicyId?: string) => {\r\n    const data = await this.getToken<GetTokenResponse>(`${host}/media/${id}/sign${drmPolicyId ? `/drm/${drmPolicyId}` : ''}`, params, jwt);\r\n\r\n    if (!data.entitled) throw new Error('Unauthorized');\r\n\r\n    return data.token;\r\n  };\r\n}\r\n","import InPlayer from '@inplayer-org/inplayer.js';\r\nimport { injectable } from 'inversify';\r\n\r\n@injectable()\r\nexport default class JWPEntitlementService {\r\n  getJWPMediaToken = async (configId: string = '', mediaId: string) => {\r\n    try {\r\n      const { data } = await InPlayer.Asset.getSignedMediaToken(configId, mediaId);\r\n      return data.token;\r\n    } catch {\r\n      throw new Error('Unauthorized');\r\n    }\r\n  };\r\n}\r\n","import { inject, injectable } from 'inversify';\r\nimport { object, array, string } from 'yup';\r\n\r\nimport type { Favorite, SerializedFavorite } from '../../types/favorite';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\nimport type { Customer } from '../../types/account';\r\nimport { getNamedModule } from '../modules/container';\r\nimport { INTEGRATION_TYPE } from '../modules/types';\r\nimport { logDev } from '../utils/common';\r\nimport { MAX_WATCHLIST_ITEMS_COUNT } from '../constants';\r\n\r\nimport ApiService from './ApiService';\r\nimport StorageService from './StorageService';\r\nimport AccountService from './integrations/AccountService';\r\n\r\nconst schema = array(\r\n  object().shape({\r\n    mediaid: string(),\r\n  }),\r\n);\r\n\r\n@injectable()\r\nexport default class FavoriteService {\r\n  private PERSIST_KEY_FAVORITES = 'favorites';\r\n\r\n  private readonly apiService;\r\n  private readonly storageService;\r\n  private readonly accountService;\r\n\r\n  constructor(@inject(INTEGRATION_TYPE) integrationType: string, apiService: ApiService, storageService: StorageService) {\r\n    this.apiService = apiService;\r\n    this.storageService = storageService;\r\n    this.accountService = getNamedModule(AccountService, integrationType, false);\r\n  }\r\n\r\n  private validateFavorites(favorites: unknown) {\r\n    if (favorites && schema.validateSync(favorites)) {\r\n      return favorites as SerializedFavorite[];\r\n    }\r\n\r\n    return [];\r\n  }\r\n\r\n  private async getFavoritesFromAccount(user: Customer) {\r\n    const favorites = await this.accountService?.getFavorites({ user });\r\n\r\n    return this.validateFavorites(favorites);\r\n  }\r\n\r\n  private async getFavoritesFromStorage() {\r\n    const favorites = await this.storageService.getItem(this.PERSIST_KEY_FAVORITES, true);\r\n\r\n    return this.validateFavorites(favorites);\r\n  }\r\n\r\n  getFavorites = async (user: Customer | null, favoritesList: string) => {\r\n    const savedItems = user ? await this.getFavoritesFromAccount(user) : await this.getFavoritesFromStorage();\r\n    const mediaIds = savedItems.map(({ mediaid }) => mediaid);\r\n\r\n    if (!mediaIds) {\r\n      return [];\r\n    }\r\n\r\n    try {\r\n      const playlistItems = await this.apiService.getMediaByWatchlist(favoritesList, mediaIds);\r\n\r\n      return (playlistItems || []).map((item) => this.createFavorite(item));\r\n    } catch (error: unknown) {\r\n      logDev('Failed to get favorites', error);\r\n    }\r\n\r\n    return [];\r\n  };\r\n\r\n  serializeFavorites = (favorites: Favorite[]): SerializedFavorite[] => {\r\n    return favorites.map(({ mediaid }) => ({ mediaid }));\r\n  };\r\n\r\n  persistFavorites = async (favorites: Favorite[], user: Customer | null) => {\r\n    if (user) {\r\n      return this.accountService?.updateFavorites({\r\n        favorites: this.serializeFavorites(favorites),\r\n        user,\r\n      });\r\n    } else {\r\n      await this.storageService.setItem(this.PERSIST_KEY_FAVORITES, JSON.stringify(this.serializeFavorites(favorites)));\r\n    }\r\n  };\r\n\r\n  getMaxFavoritesCount = () => {\r\n    return this.accountService?.features?.watchListSizeLimit || MAX_WATCHLIST_ITEMS_COUNT;\r\n  };\r\n\r\n  createFavorite = (item: PlaylistItem): Favorite => {\r\n    return {\r\n      mediaid: item.mediaid,\r\n      title: item.title,\r\n      tags: item.tags,\r\n      duration: item.duration,\r\n      playlistItem: item,\r\n    } as Favorite;\r\n  };\r\n}\r\n","import { array, boolean, mixed, number, object, type SchemaOf, string, StringSchema } from 'yup';\r\n\r\nimport type { Cleeng, Config, Content, Features, JWP, Menu, Styling } from '../../types/config';\r\n\r\nconst contentSchema: SchemaOf<Content> = object({\r\n  contentId: string().notRequired(),\r\n  title: string().notRequired(),\r\n  featured: boolean().notRequired(),\r\n  backgroundColor: string().nullable().notRequired(),\r\n  type: mixed().oneOf(['playlist', 'continue_watching', 'favorites']),\r\n}).defined();\r\n\r\nconst menuSchema: SchemaOf<Menu> = object().shape({\r\n  label: string().defined(),\r\n  contentId: string().defined(),\r\n  filterTags: string().notRequired(),\r\n  type: mixed().oneOf(['playlist']).notRequired(),\r\n});\r\n\r\nconst featuresSchema: SchemaOf<Features> = object({\r\n  recommendationsPlaylist: string().nullable(),\r\n  searchPlaylist: string().nullable(),\r\n  continueWatchingList: string().nullable(),\r\n  favoritesList: string().nullable(),\r\n});\r\n\r\nconst cleengSchema: SchemaOf<Cleeng> = object({\r\n  id: string().nullable(),\r\n  monthlyOffer: string().nullable(),\r\n  yearlyOffer: string().nullable(),\r\n  useSandbox: boolean().default(true),\r\n});\r\n\r\nconst jwpSchema: SchemaOf<JWP> = object({\r\n  clientId: string().nullable(),\r\n  assetId: number().nullable(),\r\n  useSandbox: boolean().default(true),\r\n});\r\n\r\nconst stylingSchema: SchemaOf<Styling> = object({\r\n  backgroundColor: string().nullable(),\r\n  highlightColor: string().nullable(),\r\n  headerBackground: string().nullable(),\r\n  footerText: string().nullable(),\r\n});\r\n\r\nexport const configSchema: SchemaOf<Config> = object({\r\n  id: string().notRequired(),\r\n  siteName: string().notRequired(),\r\n  description: string().defined(),\r\n  analyticsToken: string().nullable(),\r\n  adSchedule: string().nullable(),\r\n  siteId: string().defined(),\r\n  assets: object({\r\n    banner: string().notRequired().nullable(),\r\n  }).notRequired(),\r\n  content: array().of(contentSchema),\r\n  menu: array().of(menuSchema),\r\n  styling: stylingSchema.notRequired(),\r\n  features: featuresSchema.notRequired(),\r\n  integrations: object({\r\n    cleeng: cleengSchema.notRequired(),\r\n    jwp: jwpSchema.notRequired(),\r\n  }).notRequired(),\r\n  adScheduleUrls: object({\r\n    json: string().notRequired().nullable(),\r\n    xml: string().notRequired().nullable(),\r\n  }).notRequired(),\r\n  custom: object().notRequired(),\r\n  contentSigningService: object().shape({\r\n    // see {@link https://github.com/jquense/yup/issues/1367}\r\n    host: string().required() as StringSchema<string>,\r\n    drmPolicyId: string().notRequired(),\r\n  }),\r\n  contentProtection: object()\r\n    .shape({\r\n      accessModel: string().oneOf(['free', 'freeauth', 'authvod', 'svod']).notRequired(),\r\n      drm: object({\r\n        defaultPolicyId: string(),\r\n      }).notRequired(),\r\n    })\r\n    .notRequired(),\r\n}).defined();\r\n","type Payload = {\r\n  title: string;\r\n  description: string;\r\n  helpLink: string;\r\n};\r\n\r\nexport class AppError extends Error {\r\n  payload: Payload;\r\n\r\n  constructor(message: string, payload: Payload) {\r\n    super(message);\r\n    this.name = 'AppError';\r\n    this.payload = payload;\r\n  }\r\n}\r\n","import i18next from 'i18next';\r\nimport { injectable } from 'inversify';\r\nimport { getI18n } from 'react-i18next';\r\n\r\nimport { configSchema } from '../utils/configSchema';\r\nimport { AppError } from '../utils/error';\r\nimport type { Config } from '../../types/config';\r\nimport env from '../env';\r\n\r\nimport ApiService from './ApiService';\r\n\r\n/**\r\n * Set config setup changes in both config.service.ts and config.d.ts\r\n * */\r\n\r\n@injectable()\r\nexport default class ConfigService {\r\n  private CONFIG_HOST = env.APP_API_BASE_URL;\r\n  // Explicitly set default config here as a local variable,\r\n  // otherwise if it's a module level const, the merge below causes changes to nested properties\r\n  private DEFAULT_CONFIG: Config = {\r\n    id: '',\r\n    siteName: '',\r\n    description: '',\r\n    siteId: '',\r\n    assets: {\r\n      banner: '/images/logo.png',\r\n    },\r\n    content: [],\r\n    menu: [],\r\n    integrations: {},\r\n    styling: {\r\n      footerText: '',\r\n    },\r\n    features: {},\r\n  };\r\n\r\n  private readonly apiService: ApiService;\r\n\r\n  constructor(apiService: ApiService) {\r\n    this.apiService = apiService;\r\n  }\r\n\r\n  private enrichConfig = (config: Config): Config => {\r\n    const { content, siteName } = config;\r\n    const updatedContent = content.map((content) => Object.assign({ featured: false }, content));\r\n\r\n    return { ...config, siteName: siteName || i18next.t('common:default_site_name'), content: updatedContent };\r\n  };\r\n\r\n  getDefaultConfig = (): Config => {\r\n    return this.DEFAULT_CONFIG;\r\n  };\r\n\r\n  validateConfig = (config?: Config): Promise<Config> => {\r\n    return configSchema.validate(config, {\r\n      strict: true,\r\n    }) as Promise<Config>;\r\n  };\r\n\r\n  formatSourceLocation = (source?: string) => {\r\n    if (!source) {\r\n      return undefined;\r\n    }\r\n\r\n    if (source.match(/^[a-z,\\d]{8}$/)) {\r\n      return `${this.CONFIG_HOST}/apps/configs/${source}.json`;\r\n    }\r\n\r\n    return source;\r\n  };\r\n\r\n  loadAdSchedule = async (adScheduleId: string | undefined | null) => {\r\n    return this.apiService.getAdSchedule(adScheduleId);\r\n  };\r\n\r\n  loadConfig = async (configLocation: string | undefined) => {\r\n    const i18n = getI18n();\r\n\r\n    const errorPayload = {\r\n      title: i18n.t('error:config_invalid'),\r\n      description: i18n.t('error:check_your_config'),\r\n      helpLink: 'https://github.com/jwplayer/ott-web-app/blob/develop/docs/configuration.md',\r\n    };\r\n\r\n    if (!configLocation) {\r\n      throw new AppError('No config location found', errorPayload);\r\n    }\r\n\r\n    const response = await fetch(configLocation, {\r\n      headers: {\r\n        Accept: 'application/json',\r\n      },\r\n      method: 'GET',\r\n    }).catch(() => {\r\n      throw new AppError('Failed to load the config', errorPayload);\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new AppError('Failed to load the config', errorPayload);\r\n    }\r\n\r\n    const data = (await response.json()) as Config;\r\n\r\n    if (!data) {\r\n      throw new Error('No config found');\r\n    }\r\n\r\n    return this.enrichConfig(data);\r\n  };\r\n}\r\n","import { injectable } from 'inversify';\r\nimport ini from 'ini';\r\nimport { getI18n } from 'react-i18next';\r\n\r\nimport { CONFIG_FILE_STORAGE_KEY, CONFIG_QUERY_KEY, OTT_GLOBAL_PLAYER_ID } from '../constants';\r\nimport { logDev } from '../utils/common';\r\nimport { AppError } from '../utils/error';\r\nimport type { Settings } from '../../types/settings';\r\nimport env from '../env';\r\n\r\nimport StorageService from './StorageService';\r\n\r\n@injectable()\r\nexport default class SettingsService {\r\n  private readonly storageService;\r\n\r\n  constructor(storageService: StorageService) {\r\n    this.storageService = storageService;\r\n  }\r\n\r\n  async getConfigSource(settings: Settings | undefined, url: string) {\r\n    if (!settings) {\r\n      return '';\r\n    }\r\n\r\n    const urlParams = new URLSearchParams(url.split('?')[1]);\r\n    const configKey = urlParams.get(CONFIG_QUERY_KEY);\r\n\r\n    // Skip all the fancy logic below if there aren't any other options besides the default anyhow\r\n    if (!settings.UNSAFE_allowAnyConfigSource && (settings.additionalAllowedConfigSources?.length || 0) <= 0) {\r\n      return settings.defaultConfigSource;\r\n    }\r\n\r\n    if (configKey !== null) {\r\n      // If the query param exists but the value is empty, clear the storage and allow fallback to the default config\r\n      if (!configKey) {\r\n        await this.storageService.removeItem(CONFIG_FILE_STORAGE_KEY);\r\n        return settings.defaultConfigSource;\r\n      }\r\n\r\n      // If it's valid, store it and return it\r\n      if (this.isValidConfigSource(configKey, settings)) {\r\n        await this.storageService.setItem(CONFIG_FILE_STORAGE_KEY, configKey);\r\n        return configKey;\r\n      }\r\n\r\n      logDev(`Invalid app-config query param: ${configKey}`);\r\n    }\r\n    // Yes this falls through from above to look up the stored value if the query string is invalid and that's OK\r\n\r\n    const storedSource = await this.storageService.getItem(CONFIG_FILE_STORAGE_KEY, false);\r\n\r\n    // Make sure the stored value is still valid before returning it\r\n    if (storedSource && typeof storedSource === 'string') {\r\n      if (this.isValidConfigSource(storedSource, settings)) {\r\n        return storedSource;\r\n      }\r\n\r\n      logDev('Invalid stored config: ' + storedSource);\r\n      await this.storageService.removeItem(CONFIG_FILE_STORAGE_KEY);\r\n    }\r\n\r\n    return settings.defaultConfigSource;\r\n  }\r\n\r\n  isValidConfigSource = (source: string, settings: Settings) => {\r\n    // Dynamic values are valid as long as they are defined\r\n    if (settings?.UNSAFE_allowAnyConfigSource) {\r\n      return !!source;\r\n    }\r\n\r\n    return (\r\n      settings?.defaultConfigSource === source || (settings?.additionalAllowedConfigSources && settings?.additionalAllowedConfigSources.indexOf(source) >= 0)\r\n    );\r\n  };\r\n\r\n  initialize = async () => {\r\n    const settings = await fetch('/.webapp.ini')\r\n      .then((result) => result.text())\r\n      .then((iniString) => ini.parse(iniString) as Settings)\r\n      .catch((e) => {\r\n        logDev(e);\r\n        // It's possible to not use the ini settings files, so an error doesn't have to be fatal\r\n        return {} as Settings;\r\n      });\r\n\r\n    const i18n = getI18n();\r\n\r\n    // @TODO: use `i18next.t()`?\r\n    // t('error:settings_invalid')\r\n    // t('error:check_your_settings')\r\n    const errorPayload = {\r\n      title: i18n.t('error:settings_invalid'),\r\n      description: i18n.t('error:check_your_settings'),\r\n      helpLink: 'https://github.com/jwplayer/ott-web-app/blob/develop/docs/initialization-file.md',\r\n    };\r\n\r\n    if (!settings) {\r\n      throw new AppError('Unable to load .webapp.ini', errorPayload);\r\n    }\r\n\r\n    // The ini file values will be used if provided, even if compile-time values are set\r\n    settings.defaultConfigSource ||= env.APP_DEFAULT_CONFIG_SOURCE;\r\n    settings.playerId ||= env.APP_PLAYER_ID || OTT_GLOBAL_PLAYER_ID;\r\n    settings.playerLicenseKey ||= env.APP_PLAYER_LICENSE_KEY;\r\n\r\n    // The player key should be set if using the global ott player\r\n    if (settings.playerId === OTT_GLOBAL_PLAYER_ID && !settings.playerLicenseKey) {\r\n      console.warn('Using Global OTT Player without setting player key. Some features, such as analytics, may not work correctly.');\r\n    }\r\n\r\n    // This will result in an unusable app\r\n    if (\r\n      !settings.defaultConfigSource &&\r\n      (!settings.additionalAllowedConfigSources || settings.additionalAllowedConfigSources?.length === 0) &&\r\n      !settings.UNSAFE_allowAnyConfigSource\r\n    ) {\r\n      throw new AppError('No usable config sources', errorPayload);\r\n    }\r\n\r\n    return settings;\r\n  };\r\n}\r\n","import type { CustomFormField, Customer, CustomerConsent } from '../../types/account';\r\nimport type { Offer } from '../../types/checkout';\r\nimport type { PaymentDetail, Subscription, Transaction } from '../../types/subscription';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype AccountStore = {\r\n  loading: boolean;\r\n  user: Customer | null;\r\n  subscription: Subscription | null;\r\n  transactions: Transaction[] | null;\r\n  activePayment: PaymentDetail | null;\r\n  customerConsents: CustomerConsent[] | null;\r\n  publisherConsents: CustomFormField[] | null;\r\n  publisherConsentsLoading: boolean;\r\n  pendingOffer: Offer | null;\r\n  setLoading: (loading: boolean) => void;\r\n  getAccountInfo: () => { customerId: string; customer: Customer; customerConsents: CustomerConsent[] | null };\r\n};\r\n\r\nexport const useAccountStore = createStore<AccountStore>('AccountStore', (set, get) => ({\r\n  loading: false,\r\n  user: null,\r\n  subscription: null,\r\n  transactions: null,\r\n  activePayment: null,\r\n  customerConsents: null,\r\n  publisherConsents: null,\r\n  publisherConsentsLoading: false,\r\n  pendingOffer: null,\r\n  setLoading: (loading: boolean) => set({ loading }),\r\n  getAccountInfo: () => {\r\n    const user = get().user;\r\n    const customerConsents = get().customerConsents;\r\n\r\n    if (!user?.id) throw new Error('user not logged in');\r\n\r\n    return { customerId: user?.id, customer: user, customerConsents };\r\n  },\r\n}));\r\n","import { PersonalShelf, VideoProgressMinMax } from '../constants';\r\nimport type { WatchHistoryItem } from '../../types/watchHistory';\r\nimport type { Playlist, PlaylistItem } from '../../types/playlist';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype WatchHistoryState = {\r\n  watchHistory: WatchHistoryItem[];\r\n  playlistItemsLoaded: boolean;\r\n  continueWatchingPlaylistId: string;\r\n  getItem: (item: PlaylistItem) => WatchHistoryItem | undefined;\r\n  getPlaylist: () => Playlist;\r\n  getDictionaryWithEpisodes: () => { [key: string]: number };\r\n  getDictionaryWithSeries: () => { [key: string]: number };\r\n};\r\n\r\nexport const useWatchHistoryStore = createStore<WatchHistoryState>('WatchHistoryStore', (_, get) => ({\r\n  watchHistory: [],\r\n  playlistItemsLoaded: false,\r\n  continueWatchingPlaylistId: PersonalShelf.ContinueWatching,\r\n  getItem: (item: PlaylistItem) =>\r\n    get().watchHistory.find(({ mediaid, progress }) => {\r\n      return mediaid === item.mediaid && progress > VideoProgressMinMax.Min && progress < VideoProgressMinMax.Max;\r\n    }),\r\n  getPlaylist: () =>\r\n    ({\r\n      feedid: get().continueWatchingPlaylistId || PersonalShelf.ContinueWatching,\r\n      title: 'Continue watching',\r\n      playlist: get()\r\n        .watchHistory.filter(({ playlistItem, progress }) => !!playlistItem && progress > VideoProgressMinMax.Min && progress < VideoProgressMinMax.Max)\r\n        .map(({ playlistItem }) => playlistItem),\r\n    } as Playlist),\r\n  getDictionaryWithEpisodes: () =>\r\n    get().watchHistory.reduce((dict: { [key: string]: number }, item) => {\r\n      const key = item.mediaid;\r\n\r\n      dict[key] = item.progress;\r\n\r\n      return dict;\r\n    }, {}),\r\n  getDictionaryWithSeries: () =>\r\n    get().watchHistory.reduce((dict: { [key: string]: number }, item) => {\r\n      const key = item.seriesId || item.mediaid;\r\n\r\n      dict[key] = item.progress;\r\n\r\n      return dict;\r\n    }, {}),\r\n}));\r\n","import { injectable } from 'inversify';\r\n\r\nimport WatchHistoryService from '../services/WatchHistoryService';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\nimport type { WatchHistoryItem } from '../../types/watchHistory';\r\nimport { useAccountStore } from '../stores/AccountStore';\r\nimport { useConfigStore } from '../stores/ConfigStore';\r\nimport { useWatchHistoryStore } from '../stores/WatchHistoryStore';\r\n\r\n@injectable()\r\nexport default class WatchHistoryController {\r\n  private readonly watchHistoryService: WatchHistoryService;\r\n\r\n  constructor(watchHistoryService: WatchHistoryService) {\r\n    this.watchHistoryService = watchHistoryService;\r\n  }\r\n\r\n  initialize = async () => {\r\n    await this.restoreWatchHistory();\r\n  };\r\n\r\n  restoreWatchHistory = async () => {\r\n    const { user } = useAccountStore.getState();\r\n    const continueWatchingList = useConfigStore.getState().config.features?.continueWatchingList;\r\n\r\n    if (!continueWatchingList) {\r\n      return;\r\n    }\r\n\r\n    const watchHistory = await this.watchHistoryService.getWatchHistory(user, continueWatchingList);\r\n\r\n    useWatchHistoryStore.setState({\r\n      watchHistory: watchHistory.filter((item): item is WatchHistoryItem => !!item?.mediaid),\r\n      playlistItemsLoaded: true,\r\n      continueWatchingPlaylistId: continueWatchingList,\r\n    });\r\n  };\r\n\r\n  persistWatchHistory = async () => {\r\n    const { watchHistory } = useWatchHistoryStore.getState();\r\n    const { user } = useAccountStore.getState();\r\n\r\n    await this.watchHistoryService.persistWatchHistory(watchHistory, user);\r\n  };\r\n\r\n  /**\r\n   *  If we already have an element with continue watching state, we:\r\n   *    1. Update the progress\r\n   *    2. Move the element to the continue watching list start\r\n   *  Otherwise:\r\n   *    1. Move the element to the continue watching list start\r\n   *    2. If there are many elements in continue watching state we remove the oldest one\r\n   */\r\n  saveItem = async (item: PlaylistItem, seriesItem: PlaylistItem | undefined, videoProgress: number | null) => {\r\n    const { watchHistory } = useWatchHistoryStore.getState();\r\n\r\n    if (!videoProgress) return;\r\n\r\n    const updatedHistory = await this.watchHistoryService.saveItem(item, seriesItem, videoProgress, watchHistory);\r\n\r\n    if (updatedHistory) {\r\n      useWatchHistoryStore.setState({ watchHistory: updatedHistory });\r\n      await this.persistWatchHistory();\r\n    }\r\n  };\r\n}\r\n","import type {\r\n  AddAdyenPaymentDetails,\r\n  CreateOrder,\r\n  DeletePaymentMethod,\r\n  FinalizeAdyenPaymentDetails,\r\n  GetAdyenPaymentSession,\r\n  GetDirectPostCardPayment,\r\n  GetEntitlements,\r\n  GetFinalizeAdyenPayment,\r\n  GetInitialAdyenPayment,\r\n  GetOffer,\r\n  GetOffers,\r\n  GetOrder,\r\n  GetPaymentMethods,\r\n  GetSubscriptionSwitch,\r\n  GetSubscriptionSwitches,\r\n  PaymentWithoutDetails,\r\n  PaymentWithPayPal,\r\n  SwitchSubscription,\r\n  UpdateOrder,\r\n  UpdatePaymentWithPayPal,\r\n} from '../../../types/checkout';\r\n\r\nexport default abstract class CheckoutService {\r\n  abstract getOffers: GetOffers;\r\n\r\n  abstract createOrder: CreateOrder;\r\n\r\n  abstract updateOrder: UpdateOrder;\r\n\r\n  abstract getPaymentMethods: GetPaymentMethods;\r\n\r\n  abstract paymentWithoutDetails: PaymentWithoutDetails;\r\n\r\n  abstract paymentWithPayPal: PaymentWithPayPal;\r\n\r\n  abstract getEntitlements: GetEntitlements;\r\n\r\n  abstract directPostCardPayment: GetDirectPostCardPayment;\r\n\r\n  abstract getOffer?: GetOffer;\r\n\r\n  abstract getOrder?: GetOrder;\r\n\r\n  abstract switchSubscription?: SwitchSubscription;\r\n\r\n  abstract getSubscriptionSwitches?: GetSubscriptionSwitches;\r\n\r\n  abstract getSubscriptionSwitch?: GetSubscriptionSwitch;\r\n\r\n  abstract createAdyenPaymentSession?: GetAdyenPaymentSession;\r\n\r\n  abstract initialAdyenPayment?: GetInitialAdyenPayment;\r\n\r\n  abstract finalizeAdyenPayment?: GetFinalizeAdyenPayment;\r\n\r\n  abstract updatePaymentMethodWithPayPal?: UpdatePaymentWithPayPal;\r\n\r\n  abstract deletePaymentMethod?: DeletePaymentMethod;\r\n\r\n  abstract addAdyenPaymentDetails?: AddAdyenPaymentDetails;\r\n\r\n  abstract finalizeAdyenPaymentDetails?: FinalizeAdyenPaymentDetails;\r\n}\r\n","import type {\r\n  ChangeSubscription,\r\n  FetchReceipt,\r\n  GetActivePayment,\r\n  GetActiveSubscription,\r\n  GetAllTransactions,\r\n  GetPaymentDetails,\r\n  GetSubscriptions,\r\n  GetTransactions,\r\n  UpdateCardDetails,\r\n  UpdateSubscription,\r\n} from '../../../types/subscription';\r\n\r\nexport default abstract class SubscriptionService {\r\n  abstract getActiveSubscription: GetActiveSubscription;\r\n\r\n  abstract getAllTransactions: GetAllTransactions;\r\n\r\n  abstract getActivePayment: GetActivePayment;\r\n\r\n  abstract getSubscriptions: GetSubscriptions;\r\n\r\n  abstract updateSubscription: UpdateSubscription;\r\n\r\n  abstract fetchReceipt: FetchReceipt;\r\n\r\n  abstract changeSubscription?: ChangeSubscription;\r\n\r\n  abstract updateCardDetails?: UpdateCardDetails;\r\n\r\n  abstract getPaymentDetails?: GetPaymentDetails;\r\n\r\n  abstract getTransactions?: GetTransactions;\r\n}\r\n","import type { Offer, Order, PaymentMethod } from '../../types/checkout';\r\nimport type { MediaOffer } from '../../types/media';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype CheckoutStore = {\r\n  requestedMediaOffers: MediaOffer[];\r\n  mediaOffers: Offer[];\r\n  subscriptionOffers: Offer[];\r\n  switchSubscriptionOffers: Offer[];\r\n  selectedOffer: Offer | null;\r\n  defaultOfferId: string | null;\r\n  order: Order | null;\r\n  paymentMethods: PaymentMethod[] | null;\r\n  setRequestedMediaOffers: (requestedMediaOffers: MediaOffer[]) => void;\r\n  setOrder: (order: Order | null) => void;\r\n  setPaymentMethods: (paymentMethods: PaymentMethod[] | null) => void;\r\n};\r\n\r\nexport const useCheckoutStore = createStore<CheckoutStore>('CheckoutStore', (set) => ({\r\n  requestedMediaOffers: [],\r\n  mediaOffers: [],\r\n  subscriptionOffers: [],\r\n  switchSubscriptionOffers: [],\r\n  selectedOffer: null,\r\n  defaultOfferId: null,\r\n  order: null,\r\n  paymentMethods: null,\r\n  setRequestedMediaOffers: (requestedMediaOffers) => set({ requestedMediaOffers }),\r\n  setOrder: (order) => set({ order }),\r\n  setPaymentMethods: (paymentMethods) => set({ paymentMethods }),\r\n}));\r\n","type FormValidationErrors = Record<string, string[]>;\r\n\r\nexport class FormValidationError extends Error {\r\n  public errors: FormValidationErrors;\r\n\r\n  constructor(errors: FormValidationErrors) {\r\n    super(Object.values(errors).flat().join(';'));\r\n\r\n    this.errors = errors;\r\n  }\r\n}\r\n","import type { Subscription } from '../../types/subscription';\r\n\r\nexport const determineSwitchDirection = (subscription: Subscription | null) => {\r\n  const currentPeriod = subscription?.period;\r\n\r\n  if (currentPeriod === 'month') return 'upgrade';\r\n  if (currentPeriod === 'year') return 'downgrade';\r\n\r\n  return 'upgrade'; // Default to 'upgrade' if the period is not 'month' or 'year'\r\n};\r\n","import { inject, injectable } from 'inversify';\r\nimport i18next from 'i18next';\r\n\r\nimport type {\r\n  AddAdyenPaymentDetailsResponse,\r\n  AdyenPaymentSession,\r\n  CardPaymentData,\r\n  CreateOrderArgs,\r\n  FinalizeAdyenPayment,\r\n  FinalizeAdyenPaymentDetailsResponse,\r\n  GetEntitlements,\r\n  GetOffers,\r\n  InitialAdyenPayment,\r\n  Offer,\r\n  Order,\r\n  Payment,\r\n  PaymentMethod,\r\n} from '../../types/checkout';\r\nimport CheckoutService from '../services/integrations/CheckoutService';\r\nimport SubscriptionService from '../services/integrations/SubscriptionService';\r\nimport type { IntegrationType } from '../../types/config';\r\nimport { assertModuleMethod, getNamedModule } from '../modules/container';\r\nimport { GET_CUSTOMER_IP, INTEGRATION_TYPE } from '../modules/types';\r\nimport type { GetCustomerIP } from '../../types/get-customer-ip';\r\nimport AccountService from '../services/integrations/AccountService';\r\nimport { useCheckoutStore } from '../stores/CheckoutStore';\r\nimport { useAccountStore } from '../stores/AccountStore';\r\nimport { FormValidationError } from '../errors/FormValidationError';\r\nimport { determineSwitchDirection } from '../utils/subscription';\r\n\r\n@injectable()\r\nexport default class CheckoutController {\r\n  private readonly accountService: AccountService;\r\n  private readonly checkoutService: CheckoutService;\r\n  private readonly subscriptionService: SubscriptionService;\r\n  private readonly getCustomerIP: GetCustomerIP;\r\n\r\n  constructor(@inject(INTEGRATION_TYPE) integrationType: IntegrationType, @inject(GET_CUSTOMER_IP) getCustomerIP: GetCustomerIP) {\r\n    this.getCustomerIP = getCustomerIP;\r\n    this.accountService = getNamedModule(AccountService, integrationType);\r\n    this.checkoutService = getNamedModule(CheckoutService, integrationType);\r\n    this.subscriptionService = getNamedModule(SubscriptionService, integrationType);\r\n  }\r\n\r\n  initialiseOffers = async () => {\r\n    const requestedMediaOffers = useCheckoutStore.getState().requestedMediaOffers;\r\n    const mediaOffers = requestedMediaOffers ? await this.getOffers({ offerIds: requestedMediaOffers.map(({ offerId }) => offerId) }) : [];\r\n    useCheckoutStore.setState({ mediaOffers });\r\n\r\n    if (!useCheckoutStore.getState().subscriptionOffers.length && this.accountService.svodOfferIds) {\r\n      const subscriptionOffers = await this.getOffers({ offerIds: this.accountService.svodOfferIds });\r\n      useCheckoutStore.setState({ subscriptionOffers });\r\n    }\r\n\r\n    if (!useCheckoutStore.getState().switchSubscriptionOffers.length) {\r\n      const subscriptionSwitches = await this.getSubscriptionSwitches();\r\n      const switchSubscriptionOffers = subscriptionSwitches ? await this.getOffers({ offerIds: subscriptionSwitches }) : [];\r\n      useCheckoutStore.setState({ switchSubscriptionOffers });\r\n    }\r\n  };\r\n\r\n  getSubscriptionOfferIds = () => this.accountService.svodOfferIds;\r\n\r\n  chooseOffer = async (selectedOffer: Offer) => {\r\n    useCheckoutStore.setState({ selectedOffer });\r\n  };\r\n\r\n  initialiseOrder = async (offer: Offer): Promise<void> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customer } = getAccountInfo();\r\n\r\n    const paymentMethods = await this.getPaymentMethods();\r\n    const paymentMethodId = paymentMethods[0]?.id;\r\n\r\n    const createOrderArgs: CreateOrderArgs = {\r\n      offer,\r\n      customerId: customer.id,\r\n      country: customer?.country || '',\r\n      paymentMethodId,\r\n    };\r\n\r\n    const response = await this.checkoutService.createOrder(createOrderArgs);\r\n\r\n    if (response?.errors?.length > 0) {\r\n      useCheckoutStore.getState().setOrder(null);\r\n\r\n      throw new Error(response?.errors[0]);\r\n    }\r\n\r\n    useCheckoutStore.getState().setOrder(response.responseData?.order);\r\n  };\r\n\r\n  updateOrder = async (order: Order, paymentMethodId?: number, couponCode?: string | null): Promise<void> => {\r\n    try {\r\n      const response = await this.checkoutService.updateOrder({ order, paymentMethodId, couponCode });\r\n\r\n      if (response.responseData.order) {\r\n        useCheckoutStore.getState().setOrder(response.responseData?.order);\r\n      }\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        if (error.message === 'Order not found') {\r\n          useCheckoutStore.getState().setOrder(null);\r\n        } else if (error.message === 'Invalid coupon code') {\r\n          throw new FormValidationError({ couponCode: [i18next.t('account:checkout.coupon_not_valid')] });\r\n        } else if (error.message === 'Invalid coupon code for this offer') {\r\n          throw new FormValidationError({ couponCode: [i18next.t('account:checkout.coupon_not_valid_for_offer')] });\r\n        }\r\n      }\r\n\r\n      throw new FormValidationError({ form: [i18next.t('error:unknown_error')] });\r\n    }\r\n  };\r\n\r\n  getPaymentMethods = async (): Promise<PaymentMethod[]> => {\r\n    const { paymentMethods } = useCheckoutStore.getState();\r\n\r\n    if (paymentMethods) return paymentMethods; // already fetched payment methods\r\n\r\n    const response = await this.checkoutService.getPaymentMethods();\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    useCheckoutStore.getState().setPaymentMethods(response.responseData?.paymentMethods);\r\n\r\n    return response.responseData?.paymentMethods;\r\n  };\r\n\r\n  //\r\n  paymentWithoutDetails = async (): Promise<Payment> => {\r\n    const { order } = useCheckoutStore.getState();\r\n\r\n    if (!order) throw new Error('No order created');\r\n\r\n    const response = await this.checkoutService.paymentWithoutDetails({ orderId: order.id });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n    if (response.responseData.rejectedReason) throw new Error(response.responseData.rejectedReason);\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  directPostCardPayment = async ({ cardPaymentPayload, referrer, returnUrl }: { cardPaymentPayload: CardPaymentData; referrer: string; returnUrl: string }) => {\r\n    const { order } = useCheckoutStore.getState();\r\n\r\n    if (!order) throw new Error('No order created');\r\n\r\n    return await this.checkoutService.directPostCardPayment(cardPaymentPayload, order, referrer, returnUrl);\r\n  };\r\n\r\n  createAdyenPaymentSession = async (returnUrl: string, isInitialPayment: boolean = true): Promise<AdyenPaymentSession> => {\r\n    const { order } = useCheckoutStore.getState();\r\n    const orderId = order?.id;\r\n\r\n    if (isInitialPayment && !orderId) throw new Error('There is no order to pay for');\r\n\r\n    assertModuleMethod(this.checkoutService.createAdyenPaymentSession, 'createAdyenPaymentSession is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.createAdyenPaymentSession({\r\n      orderId: orderId,\r\n      returnUrl: returnUrl,\r\n    });\r\n\r\n    if (response.errors.length > 0) {\r\n      throw new Error(response.errors[0]);\r\n    }\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  initialAdyenPayment = async (paymentMethod: AdyenPaymentMethod, returnUrl: string): Promise<InitialAdyenPayment> => {\r\n    const { order } = useCheckoutStore.getState();\r\n\r\n    if (!order) throw new Error('No order created');\r\n\r\n    assertModuleMethod(this.checkoutService.initialAdyenPayment, 'initialAdyenPayment is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.initialAdyenPayment({\r\n      orderId: order.id,\r\n      returnUrl: returnUrl,\r\n      paymentMethod,\r\n      customerIP: await this.getCustomerIP(),\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  finalizeAdyenPayment = async (details: unknown, orderId?: number, paymentData?: string): Promise<FinalizeAdyenPayment> => {\r\n    if (!orderId) throw new Error('No order created');\r\n\r\n    assertModuleMethod(this.checkoutService.finalizeAdyenPayment, 'finalizeAdyenPayment is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.finalizeAdyenPayment({\r\n      orderId,\r\n      details,\r\n      paymentData,\r\n    });\r\n\r\n    if (response.errors.length > 0) {\r\n      throw new Error(response.errors[0]);\r\n    }\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  paypalPayment = async ({\r\n    successUrl,\r\n    waitingUrl,\r\n    cancelUrl,\r\n    errorUrl,\r\n    couponCode = '',\r\n  }: {\r\n    successUrl: string;\r\n    waitingUrl: string;\r\n    cancelUrl: string;\r\n    errorUrl: string;\r\n    couponCode: string;\r\n  }): Promise<{ redirectUrl: string }> => {\r\n    const { order } = useCheckoutStore.getState();\r\n\r\n    if (!order) throw new Error('No order created');\r\n\r\n    const response = await this.checkoutService.paymentWithPayPal({\r\n      order: order,\r\n      successUrl,\r\n      waitingUrl,\r\n      cancelUrl,\r\n      errorUrl,\r\n      couponCode,\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    return {\r\n      redirectUrl: response.responseData.redirectUrl,\r\n    };\r\n  };\r\n\r\n  getSubscriptionSwitches = async (): Promise<string[] | null> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n\r\n    const { customerId } = getAccountInfo();\r\n    const { subscription } = useAccountStore.getState();\r\n\r\n    if (!subscription || !this.checkoutService.getSubscriptionSwitches) return null;\r\n\r\n    assertModuleMethod(this.checkoutService.getOffer, 'getOffer is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.getSubscriptionSwitches({\r\n      customerId: customerId,\r\n      offerId: subscription.offerId,\r\n    });\r\n\r\n    if (!response.responseData.available.length) return null;\r\n\r\n    return response.responseData.available.map(({ toOfferId }) => toOfferId);\r\n  };\r\n\r\n  switchSubscription = async () => {\r\n    const selectedOffer = useCheckoutStore.getState().selectedOffer;\r\n    const subscription = useAccountStore.getState().subscription;\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customerId } = getAccountInfo();\r\n\r\n    if (!selectedOffer || !subscription) throw new Error('No offer selected');\r\n\r\n    assertModuleMethod(this.checkoutService.switchSubscription, 'switchSubscription is not available in checkout service');\r\n\r\n    const switchDirection: 'upgrade' | 'downgrade' = determineSwitchDirection(subscription);\r\n\r\n    const switchSubscriptionPayload = {\r\n      toOfferId: selectedOffer.offerId,\r\n      customerId: customerId,\r\n      offerId: subscription.offerId,\r\n      switchDirection: switchDirection,\r\n    };\r\n\r\n    await this.checkoutService.switchSubscription(switchSubscriptionPayload);\r\n  };\r\n\r\n  changeSubscription = async ({ accessFeeId, subscriptionId }: { accessFeeId: string; subscriptionId: string }) => {\r\n    assertModuleMethod(this.subscriptionService.changeSubscription, 'changeSubscription is not available in subscription service');\r\n\r\n    const { responseData } = await this.subscriptionService.changeSubscription({\r\n      accessFeeId,\r\n      subscriptionId,\r\n    });\r\n\r\n    return responseData;\r\n  };\r\n\r\n  updatePayPalPaymentMethod = async (\r\n    successUrl: string,\r\n    waitingUrl: string,\r\n    cancelUrl: string,\r\n    errorUrl: string,\r\n    paymentMethodId: number,\r\n    currentPaymentId?: number,\r\n  ) => {\r\n    assertModuleMethod(this.checkoutService.updatePaymentMethodWithPayPal, 'updatePaymentMethodWithPayPal is not available in checkout service');\r\n    assertModuleMethod(this.checkoutService.deletePaymentMethod, 'deletePaymentMethod is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.updatePaymentMethodWithPayPal({\r\n      paymentMethodId,\r\n      successUrl,\r\n      waitingUrl,\r\n      cancelUrl,\r\n      errorUrl,\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    if (currentPaymentId) {\r\n      await this.checkoutService.deletePaymentMethod({ paymentDetailsId: currentPaymentId });\r\n    }\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  addAdyenPaymentDetails = async (paymentMethod: AdyenPaymentMethod, paymentMethodId: number, returnUrl: string): Promise<AddAdyenPaymentDetailsResponse> => {\r\n    assertModuleMethod(this.checkoutService.addAdyenPaymentDetails, 'addAdyenPaymentDetails is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.addAdyenPaymentDetails({\r\n      paymentMethodId,\r\n      returnUrl,\r\n      paymentMethod,\r\n      customerIP: await this.getCustomerIP(),\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  finalizeAdyenPaymentDetails = async (details: unknown, paymentMethodId: number, paymentData?: string): Promise<FinalizeAdyenPaymentDetailsResponse> => {\r\n    assertModuleMethod(this.checkoutService.finalizeAdyenPaymentDetails, 'finalizeAdyenPaymentDetails is not available in checkout service');\r\n\r\n    const response = await this.checkoutService.finalizeAdyenPaymentDetails({\r\n      paymentMethodId,\r\n      details,\r\n      paymentData,\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  getOffers: GetOffers = (payload) => {\r\n    return this.checkoutService.getOffers(payload);\r\n  };\r\n\r\n  getEntitlements: GetEntitlements = (payload) => {\r\n    return this.checkoutService.getEntitlements(payload);\r\n  };\r\n}\r\n","export default \"__VITE_ASSET__BFaAV$0k__\"","import defaultAvatar from '@jwp/ott-theme/assets/profiles/default_avatar.png';\r\n\r\nimport type { Profile } from '../../types/profiles';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype ProfileStore = {\r\n  profile: Profile | null;\r\n  selectingProfileAvatar: string | null;\r\n  canManageProfiles: boolean;\r\n  setProfile: (profile: Profile | null) => void;\r\n};\r\n\r\nexport const useProfileStore = createStore<ProfileStore>('AccountStore', () => ({\r\n  profile: null,\r\n  selectingProfileAvatar: null,\r\n  canManageProfiles: false,\r\n  setProfile: (profile) => {\r\n    useProfileStore.setState({\r\n      profile: profile\r\n        ? {\r\n            ...profile,\r\n            avatar_url: profile?.avatar_url || defaultAvatar,\r\n          }\r\n        : null,\r\n    });\r\n  },\r\n}));\r\n","import type { CreateProfile, DeleteProfile, EnterProfile, GetProfileDetails, ListProfiles, UpdateProfile } from '../../../types/profiles';\r\n\r\nexport default abstract class ProfileService {\r\n  abstract listProfiles: ListProfiles;\r\n\r\n  abstract createProfile: CreateProfile;\r\n\r\n  abstract updateProfile: UpdateProfile;\r\n\r\n  abstract enterProfile: EnterProfile;\r\n\r\n  abstract getProfileDetails: GetProfileDetails;\r\n\r\n  abstract deleteProfile: DeleteProfile;\r\n}\r\n","import { inject, injectable } from 'inversify';\r\nimport type { ProfilesData } from '@inplayer-org/inplayer.js';\r\nimport * as yup from 'yup';\r\n\r\nimport ProfileService from '../services/integrations/ProfileService';\r\nimport type { IntegrationType } from '../../types/config';\r\nimport { assertModuleMethod, getNamedModule } from '../modules/container';\r\nimport StorageService from '../services/StorageService';\r\nimport { INTEGRATION_TYPE } from '../modules/types';\r\nimport type { EnterProfilePayload, ProfileDetailsPayload, ProfilePayload } from '../../types/profiles';\r\nimport { useProfileStore } from '../stores/ProfileStore';\r\n\r\nconst PERSIST_PROFILE = 'profile';\r\n\r\nconst profileSchema = yup.object().shape({\r\n  id: yup.string().required(),\r\n  name: yup.string().required(),\r\n  avatar_url: yup.string(),\r\n  adult: yup.boolean().required(),\r\n  credentials: yup.object().shape({\r\n    access_token: yup.string().required(),\r\n    expires: yup.number().required(),\r\n  }),\r\n});\r\n\r\n@injectable()\r\nexport default class ProfileController {\r\n  private readonly profileService?: ProfileService;\r\n  private readonly storageService: StorageService;\r\n\r\n  constructor(@inject(INTEGRATION_TYPE) integrationType: IntegrationType, storageService: StorageService) {\r\n    this.profileService = getNamedModule(ProfileService, integrationType, false);\r\n    this.storageService = storageService;\r\n  }\r\n\r\n  private isValidProfile = (profile: unknown): profile is ProfilesData => {\r\n    try {\r\n      profileSchema.validateSync(profile);\r\n      return true;\r\n    } catch (e: unknown) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  isEnabled() {\r\n    return !!this.profileService;\r\n  }\r\n\r\n  listProfiles = async () => {\r\n    assertModuleMethod(this.profileService?.listProfiles, 'listProfiles is not available in profile service');\r\n\r\n    return this.profileService.listProfiles(undefined);\r\n  };\r\n\r\n  createProfile = async ({ name, adult, avatar_url, pin }: ProfilePayload) => {\r\n    assertModuleMethod(this.profileService?.createProfile, 'createProfile is not available in profile service');\r\n\r\n    return this.profileService.createProfile({ name, adult, avatar_url, pin });\r\n  };\r\n\r\n  updateProfile = async ({ id, name, adult, avatar_url, pin }: ProfilePayload) => {\r\n    assertModuleMethod(this.profileService?.updateProfile, 'updateProfile is not available in profile service');\r\n\r\n    return this.profileService.updateProfile({ id, name, adult, avatar_url, pin });\r\n  };\r\n\r\n  enterProfile = async ({ id, pin }: EnterProfilePayload) => {\r\n    assertModuleMethod(this.profileService?.enterProfile, 'enterProfile is not available in profile service');\r\n\r\n    const profile = await this.profileService.enterProfile({ id, pin });\r\n\r\n    if (!profile) {\r\n      throw new Error('Unable to enter profile');\r\n    }\r\n\r\n    await this.initializeProfile({ profile });\r\n  };\r\n\r\n  deleteProfile = async ({ id }: ProfileDetailsPayload) => {\r\n    assertModuleMethod(this.profileService?.deleteProfile, 'deleteProfile is not available in profile service');\r\n\r\n    return this.profileService.deleteProfile({ id });\r\n  };\r\n\r\n  getProfileDetails = async ({ id }: ProfileDetailsPayload) => {\r\n    assertModuleMethod(this.profileService?.getProfileDetails, 'getProfileDetails is not available in profile service');\r\n\r\n    return this.profileService.getProfileDetails({ id });\r\n  };\r\n\r\n  persistProfile = ({ profile }: { profile: ProfilesData }) => {\r\n    this.storageService.setItem(PERSIST_PROFILE, JSON.stringify(profile));\r\n  };\r\n\r\n  unpersistProfile = async () => {\r\n    await this.storageService.removeItem(PERSIST_PROFILE);\r\n  };\r\n\r\n  loadPersistedProfile = async () => {\r\n    const profile = await this.storageService.getItem(PERSIST_PROFILE, true);\r\n\r\n    if (this.isValidProfile(profile)) {\r\n      useProfileStore.getState().setProfile(profile);\r\n      return profile;\r\n    }\r\n\r\n    useProfileStore.getState().setProfile(null);\r\n\r\n    return null;\r\n  };\r\n\r\n  initializeProfile = async ({ profile }: { profile: ProfilesData }) => {\r\n    this.persistProfile({ profile });\r\n    useProfileStore.getState().setProfile(profile);\r\n\r\n    return profile;\r\n  };\r\n}\r\n","import { PersonalShelf } from '../constants';\r\nimport type { Favorite } from '../../types/favorite';\r\nimport type { Playlist, PlaylistItem } from '../../types/playlist';\r\n\r\nimport { createStore } from './utils';\r\n\r\ntype FavoritesState = {\r\n  favorites: Favorite[];\r\n  warning: string | null;\r\n  favoritesPlaylistId: string;\r\n  hasItem: (item: PlaylistItem) => boolean;\r\n  getPlaylist: () => Playlist;\r\n  setWarning: (warning: string) => void;\r\n  clearWarning: () => void;\r\n};\r\n\r\nexport const useFavoritesStore = createStore<FavoritesState>('FavoritesState', (set, get) => ({\r\n  favorites: [],\r\n  warning: null,\r\n  favoritesPlaylistId: PersonalShelf.Favorites,\r\n  setWarning: (message: string | null) => set({ warning: message }),\r\n  clearWarning: () => set({ warning: null }),\r\n  hasItem: (item: PlaylistItem) => get().favorites.some((favoriteItem) => favoriteItem.mediaid === item.mediaid),\r\n  getPlaylist: () =>\r\n    ({\r\n      feedid: get().favoritesPlaylistId || PersonalShelf.Favorites,\r\n      title: 'Favorites',\r\n      playlist: get().favorites.map(({ playlistItem }) => playlistItem),\r\n    } as Playlist),\r\n}));\r\n","import i18next from 'i18next';\r\nimport { injectable } from 'inversify';\r\n\r\nimport FavoriteService from '../services/FavoriteService';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\nimport { useAccountStore } from '../stores/AccountStore';\r\nimport { useFavoritesStore } from '../stores/FavoritesStore';\r\nimport { useConfigStore } from '../stores/ConfigStore';\r\n\r\n@injectable()\r\nexport default class FavoritesController {\r\n  private readonly favoritesService: FavoriteService;\r\n\r\n  constructor(favoritesService: FavoriteService) {\r\n    this.favoritesService = favoritesService;\r\n  }\r\n\r\n  initialize = async () => {\r\n    await this.restoreFavorites();\r\n  };\r\n\r\n  restoreFavorites = async () => {\r\n    const { user } = useAccountStore.getState();\r\n    const favoritesList = useConfigStore.getState().config.features?.favoritesList;\r\n\r\n    if (!favoritesList) {\r\n      return;\r\n    }\r\n\r\n    const favorites = await this.favoritesService.getFavorites(user, favoritesList);\r\n\r\n    useFavoritesStore.setState({ favorites, favoritesPlaylistId: favoritesList });\r\n  };\r\n\r\n  persistFavorites = async () => {\r\n    const { favorites } = useFavoritesStore.getState();\r\n    const { user } = useAccountStore.getState();\r\n\r\n    await this.favoritesService.persistFavorites(favorites, user);\r\n  };\r\n\r\n  saveItem = async (item: PlaylistItem) => {\r\n    const { favorites } = useFavoritesStore.getState();\r\n\r\n    if (!favorites.some(({ mediaid }) => mediaid === item.mediaid)) {\r\n      const items = [this.favoritesService.createFavorite(item)].concat(favorites);\r\n      useFavoritesStore.setState({ favorites: items });\r\n      await this.persistFavorites();\r\n    }\r\n  };\r\n\r\n  removeItem = async (item: PlaylistItem) => {\r\n    const { favorites } = useFavoritesStore.getState();\r\n\r\n    const items = favorites.filter(({ mediaid }) => mediaid !== item.mediaid);\r\n    useFavoritesStore.setState({ favorites: items });\r\n\r\n    await this.persistFavorites();\r\n  };\r\n\r\n  toggleFavorite = async (item: PlaylistItem | undefined) => {\r\n    const { favorites, hasItem, setWarning } = useFavoritesStore.getState();\r\n\r\n    if (!item) {\r\n      return;\r\n    }\r\n\r\n    const isFavorite = hasItem(item);\r\n\r\n    if (isFavorite) {\r\n      await this.removeItem(item);\r\n\r\n      return;\r\n    }\r\n\r\n    // If we exceed the max available number of favorites, we show a warning\r\n    if (favorites.length > this.favoritesService.getMaxFavoritesCount()) {\r\n      setWarning(i18next.t('video:favorites_warning', { maxCount: this.favoritesService.getMaxFavoritesCount() }));\r\n      return;\r\n    }\r\n\r\n    await this.saveItem(item);\r\n  };\r\n\r\n  clear = async () => {\r\n    useFavoritesStore.setState({ favorites: [] });\r\n\r\n    await this.persistFavorites();\r\n  };\r\n}\r\n","import i18next from 'i18next';\r\nimport { inject, injectable } from 'inversify';\r\n\r\nimport { DEFAULT_FEATURES } from '../constants';\r\nimport { logDev } from '../utils/common';\r\nimport type { IntegrationType } from '../../types/config';\r\nimport CheckoutService from '../services/integrations/CheckoutService';\r\nimport AccountService, { type AccountServiceFeatures } from '../services/integrations/AccountService';\r\nimport SubscriptionService from '../services/integrations/SubscriptionService';\r\nimport type { Offer } from '../../types/checkout';\r\nimport type {\r\n  Capture,\r\n  Customer,\r\n  CustomerConsent,\r\n  EmailConfirmPasswordInput,\r\n  FirstLastNameInput,\r\n  GetCaptureStatusResponse,\r\n  SubscribeToNotificationsPayload,\r\n} from '../../types/account';\r\nimport { assertFeature, assertModuleMethod, getNamedModule } from '../modules/container';\r\nimport { INTEGRATION_TYPE } from '../modules/types';\r\nimport type { ServiceResponse } from '../../types/service';\r\nimport { useAccountStore } from '../stores/AccountStore';\r\nimport { useConfigStore } from '../stores/ConfigStore';\r\nimport { useProfileStore } from '../stores/ProfileStore';\r\nimport { FormValidationError } from '../errors/FormValidationError';\r\n\r\nimport WatchHistoryController from './WatchHistoryController';\r\nimport ProfileController from './ProfileController';\r\nimport FavoritesController from './FavoritesController';\r\n\r\n@injectable()\r\nexport default class AccountController {\r\n  private readonly checkoutService: CheckoutService;\r\n  private readonly accountService: AccountService;\r\n  private readonly subscriptionService: SubscriptionService;\r\n  private readonly profileController: ProfileController;\r\n  private readonly favoritesController: FavoritesController;\r\n  private readonly watchHistoryController: WatchHistoryController;\r\n  private readonly features: AccountServiceFeatures;\r\n\r\n  // temporary callback for refreshing the query cache until we've updated to react-query v4 or v5\r\n  private refreshEntitlements: (() => Promise<void>) | undefined;\r\n\r\n  constructor(\r\n    @inject(INTEGRATION_TYPE) integrationType: IntegrationType,\r\n    favoritesController: FavoritesController,\r\n    watchHistoryController: WatchHistoryController,\r\n    profileController: ProfileController,\r\n  ) {\r\n    this.checkoutService = getNamedModule(CheckoutService, integrationType);\r\n    this.accountService = getNamedModule(AccountService, integrationType);\r\n    this.subscriptionService = getNamedModule(SubscriptionService, integrationType);\r\n\r\n    // @TODO: Controllers shouldn't be depending on other controllers, but we've agreed to keep this as is for now\r\n    this.favoritesController = favoritesController;\r\n    this.watchHistoryController = watchHistoryController;\r\n    this.profileController = profileController;\r\n\r\n    this.features = integrationType ? this.accountService.features : DEFAULT_FEATURES;\r\n  }\r\n\r\n  loadUserData = async () => {\r\n    try {\r\n      const authData = await this.accountService.getAuthData();\r\n\r\n      if (authData) {\r\n        await this.getAccount();\r\n      }\r\n    } catch (error: unknown) {\r\n      logDev('Failed to get user', error);\r\n\r\n      // clear the session when the token was invalid\r\n      // don't clear the session when the error is unknown (network hiccup or something similar)\r\n      if (error instanceof Error && error.message.includes('Invalid JWT token')) {\r\n        await this.logout();\r\n      }\r\n    }\r\n  };\r\n\r\n  initialize = async (url: string, refreshEntitlements?: () => Promise<void>) => {\r\n    this.refreshEntitlements = refreshEntitlements;\r\n\r\n    useAccountStore.setState({ loading: true });\r\n    const config = useConfigStore.getState().config;\r\n\r\n    await this.profileController?.loadPersistedProfile();\r\n    await this.accountService.initialize(config, url, this.logout);\r\n\r\n    // set the accessModel before restoring the user session\r\n    useConfigStore.setState({ accessModel: this.accountService.accessModel });\r\n\r\n    await this.loadUserData();\r\n\r\n    useAccountStore.setState({ loading: false });\r\n  };\r\n\r\n  getSandbox() {\r\n    return this.accountService.sandbox;\r\n  }\r\n\r\n  updateUser = async (values: FirstLastNameInput | EmailConfirmPasswordInput): Promise<ServiceResponse<Customer>> => {\r\n    useAccountStore.setState({ loading: true });\r\n\r\n    const { user } = useAccountStore.getState();\r\n    const { canUpdateEmail, canSupportEmptyFullName } = this.getFeatures();\r\n\r\n    if (Object.prototype.hasOwnProperty.call(values, 'email') && !canUpdateEmail) {\r\n      throw new Error('Email update not supported');\r\n    }\r\n\r\n    if (!user) {\r\n      throw new Error('User not logged in');\r\n    }\r\n\r\n    const errors = this.validateInputLength(values as FirstLastNameInput);\r\n    if (errors.length) {\r\n      return {\r\n        errors,\r\n        responseData: {} as Customer,\r\n      };\r\n    }\r\n\r\n    let payload = values;\r\n    // this is needed as a fallback when the name is empty (cannot be empty on JWP integration)\r\n    if (!canSupportEmptyFullName) {\r\n      payload = { ...values, email: user.email };\r\n    }\r\n\r\n    const updatedUser = await this.accountService.updateCustomer({ ...payload, id: user.id.toString() });\r\n\r\n    if (!updatedUser) {\r\n      throw new Error('Unknown error');\r\n    }\r\n\r\n    useAccountStore.setState({ user: updatedUser });\r\n\r\n    return { errors: [], responseData: updatedUser };\r\n  };\r\n\r\n  getAccount = async () => {\r\n    const { config } = useConfigStore.getState();\r\n\r\n    try {\r\n      const response = await this.accountService.getUser({ config });\r\n\r\n      if (response) {\r\n        await this.afterLogin(response.user, response.customerConsents);\r\n      }\r\n\r\n      useAccountStore.setState({ loading: false });\r\n    } catch (error: unknown) {\r\n      useAccountStore.setState({\r\n        user: null,\r\n        subscription: null,\r\n        transactions: null,\r\n        activePayment: null,\r\n        customerConsents: null,\r\n        publisherConsents: null,\r\n        loading: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  login = async (email: string, password: string, referrer: string) => {\r\n    useAccountStore.setState({ loading: true });\r\n\r\n    try {\r\n      const response = await this.accountService.login({ email, password, referrer });\r\n\r\n      if (response) {\r\n        await this.afterLogin(response.user, response.customerConsents);\r\n        return;\r\n      }\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error && error.message.toLowerCase().includes('invalid param email')) {\r\n        throw new FormValidationError({ email: [i18next.t('account:login.wrong_email')] });\r\n      }\r\n    } finally {\r\n      useAccountStore.setState({ loading: false });\r\n    }\r\n\r\n    // consider any unknown response as a wrong combinations error (we could specify this even more)\r\n    throw new FormValidationError({ form: [i18next.t('account:login.wrong_combination')] });\r\n  };\r\n\r\n  logout = async () => {\r\n    await this.accountService?.logout();\r\n    await this.clearLoginState();\r\n\r\n    // let the application know to refresh all entitlements\r\n    await this.refreshEntitlements?.();\r\n  };\r\n\r\n  register = async (email: string, password: string, referrer: string, consentsValues: CustomerConsent[]) => {\r\n    try {\r\n      const response = await this.accountService.register({ email, password, consents: consentsValues, referrer });\r\n\r\n      if (response) {\r\n        const { user, customerConsents } = response;\r\n        await this.afterLogin(user, customerConsents, true);\r\n\r\n        return;\r\n      }\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        const errorMessage = error.message.toLowerCase();\r\n\r\n        if (errorMessage.includes('customer already exists') || errorMessage.includes('account already exists')) {\r\n          throw new FormValidationError({ form: [i18next.t('account:registration.user_exists')] });\r\n        } else if (errorMessage.includes('please enter a valid e-mail address')) {\r\n          throw new FormValidationError({ email: [i18next.t('account:registration.field_is_not_valid_email')] });\r\n        } else if (errorMessage.includes('invalid param password')) {\r\n          throw new FormValidationError({ password: [i18next.t('account:registration.invalid_password')] });\r\n        }\r\n      }\r\n    }\r\n\r\n    // in case the endpoint fails\r\n    throw new FormValidationError({ form: [i18next.t('account:registration.failed_to_create')] });\r\n  };\r\n\r\n  updateConsents = async (customerConsents: CustomerConsent[]): Promise<ServiceResponse<CustomerConsent[]>> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customer } = getAccountInfo();\r\n\r\n    useAccountStore.setState({ loading: true });\r\n\r\n    try {\r\n      const updatedConsents = await this.accountService?.updateCustomerConsents({\r\n        customer,\r\n        consents: customerConsents,\r\n      });\r\n\r\n      if (updatedConsents) {\r\n        useAccountStore.setState({ customerConsents: updatedConsents });\r\n        return {\r\n          responseData: updatedConsents,\r\n          errors: [],\r\n        };\r\n      }\r\n      return {\r\n        responseData: [],\r\n        errors: [],\r\n      };\r\n    } finally {\r\n      useAccountStore.setState({ loading: false });\r\n    }\r\n  };\r\n\r\n  // TODO: Decide if it's worth keeping this or just leave combined with getUser\r\n  // noinspection JSUnusedGlobalSymbols\r\n  getCustomerConsents = async () => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customer } = getAccountInfo();\r\n\r\n    const consents = await this.accountService.getCustomerConsents({ customer });\r\n\r\n    if (consents) {\r\n      useAccountStore.setState({ customerConsents: consents });\r\n    }\r\n\r\n    return consents;\r\n  };\r\n\r\n  getPublisherConsents = async () => {\r\n    const { config } = useConfigStore.getState();\r\n\r\n    useAccountStore.setState({ publisherConsentsLoading: true });\r\n    const consents = await this.accountService.getPublisherConsents(config);\r\n\r\n    useAccountStore.setState({ publisherConsents: consents, publisherConsentsLoading: false });\r\n  };\r\n\r\n  getCaptureStatus = async (): Promise<GetCaptureStatusResponse> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customer } = getAccountInfo();\r\n\r\n    return this.accountService.getCaptureStatus({ customer });\r\n  };\r\n\r\n  updateCaptureAnswers = async (capture: Capture): Promise<Capture> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customer, customerConsents } = getAccountInfo();\r\n\r\n    const updatedCustomer = await this.accountService.updateCaptureAnswers({ customer, ...capture });\r\n\r\n    useAccountStore.setState({\r\n      user: updatedCustomer,\r\n      customerConsents,\r\n    });\r\n\r\n    return updatedCustomer;\r\n  };\r\n\r\n  resetPassword = async (email: string, resetUrl: string) => {\r\n    await this.accountService.resetPassword({\r\n      customerEmail: email,\r\n      resetUrl,\r\n    });\r\n  };\r\n\r\n  changePasswordWithOldPassword = async (oldPassword: string, newPassword: string, newPasswordConfirmation: string) => {\r\n    await this.accountService.changePasswordWithOldPassword({\r\n      oldPassword,\r\n      newPassword,\r\n      newPasswordConfirmation,\r\n    });\r\n  };\r\n\r\n  changePasswordWithToken = async (customerEmail: string, newPassword: string, resetPasswordToken: string, newPasswordConfirmation: string) => {\r\n    await this.accountService.changePasswordWithResetToken({\r\n      customerEmail,\r\n      newPassword,\r\n      resetPasswordToken,\r\n      newPasswordConfirmation,\r\n    });\r\n  };\r\n\r\n  updateSubscription = async (status: 'active' | 'cancelled'): Promise<unknown> => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n\r\n    const { customerId } = getAccountInfo();\r\n\r\n    const { subscription } = useAccountStore.getState();\r\n    if (!subscription) throw new Error('user has no active subscription');\r\n\r\n    const response = await this.subscriptionService?.updateSubscription({\r\n      customerId,\r\n      offerId: subscription.offerId,\r\n      status,\r\n      unsubscribeUrl: subscription.unsubscribeUrl,\r\n    });\r\n\r\n    if (response.errors.length > 0) throw new Error(response.errors[0]);\r\n\r\n    await this.reloadSubscriptions({ retry: 10 });\r\n\r\n    return response?.responseData;\r\n  };\r\n\r\n  updateCardDetails = async ({\r\n    cardName,\r\n    cardNumber,\r\n    cvc,\r\n    expMonth,\r\n    expYear,\r\n    currency,\r\n  }: {\r\n    cardName: string;\r\n    cardNumber: string;\r\n    cvc: number;\r\n    expMonth: number;\r\n    expYear: number;\r\n    currency: string;\r\n  }) => {\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n\r\n    const { customerId } = getAccountInfo();\r\n\r\n    assertModuleMethod(this.subscriptionService.updateCardDetails, 'updateCardDetails is not available in subscription service');\r\n\r\n    const response = await this.subscriptionService.updateCardDetails({\r\n      cardName,\r\n      cardNumber,\r\n      cvc,\r\n      expMonth,\r\n      expYear,\r\n      currency,\r\n    });\r\n    const activePayment = (await this.subscriptionService.getActivePayment({ customerId })) || null;\r\n\r\n    useAccountStore.setState({\r\n      loading: false,\r\n      activePayment,\r\n    });\r\n    return response;\r\n  };\r\n\r\n  checkEntitlements = async (offerId?: string): Promise<unknown> => {\r\n    if (!offerId) {\r\n      return false;\r\n    }\r\n\r\n    const { responseData } = await this.checkoutService.getEntitlements({ offerId });\r\n    return !!responseData?.accessGranted;\r\n  };\r\n\r\n  reloadSubscriptions = async ({ delay, retry }: { delay?: number; retry?: number } = { delay: 0, retry: 0 }): Promise<unknown> => {\r\n    useAccountStore.setState({ loading: true });\r\n\r\n    const { getAccountInfo } = useAccountStore.getState();\r\n    const { customerId } = getAccountInfo();\r\n    const { accessModel } = useConfigStore.getState();\r\n\r\n    // The subscription data takes a few seconds to load after it's purchased,\r\n    // so here's a delay mechanism to give it time to process\r\n    if (delay && delay > 0) {\r\n      return new Promise((resolve: (value?: unknown) => void) => {\r\n        setTimeout(() => {\r\n          this.reloadSubscriptions({ retry }).finally(resolve);\r\n        }, delay);\r\n      });\r\n    }\r\n\r\n    // For non-SVOD platforms, there could be TVOD items, so we only reload entitlements\r\n    if (accessModel !== 'SVOD') {\r\n      await this.refreshEntitlements?.();\r\n\r\n      return useAccountStore.setState({ loading: false });\r\n    }\r\n\r\n    const [activeSubscription, transactions, activePayment] = await Promise.all([\r\n      this.subscriptionService.getActiveSubscription({ customerId }),\r\n      this.subscriptionService.getAllTransactions({ customerId }),\r\n      this.subscriptionService.getActivePayment({ customerId }),\r\n    ]);\r\n\r\n    let pendingOffer: Offer | null = null;\r\n\r\n    if (!activeSubscription && !!retry && retry > 0) {\r\n      const retryDelay = 1500; // Any initial delay has already occurred, so we can set this to a fixed value\r\n\r\n      return await this.reloadSubscriptions({ delay: retryDelay, retry: retry - 1 });\r\n    }\r\n\r\n    // resolve and fetch the pending offer after upgrade/downgrade\r\n    try {\r\n      if (activeSubscription?.pendingSwitchId) {\r\n        assertModuleMethod(this.checkoutService.getOffer, 'getOffer is not available in checkout service');\r\n        assertModuleMethod(this.checkoutService.getSubscriptionSwitch, 'getSubscriptionSwitch is not available in checkout service');\r\n\r\n        const switchOffer = await this.checkoutService.getSubscriptionSwitch({ switchId: activeSubscription.pendingSwitchId });\r\n        const offerResponse = await this.checkoutService.getOffer({ offerId: switchOffer.responseData.toOfferId });\r\n\r\n        pendingOffer = offerResponse.responseData;\r\n      }\r\n    } catch (error: unknown) {\r\n      logDev('Failed to fetch the pending offer', error);\r\n    }\r\n\r\n    // let the app know to refresh the entitlements\r\n    await this.refreshEntitlements?.();\r\n\r\n    useAccountStore.setState({\r\n      subscription: activeSubscription,\r\n      loading: false,\r\n      pendingOffer,\r\n      transactions,\r\n      activePayment,\r\n    });\r\n  };\r\n\r\n  exportAccountData = async () => {\r\n    const { canExportAccountData } = this.getFeatures();\r\n\r\n    assertModuleMethod(this.accountService.exportAccountData, 'exportAccountData is not available in account service');\r\n    assertFeature(canExportAccountData, 'Export account');\r\n\r\n    return this.accountService?.exportAccountData(undefined);\r\n  };\r\n\r\n  getSocialLoginUrls = (redirectUrl: string) => {\r\n    const { hasSocialURLs } = this.getFeatures();\r\n\r\n    assertModuleMethod(this.accountService.getSocialUrls, 'getSocialUrls is not available in account service');\r\n    assertFeature(hasSocialURLs, 'Social logins');\r\n\r\n    return this.accountService.getSocialUrls({ redirectUrl });\r\n  };\r\n\r\n  deleteAccountData = async (password: string) => {\r\n    const { canDeleteAccount } = this.getFeatures();\r\n\r\n    assertModuleMethod(this.accountService.deleteAccount, 'deleteAccount is not available in account service');\r\n    assertFeature(canDeleteAccount, 'Delete account');\r\n\r\n    try {\r\n      await this.accountService.deleteAccount({ password });\r\n    } catch (error: unknown) {\r\n      const message = error instanceof Error ? error.message.toLowerCase() : '';\r\n\r\n      if (message.includes('invalid credentials')) {\r\n        throw new FormValidationError({ form: [i18next.t('user:account.delete_account.invalid_credentials')] });\r\n      }\r\n\r\n      throw new FormValidationError({ form: [i18next.t('user:account.delete_account.error')] });\r\n    }\r\n  };\r\n\r\n  getReceipt = async (transactionId: string) => {\r\n    assertModuleMethod(this.subscriptionService.fetchReceipt, 'fetchReceipt is not available in subscription service');\r\n\r\n    const { responseData } = await this.subscriptionService.fetchReceipt({ transactionId });\r\n\r\n    return responseData;\r\n  };\r\n\r\n  getAuthData = async () => {\r\n    return this.accountService.getAuthData();\r\n  };\r\n\r\n  subscribeToNotifications = async ({ uuid, onMessage }: SubscribeToNotificationsPayload) => {\r\n    return this.accountService.subscribeToNotifications({ uuid, onMessage });\r\n  };\r\n\r\n  getFeatures() {\r\n    return this.features;\r\n  }\r\n\r\n  private async afterLogin(user: Customer, customerConsents: CustomerConsent[] | null, registration = false) {\r\n    useAccountStore.setState({\r\n      user,\r\n      customerConsents,\r\n    });\r\n\r\n    await Promise.allSettled([\r\n      this.reloadSubscriptions(),\r\n      this.getPublisherConsents(),\r\n      // after registration, transfer the personal shelves to the account\r\n      registration ? this.favoritesController.persistFavorites() : this.favoritesController.restoreFavorites(),\r\n      registration ? this.watchHistoryController.persistWatchHistory() : this.watchHistoryController.restoreWatchHistory(),\r\n    ]);\r\n\r\n    useAccountStore.setState({ loading: false });\r\n  }\r\n\r\n  private validateInputLength = (values: { firstName: string; lastName: string }) => {\r\n    const errors: string[] = [];\r\n    if (Number(values?.firstName?.length) > 50) {\r\n      errors.push(i18next.t('account:validation.first_name'));\r\n    }\r\n    if (Number(values?.lastName?.length) > 50) {\r\n      errors.push(i18next.t('account:validation.last_name'));\r\n    }\r\n\r\n    return errors;\r\n  };\r\n\r\n  private clearLoginState = async () => {\r\n    useAccountStore.setState({\r\n      user: null,\r\n      subscription: null,\r\n      transactions: null,\r\n      activePayment: null,\r\n      customerConsents: null,\r\n      publisherConsents: null,\r\n      loading: false,\r\n    });\r\n\r\n    useProfileStore.setState({\r\n      profile: null,\r\n      selectingProfileAvatar: null,\r\n    });\r\n\r\n    this.profileController.unpersistProfile();\r\n\r\n    await this.favoritesController.restoreFavorites();\r\n    await this.watchHistoryController.restoreWatchHistory();\r\n  };\r\n}\r\n","import merge from 'lodash.merge';\r\nimport { inject, injectable } from 'inversify';\r\n\r\nimport { PersonalShelf } from '../constants';\r\nimport SettingsService from '../services/SettingsService';\r\nimport ConfigService from '../services/ConfigService';\r\nimport { container, getModule } from '../modules/container';\r\nimport StorageService from '../services/StorageService';\r\nimport type { Config } from '../../types/config';\r\nimport type { CalculateIntegrationType } from '../../types/calculate-integration-type';\r\nimport { DETERMINE_INTEGRATION_TYPE } from '../modules/types';\r\nimport { useConfigStore } from '../stores/ConfigStore';\r\n\r\nimport WatchHistoryController from './WatchHistoryController';\r\nimport FavoritesController from './FavoritesController';\r\nimport AccountController from './AccountController';\r\n\r\n@injectable()\r\nexport default class AppController {\r\n  private readonly configService: ConfigService;\r\n  private readonly settingsService: SettingsService;\r\n  private readonly storageService: StorageService;\r\n\r\n  constructor(\r\n    @inject(ConfigService) configService: ConfigService,\r\n    @inject(SettingsService) settingsService: SettingsService,\r\n    @inject(StorageService) storageService: StorageService,\r\n  ) {\r\n    this.configService = configService;\r\n    this.settingsService = settingsService;\r\n    this.storageService = storageService;\r\n  }\r\n\r\n  loadAndValidateConfig = async (configSource: string | undefined) => {\r\n    const configLocation = this.configService.formatSourceLocation(configSource);\r\n    const defaultConfig = this.configService.getDefaultConfig();\r\n\r\n    if (!configLocation) {\r\n      useConfigStore.setState({ config: defaultConfig });\r\n    }\r\n\r\n    let config = await this.configService.loadConfig(configLocation);\r\n\r\n    config.id = configSource;\r\n    config.assets = config.assets || {};\r\n\r\n    // make sure the banner always defaults to the JWP banner when not defined in the config\r\n    if (!config.assets.banner) {\r\n      config.assets.banner = defaultConfig.assets.banner;\r\n    }\r\n\r\n    // Store the logo right away and set css variables so the error page will be branded\r\n    const banner = config.assets.banner;\r\n\r\n    useConfigStore.setState((s) => {\r\n      s.config.assets.banner = banner;\r\n    });\r\n\r\n    config = await this.configService.validateConfig(config);\r\n    config = merge({}, defaultConfig, config);\r\n\r\n    return config;\r\n  };\r\n\r\n  initializeApp = async (url: string, refreshEntitlements?: () => Promise<void>) => {\r\n    const settings = await this.settingsService.initialize();\r\n    const configSource = await this.settingsService.getConfigSource(settings, url);\r\n    const config = await this.loadAndValidateConfig(configSource);\r\n    const integrationType = this.calculateIntegrationType(config);\r\n\r\n    // update the config store\r\n    useConfigStore.setState({ config, loaded: true, integrationType });\r\n\r\n    // we could add the configSource to the storage prefix, but this would cause a breaking change for end users\r\n    // (since 'window.configId' isn't used anymore, all platforms currently use the same prefix)\r\n    this.storageService.initialize('jwapp');\r\n\r\n    // update settings in the config store\r\n    useConfigStore.setState({ settings });\r\n\r\n    // when an integration is set, we initialize the AccountController\r\n    if (integrationType) {\r\n      await getModule(AccountController).initialize(url, refreshEntitlements);\r\n    }\r\n\r\n    if (config.features?.continueWatchingList && config.content.some((el) => el.type === PersonalShelf.ContinueWatching)) {\r\n      await getModule(WatchHistoryController).initialize();\r\n    }\r\n\r\n    if (config.features?.favoritesList && config.content.some((el) => el.type === PersonalShelf.Favorites)) {\r\n      await getModule(FavoritesController).initialize();\r\n    }\r\n\r\n    return { config, settings, configSource };\r\n  };\r\n\r\n  calculateIntegrationType = (config: Config) => {\r\n    const registerIntegrationTypes = container.getAll<CalculateIntegrationType>(DETERMINE_INTEGRATION_TYPE);\r\n\r\n    const activatedIntegrationTypes = registerIntegrationTypes.reduce((previousValue, calculateIntegrationType) => {\r\n      const integrationType = calculateIntegrationType(config);\r\n\r\n      return integrationType ? [...previousValue, integrationType] : previousValue;\r\n    }, [] as string[]);\r\n\r\n    if (activatedIntegrationTypes.length > 1) {\r\n      throw new Error(`Failed to initialize app, more than 1 integrations are enabled: ${activatedIntegrationTypes.join(', ')}`);\r\n    }\r\n\r\n    return activatedIntegrationTypes[0] || null;\r\n  };\r\n\r\n  getIntegrationType = (): string | null => {\r\n    const configState = useConfigStore.getState();\r\n\r\n    if (!configState.loaded) throw new Error('A call to `AppController#getIntegrationType()` was made before loading the config');\r\n\r\n    return configState.integrationType;\r\n  };\r\n}\r\n","import type { EpgProgram } from '../../types/epg';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\n\r\nexport default abstract class EpgService {\r\n  /**\r\n   * Fetch the schedule data for the given PlaylistItem\r\n   */\r\n  abstract fetchSchedule: (item: PlaylistItem) => Promise<unknown>;\r\n\r\n  /**\r\n   * Validate the given data with the schema and transform it into an EpgProgram\r\n   */\r\n  abstract transformProgram: (data: unknown) => Promise<EpgProgram>;\r\n}\r\n","import { addDays, differenceInDays } from 'date-fns';\r\nimport { injectable } from 'inversify';\r\n\r\nimport EpgService from '../services/EpgService';\r\nimport { EPG_TYPE } from '../constants';\r\nimport { getNamedModule } from '../modules/container';\r\nimport { logDev } from '../utils/common';\r\nimport type { PlaylistItem } from '../../types/playlist';\r\nimport type { EpgChannel, EpgProgram } from '../../types/epg';\r\n\r\nexport const isFulfilled = <T>(input: PromiseSettledResult<T>): input is PromiseFulfilledResult<T> => {\r\n  if (input.status === 'fulfilled') {\r\n    return true;\r\n  }\r\n\r\n  logDev(`An error occurred resolving a promise: `, input.reason);\r\n  return false;\r\n};\r\n\r\n@injectable()\r\nexport default class EpgController {\r\n  /**\r\n   * Update the start and end time properties of the given programs with the current date.\r\n   * This can be used when having a static schedule or while developing\r\n   */\r\n  private generateDemoPrograms(programs: EpgProgram[]) {\r\n    const today = new Date();\r\n    const startDate = new Date(programs[0]?.startTime);\r\n\r\n    // this makes sure that the start of the day is correct. `startOfDay(startDate)` doesn't work since it can yield\r\n    // a different date depending on the timezone.\r\n    // for example, given a startTime of `2022-08-03T23:00:00Z` will parse to `2022-08-04T01:00:00+0200` in\r\n    // Europe/Amsterdam (GMT+2) which makes startOfDay return `2022-08-04T00:00:00+0200`.\r\n    const utcStartDate = new Date(Date.UTC(startDate.getUTCFullYear(), startDate.getUTCMonth(), startDate.getUTCDate()));\r\n    const daysDelta = differenceInDays(today, utcStartDate);\r\n\r\n    return programs.map((program, idx) => ({\r\n      ...program,\r\n      id: `${program.id}_${idx}`,\r\n      startTime: addDays(new Date(program.startTime), daysDelta).toJSON(),\r\n      endTime: addDays(new Date(program.endTime), daysDelta).toJSON(),\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Ensure the given data validates to the EpgProgram schema\r\n   */\r\n  parseSchedule = async (data: unknown, item: PlaylistItem) => {\r\n    const demo = !!item.scheduleDemo || false;\r\n\r\n    const epgService = this.getEpgService(item);\r\n\r\n    if (!Array.isArray(data)) return [];\r\n\r\n    const transformResults = await Promise.allSettled(\r\n      data.map((program) =>\r\n        epgService\r\n          ?.transformProgram(program)\r\n          // This quiets promise resolution errors in the console\r\n          .catch((error) => {\r\n            logDev(error);\r\n            return undefined;\r\n          }),\r\n      ),\r\n    );\r\n\r\n    const programs = transformResults\r\n      .filter(isFulfilled)\r\n      .map((result) => result.value)\r\n      .filter((program): program is EpgProgram => !!program);\r\n\r\n    return demo ? this.generateDemoPrograms(programs) : programs;\r\n  };\r\n\r\n  /**\r\n   * Fetch and parse the EPG schedule for the given PlaylistItem.\r\n   * When there is no program (empty schedule) or the request fails, it returns a static program.\r\n   */\r\n  getSchedule = async (item: PlaylistItem) => {\r\n    const epgService = this.getEpgService(item);\r\n\r\n    const schedule = await epgService?.fetchSchedule(item);\r\n    const programs = await this.parseSchedule(schedule, item);\r\n\r\n    const catchupHours = item.catchupHours && parseInt(item.catchupHours);\r\n\r\n    return {\r\n      id: item.mediaid,\r\n      title: item.title,\r\n      description: item.description,\r\n      catchupHours: catchupHours || 8,\r\n      channelLogoImage: item.channelLogoImage,\r\n      backgroundImage: item.backgroundImage,\r\n      programs,\r\n    } as EpgChannel;\r\n  };\r\n\r\n  getEpgService = (item: PlaylistItem) => {\r\n    const scheduleType = item?.scheduleType?.toLocaleLowerCase() || EPG_TYPE.jwp;\r\n    const service = getNamedModule(EpgService, scheduleType, false);\r\n\r\n    if (!service) {\r\n      console.error(`No epg service was added for the ${scheduleType} schedule type`);\r\n    }\r\n\r\n    return service;\r\n  };\r\n\r\n  /**\r\n   * Get all schedules for the given PlaylistItem's\r\n   */\r\n  getSchedules = async (items: PlaylistItem[]) => {\r\n    return Promise.all(items.map((item) => this.getSchedule(item)));\r\n  };\r\n}\r\n","import { object, string } from 'yup';\r\nimport { parse } from 'date-fns';\r\nimport { injectable } from 'inversify';\r\n\r\nimport EpgService from '../EpgService';\r\nimport type { PlaylistItem } from '../../../types/playlist';\r\nimport { logDev } from '../../utils/common';\r\nimport type { EpgProgram } from '../../../types/epg';\r\n\r\nconst viewNexaEpgProgramSchema = object().shape({\r\n  'episode-num': object().shape({\r\n    '#text': string().required(),\r\n  }),\r\n  title: object().shape({\r\n    '#text': string().required(),\r\n  }),\r\n  desc: object().shape({\r\n    '#text': string(),\r\n  }),\r\n  icon: object().shape({\r\n    src: string(),\r\n  }),\r\n  start: string().required(),\r\n  stop: string().required(),\r\n});\r\n\r\nconst parseData = (date: string): string => parse(date, 'yyyyMdHms xxxx', new Date()).toISOString();\r\n\r\n@injectable()\r\nexport default class ViewNexaEpgService extends EpgService {\r\n  transformProgram = async (data: unknown): Promise<EpgProgram> => {\r\n    const program = await viewNexaEpgProgramSchema.validate(data);\r\n\r\n    return {\r\n      id: program['episode-num']['#text'],\r\n      title: program['title']['#text'],\r\n      startTime: parseData(program['start']),\r\n      endTime: parseData(program['stop']),\r\n      description: program?.['desc']?.['#text'],\r\n      cardImage: program?.['icon']?.['src'],\r\n      backgroundImage: program?.['icon']?.['src'],\r\n    };\r\n  };\r\n\r\n  fetchSchedule = async (item: PlaylistItem) => {\r\n    const { XMLParser } = await import('fast-xml-parser');\r\n\r\n    const scheduleUrl = item.scheduleUrl;\r\n\r\n    if (!scheduleUrl) {\r\n      logDev('Tried requesting a schedule for an item with missing `scheduleUrl`', item);\r\n      return undefined;\r\n    }\r\n\r\n    const xmlParserOptions = {\r\n      ignoreAttributes: false,\r\n      attributeNamePrefix: '',\r\n    };\r\n\r\n    try {\r\n      const data = await fetch(scheduleUrl).then((res) => res.text());\r\n      const parser = new XMLParser(xmlParserOptions);\r\n      const schedule = parser.parse(data);\r\n\r\n      return schedule?.tv?.programme || [];\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        logDev(`Fetch failed for View Nexa EPG schedule: '${scheduleUrl}'`, error);\r\n      }\r\n    }\r\n  };\r\n}\r\n","import { array, object, string } from 'yup';\r\nimport { isValid } from 'date-fns';\r\nimport { injectable } from 'inversify';\r\n\r\nimport EpgService from '../EpgService';\r\nimport type { PlaylistItem } from '../../../types/playlist';\r\nimport type { EpgProgram } from '../../../types/epg';\r\nimport { getDataOrThrow } from '../../utils/api';\r\nimport { logDev } from '../../utils/common';\r\n\r\nconst AUTHENTICATION_HEADER = 'API-KEY';\r\n\r\nconst jwEpgProgramSchema = object().shape({\r\n  id: string().required(),\r\n  title: string().required(),\r\n  startTime: string()\r\n    .required()\r\n    .test((value) => (value ? isValid(new Date(value)) : false)),\r\n  endTime: string()\r\n    .required()\r\n    .test((value) => (value ? isValid(new Date(value)) : false)),\r\n  chapterPointCustomProperties: array().of(\r\n    object().shape({\r\n      key: string().required(),\r\n      value: string().test('required-but-empty', 'value is required', (value: unknown) => typeof value === 'string'),\r\n    }),\r\n  ),\r\n});\r\n\r\n@injectable()\r\nexport default class JWEpgService extends EpgService {\r\n  transformProgram = async (data: unknown): Promise<EpgProgram> => {\r\n    const program = await jwEpgProgramSchema.validate(data);\r\n    const image = program.chapterPointCustomProperties?.find((item) => item.key === 'image')?.value || undefined;\r\n\r\n    return {\r\n      id: program.id,\r\n      title: program.title,\r\n      startTime: program.startTime,\r\n      endTime: program.endTime,\r\n      cardImage: image,\r\n      backgroundImage: image,\r\n      description: program.chapterPointCustomProperties?.find((item) => item.key === 'description')?.value || undefined,\r\n    };\r\n  };\r\n\r\n  fetchSchedule = async (item: PlaylistItem) => {\r\n    if (!item.scheduleUrl) {\r\n      logDev('Tried requesting a schedule for an item with missing `scheduleUrl`', item);\r\n      return undefined;\r\n    }\r\n\r\n    const headers = new Headers();\r\n\r\n    // add authentication token when `scheduleToken` is defined\r\n    if (item.scheduleToken) {\r\n      headers.set(AUTHENTICATION_HEADER, item.scheduleToken);\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(item.scheduleUrl, {\r\n        headers,\r\n      });\r\n\r\n      // await needed to ensure the error is caught here\r\n      return await getDataOrThrow(response);\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        logDev(`Fetch failed for EPG schedule: '${item.scheduleUrl}'`, error);\r\n      }\r\n    }\r\n  };\r\n}\r\n","type QueueItem<T> = {\r\n  resolve: (data?: T) => void;\r\n  reject: (reason?: unknown) => void;\r\n};\r\n\r\n/**\r\n * A really simple promise queue implementation that can be used to enqueue a promise to be resolved later from within\r\n * the same context.\r\n *\r\n * For example, when a request needs to refresh an access token but multiple requests are called parallel (without\r\n * knowing from each other), a promise queue can be used to wait for the main process to be resolved.\r\n *\r\n * So the first request decides the access token needs to be refreshed and enqueues a request to the refresh endpoint.\r\n * The next request that is performed also sees that access token needs to be refreshed, but since the first request\r\n * already is performing the refresh, it is added to the promise queue and waits until the main promise is resolved\r\n * (or rejected).\r\n */\r\nexport class PromiseQueue<T = undefined> {\r\n  private queue: QueueItem<T>[] = [];\r\n\r\n  getLength() {\r\n    return this.queue.length;\r\n  }\r\n\r\n  /**\r\n   * Enqueues a promise and wait for the promise to be resolved (or rejected).\r\n   */\r\n  async enqueue() {\r\n    return new Promise<T | undefined>((resolve, reject) => {\r\n      this.queue.push({ resolve, reject });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Resolve all promises and clear the queue. Optionally pas in data confirming to the type.\r\n   */\r\n  async resolve(data?: T) {\r\n    const promises = this.queue.map(({ resolve }) => resolve(data));\r\n    this.queue = [];\r\n\r\n    // optionally wait for all promises\r\n    await Promise.allSettled(promises);\r\n  }\r\n\r\n  /**\r\n   * Reject all promises and clear the queue. Optionally pas in a reason.\r\n   */\r\n  async reject(reason?: unknown) {\r\n    const promises = this.queue.map(({ reject }) => reject(reason));\r\n    this.queue = [];\r\n\r\n    // optionally wait for all promises\r\n    await Promise.allSettled(promises);\r\n  }\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\nimport { object, string } from 'yup';\r\nimport { inject, injectable } from 'inversify';\r\nimport { BroadcastChannel } from 'broadcast-channel';\r\n\r\nimport { IS_DEVELOPMENT_BUILD, logDev } from '../../../utils/common';\r\nimport { PromiseQueue } from '../../../utils/promiseQueue';\r\nimport type { AuthData } from '../../../../types/account';\r\nimport StorageService from '../../StorageService';\r\nimport { GET_CUSTOMER_IP } from '../../../modules/types';\r\nimport type { GetCustomerIP } from '../../../../types/get-customer-ip';\r\n\r\nimport type { GetLocalesResponse } from './types/account';\r\nimport type { Response } from './types/api';\r\n\r\nconst AUTH_PERSIST_KEY = 'auth';\r\n\r\ntype Tokens = {\r\n  accessToken: string;\r\n  refreshToken: string;\r\n};\r\n\r\ntype MessageAction = 'refreshing' | 'resolved' | 'rejected';\r\n\r\ntype MessageData = {\r\n  action: MessageAction;\r\n  tokens?: Tokens;\r\n};\r\n\r\ntype JWTPayload = {\r\n  exp?: number;\r\n};\r\n\r\ntype RequestOptions = {\r\n  authenticate?: boolean;\r\n  keepalive?: boolean;\r\n};\r\n\r\nconst tokensSchema = object().shape({\r\n  accessToken: string().required(),\r\n  refreshToken: string().required(),\r\n});\r\n\r\n/**\r\n * Validate the given input if it confirms to the tokenSchema\r\n */\r\nconst isValidTokens = (candidate: unknown): candidate is Tokens => {\r\n  return tokensSchema.isValidSync(candidate);\r\n};\r\n\r\n/**\r\n * Given an JWT, return token expiration in milliseconds. Returns -1 when the token is invalid.\r\n */\r\nconst getTokenExpiration = (token: string) => {\r\n  try {\r\n    const decodedToken: JWTPayload = jwtDecode(token);\r\n\r\n    if (typeof decodedToken.exp === 'number') {\r\n      return decodedToken.exp * 1000;\r\n    }\r\n  } catch (error: unknown) {\r\n    // failed to parse the JWT string\r\n  }\r\n\r\n  return -1;\r\n};\r\n\r\n/**\r\n * The AuthService is responsible for managing JWT access tokens and refresh tokens.\r\n *\r\n * Once an access token and refresh token is set, it will automatically refresh the access token when it is about to\r\n * expire.\r\n *\r\n * It uses a PromiseQueue to prevent multiple instances refreshing the same token which fails.\r\n *\r\n * The Broadcaster ensures that all potential browser tabs are notified about the updated token. This prevents\r\n * race-conditions when the user has multiple tabs open (but also very helpful while developing).\r\n */\r\n\r\n@injectable()\r\nexport default class CleengService {\r\n  private readonly storageService;\r\n  private readonly getCustomerIP;\r\n  private readonly channel: BroadcastChannel<MessageData>;\r\n  private readonly queue = new PromiseQueue();\r\n  private isRefreshing = false;\r\n  private expiration = -1;\r\n\r\n  sandbox = false;\r\n  tokens: Tokens | null = null;\r\n\r\n  constructor(storageService: StorageService, @inject(GET_CUSTOMER_IP) getCustomerIP: GetCustomerIP) {\r\n    this.storageService = storageService;\r\n    this.getCustomerIP = getCustomerIP;\r\n\r\n    this.channel = new BroadcastChannel<MessageData>('jwp-refresh-token-channel');\r\n    this.channel.addEventListener('message', this.handleBroadcastMessage);\r\n  }\r\n\r\n  /**\r\n   * Persist the given token in the storage. Removes the token when the given token is `null`.\r\n   */\r\n  private async persistInStorage(tokens: Tokens | null) {\r\n    if (tokens) {\r\n      await this.storageService.setItem(AUTH_PERSIST_KEY, JSON.stringify(tokens));\r\n    } else {\r\n      await this.storageService.removeItem(AUTH_PERSIST_KEY);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * The `logoutCallback` is a delegate that can be set to handle what should happen when the token is expired or not\r\n   * valid anymore. Since this service shouldn't care about the UI or Zustand state, a controller can use this delegate\r\n   * to update the UI and clear the logged in state. Alternatively, this could dispatch an event, but a delegate is\r\n   * easier to align with the InPlayer integration.\r\n   */\r\n  private logoutCallback?: () => Promise<void>;\r\n\r\n  /**\r\n   * This function does the actual refresh of the access token by calling the `refreshToken` endpoint in the Cleeng\r\n   * service.\r\n   */\r\n  private getNewTokens: (tokens: Tokens) => Promise<Tokens | null> = async ({ refreshToken }) => {\r\n    try {\r\n      const { responseData: newTokens } = await this.post<Response<AuthData>>('/auths/refresh_token', JSON.stringify({ refreshToken }));\r\n\r\n      return {\r\n        accessToken: newTokens.jwt,\r\n        refreshToken: newTokens.refreshToken,\r\n      };\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        logDev('Failed to refresh accessToken', error);\r\n\r\n        // only logout when the token is expired or invalid, this prevents logging out users when the request failed due to a\r\n        // network error or for aborted requests\r\n        if (error.message.includes('Refresh token is expired or does not exist') || error.message.includes('Missing or invalid parameter')) {\r\n          if (!this.logoutCallback) logDev('logoutCallback is not set');\r\n          await this.logoutCallback?.();\r\n        }\r\n      }\r\n\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * This function is called when a broadcast message is received from another browser tab (same origin)\r\n   */\r\n  private handleBroadcastMessage = async (data: MessageData) => {\r\n    this.isRefreshing = data.action === 'refreshing';\r\n\r\n    if (data.tokens) {\r\n      await this.setTokens(data.tokens);\r\n    }\r\n\r\n    if (data.action === 'resolved') {\r\n      await this.queue.resolve();\r\n    } else if (data.action === 'rejected') {\r\n      await this.queue.reject();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Notify other browser tabs about a change in the auth state\r\n   */\r\n  private sendBroadcastMessage = (state: MessageAction, tokens?: Tokens) => {\r\n    const message: MessageData = {\r\n      action: state,\r\n      tokens,\r\n    };\r\n\r\n    this.channel.postMessage(message);\r\n  };\r\n\r\n  private getBaseUrl = () => (this.sandbox ? 'https://mediastore-sandbox.cleeng.com' : 'https://mediastore.cleeng.com');\r\n\r\n  private performRequest = async (path: string = '/', method = 'GET', body?: string, options: RequestOptions = {}) => {\r\n    try {\r\n      const token = options.authenticate ? await this.getAccessTokenOrThrow() : undefined;\r\n\r\n      const resp = await fetch(`${this.getBaseUrl()}${path}`, {\r\n        headers: {\r\n          Accept: 'application/json',\r\n          'Content-Type': 'application/json',\r\n          Authorization: token ? `Bearer ${token}` : '',\r\n        },\r\n        keepalive: options.keepalive,\r\n        method,\r\n        body,\r\n      });\r\n\r\n      return await resp.json();\r\n    } catch (error: unknown) {\r\n      return {\r\n        errors: Array.of(error instanceof Error ? error.message : String(error)),\r\n      };\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Initialize the auth service and try to restore the session from the storage.\r\n   *\r\n   * When a valid session is found, it refreshes the access token when needed.\r\n   *\r\n   * For development builds, a small random delay is added to prevent all open tabs refreshing the same token when\r\n   * being fully refreshed.\r\n   */\r\n  initialize = async (sandbox: boolean, logoutCallback: () => Promise<void>) => {\r\n    this.sandbox = sandbox;\r\n    this.logoutCallback = logoutCallback;\r\n\r\n    await this.restoreTokensFromStorage();\r\n\r\n    // wait a random time to prevent refresh token race-conditions when multiple tabs are open\r\n    // this is only needed when dealing with a live reload environment\r\n    if (IS_DEVELOPMENT_BUILD) {\r\n      await new Promise((resolve) => setTimeout(resolve, Math.random() * 500));\r\n    }\r\n\r\n    await this.maybeRefreshAccessToken();\r\n  };\r\n\r\n  /**\r\n   * Set tokens and persist the tokens in the storage\r\n   */\r\n  setTokens = async (tokens: Tokens) => {\r\n    this.tokens = tokens;\r\n    this.expiration = getTokenExpiration(tokens.accessToken);\r\n\r\n    await this.persistInStorage(this.tokens);\r\n  };\r\n\r\n  /**\r\n   * Remove tokens and clear the storage\r\n   */\r\n  clearTokens = async () => {\r\n    this.tokens = null;\r\n\r\n    await this.persistInStorage(null);\r\n  };\r\n\r\n  /**\r\n   * Try to restore tokens from the storage and overwrite the current when they are newer.\r\n   */\r\n  restoreTokensFromStorage = async () => {\r\n    const tokensString = await this.storageService.getItem(AUTH_PERSIST_KEY, false);\r\n    let tokens;\r\n\r\n    if (typeof tokensString !== 'string') return;\r\n\r\n    try {\r\n      tokens = JSON.parse(tokensString);\r\n\r\n      if (!isValidTokens(tokens)) return;\r\n    } catch {\r\n      return;\r\n    }\r\n\r\n    const expires = getTokenExpiration(tokens.accessToken);\r\n\r\n    // verify if the token from storage is newer than the one we have in the current session\r\n    if (expires > this.expiration) {\r\n      this.tokens = tokens;\r\n      this.expiration = expires;\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Returns true when the current access token is expired\r\n   */\r\n  accessTokenIsExpired = () => {\r\n    if (!this.tokens) return false;\r\n\r\n    return this.expiration > -1 && Date.now() - this.expiration > 0;\r\n  };\r\n\r\n  hasTokens = () => {\r\n    return !!this.tokens;\r\n  };\r\n\r\n  /**\r\n   * Don't use this method directly, but use the `maybeRefreshAccessToken` method instead.\r\n   * This function will fetch new tokens and updates the isRefreshing state. It also resolves or rejects the promise\r\n   * queue.\r\n   */\r\n  private refreshTokens = async (tokens: Tokens) => {\r\n    this.sendBroadcastMessage('refreshing');\r\n    this.isRefreshing = true;\r\n\r\n    try {\r\n      const newTokens = await this.getNewTokens(tokens);\r\n\r\n      if (newTokens) {\r\n        await this.setTokens(newTokens);\r\n        this.isRefreshing = false;\r\n        this.sendBroadcastMessage('resolved', newTokens);\r\n        await this.queue.resolve();\r\n\r\n        return;\r\n      }\r\n    } catch (error: unknown) {\r\n      logDev('Failed to refresh tokens', error);\r\n    }\r\n\r\n    // if we are here, we didn't receive new tokens\r\n    await this.clearTokens();\r\n    this.isRefreshing = false;\r\n    this.sendBroadcastMessage('rejected');\r\n    await this.queue.reject();\r\n  };\r\n\r\n  /**\r\n   * Use this function ensure that the access token is not expired. If the current token is expired, it will request\r\n   * new tokens. When another session is already refreshing the tokens it will wait in queue instead and use the same\r\n   * results.\r\n   */\r\n  maybeRefreshAccessToken = async () => {\r\n    try {\r\n      // token is already refreshing, let's wait for it\r\n      if (this.isRefreshing) {\r\n        logDev('Token is already refreshing, waiting in queue...');\r\n        return await this.queue.enqueue();\r\n      }\r\n\r\n      // token is not expired or there is no session\r\n      if (!this.accessTokenIsExpired() || !this.tokens) {\r\n        return;\r\n      }\r\n\r\n      await this.refreshTokens(this.tokens);\r\n    } catch (error: unknown) {\r\n      logDev('Error caught while refreshing the access token', error);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Get access optional token\r\n   */\r\n  getAccessToken = async () => {\r\n    await this.maybeRefreshAccessToken();\r\n\r\n    // fallback to always \"syncing\" the tokens from storage in case the broadcast channel isn't supported\r\n    await this.restoreTokensFromStorage();\r\n\r\n    return this.tokens?.accessToken;\r\n  };\r\n\r\n  /**\r\n   * Get access token or throw an error\r\n   */\r\n  getAccessTokenOrThrow = async () => {\r\n    const accessToken = await this.getAccessToken();\r\n\r\n    if (!accessToken) {\r\n      throw new Error('Access token is missing');\r\n    }\r\n\r\n    return accessToken;\r\n  };\r\n\r\n  getLocales = async () => {\r\n    const customerIP = await this.getCustomerIP();\r\n\r\n    return this.get<GetLocalesResponse>(`/locales${customerIP ? '?customerIP=' + customerIP : ''}`);\r\n  };\r\n\r\n  get = <T>(path: string, options?: RequestOptions) => this.performRequest(path, 'GET', undefined, options) as Promise<T>;\r\n\r\n  patch = <T>(path: string, body?: string, options?: RequestOptions) => this.performRequest(path, 'PATCH', body, options) as Promise<T>;\r\n\r\n  put = <T>(path: string, body?: string, options?: RequestOptions) => this.performRequest(path, 'PUT', body, options) as Promise<T>;\r\n\r\n  post = <T>(path: string, body?: string, options?: RequestOptions) => this.performRequest(path, 'POST', body, options) as Promise<T>;\r\n\r\n  remove = <T>(path: string, options?: RequestOptions) => this.performRequest(path, 'DELETE', undefined, options) as Promise<T>;\r\n}\r\n","import type { CleengCustomer } from '../types/models';\r\nimport type { Customer } from '../../../../../types/account';\r\n\r\nexport const formatCustomer = (customer: CleengCustomer): Customer => {\r\n  return {\r\n    id: customer.id,\r\n    email: customer.email,\r\n    country: customer.country,\r\n    firstName: customer.firstName,\r\n    lastName: customer.lastName,\r\n    fullName: `${customer.firstName} ${customer.lastName}`,\r\n    // map `externalData` to `metadata` (NOTE; The Cleeng API returns parsed values)\r\n    metadata: customer.externalData || {},\r\n  };\r\n};\r\n","import type { PublisherConsent } from '../types/models';\r\nimport type { CustomFormField } from '../../../../../types/account';\r\n\r\nexport const formatPublisherConsent = (consent: PublisherConsent): CustomFormField => {\r\n  return {\r\n    type: 'checkbox',\r\n    name: consent.name,\r\n    label: consent.label,\r\n    defaultValue: '',\r\n    required: consent.required,\r\n    placeholder: consent.placeholder,\r\n    options: {},\r\n    enabledByDefault: false,\r\n    version: consent.version,\r\n  };\r\n};\r\n","import jwtDecode from 'jwt-decode';\r\nimport { inject, injectable } from 'inversify';\r\n\r\nimport type { AccessModel, Config } from '../../../../types/config';\r\nimport type {\r\n  AuthData,\r\n  ChangePassword,\r\n  ChangePasswordWithOldPassword,\r\n  GetCaptureStatus,\r\n  GetCaptureStatusResponse,\r\n  GetCustomerConsents,\r\n  GetPublisherConsents,\r\n  JwtDetails,\r\n  Login,\r\n  LoginPayload,\r\n  NotificationsData,\r\n  Register,\r\n  RegisterPayload,\r\n  ResetPassword,\r\n  UpdateCaptureAnswers,\r\n  UpdateCaptureAnswersPayload,\r\n  UpdateCustomer,\r\n  UpdateCustomerConsents,\r\n  UpdateCustomerConsentsPayload,\r\n  UpdateCustomerPayload,\r\n  UpdateFavorites,\r\n  UpdateWatchHistory,\r\n} from '../../../../types/account';\r\nimport AccountService from '../AccountService';\r\nimport { GET_CUSTOMER_IP } from '../../../modules/types';\r\nimport type { GetCustomerIP } from '../../../../types/get-customer-ip';\r\nimport { ACCESS_MODEL } from '../../../constants';\r\nimport type { ServiceResponse } from '../../../../types/service';\r\nimport type { SerializedWatchHistoryItem } from '../../../../types/watchHistory';\r\nimport type { SerializedFavorite } from '../../../../types/favorite';\r\n\r\nimport CleengService from './CleengService';\r\nimport type {\r\n  GetCustomerResponse,\r\n  GetCustomerConsentsResponse,\r\n  GetPublisherConsentsResponse,\r\n  UpdateConsentsResponse,\r\n  UpdateCustomerResponse,\r\n  AuthResponse,\r\n} from './types/account';\r\nimport { formatCustomer } from './formatters/customer';\r\nimport { formatPublisherConsent } from './formatters/consents';\r\nimport type { Response } from './types/api';\r\n\r\n@injectable()\r\nexport default class CleengAccountService extends AccountService {\r\n  private readonly cleengService;\r\n  private readonly getCustomerIP;\r\n  private publisherId = '';\r\n\r\n  private externalData: Record<string, unknown> = {};\r\n\r\n  accessModel: AccessModel = ACCESS_MODEL.AUTHVOD;\r\n  svodOfferIds: string[] = [];\r\n  sandbox = false;\r\n\r\n  constructor(cleengService: CleengService, @inject(GET_CUSTOMER_IP) getCustomerIP: GetCustomerIP) {\r\n    super({\r\n      canUpdateEmail: true,\r\n      canSupportEmptyFullName: true,\r\n      canChangePasswordWithOldPassword: false,\r\n      canRenewSubscription: true,\r\n      canExportAccountData: false,\r\n      canDeleteAccount: false,\r\n      canUpdatePaymentMethod: true,\r\n      canShowReceipts: false,\r\n      hasSocialURLs: false,\r\n      hasNotifications: false,\r\n      // The 'externalData' attribute of Cleeng can contain max 4000 characters\r\n      watchListSizeLimit: 48,\r\n    });\r\n\r\n    this.cleengService = cleengService;\r\n    this.getCustomerIP = getCustomerIP;\r\n  }\r\n\r\n  private handleErrors = (errors: string[]) => {\r\n    if (errors.length > 0) {\r\n      throw new Error(errors[0]);\r\n    }\r\n  };\r\n\r\n  private getCustomerIdFromAuthData = (auth: AuthData) => {\r\n    const decodedToken: JwtDetails = jwtDecode(auth.jwt);\r\n    return decodedToken.customerId;\r\n  };\r\n\r\n  private getCustomer = async ({ customerId }: { customerId: string }) => {\r\n    const { responseData, errors } = await this.cleengService.get<GetCustomerResponse>(`/customers/${customerId}`, {\r\n      authenticate: true,\r\n    });\r\n\r\n    this.handleErrors(errors);\r\n    this.externalData = responseData.externalData || {};\r\n\r\n    return formatCustomer(responseData);\r\n  };\r\n\r\n  private getLocales = async () => {\r\n    return this.cleengService.getLocales();\r\n  };\r\n\r\n  initialize = async (config: Config, _url: string, logoutCallback: () => Promise<void>) => {\r\n    const cleengConfig = config?.integrations?.cleeng;\r\n\r\n    if (!cleengConfig?.id) {\r\n      throw new Error('Failed to initialize Cleeng integration. The publisherId is missing.');\r\n    }\r\n\r\n    // set accessModel and publisherId\r\n    this.publisherId = cleengConfig.id;\r\n    this.accessModel = cleengConfig.monthlyOffer || cleengConfig.yearlyOffer ? ACCESS_MODEL.SVOD : ACCESS_MODEL.AUTHVOD;\r\n    this.svodOfferIds = [cleengConfig?.monthlyOffer, cleengConfig?.yearlyOffer].filter(Boolean).map(String);\r\n\r\n    // initialize the Cleeng service\r\n    this.sandbox = !!cleengConfig.useSandbox;\r\n    await this.cleengService.initialize(this.sandbox, logoutCallback);\r\n  };\r\n\r\n  getAuthData = async () => {\r\n    if (this.cleengService.tokens) {\r\n      return {\r\n        jwt: this.cleengService.tokens.accessToken,\r\n        refreshToken: this.cleengService.tokens.refreshToken,\r\n      } as AuthData;\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  getCustomerConsents: GetCustomerConsents = async (payload) => {\r\n    const { customer } = payload;\r\n    const response = await this.cleengService.get<GetCustomerConsentsResponse>(`/customers/${customer?.id}/consents`, {\r\n      authenticate: true,\r\n    });\r\n    this.handleErrors(response.errors);\r\n\r\n    return response?.responseData?.consents || [];\r\n  };\r\n\r\n  updateCustomerConsents: UpdateCustomerConsents = async (payload) => {\r\n    const { customer } = payload;\r\n\r\n    const params: UpdateCustomerConsentsPayload = {\r\n      id: customer.id,\r\n      consents: payload.consents,\r\n    };\r\n\r\n    const response = await this.cleengService.put<UpdateConsentsResponse>(`/customers/${customer?.id}/consents`, JSON.stringify(params), {\r\n      authenticate: true,\r\n    });\r\n    this.handleErrors(response.errors);\r\n\r\n    return await this.getCustomerConsents(payload);\r\n  };\r\n\r\n  login: Login = async ({ email, password }) => {\r\n    const payload: LoginPayload = {\r\n      email,\r\n      password,\r\n      publisherId: this.publisherId,\r\n      customerIP: await this.getCustomerIP(),\r\n    };\r\n\r\n    const { responseData: auth, errors } = await this.cleengService.post<AuthResponse>('/auths', JSON.stringify(payload));\r\n    this.handleErrors(errors);\r\n\r\n    await this.cleengService.setTokens({ accessToken: auth.jwt, refreshToken: auth.refreshToken });\r\n\r\n    const { user, customerConsents } = await this.getUser();\r\n\r\n    return {\r\n      user,\r\n      auth,\r\n      customerConsents,\r\n    };\r\n  };\r\n\r\n  register: Register = async ({ email, password, consents }) => {\r\n    const localesResponse = await this.getLocales();\r\n\r\n    this.handleErrors(localesResponse.errors);\r\n\r\n    const payload: RegisterPayload = {\r\n      email,\r\n      password,\r\n      locale: localesResponse.responseData.locale,\r\n      country: localesResponse.responseData.country,\r\n      currency: localesResponse.responseData.currency,\r\n      publisherId: this.publisherId,\r\n      customerIP: await this.getCustomerIP(),\r\n    };\r\n\r\n    const { responseData: auth, errors }: ServiceResponse<AuthData> = await this.cleengService.post('/customers', JSON.stringify(payload));\r\n    this.handleErrors(errors);\r\n\r\n    await this.cleengService.setTokens({ accessToken: auth.jwt, refreshToken: auth.refreshToken });\r\n\r\n    const { user } = await this.getUser();\r\n\r\n    const customerConsents = await this.updateCustomerConsents({ consents, customer: user }).catch(() => {\r\n      // error caught while updating the consents, but continue the registration process\r\n      return [];\r\n    });\r\n\r\n    return {\r\n      user,\r\n      auth,\r\n      customerConsents,\r\n    };\r\n  };\r\n\r\n  logout = async () => {\r\n    // clear the persisted access tokens\r\n    await this.cleengService.clearTokens();\r\n  };\r\n\r\n  getUser = async () => {\r\n    const authData = await this.getAuthData();\r\n\r\n    if (!authData) throw new Error('Not logged in');\r\n\r\n    const customerId = this.getCustomerIdFromAuthData(authData);\r\n    const user = await this.getCustomer({ customerId });\r\n    const consents = await this.getCustomerConsents({ customer: user });\r\n\r\n    return {\r\n      user,\r\n      customerConsents: consents,\r\n    };\r\n  };\r\n\r\n  getPublisherConsents: GetPublisherConsents = async () => {\r\n    const response = await this.cleengService.get<GetPublisherConsentsResponse>(`/publishers/${this.publisherId}/consents`);\r\n\r\n    this.handleErrors(response.errors);\r\n\r\n    return (response.responseData?.consents || []).map(formatPublisherConsent);\r\n  };\r\n\r\n  getCaptureStatus: GetCaptureStatus = async ({ customer }) => {\r\n    const response: ServiceResponse<GetCaptureStatusResponse> = await this.cleengService.get(`/customers/${customer?.id}/capture/status`, {\r\n      authenticate: true,\r\n    });\r\n\r\n    this.handleErrors(response.errors);\r\n\r\n    return response.responseData;\r\n  };\r\n\r\n  updateCaptureAnswers: UpdateCaptureAnswers = async ({ customer, ...payload }) => {\r\n    const params: UpdateCaptureAnswersPayload = {\r\n      customerId: customer.id,\r\n      ...payload,\r\n    };\r\n\r\n    const response = await this.cleengService.put<UpdateConsentsResponse>(`/customers/${customer.id}/capture`, JSON.stringify(params), {\r\n      authenticate: true,\r\n    });\r\n    this.handleErrors(response.errors);\r\n\r\n    return this.getCustomer({ customerId: customer.id });\r\n  };\r\n\r\n  resetPassword: ResetPassword = async (payload) => {\r\n    const response = await this.cleengService.put<Response<unknown>>(\r\n      '/customers/passwords',\r\n      JSON.stringify({\r\n        ...payload,\r\n        publisherId: this.publisherId,\r\n      }),\r\n    );\r\n\r\n    this.handleErrors(response.errors);\r\n  };\r\n\r\n  changePasswordWithResetToken: ChangePassword = async (payload) => {\r\n    const response = await this.cleengService.patch<Response<unknown>>(\r\n      '/customers/passwords',\r\n      JSON.stringify({\r\n        ...payload,\r\n        publisherId: this.publisherId,\r\n      }),\r\n    );\r\n\r\n    this.handleErrors(response.errors);\r\n  };\r\n\r\n  changePasswordWithOldPassword: ChangePasswordWithOldPassword = async () => {\r\n    // Cleeng doesn't support this feature\r\n  };\r\n\r\n  updateCustomer: UpdateCustomer = async (payload) => {\r\n    const { id, metadata, fullName, ...rest } = payload;\r\n    const params: UpdateCustomerPayload = {\r\n      id,\r\n      ...rest,\r\n    };\r\n\r\n    // enable keepalive to ensure data is persisted when closing the browser/tab\r\n    const { responseData, errors } = await this.cleengService.patch<UpdateCustomerResponse>(`/customers/${id}`, JSON.stringify(params), {\r\n      authenticate: true,\r\n      keepalive: true,\r\n    });\r\n\r\n    this.handleErrors(errors);\r\n    this.externalData = responseData.externalData || {};\r\n\r\n    return formatCustomer(responseData);\r\n  };\r\n\r\n  updateWatchHistory: UpdateWatchHistory = async ({ user, history }) => {\r\n    const payload = { id: user.id, externalData: { ...this.externalData, history } };\r\n    const { errors, responseData } = await this.cleengService.patch<UpdateCustomerResponse>(`/customers/${user.id}`, JSON.stringify(payload), {\r\n      authenticate: true,\r\n      keepalive: true,\r\n    });\r\n\r\n    this.handleErrors(errors);\r\n    this.externalData = responseData.externalData || {};\r\n  };\r\n\r\n  updateFavorites: UpdateFavorites = async ({ user, favorites }) => {\r\n    const payload = { id: user.id, externalData: { ...this.externalData, favorites } };\r\n    const { errors, responseData } = await this.cleengService.patch<UpdateCustomerResponse>(`/customers/${user.id}`, JSON.stringify(payload), {\r\n      authenticate: true,\r\n      keepalive: true,\r\n    });\r\n\r\n    this.handleErrors(errors);\r\n    this.externalData = responseData.externalData || {};\r\n  };\r\n\r\n  getWatchHistory = async () => {\r\n    return (this.externalData['history'] || []) as SerializedWatchHistoryItem[];\r\n  };\r\n\r\n  getFavorites = async () => {\r\n    return (this.externalData['favorites'] || []) as SerializedFavorite[];\r\n  };\r\n\r\n  subscribeToNotifications: NotificationsData = async () => {\r\n    return false;\r\n  };\r\n\r\n  getSocialUrls: undefined;\r\n\r\n  exportAccountData: undefined;\r\n\r\n  deleteAccount: undefined;\r\n}\r\n","import { inject, injectable } from 'inversify';\r\n\r\nimport type {\r\n  AddAdyenPaymentDetails,\r\n  CreateOrder,\r\n  CreateOrderPayload,\r\n  DeletePaymentMethod,\r\n  FinalizeAdyenPaymentDetails,\r\n  GetAdyenPaymentSession,\r\n  GetEntitlements,\r\n  GetFinalizeAdyenPayment,\r\n  GetInitialAdyenPayment,\r\n  GetOffer,\r\n  GetOffers,\r\n  GetOrder,\r\n  GetPaymentMethods,\r\n  GetSubscriptionSwitch,\r\n  GetSubscriptionSwitches,\r\n  PaymentWithoutDetails,\r\n  PaymentWithPayPal,\r\n  SwitchSubscription,\r\n  UpdateOrder,\r\n  UpdateOrderResponse,\r\n  UpdatePaymentWithPayPal,\r\n} from '../../../../types/checkout';\r\nimport CheckoutService from '../CheckoutService';\r\nimport { GET_CUSTOMER_IP } from '../../../modules/types';\r\nimport type { GetCustomerIP } from '../../../../types/get-customer-ip';\r\nimport type { ServiceResponse } from '../../../../types/service';\r\n\r\nimport CleengService from './CleengService';\r\n\r\n@injectable()\r\nexport default class CleengCheckoutService extends CheckoutService {\r\n  private readonly cleengService: CleengService;\r\n  private readonly getCustomerIP: GetCustomerIP;\r\n\r\n  constructor(cleengService: CleengService, @inject(GET_CUSTOMER_IP) getCustomerIP: GetCustomerIP) {\r\n    super();\r\n    this.cleengService = cleengService;\r\n    this.getCustomerIP = getCustomerIP;\r\n  }\r\n\r\n  getOffers: GetOffers = async (payload) => {\r\n    return await Promise.all(\r\n      payload.offerIds.map(async (offerId) => {\r\n        const response = await this.getOffer({ offerId: String(offerId) });\r\n\r\n        if (response.errors.length > 0) {\r\n          throw new Error(response.errors[0]);\r\n        }\r\n\r\n        return response.responseData;\r\n      }),\r\n    );\r\n  };\r\n\r\n  getOffer: GetOffer = async (payload) => {\r\n    const customerIP = await this.getCustomerIP();\r\n\r\n    return this.cleengService.get(`/offers/${payload.offerId}${customerIP ? '?customerIP=' + customerIP : ''}`);\r\n  };\r\n\r\n  createOrder: CreateOrder = async (payload) => {\r\n    const locales = await this.cleengService.getLocales();\r\n\r\n    if (locales.errors.length > 0) throw new Error(locales.errors[0]);\r\n\r\n    const customerIP = locales.responseData.ipAddress;\r\n\r\n    const createOrderPayload: CreateOrderPayload = {\r\n      offerId: payload.offer.offerId,\r\n      customerId: payload.customerId,\r\n      country: payload.country,\r\n      currency: locales?.responseData?.currency || 'EUR',\r\n      customerIP,\r\n      paymentMethodId: payload.paymentMethodId,\r\n    };\r\n\r\n    return this.cleengService.post('/orders', JSON.stringify(createOrderPayload), { authenticate: true });\r\n  };\r\n\r\n  getOrder: GetOrder = async ({ orderId }) => {\r\n    return this.cleengService.get(`/orders/${orderId}`, { authenticate: true });\r\n  };\r\n\r\n  updateOrder: UpdateOrder = async ({ order, ...payload }) => {\r\n    const response = await this.cleengService.patch<ServiceResponse<UpdateOrderResponse>>(`/orders/${order.id}`, JSON.stringify(payload), {\r\n      authenticate: true,\r\n    });\r\n\r\n    if (response.errors.length) {\r\n      if (response.errors[0].includes(`Order with ${order.id} not found`)) {\r\n        throw new Error('Order not found');\r\n      }\r\n\r\n      if (response.errors[0].includes(`Coupon ${payload.couponCode} not found`)) {\r\n        throw new Error('Invalid coupon code');\r\n      }\r\n\r\n      if (response.errors[0].includes(`Coupon ${payload.couponCode} cannot be applied on this offer`)) {\r\n        throw new Error('Invalid coupon code for this offer');\r\n      }\r\n    }\r\n\r\n    return response;\r\n  };\r\n\r\n  getPaymentMethods: GetPaymentMethods = async () => {\r\n    return this.cleengService.get('/payment-methods', { authenticate: true });\r\n  };\r\n\r\n  paymentWithoutDetails: PaymentWithoutDetails = async (payload) => {\r\n    return this.cleengService.post('/payments', JSON.stringify(payload), { authenticate: true });\r\n  };\r\n\r\n  paymentWithPayPal: PaymentWithPayPal = async (payload) => {\r\n    const { order, successUrl, cancelUrl, errorUrl } = payload;\r\n\r\n    const paypalPayload = {\r\n      orderId: order.id,\r\n      successUrl,\r\n      cancelUrl,\r\n      errorUrl,\r\n    };\r\n\r\n    return this.cleengService.post('/connectors/paypal/v1/tokens', JSON.stringify(paypalPayload), { authenticate: true });\r\n  };\r\n\r\n  getSubscriptionSwitches: GetSubscriptionSwitches = async (payload) => {\r\n    return this.cleengService.get(`/customers/${payload.customerId}/subscription_switches/${payload.offerId}/availability`, { authenticate: true });\r\n  };\r\n\r\n  getSubscriptionSwitch: GetSubscriptionSwitch = async (payload) => {\r\n    return this.cleengService.get(`/subscription_switches/${payload.switchId}`, { authenticate: true });\r\n  };\r\n\r\n  switchSubscription: SwitchSubscription = async (payload) => {\r\n    return this.cleengService.post(\r\n      `/customers/${payload.customerId}/subscription_switches/${payload.offerId}`,\r\n      JSON.stringify({ toOfferId: payload.toOfferId, switchDirection: payload.switchDirection }),\r\n      { authenticate: true },\r\n    );\r\n  };\r\n\r\n  getEntitlements: GetEntitlements = async (payload) => {\r\n    return this.cleengService.get(`/entitlements/${payload.offerId}`, { authenticate: true });\r\n  };\r\n\r\n  createAdyenPaymentSession: GetAdyenPaymentSession = async (payload) => {\r\n    return await this.cleengService.post('/connectors/adyen/sessions', JSON.stringify(payload), { authenticate: true });\r\n  };\r\n\r\n  initialAdyenPayment: GetInitialAdyenPayment = async (payload) =>\r\n    this.cleengService.post(\r\n      '/connectors/adyen/initial-payment',\r\n      JSON.stringify({ ...payload, attemptAuthentication: this.cleengService.sandbox ? 'always' : undefined }),\r\n      { authenticate: true },\r\n    );\r\n\r\n  finalizeAdyenPayment: GetFinalizeAdyenPayment = async (payload) =>\r\n    this.cleengService.post('/connectors/adyen/initial-payment/finalize', JSON.stringify(payload), { authenticate: true });\r\n\r\n  updatePaymentMethodWithPayPal: UpdatePaymentWithPayPal = async (payload) => {\r\n    return this.cleengService.post('/connectors/paypal/v1/payment_details/tokens', JSON.stringify(payload), { authenticate: true });\r\n  };\r\n\r\n  deletePaymentMethod: DeletePaymentMethod = async (payload) => {\r\n    return this.cleengService.remove(`/payment_details/${payload.paymentDetailsId}`, { authenticate: true });\r\n  };\r\n\r\n  addAdyenPaymentDetails: AddAdyenPaymentDetails = async (payload) =>\r\n    this.cleengService.post(\r\n      '/connectors/adyen/payment-details',\r\n      JSON.stringify({\r\n        ...payload,\r\n        attemptAuthentication: this.cleengService.sandbox ? 'always' : undefined,\r\n      }),\r\n      { authenticate: true },\r\n    );\r\n\r\n  finalizeAdyenPaymentDetails: FinalizeAdyenPaymentDetails = async (payload) =>\r\n    this.cleengService.post('/connectors/adyen/payment-details/finalize', JSON.stringify(payload), { authenticate: true });\r\n\r\n  directPostCardPayment = async () => false;\r\n}\r\n","import { injectable } from 'inversify';\r\n\r\nimport { createURL } from '../../../utils/urlFormatting';\r\nimport type {\r\n  FetchReceipt,\r\n  GetActivePayment,\r\n  GetActiveSubscription,\r\n  GetAllTransactions,\r\n  GetPaymentDetails,\r\n  GetSubscriptions,\r\n  GetTransactions,\r\n  UpdateSubscription,\r\n} from '../../../../types/subscription';\r\nimport SubscriptionService from '../SubscriptionService';\r\n\r\nimport CleengService from './CleengService';\r\n\r\n@injectable()\r\nexport default class CleengSubscriptionService extends SubscriptionService {\r\n  private readonly cleengService: CleengService;\r\n\r\n  constructor(cleengService: CleengService) {\r\n    super();\r\n    this.cleengService = cleengService;\r\n  }\r\n\r\n  getActiveSubscription: GetActiveSubscription = async ({ customerId }) => {\r\n    const response = await this.getSubscriptions({ customerId });\r\n\r\n    if (response.errors.length > 0) return null;\r\n\r\n    return response.responseData.items.find((item) => item.status === 'active' || item.status === 'cancelled') || null;\r\n  };\r\n\r\n  getAllTransactions: GetAllTransactions = async ({ customerId }) => {\r\n    const response = await this.getTransactions({ customerId });\r\n\r\n    if (response.errors.length > 0) return null;\r\n\r\n    return response.responseData.items;\r\n  };\r\n\r\n  getActivePayment: GetActivePayment = async ({ customerId }) => {\r\n    const response = await this.getPaymentDetails({ customerId });\r\n\r\n    if (response.errors.length > 0) return null;\r\n\r\n    return response.responseData.paymentDetails.find((paymentDetails) => paymentDetails.active) || null;\r\n  };\r\n\r\n  getSubscriptions: GetSubscriptions = async (payload) => {\r\n    return this.cleengService.get(`/customers/${payload.customerId}/subscriptions`, { authenticate: true });\r\n  };\r\n\r\n  updateSubscription: UpdateSubscription = async (payload) => {\r\n    return this.cleengService.patch(`/customers/${payload.customerId}/subscriptions`, JSON.stringify(payload), { authenticate: true });\r\n  };\r\n\r\n  getPaymentDetails: GetPaymentDetails = async (payload) => {\r\n    return this.cleengService.get(`/customers/${payload.customerId}/payment_details`, { authenticate: true });\r\n  };\r\n\r\n  getTransactions: GetTransactions = async ({ customerId, limit, offset }) => {\r\n    return this.cleengService.get(createURL(`/customers/${customerId}/transactions`, { limit, offset }), { authenticate: true });\r\n  };\r\n\r\n  fetchReceipt: FetchReceipt = async ({ transactionId }) => {\r\n    return this.cleengService.get(`/receipt/${transactionId}`, { authenticate: true });\r\n  };\r\n\r\n  updateCardDetails: undefined;\r\n\r\n  changeSubscription: undefined;\r\n}\r\n","import type { CustomFormField, CustomerConsent } from '../../types/account';\r\nimport type { Config } from '../../types/config';\r\nimport type { GenericFormValues } from '../../types/form';\r\nimport type { Playlist, PlaylistItem } from '../../types/playlist';\r\nimport { CARD_ASPECT_RATIOS } from '../constants';\r\n\r\nexport type PosterAspectRatio = (typeof CARD_ASPECT_RATIOS)[number];\r\n\r\nconst getFiltersFromConfig = (config: Config, playlistId: string | undefined): string[] => {\r\n  const menuItem = config.menu.find((item) => item.contentId === playlistId);\r\n  const filters = menuItem?.filterTags?.split(',').filter(Boolean);\r\n\r\n  return filters || [];\r\n};\r\n\r\nconst filterPlaylist = (playlist: Playlist, filter: string) => {\r\n  if (filter === '') return playlist;\r\n\r\n  return {\r\n    ...playlist,\r\n    playlist: playlist.playlist.filter(({ tags }) => (tags ? tags.split(',').includes(filter) : false)),\r\n  };\r\n};\r\n\r\nconst chunk = <T>(input: T[], size: number) => {\r\n  return input?.reduce((arr: T[][], item, idx: number) => {\r\n    return idx % size === 0 ? [...arr, [item]] : [...arr.slice(0, -1), [...arr.slice(-1)[0], item]];\r\n  }, []);\r\n};\r\n\r\nconst findPlaylistImageForWidth = (playlistItem: PlaylistItem, width: number): string =>\r\n  playlistItem.images.find((img) => img.width === width)?.src || playlistItem.image;\r\n\r\nconst generatePlaylistPlaceholder = (playlistLength: number = 15): Playlist => ({\r\n  title: '',\r\n  playlist: new Array(playlistLength).fill({}).map(\r\n    (_value, index) =>\r\n      ({\r\n        description: '',\r\n        duration: 0,\r\n        feedid: '',\r\n        image: '',\r\n        images: [],\r\n        cardImage: '',\r\n        backgroundImage: '',\r\n        channelLogoImage: '',\r\n        link: '',\r\n        genre: '',\r\n        mediaid: `placeholder_${index}`,\r\n        pubdate: 0,\r\n        rating: '',\r\n        sources: [],\r\n        tags: '',\r\n        title: '',\r\n        tracks: [],\r\n      } as PlaylistItem),\r\n  ),\r\n});\r\n\r\nconst formatConsentValues = (publisherConsents: CustomFormField[] | null = [], customerConsents: CustomerConsent[] | null = []) => {\r\n  if (!publisherConsents || !customerConsents) {\r\n    return {};\r\n  }\r\n\r\n  const values = publisherConsents?.reduce((acc, publisherConsent) => {\r\n    const consent = customerConsents?.find((customerConsent) => customerConsent.name === publisherConsent.name);\r\n\r\n    if (consent) {\r\n      const value = publisherConsent.isCustomRegisterField ? consent.value ?? '' : consent.state === 'accepted';\r\n      acc[publisherConsent.name] = value;\r\n    }\r\n\r\n    return acc;\r\n  }, {} as Record<string, string | boolean>);\r\n\r\n  return values;\r\n};\r\n\r\nconst formatConsents = (publisherConsents: CustomFormField[] | null = [], customerConsents: CustomerConsent[] | null = []) => {\r\n  if (!publisherConsents || !customerConsents) {\r\n    return {};\r\n  }\r\n  const values: Record<string, boolean> = {};\r\n  publisherConsents?.forEach((publisherConsent) => {\r\n    if (customerConsents?.find((customerConsent) => customerConsent.name === publisherConsent.name && customerConsent.state === 'accepted')) {\r\n      values[publisherConsent.name] = true;\r\n    }\r\n  });\r\n\r\n  return values;\r\n};\r\n\r\nconst extractConsentValues = (consents?: CustomFormField[]) => {\r\n  const values: Record<string, string | boolean> = {};\r\n\r\n  if (!consents) {\r\n    return values;\r\n  }\r\n\r\n  consents?.forEach((consent) => {\r\n    values[consent.name] = consent.type === 'checkbox' ? consent.enabledByDefault === true : consent.defaultValue ?? '';\r\n  });\r\n\r\n  return values;\r\n};\r\n\r\nconst formatConsentsFromValues = (publisherConsents: CustomFormField[] | null, values?: GenericFormValues) => {\r\n  const consents: CustomerConsent[] = [];\r\n\r\n  if (!publisherConsents || !values) return consents;\r\n\r\n  publisherConsents.forEach((consent) => {\r\n    consents.push({\r\n      name: consent.name,\r\n      version: consent.version,\r\n      state: values[consent.name] ? 'accepted' : 'declined',\r\n      value: values[consent.name] ?? '',\r\n    });\r\n  });\r\n\r\n  return consents;\r\n};\r\n\r\nconst checkConsentsFromValues = (publisherConsents: CustomFormField[], consents: Record<string, string | boolean>) => {\r\n  const customerConsents: CustomerConsent[] = [];\r\n  const consentsErrors: string[] = [];\r\n\r\n  if (!publisherConsents || !consents) return { customerConsents, consentsErrors };\r\n\r\n  publisherConsents.forEach((consent) => {\r\n    if (consent.required && !consents[consent.name]) {\r\n      consentsErrors.push(consent.name);\r\n    }\r\n\r\n    customerConsents.push({\r\n      name: consent.name,\r\n      version: consent.version,\r\n      state: consents[consent.name] ? 'accepted' : 'declined',\r\n      value: consents[consent.name] ?? '',\r\n    });\r\n  });\r\n\r\n  return { customerConsents, consentsErrors };\r\n};\r\n\r\nconst isNotEmptyConsent = (consent: CustomerConsent) => consent.value !== '';\r\n\r\nconst formatConsentToRegisterField = ({ name, value = '' }: CustomerConsent, _: number, collection: CustomerConsent[]) => {\r\n  const val = (() => {\r\n    if (name === 'us_state') {\r\n      if (collection.find(({ name, value }) => name === 'country' && value === 'us')) {\r\n        return value === 'n/a' ? '' : value;\r\n      }\r\n\r\n      return 'n/a';\r\n    }\r\n\r\n    const isBoolean = value === true || value === false;\r\n\r\n    if (isBoolean && name !== 'terms') {\r\n      return value ? 'on' : 'off';\r\n    }\r\n\r\n    return value;\r\n  })();\r\n\r\n  return [name, val] as const;\r\n};\r\n\r\nconst formatConsentsToRegisterFields = (consents: CustomerConsent[]) =>\r\n  Object.fromEntries(consents.filter(isNotEmptyConsent).map(formatConsentToRegisterField));\r\n\r\nconst deepCopy = (obj: unknown) => {\r\n  if (Array.isArray(obj) || (typeof obj === 'object' && obj !== null)) {\r\n    return JSON.parse(JSON.stringify(obj));\r\n  }\r\n  return obj;\r\n};\r\n\r\nconst parseAspectRatio = (input: unknown) => {\r\n  if (typeof input === 'string' && (CARD_ASPECT_RATIOS as readonly string[]).includes(input)) return input as PosterAspectRatio;\r\n};\r\n\r\nconst parseTilesDelta = (posterAspect?: PosterAspectRatio) => {\r\n  if (!posterAspect) {\r\n    return 0;\r\n  }\r\n\r\n  const parts = posterAspect.split(':');\r\n\r\n  return parts.length === 2 ? Math.floor(parseInt(parts[1]) / parseInt(parts[0])) : 0;\r\n};\r\n\r\nexport {\r\n  getFiltersFromConfig,\r\n  filterPlaylist,\r\n  chunk,\r\n  findPlaylistImageForWidth,\r\n  generatePlaylistPlaceholder,\r\n  formatConsentValues,\r\n  formatConsents,\r\n  formatConsentsFromValues,\r\n  extractConsentValues,\r\n  checkConsentsFromValues,\r\n  deepCopy,\r\n  parseAspectRatio,\r\n  parseTilesDelta,\r\n  isNotEmptyConsent,\r\n  formatConsentToRegisterField,\r\n  formatConsentsToRegisterFields,\r\n};\r\n","import InPlayer, { Env } from '@inplayer-org/inplayer.js';\r\nimport type { AccountData, FavoritesData, RegisterField, UpdateAccountData, WatchHistory } from '@inplayer-org/inplayer.js';\r\nimport i18next from 'i18next';\r\nimport { injectable } from 'inversify';\r\n\r\nimport { formatConsentsToRegisterFields } from '../../../utils/collection';\r\nimport { isCommonError } from '../../../utils/api';\r\nimport type {\r\n  AuthData,\r\n  ChangePassword,\r\n  ChangePasswordWithOldPassword,\r\n  CustomFormField,\r\n  Customer,\r\n  CustomerConsent,\r\n  CustomRegisterFieldVariant,\r\n  DeleteAccount,\r\n  ExportAccountData,\r\n  GetCaptureStatus,\r\n  GetCustomerConsents,\r\n  GetPublisherConsents,\r\n  Login,\r\n  NotificationsData,\r\n  Register,\r\n  ResetPassword,\r\n  GetSocialURLs,\r\n  UpdateCaptureAnswers,\r\n  UpdateCustomerArgs,\r\n  UpdateCustomerConsents,\r\n  UpdateFavorites,\r\n  UpdateWatchHistory,\r\n  UpdateCustomer,\r\n} from '../../../../types/account';\r\nimport type { AccessModel, Config } from '../../../../types/config';\r\nimport type { InPlayerAuthData } from '../../../../types/inplayer';\r\nimport type { SerializedFavorite } from '../../../../types/favorite';\r\nimport type { SerializedWatchHistoryItem } from '../../../../types/watchHistory';\r\nimport AccountService from '../AccountService';\r\nimport StorageService from '../../StorageService';\r\nimport { ACCESS_MODEL } from '../../../constants';\r\n\r\nenum InPlayerEnv {\r\n  Development = 'development',\r\n  Production = 'production',\r\n  Daily = 'daily',\r\n}\r\n\r\nconst JW_TERMS_URL = 'https://inplayer.com/legal/terms';\r\n\r\n@injectable()\r\nexport default class JWPAccountService extends AccountService {\r\n  private readonly storageService;\r\n  private clientId = '';\r\n\r\n  accessModel: AccessModel = ACCESS_MODEL.AUTHVOD;\r\n  assetId: number | null = null;\r\n  svodOfferIds: string[] = [];\r\n  sandbox = false;\r\n\r\n  constructor(storageService: StorageService) {\r\n    super({\r\n      canUpdateEmail: false,\r\n      canSupportEmptyFullName: false,\r\n      canChangePasswordWithOldPassword: true,\r\n      canRenewSubscription: false,\r\n      canExportAccountData: true,\r\n      canUpdatePaymentMethod: false,\r\n      canShowReceipts: true,\r\n      canDeleteAccount: true,\r\n      hasNotifications: true,\r\n      hasSocialURLs: true,\r\n      // Limit of media_ids length passed to the /apps/watchlists endpoint\r\n      watchListSizeLimit: 48,\r\n    });\r\n\r\n    this.storageService = storageService;\r\n  }\r\n\r\n  private parseJson = (value: string, fallback = {}) => {\r\n    try {\r\n      return JSON.parse(value);\r\n    } catch {\r\n      return fallback;\r\n    }\r\n  };\r\n\r\n  private formatFavorite = (favorite: FavoritesData): SerializedFavorite => {\r\n    return {\r\n      mediaid: favorite.media_id,\r\n    };\r\n  };\r\n\r\n  private formatHistoryItem = (history: WatchHistory): SerializedWatchHistoryItem => {\r\n    return {\r\n      mediaid: history.media_id,\r\n      progress: history.progress,\r\n    };\r\n  };\r\n\r\n  private formatAccount = (account: AccountData): Customer => {\r\n    const { id, uuid, email, full_name: fullName, metadata, created_at: createdAt } = account;\r\n    const regDate = new Date(createdAt * 1000).toLocaleString();\r\n\r\n    const firstName = metadata?.first_name as string;\r\n    const lastName = metadata?.surname as string;\r\n\r\n    return {\r\n      id: id.toString(),\r\n      uuid,\r\n      email,\r\n      fullName,\r\n      firstName,\r\n      lastName,\r\n      metadata,\r\n      regDate,\r\n      country: '',\r\n      lastUserIp: '',\r\n    };\r\n  };\r\n\r\n  private formatAuth(auth: InPlayerAuthData): AuthData {\r\n    const { access_token: jwt } = auth;\r\n    return {\r\n      jwt,\r\n      refreshToken: '',\r\n    };\r\n  }\r\n\r\n  initialize = async (config: Config, url: string, _logoutFn: () => Promise<void>) => {\r\n    const jwpConfig = config.integrations?.jwp;\r\n\r\n    if (!jwpConfig?.clientId) {\r\n      throw new Error('Failed to initialize JWP integration. The clientId is missing.');\r\n    }\r\n\r\n    // set environment\r\n    this.sandbox = !!jwpConfig.useSandbox;\r\n\r\n    const env: string = this.sandbox ? InPlayerEnv.Development : InPlayerEnv.Production;\r\n    InPlayer.setConfig(env as Env);\r\n\r\n    // calculate access model\r\n    if (jwpConfig.clientId) {\r\n      this.clientId = jwpConfig.clientId;\r\n    }\r\n\r\n    if (jwpConfig.assetId) {\r\n      this.accessModel = ACCESS_MODEL.SVOD;\r\n      this.assetId = jwpConfig.assetId;\r\n      this.svodOfferIds = jwpConfig.assetId ? [String(jwpConfig.assetId)] : [];\r\n    }\r\n\r\n    // restore session from URL params\r\n    const queryParams = new URLSearchParams(url.split('#')[1]);\r\n    const token = queryParams.get('token');\r\n    const refreshToken = queryParams.get('refresh_token');\r\n    const expires = queryParams.get('expires');\r\n\r\n    if (!token || !refreshToken || !expires) {\r\n      return;\r\n    }\r\n\r\n    InPlayer.Account.setToken(token, refreshToken, parseInt(expires));\r\n  };\r\n\r\n  getAuthData = async () => {\r\n    if (InPlayer.Account.isAuthenticated()) {\r\n      const credentials = InPlayer.Account.getToken().toObject();\r\n\r\n      return {\r\n        jwt: credentials.token,\r\n        refreshToken: credentials.refreshToken,\r\n      } as AuthData;\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  getPublisherConsents: GetPublisherConsents = async () => {\r\n    try {\r\n      const { data } = await InPlayer.Account.getRegisterFields(this.clientId);\r\n\r\n      const terms = data?.collection.find(({ name }) => name === 'terms');\r\n\r\n      const result = data?.collection\r\n        // we exclude these fields because we already have them by default\r\n        .filter((field) => !['email_confirmation', 'first_name', 'surname'].includes(field.name) && ![terms].includes(field))\r\n        .map(\r\n          (field): CustomFormField => ({\r\n            type: field.type as CustomRegisterFieldVariant,\r\n            isCustomRegisterField: true,\r\n            name: field.name,\r\n            label: field.label,\r\n            placeholder: field.placeholder,\r\n            required: field.required,\r\n            options: field.options,\r\n            defaultValue: '',\r\n            version: '1',\r\n            ...(field.type === 'checkbox'\r\n              ? {\r\n                  enabledByDefault: field.default_value === 'true',\r\n                }\r\n              : {\r\n                  defaultValue: field.default_value,\r\n                }),\r\n          }),\r\n        );\r\n\r\n      return terms ? [this.getTermsConsent(terms), ...result] : result;\r\n    } catch {\r\n      throw new Error('Failed to fetch publisher consents.');\r\n    }\r\n  };\r\n\r\n  getCustomerConsents: GetCustomerConsents = async (payload) => {\r\n    try {\r\n      if (!payload?.customer) {\r\n        return {\r\n          consents: [],\r\n        };\r\n      }\r\n\r\n      const { customer } = payload;\r\n\r\n      return this.parseJson(customer.metadata?.consents as string, []);\r\n    } catch {\r\n      throw new Error('Unable to fetch Customer consents.');\r\n    }\r\n  };\r\n\r\n  updateCustomerConsents: UpdateCustomerConsents = async (payload) => {\r\n    try {\r\n      const { customer, consents } = payload;\r\n\r\n      const existingAccountData = this.formatUpdateAccount(customer);\r\n\r\n      const params = {\r\n        ...existingAccountData,\r\n        metadata: {\r\n          ...existingAccountData.metadata,\r\n          ...formatConsentsToRegisterFields(consents),\r\n          consents: JSON.stringify(consents),\r\n        },\r\n      };\r\n\r\n      const { data } = await InPlayer.Account.updateAccount(params);\r\n\r\n      return this.parseJson(data?.metadata?.consents as string, []);\r\n    } catch {\r\n      throw new Error('Unable to update Customer consents');\r\n    }\r\n  };\r\n\r\n  updateCaptureAnswers: UpdateCaptureAnswers = async ({ customer, ...newAnswers }) => {\r\n    return this.updateCustomer({ ...customer, ...newAnswers });\r\n  };\r\n\r\n  changePasswordWithOldPassword: ChangePasswordWithOldPassword = async (payload) => {\r\n    const { oldPassword, newPassword, newPasswordConfirmation } = payload;\r\n\r\n    try {\r\n      await InPlayer.Account.changePassword({\r\n        oldPassword,\r\n        password: newPassword,\r\n        passwordConfirmation: newPasswordConfirmation,\r\n      });\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error)) {\r\n        throw new Error(error.response.data.message);\r\n      }\r\n      throw new Error('Failed to change password');\r\n    }\r\n  };\r\n\r\n  resetPassword: ResetPassword = async ({ customerEmail }) => {\r\n    try {\r\n      await InPlayer.Account.requestNewPassword({\r\n        email: customerEmail,\r\n        merchantUuid: this.clientId,\r\n        brandingId: 0,\r\n      });\r\n    } catch {\r\n      throw new Error('Failed to reset password.');\r\n    }\r\n  };\r\n\r\n  login: Login = async ({ email, password, referrer }) => {\r\n    try {\r\n      const { data } = await InPlayer.Account.signInV2({\r\n        email,\r\n        password,\r\n        referrer,\r\n        clientId: this.clientId || '',\r\n      });\r\n\r\n      const user = this.formatAccount(data.account);\r\n\r\n      return {\r\n        auth: this.formatAuth(data),\r\n        user,\r\n        customerConsents: this.parseJson(user?.metadata?.consents as string, []),\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to authenticate user.');\r\n    }\r\n  };\r\n\r\n  register: Register = async ({ email, password, referrer, consents }) => {\r\n    try {\r\n      const { data } = await InPlayer.Account.signUpV2({\r\n        email,\r\n        password,\r\n        referrer,\r\n        passwordConfirmation: password,\r\n        fullName: email,\r\n        metadata: {\r\n          first_name: ' ',\r\n          surname: ' ',\r\n          ...formatConsentsToRegisterFields(consents),\r\n          consents: JSON.stringify(consents),\r\n        },\r\n        type: 'consumer',\r\n        clientId: this.clientId || '',\r\n      });\r\n\r\n      const user = this.formatAccount(data.account);\r\n\r\n      return {\r\n        auth: this.formatAuth(data),\r\n        user,\r\n        customerConsents: this.parseJson(user?.metadata?.consents as string, []),\r\n      };\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error)) {\r\n        throw new Error(error.response.data.message);\r\n      }\r\n      throw new Error('Failed to create account.');\r\n    }\r\n  };\r\n\r\n  logout = async () => {\r\n    try {\r\n      if (InPlayer.Notifications.isSubscribed()) {\r\n        InPlayer.Notifications.unsubscribe();\r\n      }\r\n\r\n      if (InPlayer.Account.isAuthenticated()) {\r\n        await InPlayer.Account.signOut();\r\n      }\r\n    } catch {\r\n      throw new Error('Failed to sign out.');\r\n    }\r\n  };\r\n\r\n  getUser = async () => {\r\n    try {\r\n      const { data } = await InPlayer.Account.getAccountInfo();\r\n\r\n      const user = this.formatAccount(data);\r\n\r\n      return {\r\n        user,\r\n        customerConsents: this.parseJson(user?.metadata?.consents as string, []) as CustomerConsent[],\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to fetch user data.');\r\n    }\r\n  };\r\n\r\n  updateCustomer: UpdateCustomer = async (customer) => {\r\n    try {\r\n      const response = await InPlayer.Account.updateAccount(this.formatUpdateAccount(customer));\r\n\r\n      return this.formatAccount(response.data);\r\n    } catch {\r\n      throw new Error('Failed to update user data.');\r\n    }\r\n  };\r\n\r\n  formatUpdateAccount = (customer: UpdateCustomerArgs) => {\r\n    const firstName = customer.firstName?.trim() || '';\r\n    const lastName = customer.lastName?.trim() || '';\r\n    const fullName = `${firstName} ${lastName}`.trim() || (customer.email as string);\r\n    const metadata: Record<string, string> = {\r\n      ...customer.metadata,\r\n      first_name: firstName,\r\n      surname: lastName,\r\n    };\r\n    const data: UpdateAccountData = {\r\n      fullName,\r\n      metadata,\r\n    };\r\n\r\n    return data;\r\n  };\r\n\r\n  getCaptureStatus: GetCaptureStatus = async ({ customer: { firstName, lastName } }) => {\r\n    const firstNameTrimmed = firstName?.trim() || '';\r\n    const lastNameTrimmed = lastName?.trim() || '';\r\n\r\n    return {\r\n      isCaptureEnabled: true,\r\n      shouldCaptureBeDisplayed: !firstNameTrimmed || !lastNameTrimmed,\r\n      settings: [\r\n        {\r\n          answer: {\r\n            firstName: firstNameTrimmed || null,\r\n            lastName: lastNameTrimmed || null,\r\n          },\r\n          enabled: true,\r\n          key: 'firstNameLastName',\r\n          required: true,\r\n        },\r\n      ],\r\n    };\r\n  };\r\n\r\n  changePasswordWithResetToken: ChangePassword = async (payload) => {\r\n    const { resetPasswordToken = '', newPassword, newPasswordConfirmation = '' } = payload;\r\n    try {\r\n      await InPlayer.Account.setNewPassword(\r\n        {\r\n          password: newPassword,\r\n          passwordConfirmation: newPasswordConfirmation,\r\n          brandingId: 0,\r\n        },\r\n        resetPasswordToken,\r\n      );\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error)) {\r\n        throw new Error(error.response.data.message);\r\n      }\r\n      throw new Error('Failed to change password.');\r\n    }\r\n  };\r\n\r\n  getTermsConsent = ({ label: termsUrl }: RegisterField): CustomFormField => {\r\n    const termsLink = `<a href=\"${termsUrl || JW_TERMS_URL}\" target=\"_blank\">${i18next.t('account:registration.terms_and_conditions')}</a>`;\r\n\r\n    // t('account:registration.terms_consent_jwplayer')\r\n    // t('account:registration.terms_consent')\r\n    return {\r\n      type: 'checkbox',\r\n      isCustomRegisterField: true,\r\n      required: true,\r\n      name: 'terms',\r\n      defaultValue: '',\r\n      label: termsUrl\r\n        ? i18next.t('account:registration.terms_consent', { termsLink })\r\n        : i18next.t('account:registration.terms_consent_jwplayer', { termsLink }),\r\n      enabledByDefault: false,\r\n      placeholder: '',\r\n      options: {},\r\n      version: '1',\r\n    };\r\n  };\r\n\r\n  updateWatchHistory: UpdateWatchHistory = async ({ history }) => {\r\n    const current = await this.getWatchHistory();\r\n    const savedHistory = current.map((e) => e.mediaid) || [];\r\n\r\n    await Promise.allSettled(\r\n      history.map(({ mediaid, progress }) => {\r\n        if (!savedHistory.includes(mediaid) || current.some((e) => e.mediaid == mediaid && e.progress != progress)) {\r\n          return InPlayer.Account.updateWatchHistory(mediaid, progress);\r\n        }\r\n      }),\r\n    );\r\n  };\r\n\r\n  updateFavorites: UpdateFavorites = async ({ favorites }) => {\r\n    const current = await this.getFavorites();\r\n    const currentFavoriteIds = current.map((e) => e.mediaid) || [];\r\n    const payloadFavoriteIds = favorites.map((e) => e.mediaid);\r\n\r\n    // save new favorites\r\n    await Promise.allSettled(\r\n      payloadFavoriteIds.map((mediaId) => {\r\n        return !currentFavoriteIds.includes(mediaId) ? InPlayer.Account.addToFavorites(mediaId) : Promise.resolve();\r\n      }),\r\n    );\r\n\r\n    // delete removed favorites\r\n    await Promise.allSettled(\r\n      currentFavoriteIds.map((mediaId) => {\r\n        return !payloadFavoriteIds.includes(mediaId) ? InPlayer.Account.deleteFromFavorites(mediaId) : Promise.resolve();\r\n      }),\r\n    );\r\n  };\r\n\r\n  getFavorites = async () => {\r\n    const favoritesData = await InPlayer.Account.getFavorites();\r\n\r\n    return favoritesData.data?.collection?.map(this.formatFavorite) || [];\r\n  };\r\n\r\n  getWatchHistory = async () => {\r\n    const watchHistoryData = await InPlayer.Account.getWatchHistory({});\r\n\r\n    return watchHistoryData.data?.collection?.map(this.formatHistoryItem) || [];\r\n  };\r\n\r\n  subscribeToNotifications: NotificationsData = async ({ uuid, onMessage }) => {\r\n    try {\r\n      if (!InPlayer.Notifications.isSubscribed()) {\r\n        InPlayer.subscribe(uuid, {\r\n          onMessage: onMessage,\r\n          onOpen: () => true,\r\n        });\r\n      }\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  exportAccountData: ExportAccountData = async () => {\r\n    // password is sent as undefined because it is now optional on BE\r\n    try {\r\n      const response = await InPlayer.Account.exportData({ password: undefined, brandingId: 0 });\r\n\r\n      return response.data;\r\n    } catch {\r\n      throw new Error('Failed to export account data');\r\n    }\r\n  };\r\n\r\n  deleteAccount: DeleteAccount = async ({ password }) => {\r\n    try {\r\n      const response = await InPlayer.Account.deleteAccount({ password, brandingId: 0 });\r\n\r\n      return response.data;\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error)) {\r\n        throw new Error(error.response.data.message || 'Failed to delete account');\r\n      }\r\n\r\n      throw new Error('Failed to delete account');\r\n    }\r\n  };\r\n\r\n  getSocialUrls: GetSocialURLs = async ({ redirectUrl }) => {\r\n    const socialState = this.storageService.base64Encode(\r\n      JSON.stringify({\r\n        client_id: this.clientId || '',\r\n        redirect: redirectUrl,\r\n      }),\r\n    );\r\n\r\n    const socialResponse = await InPlayer.Account.getSocialLoginUrls(socialState);\r\n\r\n    if (socialResponse.status !== 200) {\r\n      throw new Error('Failed to fetch social urls');\r\n    }\r\n\r\n    return socialResponse.data.social_urls;\r\n  };\r\n}\r\n","export const formatDurationTag = (seconds: number) => {\r\n  if (!seconds) return '';\r\n\r\n  const minutes = Math.ceil(seconds / 60);\r\n\r\n  return `${minutes} min`;\r\n};\r\n\r\n/**\r\n * @param duration Duration in seconds\r\n *\r\n * Calculates hours and minutes into a string\r\n * Hours are only shown if at least 1\r\n * Minutes get rounded\r\n *\r\n * @returns string, such as '2hrs 24min' or '31min'\r\n */\r\n\r\nexport const formatDuration = (duration: number) => {\r\n  if (!duration) return '';\r\n\r\n  const hours = Math.floor(duration / 3600);\r\n  const minutes = Math.round((duration - hours * 3600) / 60);\r\n\r\n  const hoursString = hours ? `${hours}hrs ` : '';\r\n  const minutesString = minutes ? `${minutes}min ` : '';\r\n\r\n  return `${hoursString}${minutesString}`;\r\n};\r\n\r\nexport const formatPrice = (price: number, currency: string, country?: string) => {\r\n  return new Intl.NumberFormat(country || 'en-US', {\r\n    style: 'currency',\r\n    currency: currency,\r\n  }).format(price);\r\n};\r\n\r\nexport const formatSeriesMetaString = (seasonNumber?: string, episodeNumber?: string) => {\r\n  if (!seasonNumber && !episodeNumber) {\r\n    return '';\r\n  }\r\n\r\n  return seasonNumber && seasonNumber !== '0' ? `S${seasonNumber}:E${episodeNumber}` : `E${episodeNumber}`;\r\n};\r\n\r\nexport const formatVideoSchedule = (locale: string, scheduledStart?: Date, scheduledEnd?: Date) => {\r\n  if (!scheduledStart) {\r\n    return '';\r\n  }\r\n\r\n  if (!scheduledEnd) {\r\n    return formatLocalizedDateTime(scheduledStart, locale, ' • ');\r\n  }\r\n\r\n  return `${formatLocalizedDateTime(scheduledStart, locale, ' • ')} - ${formatLocalizedTime(scheduledEnd, locale)}`;\r\n};\r\n\r\nexport const formatLocalizedDate = (date: Date, locale: string) => {\r\n  return new Intl.DateTimeFormat(locale, { day: 'numeric', month: 'long', year: 'numeric' }).format(date);\r\n};\r\n\r\nexport const formatLocalizedTime = (date: Date, locale: string) => {\r\n  return new Intl.DateTimeFormat(locale, { hour: 'numeric', minute: 'numeric' }).format(date);\r\n};\r\n\r\nexport const formatLocalizedDateTime = (date: Date, locale: string, separator = ' ') => {\r\n  return `${formatLocalizedDate(date, locale)}${separator}${formatLocalizedTime(date, locale)}`;\r\n};\r\n","import type { Offer, Order } from '../../types/checkout';\r\n\r\nimport { formatPrice } from './formatting';\r\n\r\nexport const getOfferPrice = (offer: Offer) => formatPrice(offer.customerPriceInclTax, offer.customerCurrency, offer.customerCountry);\r\n\r\nexport const isSVODOffer = (offer: Offer | Order) => offer.offerId?.[0] === 'S';\r\n","import InPlayer, { type AccessFee, type MerchantPaymentMethod } from '@inplayer-org/inplayer.js';\r\nimport { injectable } from 'inversify';\r\n\r\nimport { isSVODOffer } from '../../../utils/offers';\r\nimport type {\r\n  CardPaymentData,\r\n  CreateOrder,\r\n  CreateOrderArgs,\r\n  GetEntitlements,\r\n  GetEntitlementsResponse,\r\n  GetOffers,\r\n  GetPaymentMethods,\r\n  Offer,\r\n  Order,\r\n  Payment,\r\n  PaymentMethod,\r\n  PaymentWithAdyen,\r\n  PaymentWithoutDetails,\r\n  PaymentWithPayPal,\r\n  UpdateOrder,\r\n} from '../../../../types/checkout';\r\nimport CheckoutService from '../CheckoutService';\r\nimport type { ServiceResponse } from '../../../../types/service';\r\nimport { isCommonError } from '../../../utils/api';\r\n\r\n@injectable()\r\nexport default class JWPCheckoutService extends CheckoutService {\r\n  private readonly cardPaymentProvider = 'stripe';\r\n\r\n  private formatPaymentMethod = (method: MerchantPaymentMethod, cardPaymentProvider: string): PaymentMethod => {\r\n    return {\r\n      id: method.id,\r\n      methodName: method.method_name.toLocaleLowerCase(),\r\n      provider: cardPaymentProvider,\r\n      logoUrl: '',\r\n    } as PaymentMethod;\r\n  };\r\n\r\n  private formatEntitlements = (expiresAt: number = 0, accessGranted: boolean = false): ServiceResponse<GetEntitlementsResponse> => {\r\n    return {\r\n      errors: [],\r\n      responseData: {\r\n        accessGranted,\r\n        expiresAt,\r\n      },\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Format a (Cleeng like) offer id for the given access fee (pricing option). For JWP, we need the asset id and\r\n   * access fee id in some cases.\r\n   */\r\n  private formatOfferId(offer: AccessFee) {\r\n    const ppvOffers = ['ppv', 'ppv_custom'];\r\n\r\n    return ppvOffers.includes(offer.access_type.name) ? `C${offer.item_id}_${offer.id}` : `S${offer.item_id}_${offer.id}`;\r\n  }\r\n\r\n  /**\r\n   * Parse the given offer id and extract the asset id.\r\n   * The offer id might be the Cleeng format (`S<assetId>_<pricingOptionId>`) or the asset id as string.\r\n   */\r\n  private parseOfferId(offerId: string | number) {\r\n    if (typeof offerId === 'string') {\r\n      // offer id format `S<assetId>_<pricingOptionId>`\r\n      if (offerId.startsWith('C') || offerId.startsWith('S')) {\r\n        return parseInt(offerId.slice(1).split('_')[0]);\r\n      }\r\n\r\n      // offer id format `<assetId>`\r\n      return parseInt(offerId);\r\n    }\r\n\r\n    return offerId;\r\n  }\r\n\r\n  private formatOffer = (offer: AccessFee): Offer => {\r\n    return {\r\n      id: offer.id,\r\n      offerId: this.formatOfferId(offer),\r\n      offerCurrency: offer.currency,\r\n      customerPriceInclTax: offer.amount,\r\n      customerCurrency: offer.currency,\r\n      offerTitle: offer.description,\r\n      active: true,\r\n      period: offer.access_type.period === 'month' && offer.access_type.quantity === 12 ? 'year' : offer.access_type.period,\r\n      freePeriods: offer.trial_period ? 1 : 0,\r\n      planSwitchEnabled: offer.item.plan_switch_enabled ?? false,\r\n    } as Offer;\r\n  };\r\n\r\n  private formatOrder = (payload: CreateOrderArgs): Order => {\r\n    return {\r\n      id: payload.offer.id,\r\n      customerId: payload.customerId,\r\n      offerId: payload.offer.offerId,\r\n      totalPrice: payload.offer.customerPriceInclTax,\r\n      priceBreakdown: {\r\n        offerPrice: payload.offer.customerPriceInclTax,\r\n        // @TODO is this correct?\r\n        discountAmount: payload.offer.customerPriceInclTax,\r\n        discountedPrice: payload.offer.customerPriceInclTax,\r\n        paymentMethodFee: 0,\r\n        taxValue: 0,\r\n      },\r\n      taxRate: 0,\r\n      currency: payload.offer.offerCurrency || 'EUR',\r\n      requiredPaymentDetails: true,\r\n    } as Order;\r\n  };\r\n\r\n  createOrder: CreateOrder = async (payload) => {\r\n    return {\r\n      errors: [],\r\n      responseData: {\r\n        message: '',\r\n        order: this.formatOrder(payload),\r\n        success: true,\r\n      },\r\n    };\r\n  };\r\n\r\n  getOffers: GetOffers = async (payload) => {\r\n    const offers = await Promise.all(\r\n      payload.offerIds.map(async (offerId) => {\r\n        try {\r\n          const { data } = await InPlayer.Asset.getAssetAccessFees(this.parseOfferId(offerId));\r\n\r\n          return data?.map((offer) => this.formatOffer(offer));\r\n        } catch {\r\n          throw new Error('Failed to get offers');\r\n        }\r\n      }),\r\n    );\r\n\r\n    return offers.flat();\r\n  };\r\n\r\n  getPaymentMethods: GetPaymentMethods = async () => {\r\n    try {\r\n      const response = await InPlayer.Payment.getPaymentMethods();\r\n      const paymentMethods: PaymentMethod[] = [];\r\n      response.data.forEach((method: MerchantPaymentMethod) => {\r\n        if (['card', 'paypal'].includes(method.method_name.toLowerCase())) {\r\n          paymentMethods.push(this.formatPaymentMethod(method, this.cardPaymentProvider));\r\n        }\r\n      });\r\n      return {\r\n        errors: [],\r\n        responseData: {\r\n          message: '',\r\n          paymentMethods,\r\n          status: 1,\r\n        },\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to get payment methods');\r\n    }\r\n  };\r\n\r\n  paymentWithPayPal: PaymentWithPayPal = async (payload) => {\r\n    try {\r\n      const response = await InPlayer.Payment.getPayPalParams({\r\n        origin: payload.waitingUrl,\r\n        accessFeeId: payload.order.id,\r\n        paymentMethod: 2,\r\n        voucherCode: payload.couponCode,\r\n      });\r\n\r\n      if (response.data?.id) {\r\n        return {\r\n          errors: ['Already have an active access'],\r\n          responseData: {\r\n            redirectUrl: payload.errorUrl,\r\n          },\r\n        };\r\n      }\r\n      return {\r\n        errors: [],\r\n        responseData: {\r\n          redirectUrl: response.data.endpoint,\r\n        },\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to generate PayPal payment url');\r\n    }\r\n  };\r\n\r\n  iFrameCardPayment: PaymentWithAdyen = async () => {\r\n    return {\r\n      errors: [],\r\n      responseData: {} as Payment,\r\n    };\r\n  };\r\n\r\n  paymentWithoutDetails: PaymentWithoutDetails = async () => {\r\n    return {\r\n      errors: [],\r\n      responseData: {} as Payment,\r\n    };\r\n  };\r\n\r\n  updateOrder: UpdateOrder = async ({ order, couponCode }) => {\r\n    try {\r\n      const response = await InPlayer.Voucher.getDiscount({\r\n        voucherCode: `${couponCode}`,\r\n        accessFeeId: order.id,\r\n      });\r\n\r\n      const discountAmount = order.totalPrice - response.data.amount;\r\n      const updatedOrder: Order = {\r\n        ...order,\r\n        totalPrice: response.data.amount,\r\n        priceBreakdown: {\r\n          ...order.priceBreakdown,\r\n          discountAmount,\r\n          discountedPrice: discountAmount,\r\n        },\r\n        discount: {\r\n          applied: true,\r\n          type: 'coupon',\r\n          periods: response.data.discount_duration,\r\n        },\r\n      };\r\n\r\n      return {\r\n        errors: [],\r\n        responseData: {\r\n          message: 'successfully updated',\r\n          order: updatedOrder,\r\n          success: true,\r\n        },\r\n      };\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error) && error.response.data.message === 'Voucher not found') {\r\n        throw new Error('Invalid coupon code');\r\n      }\r\n\r\n      throw new Error('An unknown error occurred');\r\n    }\r\n  };\r\n\r\n  getEntitlements: GetEntitlements = async ({ offerId }) => {\r\n    try {\r\n      const response = await InPlayer.Asset.checkAccessForAsset(this.parseOfferId(offerId));\r\n      return this.formatEntitlements(response.data.expires_at, true);\r\n    } catch {\r\n      return this.formatEntitlements();\r\n    }\r\n  };\r\n\r\n  directPostCardPayment = async (cardPaymentPayload: CardPaymentData, order: Order, referrer: string, returnUrl: string) => {\r\n    const payload = {\r\n      number: cardPaymentPayload.cardNumber.replace(/\\s/g, ''),\r\n      cardName: cardPaymentPayload.cardholderName,\r\n      expMonth: cardPaymentPayload.cardExpMonth || '',\r\n      expYear: cardPaymentPayload.cardExpYear || '',\r\n      cvv: cardPaymentPayload.cardCVC,\r\n      accessFee: order.id,\r\n      paymentMethod: 1,\r\n      voucherCode: cardPaymentPayload.couponCode,\r\n      referrer,\r\n      returnUrl,\r\n    };\r\n\r\n    try {\r\n      if (isSVODOffer(order)) {\r\n        await InPlayer.Subscription.createSubscription(payload);\r\n      } else {\r\n        await InPlayer.Payment.createPayment(payload);\r\n      }\r\n\r\n      return true;\r\n    } catch {\r\n      throw new Error('Failed to make payment');\r\n    }\r\n  };\r\n\r\n  getSubscriptionSwitches = undefined;\r\n\r\n  getOrder = undefined;\r\n\r\n  switchSubscription = undefined;\r\n\r\n  getSubscriptionSwitch = undefined;\r\n\r\n  createAdyenPaymentSession = undefined;\r\n\r\n  initialAdyenPayment = undefined;\r\n\r\n  finalizeAdyenPayment = undefined;\r\n\r\n  updatePaymentMethodWithPayPal = undefined;\r\n\r\n  deletePaymentMethod = undefined;\r\n\r\n  addAdyenPaymentDetails = undefined;\r\n\r\n  finalizeAdyenPaymentDetails = undefined;\r\n\r\n  getOffer = undefined;\r\n}\r\n","import i18next from 'i18next';\r\nimport InPlayer from '@inplayer-org/inplayer.js';\r\nimport type { Card, GetItemAccessV1, PaymentHistory, SubscriptionDetails as InplayerSubscription } from '@inplayer-org/inplayer.js';\r\nimport { injectable, named } from 'inversify';\r\n\r\nimport { isCommonError } from '../../../utils/api';\r\nimport type {\r\n  ChangeSubscription,\r\n  GetActivePayment,\r\n  GetActiveSubscription,\r\n  GetAllTransactions,\r\n  PaymentDetail,\r\n  Subscription,\r\n  Transaction,\r\n  UpdateCardDetails,\r\n  UpdateSubscription,\r\n} from '../../../../types/subscription';\r\nimport SubscriptionService from '../SubscriptionService';\r\nimport AccountService from '../AccountService';\r\n\r\nimport type JWPAccountService from './JWPAccountService';\r\n\r\ninterface SubscriptionDetails extends InplayerSubscription {\r\n  item_id?: number;\r\n  item_title?: string;\r\n  subscription_id?: string;\r\n  subscription_price?: number;\r\n  action_type?: 'recurrent' | 'canceled' | 'free-trial' | 'ended' | 'incomplete_expired';\r\n  next_rebill_date?: number;\r\n  charged_amount?: number;\r\n  payment_method_name?: string;\r\n  access_type?: {\r\n    period: string;\r\n  };\r\n  access_fee_id?: number;\r\n}\r\n\r\n@injectable()\r\nexport default class JWPSubscriptionService extends SubscriptionService {\r\n  private readonly accountService: JWPAccountService;\r\n\r\n  constructor(@named('JWP') accountService: AccountService) {\r\n    super();\r\n\r\n    this.accountService = accountService as JWPAccountService;\r\n  }\r\n\r\n  private formatCardDetails = (\r\n    card: Card & {\r\n      card_type: string;\r\n      account_id: number;\r\n      currency: string;\r\n    },\r\n  ): PaymentDetail => {\r\n    const { number, exp_month, exp_year, card_name, card_type, account_id, currency } = card;\r\n    const zeroFillExpMonth = `0${exp_month}`.slice(-2);\r\n\r\n    return {\r\n      id: 0,\r\n      paymentMethodId: 0,\r\n      paymentGateway: 'card',\r\n      paymentMethod: 'card',\r\n      customerId: account_id.toString(),\r\n      paymentMethodSpecificParams: {\r\n        holderName: card_name,\r\n        variant: card_type,\r\n        lastCardFourDigits: String(number),\r\n        cardExpirationDate: `${zeroFillExpMonth}/${exp_year}`,\r\n      },\r\n      active: true,\r\n      currency,\r\n    } as PaymentDetail;\r\n  };\r\n\r\n  private formatTransaction = (transaction: PaymentHistory): Transaction => {\r\n    const purchasedAmount = transaction?.charged_amount?.toString() || '0';\r\n\r\n    return {\r\n      transactionId: transaction.transaction_token || i18next.t('user:payment.access_granted'),\r\n      transactionDate: transaction.created_at,\r\n      trxToken: transaction.trx_token,\r\n      offerId: transaction.item_id?.toString() || i18next.t('user:payment.no_transaction'),\r\n      offerType: transaction.item_type || '',\r\n      offerTitle: transaction?.item_title || '',\r\n      offerPeriod: '',\r\n      transactionPriceExclTax: purchasedAmount,\r\n      transactionCurrency: transaction.currency_iso || 'EUR',\r\n      discountedOfferPrice: purchasedAmount,\r\n      offerCurrency: transaction.currency_iso || 'EUR',\r\n      offerPriceExclTax: purchasedAmount,\r\n      applicableTax: '0',\r\n      transactionPriceInclTax: purchasedAmount,\r\n      customerId: transaction.consumer_id?.toString(),\r\n      customerEmail: '',\r\n      customerLocale: '',\r\n      customerCountry: 'en',\r\n      customerIpCountry: '',\r\n      customerCurrency: '',\r\n      paymentMethod: transaction.payment_method_name || i18next.t('user:payment.access_granted'),\r\n    };\r\n  };\r\n\r\n  private formatActiveSubscription = (subscription: SubscriptionDetails, expiresAt: number) => {\r\n    let status = '';\r\n    switch (subscription.action_type) {\r\n      case 'free-trial':\r\n        status = 'active_trial';\r\n        break;\r\n      case 'recurrent':\r\n        status = 'active';\r\n        break;\r\n      case 'canceled':\r\n        status = 'cancelled';\r\n        break;\r\n      case 'incomplete_expired' || 'ended':\r\n        status = 'expired';\r\n        break;\r\n      default:\r\n        status = 'terminated';\r\n    }\r\n\r\n    return {\r\n      subscriptionId: subscription.subscription_id,\r\n      offerId: subscription.item_id?.toString(),\r\n      accessFeeId: `S${subscription.access_fee_id}`,\r\n      status,\r\n      expiresAt,\r\n      nextPaymentAt: subscription.next_rebill_date,\r\n      nextPaymentPrice: subscription.subscription_price,\r\n      nextPaymentCurrency: subscription.currency,\r\n      paymentGateway: 'stripe',\r\n      paymentMethod: subscription.payment_method_name,\r\n      offerTitle: subscription.item_title,\r\n      period: subscription.access_type?.period,\r\n      totalPrice: subscription.charged_amount,\r\n      unsubscribeUrl: subscription.unsubscribe_url,\r\n      pendingSwitchId: null,\r\n    } as Subscription;\r\n  };\r\n\r\n  private formatGrantedSubscription = (subscription: GetItemAccessV1) => {\r\n    return {\r\n      subscriptionId: '',\r\n      offerId: subscription.item.id.toString(),\r\n      status: 'active',\r\n      expiresAt: subscription.expires_at,\r\n      nextPaymentAt: subscription.expires_at,\r\n      nextPaymentPrice: 0,\r\n      nextPaymentCurrency: 'EUR',\r\n      paymentGateway: 'none',\r\n      paymentMethod: i18next.t('user:payment.access_granted'),\r\n      offerTitle: subscription.item.title,\r\n      period: 'granted',\r\n      totalPrice: 0,\r\n      unsubscribeUrl: '',\r\n      pendingSwitchId: null,\r\n    } as Subscription;\r\n  };\r\n\r\n  getActiveSubscription: GetActiveSubscription = async () => {\r\n    const assetId = this.accountService.assetId;\r\n\r\n    if (assetId === null) throw new Error(\"Couldn't fetch active subscription, there is no assetId configured\");\r\n\r\n    try {\r\n      const hasAccess = await InPlayer.Asset.checkAccessForAsset(assetId);\r\n\r\n      if (hasAccess) {\r\n        const { data } = await InPlayer.Subscription.getSubscriptions();\r\n        const activeSubscription = data.collection.find((subscription: SubscriptionDetails) => subscription.item_id === assetId);\r\n\r\n        if (activeSubscription) {\r\n          return this.formatActiveSubscription(activeSubscription, hasAccess?.data?.expires_at);\r\n        }\r\n\r\n        return this.formatGrantedSubscription(hasAccess.data);\r\n      }\r\n      return null;\r\n    } catch (error: unknown) {\r\n      if (isCommonError(error) && error.response.data.code === 402) {\r\n        return null;\r\n      }\r\n      throw new Error('Unable to fetch customer subscriptions.');\r\n    }\r\n  };\r\n\r\n  getAllTransactions: GetAllTransactions = async () => {\r\n    try {\r\n      const { data } = await InPlayer.Payment.getPaymentHistory();\r\n\r\n      return data?.collection?.map((transaction) => this.formatTransaction(transaction));\r\n    } catch {\r\n      throw new Error('Failed to get transactions');\r\n    }\r\n  };\r\n\r\n  getActivePayment: GetActivePayment = async () => {\r\n    try {\r\n      const { data } = await InPlayer.Payment.getDefaultCreditCard();\r\n      const cards: PaymentDetail[] = [];\r\n      for (const currency in data?.cards) {\r\n        cards.push(\r\n          this.formatCardDetails({\r\n            ...data.cards?.[currency],\r\n            currency: currency,\r\n          }),\r\n        );\r\n      }\r\n      return cards.find((paymentDetails) => paymentDetails.active) || null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  getSubscriptions = async () => {\r\n    return {\r\n      errors: [],\r\n      responseData: { items: [] },\r\n    };\r\n  };\r\n\r\n  updateSubscription: UpdateSubscription = async ({ offerId, unsubscribeUrl }) => {\r\n    if (!unsubscribeUrl) {\r\n      throw new Error('Missing unsubscribe url');\r\n    }\r\n    try {\r\n      await InPlayer.Subscription.cancelSubscription(unsubscribeUrl);\r\n      return {\r\n        errors: [],\r\n        responseData: { offerId: offerId, status: 'cancelled', expiresAt: 0 },\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to update subscription');\r\n    }\r\n  };\r\n\r\n  changeSubscription: ChangeSubscription = async ({ accessFeeId, subscriptionId }) => {\r\n    try {\r\n      const response = await InPlayer.Subscription.changeSubscriptionPlan({\r\n        access_fee_id: parseInt(accessFeeId),\r\n        inplayer_token: subscriptionId,\r\n      });\r\n      return {\r\n        errors: [],\r\n        responseData: { message: response.data.message },\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to change subscription');\r\n    }\r\n  };\r\n\r\n  updateCardDetails: UpdateCardDetails = async ({ cardName, cardNumber, cvc, expMonth, expYear, currency }) => {\r\n    try {\r\n      const response = await InPlayer.Payment.setDefaultCreditCard({\r\n        cardName,\r\n        cardNumber,\r\n        cvc,\r\n        expMonth,\r\n        expYear,\r\n        currency,\r\n      });\r\n      return {\r\n        errors: [],\r\n        responseData: response.data,\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to update card details');\r\n    }\r\n  };\r\n\r\n  fetchReceipt = async ({ transactionId }: { transactionId: string }) => {\r\n    try {\r\n      const { data } = await InPlayer.Payment.getBillingReceipt({ trxToken: transactionId });\r\n      return {\r\n        errors: [],\r\n        responseData: data,\r\n      };\r\n    } catch {\r\n      throw new Error('Failed to get billing receipt');\r\n    }\r\n  };\r\n\r\n  getPaymentDetails = undefined;\r\n\r\n  getTransactions = undefined;\r\n}\r\n","import InPlayer from '@inplayer-org/inplayer.js';\r\nimport { injectable } from 'inversify';\r\nimport defaultAvatar from '@jwp/ott-theme/assets/profiles/default_avatar.png';\r\n\r\nimport ProfileService from '../ProfileService';\r\nimport StorageService from '../../StorageService';\r\nimport type { CreateProfile, DeleteProfile, EnterProfile, GetProfileDetails, ListProfiles, UpdateProfile } from '../../../../types/profiles';\r\n\r\n@injectable()\r\nexport default class JWPProfileService extends ProfileService {\r\n  private readonly storageService;\r\n\r\n  constructor(storageService: StorageService) {\r\n    super();\r\n    this.storageService = storageService;\r\n  }\r\n\r\n  listProfiles: ListProfiles = async () => {\r\n    try {\r\n      const response = await InPlayer.Account.getProfiles();\r\n\r\n      return {\r\n        canManageProfiles: true,\r\n        collection:\r\n          response.data.map((profile) => ({\r\n            ...profile,\r\n            avatar_url: profile?.avatar_url || defaultAvatar,\r\n          })) ?? [],\r\n      };\r\n    } catch {\r\n      console.error('Unable to list profiles.');\r\n      return {\r\n        canManageProfiles: false,\r\n        collection: [],\r\n      };\r\n    }\r\n  };\r\n\r\n  createProfile: CreateProfile = async (payload) => {\r\n    const response = await InPlayer.Account.createProfile(payload.name, payload.adult, payload.avatar_url, payload.pin);\r\n\r\n    return response.data;\r\n  };\r\n\r\n  updateProfile: UpdateProfile = async (payload) => {\r\n    if (!payload.id) {\r\n      throw new Error('Profile id is required.');\r\n    }\r\n\r\n    const response = await InPlayer.Account.updateProfile(payload.id, payload.name, payload.avatar_url, payload.adult);\r\n\r\n    return response.data;\r\n  };\r\n\r\n  enterProfile: EnterProfile = async ({ id, pin }) => {\r\n    try {\r\n      const response = await InPlayer.Account.enterProfile(id, pin);\r\n      const profile = response.data;\r\n\r\n      // this sets the inplayer_token for the InPlayer SDK\r\n      if (profile) {\r\n        const tokenData = JSON.stringify({\r\n          expires: profile.credentials.expires,\r\n          token: profile.credentials.access_token,\r\n          refreshToken: '',\r\n        });\r\n\r\n        await this.storageService.setItem('inplayer_token', tokenData, false);\r\n      }\r\n\r\n      return profile;\r\n    } catch {\r\n      throw new Error('Unable to enter profile.');\r\n    }\r\n  };\r\n\r\n  getProfileDetails: GetProfileDetails = async ({ id }) => {\r\n    try {\r\n      const response = await InPlayer.Account.getProfileDetails(id);\r\n\r\n      return response.data;\r\n    } catch {\r\n      throw new Error('Unable to get profile details.');\r\n    }\r\n  };\r\n\r\n  deleteProfile: DeleteProfile = async ({ id }) => {\r\n    try {\r\n      await InPlayer.Account.deleteProfile(id);\r\n\r\n      return {\r\n        message: 'Profile deleted successfully',\r\n        code: 200,\r\n      };\r\n    } catch {\r\n      throw new Error('Unable to delete profile.');\r\n    }\r\n  };\r\n}\r\n","import type { interfaces } from 'inversify';\r\n\r\nimport AppController from '../../controllers/AppController';\r\n\r\n/**\r\n * This function is used to get the integration type from the AppController and is mainly used for getting named\r\n * modules from the container registry.\r\n */\r\nexport const getIntegrationType = (context: interfaces.Context) => {\r\n  return context.container.get(AppController).getIntegrationType();\r\n};\r\n","import type { CalculateIntegrationType } from '../../../types/calculate-integration-type';\r\nimport { INTEGRATION } from '../../constants';\r\n\r\nexport const isCleengIntegrationType: CalculateIntegrationType = (config) => {\r\n  return config.integrations?.cleeng?.id ? INTEGRATION.CLEENG : null;\r\n};\r\n\r\nexport const isJwpIntegrationType: CalculateIntegrationType = (config) => {\r\n  return config.integrations?.jwp?.clientId ? INTEGRATION.JWP : null;\r\n};\r\n","// To organize imports in a better way\r\n/* eslint-disable import/order */\r\nimport 'reflect-metadata'; // include once in the app for inversify (see: https://github.com/inversify/InversifyJS/blob/master/README.md#-installation)\r\nimport { INTEGRATION, EPG_TYPE } from '../constants';\r\nimport { container } from './container';\r\nimport { DETERMINE_INTEGRATION_TYPE, INTEGRATION_TYPE } from './types';\r\n\r\nimport ApiService from '../services/ApiService';\r\nimport WatchHistoryService from '../services/WatchHistoryService';\r\nimport GenericEntitlementService from '../services/GenericEntitlementService';\r\nimport JWPEntitlementService from '../services/JWPEntitlementService';\r\nimport FavoriteService from '../services/FavoriteService';\r\nimport ConfigService from '../services/ConfigService';\r\nimport SettingsService from '../services/SettingsService';\r\n\r\nimport WatchHistoryController from '../controllers/WatchHistoryController';\r\nimport CheckoutController from '../controllers/CheckoutController';\r\nimport AccountController from '../controllers/AccountController';\r\nimport ProfileController from '../controllers/ProfileController';\r\nimport FavoritesController from '../controllers/FavoritesController';\r\nimport AppController from '../controllers/AppController';\r\nimport EpgController from '../controllers/EpgController';\r\n\r\n// Epg services\r\nimport EpgService from '../services/EpgService';\r\nimport ViewNexaEpgService from '../services/epg/ViewNexaEpgService';\r\nimport JWEpgService from '../services/epg/JWEpgService';\r\n\r\n// Integration interfaces\r\nimport AccountService from '../services/integrations/AccountService';\r\nimport CheckoutService from '../services/integrations/CheckoutService';\r\nimport SubscriptionService from '../services/integrations/SubscriptionService';\r\nimport ProfileService from '../services/integrations/ProfileService';\r\n\r\n// Cleeng integration\r\nimport CleengService from '../services/integrations/cleeng/CleengService';\r\nimport CleengAccountService from '../services/integrations/cleeng/CleengAccountService';\r\nimport CleengCheckoutService from '../services/integrations/cleeng/CleengCheckoutService';\r\nimport CleengSubscriptionService from '../services/integrations/cleeng/CleengSubscriptionService';\r\n\r\n// InPlayer integration\r\nimport JWPAccountService from '../services/integrations/jwp/JWPAccountService';\r\nimport JWPCheckoutService from '../services/integrations/jwp/JWPCheckoutService';\r\nimport JWPSubscriptionService from '../services/integrations/jwp/JWPSubscriptionService';\r\nimport JWPProfileService from '../services/integrations/jwp/JWPProfileService';\r\nimport { getIntegrationType } from './functions/getIntegrationType';\r\nimport { isCleengIntegrationType, isJwpIntegrationType } from './functions/calculateIntegrationType';\r\n\r\n// Common services\r\ncontainer.bind(ConfigService).toSelf();\r\ncontainer.bind(WatchHistoryService).toSelf();\r\ncontainer.bind(FavoriteService).toSelf();\r\ncontainer.bind(GenericEntitlementService).toSelf();\r\ncontainer.bind(ApiService).toSelf();\r\ncontainer.bind(SettingsService).toSelf();\r\n\r\n// Common controllers\r\ncontainer.bind(AppController).toSelf();\r\ncontainer.bind(WatchHistoryController).toSelf();\r\ncontainer.bind(FavoritesController).toSelf();\r\ncontainer.bind(EpgController).toSelf();\r\n\r\n// Integration controllers\r\ncontainer.bind(AccountController).toSelf();\r\ncontainer.bind(CheckoutController).toSelf();\r\ncontainer.bind(ProfileController).toSelf();\r\n\r\n// EPG services\r\ncontainer.bind(EpgService).to(JWEpgService).whenTargetNamed(EPG_TYPE.jwp);\r\ncontainer.bind(EpgService).to(ViewNexaEpgService).whenTargetNamed(EPG_TYPE.viewNexa);\r\n\r\n// Functions\r\ncontainer.bind(INTEGRATION_TYPE).toDynamicValue(getIntegrationType);\r\n\r\n// Cleeng integration\r\ncontainer.bind(DETERMINE_INTEGRATION_TYPE).toConstantValue(isCleengIntegrationType);\r\ncontainer.bind(CleengService).toSelf();\r\ncontainer.bind(AccountService).to(CleengAccountService).whenTargetNamed(INTEGRATION.CLEENG);\r\ncontainer.bind(CheckoutService).to(CleengCheckoutService).whenTargetNamed(INTEGRATION.CLEENG);\r\ncontainer.bind(SubscriptionService).to(CleengSubscriptionService).whenTargetNamed(INTEGRATION.CLEENG);\r\n\r\n// JWP integration\r\ncontainer.bind(DETERMINE_INTEGRATION_TYPE).toConstantValue(isJwpIntegrationType);\r\ncontainer.bind(JWPEntitlementService).toSelf();\r\ncontainer.bind(AccountService).to(JWPAccountService).whenTargetNamed(INTEGRATION.JWP);\r\ncontainer.bind(CheckoutService).to(JWPCheckoutService).whenTargetNamed(INTEGRATION.JWP);\r\ncontainer.bind(SubscriptionService).to(JWPSubscriptionService).whenTargetNamed(INTEGRATION.JWP);\r\ncontainer.bind(ProfileService).to(JWPProfileService).whenTargetNamed(INTEGRATION.JWP);\r\n","import { injectable } from '@jwp/ott-common/src/modules/container';\r\nimport StorageService from '@jwp/ott-common/src/services/StorageService';\r\n\r\n@injectable()\r\nexport class LocalStorageService extends StorageService {\r\n  prefix: string = 'jwapp';\r\n\r\n  initialize(prefix: string) {\r\n    this.prefix = prefix;\r\n  }\r\n\r\n  getStorageKey(key: string) {\r\n    return `${this.prefix}.${key}`;\r\n  }\r\n\r\n  async getItem(key: string, parse: boolean) {\r\n    try {\r\n      const value = window.localStorage.getItem(this.getStorageKey(key));\r\n\r\n      return value && parse ? JSON.parse(value) : value;\r\n    } catch (error: unknown) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  async setItem(key: string, value: string, usePrefix = true) {\r\n    try {\r\n      window.localStorage.setItem(usePrefix ? this.getStorageKey(key) : key, value);\r\n    } catch (error: unknown) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  async removeItem(key: string) {\r\n    try {\r\n      window.localStorage.removeItem(this.getStorageKey(key));\r\n    } catch (error: unknown) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  // helper functions for encoding and decoding Base64 strings\r\n  // this might end up in a different service\r\n  base64Encode(input: string): string {\r\n    return window.btoa(input);\r\n  }\r\n\r\n  base64Decode(input: string): string {\r\n    return window.atob(input);\r\n  }\r\n}\r\n","import '@jwp/ott-common/src/modules/register';\r\nimport { container } from '@jwp/ott-common/src/modules/container';\r\nimport StorageService from '@jwp/ott-common/src/services/StorageService';\r\nimport { GET_CUSTOMER_IP } from '@jwp/ott-common/src/modules/types';\r\nimport type { GetCustomerIP } from '@jwp/ott-common/types/get-customer-ip';\r\n\r\nimport { LocalStorageService } from '#src/services/LocalStorageService';\r\nimport { getOverrideIP } from '#src/utils/ip';\r\n\r\n/**\r\n * Custom integration override\r\n *\r\n * @example\r\n * ```ts\r\n * // Custom integration services\r\n * const MY_INTEGRATION_NAME = 'CUSTOM';\r\n *\r\n * container.bind(AccountService).to(CustomAccountService).whenTargetNamed(MY_INTEGRATION_NAME);\r\n * container.bind(CheckoutService).to(CustomCheckoutService).whenTargetNamed(MY_INTEGRATION_NAME);\r\n * container.bind(SubscriptionService).to(CustomSubscriptionService).whenTargetNamed(MY_INTEGRATION_NAME);\r\n *\r\n * // Override integration type calculation\r\n * container.bind(DETERMINE_INTEGRATION_TYPE).toConstantValue((config: Config) => {\r\n *   return config.custom?.['custom'] ? MY_INTEGRATION_NAME : null;\r\n * })\r\n * ```\r\n */\r\n\r\ncontainer.bind(StorageService).to(LocalStorageService);\r\n\r\n// Currently, this is only used for e2e testing to override the customer ip from a browser cookie\r\ncontainer.bind<GetCustomerIP>(GET_CUSTOMER_IP).toConstantValue(async () => getOverrideIP());\r\n\r\n/**\r\n * UI Component override\r\n *\r\n * @example\r\n * ```ts\r\n * // Define in types.ts (from `ui-react` for example)\r\n * const TAG_IDENTIFIER = 'TAG_IDENTIFIER';\r\n *\r\n * // Bind custom component\r\n * container.bind(TAG_IDENTIFIER).toConstantValue(CustomTag);\r\n *\r\n * // Then wrap the component in a HOC, from the component file itself\r\n * export default createInjectableComponent(TAG_IDENTIFIER, DefaultTag);\r\n *\r\n * ```\r\n */\r\n\r\n// Override ui-react component\r\n// uiComponentContainer.bind<React.FC<TagProps>>(TAG_IDENTIFIER).toConstantValue(Tag);\r\n","import React from 'react';\r\nimport { QueryClient, QueryClientProvider } from 'react-query';\r\n\r\nexport const queryClient = new QueryClient({\r\n  defaultOptions: {\r\n    queries: {\r\n      staleTime: 60 * 60 * 1000,\r\n      refetchOnWindowFocus: false,\r\n      retryOnMount: false,\r\n    },\r\n  },\r\n});\r\n\r\ntype QueryProviderProps = {\r\n  children: JSX.Element;\r\n};\r\n\r\nfunction QueryProvider({ children }: QueryProviderProps): JSX.Element {\r\n  return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;\r\n}\r\n\r\nexport default QueryProvider;\r\n","import React, { type ReactNode } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { IS_DEMO_MODE, IS_DEVELOPMENT_BUILD, IS_PREVIEW_MODE } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport DevStackTrace from '../DevStackTrace/DevStackTrace';\r\n\r\nimport styles from './ErrorPage.module.scss';\r\n\r\ninterface Props {\r\n  disableFallbackTranslation?: boolean;\r\n  title?: string | ReactNode;\r\n  message?: string | ReactNode;\r\n  learnMoreLabel?: string;\r\n  children?: React.ReactNode;\r\n  error?: Error;\r\n  helpLink?: string;\r\n}\r\n\r\nconst ErrorPage = ({ title, message, learnMoreLabel, ...rest }: Props) => {\r\n  const { t } = useTranslation('error');\r\n\r\n  return (\r\n    <ErrorPageWithoutTranslation\r\n      title={title || t('generic_error_heading')}\r\n      message={message || t('generic_error_description')}\r\n      learnMoreLabel={learnMoreLabel || t('learn_more')}\r\n      {...rest}\r\n    />\r\n  );\r\n};\r\n\r\nexport const ErrorPageWithoutTranslation = ({ title, children, message, learnMoreLabel, error, helpLink }: Props) => {\r\n  const logo = useConfigStore((s) => s.config?.assets?.banner);\r\n  const alt = ''; // intentionally empty for a11y, because adjacent text alternative\r\n\r\n  return (\r\n    <div className={styles.errorPage}>\r\n      <div className={styles.box}>\r\n        <img className={styles.image} src={logo || '/images/logo.png'} alt={alt} />\r\n        <h1 className={styles.title} aria-live=\"polite\">\r\n          {title || 'An error occurred'}\r\n        </h1>\r\n        <div className={styles.main}>\r\n          <p className={styles.message}>{message || 'Try refreshing this page or come back later.'}</p>\r\n          {children}\r\n          {(IS_DEVELOPMENT_BUILD || IS_DEMO_MODE || IS_PREVIEW_MODE) && helpLink && (\r\n            <div className={styles.links}>\r\n              <a href={helpLink} target={'_blank'} rel={'noreferrer'}>\r\n                {learnMoreLabel || 'Learn More'}\r\n              </a>\r\n              {(IS_DEVELOPMENT_BUILD || IS_PREVIEW_MODE) && error?.stack && (\r\n                <span className={styles.stack}>\r\n                  <DevStackTrace error={error} />\r\n                </span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ErrorPage;\r\n","import classNames from 'classnames';\r\nimport React from 'react';\r\n\r\nimport styles from './Spinner.module.scss';\r\n\r\ntype Props = {\r\n  size?: 'small' | 'medium' | 'large';\r\n  className?: string;\r\n};\r\n\r\nconst Spinner = ({ size = 'medium', className = '' }: Props): JSX.Element => {\r\n  return (\r\n    <div className={classNames(styles.buffer, className, { [styles.small]: size === 'small', [styles.large]: size === 'large' })}>\r\n      <div />\r\n      <div />\r\n      <div />\r\n      <div />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Spinner;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport Spinner from '../Spinner/Spinner';\r\n\r\nimport styles from './LoadingOverlay.module.scss';\r\n\r\ntype Props = {\r\n  transparentBackground?: boolean;\r\n  inline?: boolean;\r\n  profileImageUrl?: string;\r\n};\r\n\r\nconst LoadingOverlay = ({ transparentBackground = false, inline = false, profileImageUrl = '' }: Props): JSX.Element => {\r\n  const className = classNames(styles.loadingOverlay, {\r\n    [styles.transparent]: transparentBackground,\r\n    [styles.fixed]: !inline,\r\n    [styles.inline]: inline,\r\n    [styles.profile]: profileImageUrl,\r\n  });\r\n\r\n  return (\r\n    <div className={className}>\r\n      {profileImageUrl && <img src={profileImageUrl} alt=\"Profile Avatar\" />}\r\n      <Spinner size={profileImageUrl ? 'large' : 'medium'} />\r\n    </div>\r\n  );\r\n};\r\nexport default LoadingOverlay;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './FormFeedback.module.scss';\r\n\r\ntype Props = {\r\n  visible?: boolean;\r\n  children?: React.ReactNode;\r\n  variant: 'info' | 'success' | 'warning' | 'error';\r\n};\r\n\r\nconst variantAriaMap = {\r\n  info: 'polite',\r\n  success: 'assertive',\r\n  warning: 'polite',\r\n  error: 'assertive',\r\n} as const;\r\n\r\nconst FormFeedback: React.FC<Props> = ({ children, variant = 'error', visible = true }: Props) => {\r\n  const className = classNames(styles.formFeedback, {\r\n    [styles.error]: variant === 'error',\r\n    [styles.warning]: variant === 'warning',\r\n    [styles.success]: variant === 'success',\r\n    [styles.info]: variant === 'info',\r\n    hidden: !visible,\r\n  });\r\n\r\n  const ariaLive = variantAriaMap[variant];\r\n\r\n  return (\r\n    <div aria-live={ariaLive} className={className}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FormFeedback;\r\n","import { secondsToMilliseconds } from 'date-fns';\r\nimport { type PropsWithChildren, createContext, useCallback, useContext, useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\n\r\nimport FormFeedback from '../../components/FormFeedback/FormFeedback';\r\n\r\nexport type AriaAnnouncerVariant = 'success' | 'error' | 'warning' | 'info';\r\ntype Announcement = { message: string; variant: AriaAnnouncerVariant };\r\ntype AnnounceFn = (message: string, variant: AriaAnnouncerVariant, duration?: number) => void;\r\ntype ContextValue = { announce: AnnounceFn };\r\n\r\nconst AriaAnnouncerContext = createContext<ContextValue | undefined>(undefined);\r\n\r\nexport const useAriaAnnouncer = () => {\r\n  const announce = useContext(AriaAnnouncerContext);\r\n\r\n  if (!announce) throw new Error('Announcer context is not defined');\r\n\r\n  return announce.announce;\r\n};\r\n\r\nexport const AriaAnnouncerProvider = ({ children }: PropsWithChildren) => {\r\n  const [announcement, setAnnouncement] = useState<Announcement | null>(null);\r\n\r\n  const announce = useCallback((message: string, variant: AriaAnnouncerVariant, duration = secondsToMilliseconds(10)) => {\r\n    setAnnouncement({ message, variant });\r\n\r\n    setTimeout(() => {\r\n      setAnnouncement(null);\r\n    }, duration);\r\n  }, []);\r\n\r\n  return (\r\n    <AriaAnnouncerContext.Provider value={{ announce }}>\r\n      {announcement &&\r\n        createPortal(\r\n          <FormFeedback variant={announcement.variant} visible={false}>\r\n            {announcement.message}\r\n          </FormFeedback>,\r\n          document.body,\r\n        )}\r\n      {children}\r\n    </AriaAnnouncerContext.Provider>\r\n  );\r\n};\r\n","import type { LanguageDefinition } from '../../types/i18n';\r\n\r\nexport const filterSupportedLanguages = (definedLanguages: LanguageDefinition[], enabledLanguages: string[]) => {\r\n  return enabledLanguages.reduce((languages, languageCode) => {\r\n    const foundLanguage = definedLanguages.find(({ code }) => code === languageCode);\r\n\r\n    if (foundLanguage) {\r\n      return [...languages, foundLanguage];\r\n    }\r\n\r\n    throw new Error(`Missing defined language for code: ${languageCode}`);\r\n  }, [] as LanguageDefinition[]);\r\n};\r\n","// This file is generated by i18next-parser-workspaces, do not modify manually.\r\n// Run `$ npx i18next-workspaces` to update this file\r\n\r\nexport const NAMESPACES = ['account', 'common', 'country', 'demo', 'epg', 'error', 'menu', 'search', 'us_state', 'user', 'video'];\r\n","import { initReactI18next } from 'react-i18next';\r\nimport LanguageDetector from 'i18next-browser-languagedetector';\r\nimport I18NextHttpBackend from 'i18next-http-backend';\r\nimport i18next from 'i18next';\r\nimport type { LanguageDefinition } from '@jwp/ott-common/types/i18n';\r\nimport { filterSupportedLanguages } from '@jwp/ott-common/src/utils/i18n';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\n\r\nimport { NAMESPACES } from './resources';\r\n\r\n// This list contains all languages that are supported by the OTT Web app by default\r\n// To enable the language, make sure that the language code is added to the `APP_ENABLED_LANGUAGES` environment variable\r\n// Before adding a defined language, ensure that the translation files are added to the `./public/locales/${code}` folder\r\nexport const DEFINED_LANGUAGES: LanguageDefinition[] = [\r\n  {\r\n    code: 'en',\r\n    displayName: 'English',\r\n  },\r\n  {\r\n    code: 'es',\r\n    displayName: 'Español',\r\n  },\r\n];\r\n\r\nconst initI18n = async () => {\r\n  const enabledLanguages = import.meta.env.APP_ENABLED_LANGUAGES?.split(',') || [];\r\n  const defaultLanguage = import.meta.env.APP_DEFAULT_LANGUAGE || 'en';\r\n\r\n  const supportedLanguages = filterSupportedLanguages(DEFINED_LANGUAGES, enabledLanguages);\r\n\r\n  useConfigStore.setState({ supportedLanguages });\r\n\r\n  if (!supportedLanguages.some(({ code }) => code === defaultLanguage)) {\r\n    throw new Error(`The default language is not enabled: ${defaultLanguage}`);\r\n  }\r\n\r\n  await i18next\r\n    .use(I18NextHttpBackend)\r\n    .use(LanguageDetector)\r\n    .use(initReactI18next)\r\n    .init({\r\n      supportedLngs: supportedLanguages.map(({ code }) => code),\r\n      fallbackLng: defaultLanguage,\r\n      // this option ensures that empty strings in translations will fall back to the default language\r\n      returnEmptyString: false,\r\n      ns: NAMESPACES,\r\n      defaultNS: 'common',\r\n      fallbackNS: 'common',\r\n      interpolation: {\r\n        escapeValue: false,\r\n      },\r\n      detection: {\r\n        order: ['localStorage', 'navigator'],\r\n        caches: ['localStorage'],\r\n        lookupLocalStorage: 'jwapp.language',\r\n      },\r\n      react: {\r\n        // disabled suspense to prevent re-loading the app while loading the resources\r\n        useSuspense: false,\r\n      },\r\n    });\r\n};\r\n\r\nexport default initI18n;\r\n","import { createURL, type QueryParamsArg } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport type { Location } from 'react-router-dom';\r\n\r\nimport type { AccountModals } from '../containers/AccountModal/AccountModal';\r\n\r\nexport const createURLFromLocation = (location: Location, queryParams: QueryParamsArg = {}) => {\r\n  return createURL(`${location.pathname}${location.search || ''}`, queryParams);\r\n};\r\n\r\nexport const modalURLFromLocation = (location: Location, u: keyof AccountModals | null, queryParams?: QueryParamsArg) => {\r\n  return createURL(`${location.pathname}${location.search || ''}`, { u, ...queryParams });\r\n};\r\n\r\n/**\r\n * Create a full modal URL including the hostname, mostly for external use (e.g., for the PayPal successUrl)\r\n *\r\n * @example\r\n * modalURLFromWindowLocation('login', { foo: 'bar' }) === 'https://jwplayer.com/?u=login&foo=bar'\r\n */\r\nexport const modalURLFromWindowLocation = (u: keyof AccountModals, queryParams?: QueryParamsArg) => {\r\n  return createURL(window.location.href, { u, ...queryParams });\r\n};\r\n","import React, { useCallback, useLayoutEffect, useRef } from 'react';\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n/**\r\n * The `useEventCallback` hook can be compared to the `useCallback` hook but without dependencies. It is a \"shortcut\"\r\n * to prevent re-renders based on callback changes due to dependency changes. This can be useful to improve the\r\n * performance or to prevent adding/removing event listeners to third-party libraries such as JW Player.\r\n *\r\n * @see {https://reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down}\r\n *\r\n * @param {function} [callback]\r\n */\r\nconst useEventCallback = <T extends (...args: any[]) => unknown>(callback?: T): T => {\r\n  const fnRef = useRef(() => {\r\n    throw new Error('Callback called in render');\r\n  }) as unknown as React.MutableRefObject<T | undefined>;\r\n\r\n  useLayoutEffect(() => {\r\n    fnRef.current = callback;\r\n  }, [callback]);\r\n\r\n  // @ts-ignore\r\n  // ignore since we just want to pass all arguments to the callback function (which we don't know)\r\n  return useCallback((...args) => {\r\n    if (typeof fnRef.current === 'function') {\r\n      return fnRef.current(...args);\r\n    }\r\n  }, []);\r\n};\r\n\r\nexport default useEventCallback;\r\n","import { useSearchParams } from 'react-router-dom';\r\n\r\nfunction useQueryParam(key: string): string | null {\r\n  const [searchParams] = useSearchParams();\r\n\r\n  return searchParams.get(key);\r\n}\r\n\r\nexport default useQueryParam;\r\n","import { useEffect, useRef, useState } from 'react';\r\n\r\nconst useCountdown = (durationSeconds: number, intervalSeconds: number = 1, completeHandler?: () => void) => {\r\n  const timerRef = useRef<number>();\r\n  const [countdown, setCountdown] = useState(durationSeconds);\r\n\r\n  useEffect(() => {\r\n    window.clearTimeout(timerRef.current);\r\n    if (countdown === 0) {\r\n      if (completeHandler) completeHandler();\r\n      return;\r\n    }\r\n\r\n    timerRef.current = window.setTimeout(() => {\r\n      setCountdown((count) => count - intervalSeconds);\r\n    }, intervalSeconds * 1000);\r\n\r\n    return () => {\r\n      window.clearTimeout(timerRef.current);\r\n    };\r\n  }, [completeHandler, countdown, intervalSeconds]);\r\n\r\n  return countdown;\r\n};\r\n\r\nexport default useCountdown;\r\n","import React, { type MouseEventHandler } from 'react';\r\nimport classNames from 'classnames';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport Spinner from '../Spinner/Spinner';\r\n\r\nimport styles from './Button.module.scss';\r\n\r\ntype Color = 'default' | 'primary' | 'delete';\r\n\r\ntype Variant = 'contained' | 'outlined' | 'text' | 'danger' | 'delete';\r\n\r\ntype Props = {\r\n  children?: React.ReactNode;\r\n  label: string;\r\n  active?: boolean;\r\n  color?: Color;\r\n  fullWidth?: boolean;\r\n  startIcon?: React.ReactElement;\r\n  variant?: Variant;\r\n  onClick?: MouseEventHandler<HTMLButtonElement>;\r\n  tabIndex?: number;\r\n  size?: 'small' | 'medium' | 'large';\r\n  to?: string;\r\n  role?: string;\r\n  className?: string;\r\n  type?: 'button' | 'submit' | 'reset';\r\n  disabled?: boolean;\r\n  busy?: boolean;\r\n  id?: string;\r\n  activeClassname?: string;\r\n} & React.AriaAttributes;\r\n\r\nconst Button: React.FC<Props> = ({\r\n  label,\r\n  children,\r\n  color = 'default',\r\n  startIcon,\r\n  fullWidth = false,\r\n  active = false,\r\n  variant = 'outlined',\r\n  size = 'medium',\r\n  disabled,\r\n  busy,\r\n  type = 'button',\r\n  to,\r\n  onClick,\r\n  className,\r\n  activeClassname = '',\r\n  ...rest\r\n}: Props) => {\r\n  const buttonClassName = (isActive: boolean) =>\r\n    classNames(styles.button, className, styles[color], styles[variant], {\r\n      [styles.active]: isActive,\r\n      [activeClassname]: isActive,\r\n      [styles.fullWidth]: fullWidth,\r\n      [styles.large]: size === 'large',\r\n      [styles.small]: size === 'small',\r\n      [styles.disabled]: disabled,\r\n    });\r\n\r\n  const content = (\r\n    <>\r\n      {startIcon && <div className={styles.startIcon}>{startIcon}</div>}\r\n      {<span className={classNames({ [styles.hidden]: busy }) || undefined}>{label}</span>}\r\n      {children}\r\n      {busy && <Spinner className={styles.centerAbsolute} size={'small'} />}\r\n    </>\r\n  );\r\n\r\n  if (to) {\r\n    return (\r\n      <NavLink className={({ isActive }) => buttonClassName(isActive)} to={to} {...rest} end>\r\n        {content}\r\n      </NavLink>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <button className={buttonClassName(active)} onClick={disabled ? undefined : onClick} type={type} aria-disabled={disabled} {...rest}>\r\n      {content}\r\n    </button>\r\n  );\r\n};\r\nexport default Button;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport useCountdown from '@jwp/ott-hooks-react/src/useCountdown';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './Welcome.module.scss';\r\n\r\ntype Props = {\r\n  onCloseButtonClick?: () => void;\r\n  onCountdownCompleted?: () => void;\r\n  siteName?: string;\r\n};\r\n\r\nconst Welcome: React.FC<Props> = ({ onCloseButtonClick, onCountdownCompleted, siteName }) => {\r\n  const { t } = useTranslation('account');\r\n  const countdown = useCountdown(10, 1, onCountdownCompleted);\r\n\r\n  return (\r\n    <div className={styles.welcome}>\r\n      <h2>{t('checkout.welcome_title', { siteName })}</h2>\r\n      <p>{t('checkout.welcome_description', { siteName })}</p>\r\n      <Button variant=\"contained\" color=\"primary\" label={t('checkout.start_watching', { countdown })} onClick={onCloseButtonClick} size=\"large\" fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Welcome;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './PaymentFailed.module.scss';\r\n\r\ntype Props = {\r\n  type: 'error' | 'cancelled';\r\n  message: string | null;\r\n  onCloseButtonClick: () => void;\r\n};\r\n\r\nconst PaymentFailed: React.FC<Props> = ({ type, message, onCloseButtonClick }: Props) => {\r\n  const { t } = useTranslation('account');\r\n  return (\r\n    <div>\r\n      <h2 className={styles.title}>{type === 'cancelled' ? t('checkout.payment_cancelled') : t('checkout.payment_error')}</h2>\r\n      <p className={styles.message}>{type === 'cancelled' ? t('checkout.payment_cancelled_message') : message}</p>\r\n      <div>\r\n        <Button label={t('checkout.close')} onClick={onCloseButtonClick} color=\"primary\" variant=\"contained\" size=\"large\" fullWidth />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentFailed;\r\n","import React, { type CSSProperties, useEffect, useRef, useState } from 'react';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\n\r\ntype Props = {\r\n  className?: string;\r\n  createStyle: (status: Status) => CSSProperties;\r\n  open?: boolean;\r\n  duration?: number;\r\n  delay?: number;\r\n  children?: React.ReactNode;\r\n  keepMounted?: boolean;\r\n  onOpenAnimationEnd?: () => void;\r\n  onCloseAnimationEnd?: () => void;\r\n};\r\n\r\nexport type Status = 'opening' | 'open' | 'closing' | 'closed';\r\n\r\nconst Animation: React.FC<Props> = ({\r\n  className,\r\n  createStyle,\r\n  open = true,\r\n  duration = 250,\r\n  delay = 0,\r\n  onOpenAnimationEnd,\r\n  onCloseAnimationEnd,\r\n  keepMounted = false,\r\n  children,\r\n}) => {\r\n  const [status, setStatus] = useState<Status>('closed');\r\n  const [hasOpenedBefore, setHasOpenedBefore] = useState<boolean>(false);\r\n\r\n  const timeout = useRef<number>();\r\n  const timeout2 = useRef<number>();\r\n\r\n  // use event callbacks to ignore reactive dependencies\r\n  const openEvent = useEventCallback(() => {\r\n    setHasOpenedBefore(true);\r\n    timeout.current = window.setTimeout(() => setStatus('opening'), delay);\r\n    timeout2.current = window.setTimeout(() => {\r\n      setStatus('open');\r\n      onOpenAnimationEnd && onOpenAnimationEnd();\r\n    }, duration + delay);\r\n  });\r\n\r\n  const closeEvent = useEventCallback(() => {\r\n    if (hasOpenedBefore) {\r\n      timeout.current = window.setTimeout(() => setStatus('closing'), delay);\r\n      timeout2.current = window.setTimeout(() => {\r\n        setStatus('closed');\r\n        onCloseAnimationEnd && onCloseAnimationEnd();\r\n      }, duration + delay);\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      openEvent();\r\n    } else {\r\n      closeEvent();\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(timeout.current);\r\n      clearTimeout(timeout2.current);\r\n    };\r\n  }, [open, openEvent, closeEvent]);\r\n\r\n  if (!open && status === 'closed' && !keepMounted) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div style={createStyle(status)} className={className}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Animation;\r\n","import React, { type CSSProperties, type ReactNode } from 'react';\r\n\r\nimport Animation, { type Status } from '../Animation';\r\n\r\ntype Props = {\r\n  open?: boolean;\r\n  duration?: number;\r\n  delay?: number;\r\n  onOpenAnimationEnd?: () => void;\r\n  onCloseAnimationEnd?: () => void;\r\n  children: ReactNode;\r\n  className?: string;\r\n};\r\n\r\nconst Grow = ({ open = true, duration = 250, delay = 0, onOpenAnimationEnd, onCloseAnimationEnd, children, className }: Props): JSX.Element | null => {\r\n  const seconds = duration / 1000;\r\n  const transition = `transform ${seconds}s ease-out`; // todo: -webkit-transform;\r\n  const createStyle = (status: Status): CSSProperties => ({\r\n    transition,\r\n    transform: status === 'opening' || status === 'open' ? 'scale(1)' : 'scale(0.7)',\r\n  });\r\n\r\n  return (\r\n    <Animation\r\n      createStyle={(status: Status) => createStyle(status)}\r\n      open={open}\r\n      duration={duration}\r\n      delay={delay}\r\n      onOpenAnimationEnd={onOpenAnimationEnd}\r\n      onCloseAnimationEnd={onCloseAnimationEnd}\r\n      className={className}\r\n    >\r\n      {children}\r\n    </Animation>\r\n  );\r\n};\r\n\r\nexport default Grow;\r\n","export const canUseDOM = !!(typeof window !== 'undefined' && window.document && window.document.createElement);\r\n\r\nlet size: number;\r\n\r\nexport default function scrollbarSize(recalc?: boolean) {\r\n  if ((!size && size !== 0) || recalc) {\r\n    if (canUseDOM) {\r\n      const scrollDiv = document.createElement('div');\r\n      scrollDiv.style.position = 'absolute';\r\n      scrollDiv.style.top = '-9999px';\r\n      scrollDiv.style.width = '50px';\r\n      scrollDiv.style.height = '50px';\r\n      scrollDiv.style.overflow = 'scroll';\r\n      document.body.appendChild(scrollDiv);\r\n      size = scrollDiv.offsetWidth - scrollDiv.clientWidth;\r\n      document.body.removeChild(scrollDiv);\r\n    }\r\n  }\r\n  return size;\r\n}\r\n\r\nexport const addScript = (src: string): Promise<void> => {\r\n  return new Promise((resolve) => {\r\n    const script: HTMLScriptElement = document.createElement('script');\r\n    script.type = 'text/javascript';\r\n    script.async = true;\r\n    script.src = src;\r\n    script.onload = () => resolve();\r\n    script.onerror = (error) => {\r\n      console.info('Error loading external script', error);\r\n      throw new Error('Error loading external script');\r\n    };\r\n    document.body.appendChild(script);\r\n  });\r\n};\r\n","import { useCallback, useEffect } from 'react';\r\n\r\nimport scrollbarSize from '../utils/dom';\r\n\r\nconst removeBodyScrolling = () => {\r\n  document.body.style.marginRight = `${scrollbarSize(true)}px`;\r\n  document.body.style.overflowY = 'hidden';\r\n};\r\n\r\nconst restoreBodyScrolling = () => {\r\n  const dialogs = Array.from(document.querySelectorAll('dialog'));\r\n  const openDialogs = dialogs.filter((dialog) => dialog.open).length;\r\n\r\n  if (!openDialogs) {\r\n    document.body.style.removeProperty('margin-right');\r\n    document.body.style.removeProperty('overflow-y');\r\n  }\r\n};\r\n\r\n// shared variable between `useModal` usages\r\nlet originElement: HTMLElement | undefined;\r\n\r\nexport const useModal = () => {\r\n  const restoreFocus = useCallback(() => {\r\n    // restore focus when the focus is \"lost\" to the body element\r\n    if (!originElement || document.activeElement !== document.body) {\r\n      return;\r\n    }\r\n\r\n    const dialogs = Array.from(document.querySelectorAll('dialog'));\r\n    const openDialogs = dialogs.filter((dialog) => dialog.open).length;\r\n\r\n    // this was the last open dialog\r\n    if (openDialogs === 0) {\r\n      originElement.focus();\r\n      originElement = undefined;\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      restoreBodyScrolling();\r\n      restoreFocus();\r\n    };\r\n  }, [restoreFocus]);\r\n\r\n  const handleOpen = useCallback(() => {\r\n    if (!originElement) {\r\n      originElement = document.activeElement as HTMLElement;\r\n    }\r\n\r\n    removeBodyScrolling();\r\n  }, []);\r\n\r\n  const handleClose = useCallback(() => {\r\n    restoreFocus();\r\n    restoreBodyScrolling();\r\n  }, [restoreFocus]);\r\n\r\n  return { handleOpen, handleClose };\r\n};\r\n","import React, { type HTMLAttributes, type KeyboardEventHandler, type ReactEventHandler, useEffect, useRef } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport classNames from 'classnames';\r\n\r\nimport Grow from '../Animation/Grow/Grow';\r\nimport { useModal } from '../../hooks/useModal';\r\n\r\nimport styles from './Modal.module.scss';\r\n\r\nexport type AnimationProps = {\r\n  open?: boolean;\r\n  duration?: number;\r\n  delay?: number;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  onCloseAnimationEnd?: () => void;\r\n};\r\n\r\ntype Props = {\r\n  children?: React.ReactNode;\r\n  className?: string;\r\n  centered?: boolean;\r\n  AnimationComponent?: React.ElementType<AnimationProps>;\r\n  open: boolean;\r\n  onClose?: () => void;\r\n  animationContainerClassName?: string;\r\n  role?: HTMLAttributes<HTMLElement>['role'];\r\n} & React.AriaAttributes;\r\n\r\nconst Modal: React.FC<Props> = ({\r\n  open,\r\n  onClose,\r\n  children,\r\n  className,\r\n  centered,\r\n  role,\r\n  AnimationComponent = Grow,\r\n  animationContainerClassName,\r\n  ...ariaAttributes\r\n}: Props) => {\r\n  const modalRef = useRef<HTMLDialogElement>() as React.MutableRefObject<HTMLDialogElement>;\r\n\r\n  const { handleOpen, handleClose } = useModal();\r\n\r\n  const closeModalEvent = useEventCallback(() => {\r\n    const onAnimationEndHandler = () => {\r\n      // modalRef.current?.close();\r\n      modalRef.current?.classList.remove(styles.close);\r\n      modalRef.current?.removeEventListener('animationend', onAnimationEndHandler);\r\n    };\r\n\r\n    if (modalRef.current?.open) {\r\n      modalRef.current.addEventListener('animationend', onAnimationEndHandler);\r\n      modalRef.current.classList.add(styles.close);\r\n    }\r\n  });\r\n\r\n  const openModalEvent = useEventCallback(() => {\r\n    handleOpen();\r\n    modalRef.current?.showModal();\r\n    modalRef.current?.classList.remove(styles.close);\r\n  });\r\n\r\n  const keyDownHandler: KeyboardEventHandler<HTMLDialogElement> = (event) => {\r\n    if (event.key === 'Escape' && modalRef.current.contains(event.target as HTMLElement)) {\r\n      event.preventDefault();\r\n      onClose?.();\r\n    }\r\n  };\r\n\r\n  const closeHandler: ReactEventHandler<HTMLDialogElement> = (event) => {\r\n    if (modalRef.current.contains(event.target as HTMLElement)) {\r\n      onClose?.();\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  const closeAnimationEndHandler = () => {\r\n    modalRef.current?.close();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      openModalEvent();\r\n    } else {\r\n      closeModalEvent();\r\n    }\r\n  }, [openModalEvent, closeModalEvent, open]);\r\n\r\n  const clickHandler: ReactEventHandler<HTMLDialogElement> = (event) => {\r\n    // Backdrop click (the dialog itself) will close the modal\r\n    if (event.target === modalRef.current) {\r\n      onClose?.();\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  return ReactDOM.createPortal(\r\n    <dialog\r\n      className={classNames(className, { [styles.centered]: centered })}\r\n      onKeyDown={keyDownHandler}\r\n      onClose={closeHandler}\r\n      onClick={clickHandler}\r\n      ref={modalRef}\r\n      role={role}\r\n      {...ariaAttributes}\r\n    >\r\n      <AnimationComponent open={open} duration={300} className={animationContainerClassName} onCloseAnimationEnd={closeAnimationEndHandler}>\r\n        {children}\r\n      </AnimationComponent>\r\n    </dialog>,\r\n    document.querySelector('body') as HTMLElement,\r\n  );\r\n};\r\n\r\nexport default Modal;\r\n","import React, { type CSSProperties, type ReactNode } from 'react';\r\n\r\nimport Animation, { type Status } from '../Animation';\r\n\r\ntype Props = {\r\n  open?: boolean;\r\n  duration?: number;\r\n  delay?: number;\r\n  onOpenAnimationEnd?: () => void;\r\n  onCloseAnimationEnd?: () => void;\r\n  children: ReactNode;\r\n  direction?: 'left' | 'top' | 'right' | 'bottom';\r\n  style?: CSSProperties;\r\n};\r\n\r\nconst Slide = ({\r\n  open = true,\r\n  duration = 250,\r\n  delay = 0,\r\n  onOpenAnimationEnd,\r\n  onCloseAnimationEnd,\r\n  children,\r\n  direction = 'top',\r\n  style = {},\r\n}: Props): JSX.Element | null => {\r\n  const seconds = duration / 1000;\r\n  const transition = `transform ${seconds}s ease, opacity ${seconds}s ease`; // todo: -webkit-transform;\r\n  const directions = {\r\n    left: 'translate(-15px, 0)',\r\n    top: 'translate(0, -15px)',\r\n    right: 'translate(15px, 0)',\r\n    bottom: 'translate(0, 15px)',\r\n  };\r\n  const createStyle = (status: Status): CSSProperties => ({\r\n    transition,\r\n    transform: status === 'opening' || status === 'open' ? 'translate(0, 0)' : directions[direction],\r\n    opacity: status === 'opening' || status === 'open' ? 1 : 0,\r\n    zIndex: 15,\r\n    ...style,\r\n  });\r\n\r\n  return (\r\n    <Animation\r\n      createStyle={(status: Status) => createStyle(status)}\r\n      open={open}\r\n      duration={duration}\r\n      delay={delay}\r\n      onOpenAnimationEnd={onOpenAnimationEnd}\r\n      onCloseAnimationEnd={onCloseAnimationEnd}\r\n    >\r\n      {children}\r\n    </Animation>\r\n  );\r\n};\r\n\r\nexport default Slide;\r\n","import * as React from \"react\";\nconst SvgClose = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\" }), /* @__PURE__ */ React.createElement(\"path\", { d: \"M0 0h24v24H0z\", fill: \"none\" }));\nexport default SvgClose;\n","import classNames from 'classnames';\r\nimport React, { type ButtonHTMLAttributes } from 'react';\r\n\r\nimport styles from './IconButton.module.scss';\r\n\r\nexport type Props = ButtonHTMLAttributes<HTMLButtonElement> & {\r\n  onClick?: () => void;\r\n  onBlur?: () => void;\r\n  children: JSX.Element;\r\n  className?: string;\r\n};\r\n\r\nconst IconButton: React.FC<Props> = ({ children, onClick, className, ...ariaProps }: Props) => {\r\n  return (\r\n    <button className={classNames(styles.iconButton, className)} type=\"button\" onClick={onClick} {...ariaProps}>\r\n      {children}\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default IconButton;\r\n","import classNames from 'classnames';\r\nimport React, { type FC, type SVGProps } from 'react';\r\n\r\nimport styles from './Icon.module.scss';\r\n\r\nexport type Props = {\r\n  icon: FC<SVGProps<SVGSVGElement>>;\r\n  className?: string;\r\n};\r\n\r\nconst Icon: FC<Props> = ({ icon: IconComponent, className }) => {\r\n  return <IconComponent className={classNames(styles.icon, className)} aria-hidden=\"true\" />;\r\n};\r\n\r\nexport default Icon;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Close from '@jwp/ott-theme/assets/icons/close.svg?react';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './ModalCloseButton.module.scss';\r\n\r\ntype Props = {\r\n  onClick?: () => void;\r\n  visible?: boolean;\r\n};\r\n\r\nconst ModalCloseButton: React.FC<Props> = ({ onClick, visible = true }: Props) => {\r\n  const { t } = useTranslation('common');\r\n\r\n  return (\r\n    <IconButton onClick={onClick} aria-label={t('close_modal')} className={classNames(styles.modalCloseButton, { [styles.hidden]: !visible })}>\r\n      <Icon icon={Close} />\r\n    </IconButton>\r\n  );\r\n};\r\n\r\nexport default ModalCloseButton;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport Modal from '../Modal/Modal';\r\nimport Slide from '../Animation/Slide/Slide';\r\nimport ModalCloseButton from '../ModalCloseButton/ModalCloseButton';\r\n\r\nimport styles from './Dialog.module.scss';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  size?: 'small' | 'large';\r\n  children: React.ReactNode;\r\n  role?: React.AriaRole;\r\n} & React.AriaAttributes;\r\n\r\nconst Dialog: React.FC<Props> = ({ open, onClose, children, size = 'small', role, ...ariaAttributes }: Props) => {\r\n  return (\r\n    <Modal open={open} onClose={onClose} AnimationComponent={Slide} role={role} centered>\r\n      <div className={classNames(styles.dialog, styles[size])} data-testid={testId('dialog')} {...ariaAttributes}>\r\n        {children}\r\n        <ModalCloseButton onClick={onClose} />\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default Dialog;\r\n","import { useCallback, useState } from 'react';\r\nimport { type AnySchema, ValidationError, type SchemaOf } from 'yup';\r\nimport type { FormErrors, GenericFormValues, UseFormBlurHandler, UseFormChangeHandler, UseFormSubmitHandler } from '@jwp/ott-common/types/form';\r\nimport { FormValidationError } from '@jwp/ott-common/src/errors/FormValidationError';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport type UseFormReturnValue<T> = {\r\n  values: T;\r\n  errors: FormErrors<T>;\r\n  validationSchemaError: boolean;\r\n  submitting: boolean;\r\n  handleChange: UseFormChangeHandler;\r\n  handleBlur: UseFormBlurHandler;\r\n  handleSubmit: UseFormSubmitHandler;\r\n  setValue: (key: keyof T, value: T[keyof T]) => void;\r\n  setErrors: (errors: FormErrors<T>) => void;\r\n  setSubmitting: (submitting: boolean) => void;\r\n  setValidationSchemaError: (error: boolean) => void;\r\n  reset: () => void;\r\n};\r\n\r\ntype UseFormMethods<T> = {\r\n  setValue: (key: keyof T, value: string | boolean) => void;\r\n  setErrors: (errors: FormErrors<T>) => void;\r\n  setSubmitting: (submitting: boolean) => void;\r\n  setValidationSchemaError: (error: boolean) => void;\r\n  validate: (validationSchema: AnySchema) => boolean;\r\n};\r\n\r\nexport type UseFormOnSubmitHandler<T> = (values: T, formMethods: UseFormMethods<T>) => void;\r\n\r\nexport default function useForm<T extends GenericFormValues>({\r\n  initialValues,\r\n  validationSchema,\r\n  validateOnBlur = false,\r\n  onSubmit,\r\n  onSubmitSuccess,\r\n  onSubmitError,\r\n}: {\r\n  initialValues: T;\r\n  validationSchema?: SchemaOf<T>;\r\n  validateOnBlur?: boolean;\r\n  onSubmit: UseFormOnSubmitHandler<T>;\r\n  onSubmitSuccess?: (values: T) => void;\r\n  onSubmitError?: ({ error, resetValue }: { error: unknown; resetValue: (key: keyof T) => void }) => void;\r\n}): UseFormReturnValue<T> {\r\n  const { t } = useTranslation('error');\r\n  const [touched, setTouched] = useState<Record<keyof T, boolean>>(\r\n    Object.fromEntries((Object.keys(initialValues) as Array<keyof T>).map((key) => [key, false])) as Record<keyof T, boolean>,\r\n  );\r\n  const [values, setValues] = useState<T>(initialValues);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [errors, setErrors] = useState<FormErrors<T>>({});\r\n  const [validationSchemaError, setValidationSchemaError] = useState(false);\r\n\r\n  const reset = useCallback(() => {\r\n    setValues(initialValues);\r\n    setErrors({});\r\n    setValidationSchemaError(false);\r\n    setSubmitting(false);\r\n    setTouched(Object.fromEntries((Object.keys(initialValues) as Array<keyof T>).map((key) => [key, false])) as Record<keyof T, boolean>);\r\n  }, [initialValues]);\r\n\r\n  const validateField = (name: string, formValues: T) => {\r\n    if (!validationSchema) return;\r\n\r\n    try {\r\n      validationSchema.validateSyncAt(name, formValues);\r\n\r\n      // clear error\r\n      setErrors((errors) => ({ ...errors, [name]: null }));\r\n    } catch (error: unknown) {\r\n      if (error instanceof ValidationError) {\r\n        const errorMessage = error.errors[0];\r\n        setErrors((errors) => ({ ...errors, [name]: errorMessage }));\r\n        setValidationSchemaError(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  const setValue = useCallback((name: keyof T, value: string | boolean) => {\r\n    setValues((current) => ({ ...current, [name]: value }));\r\n  }, []);\r\n\r\n  const handleChange: UseFormChangeHandler = (event) => {\r\n    const name = event.target.name;\r\n    const value = event.target instanceof HTMLInputElement && event.target.type === 'checkbox' ? event.target.checked : event.target.value;\r\n\r\n    const newValues = { ...values, [name]: value };\r\n\r\n    setValues(newValues);\r\n    setTouched((current) => ({ ...current, [name]: value }));\r\n\r\n    if (errors[name]) {\r\n      validateField(name, newValues);\r\n    }\r\n  };\r\n\r\n  const handleBlur: UseFormBlurHandler = (event) => {\r\n    if (!validateOnBlur || !touched[event.target.name]) return;\r\n\r\n    validateField(event.target.name, values);\r\n  };\r\n\r\n  const validate = (validationSchema: AnySchema) => {\r\n    try {\r\n      validationSchema.validateSync(values, { abortEarly: false });\r\n\r\n      return true;\r\n    } catch (error: unknown) {\r\n      if (error instanceof ValidationError) {\r\n        const newErrors: Record<string, string> = {};\r\n\r\n        for (let index = 0; index < error.inner.length; index++) {\r\n          const path = error.inner[index].path as string;\r\n          const message = error.inner[index].errors[0] as string;\r\n\r\n          if (path && message && !newErrors[path]) {\r\n            newErrors[path] = message;\r\n          }\r\n        }\r\n\r\n        if (error.inner.every((error) => error.type === 'required')) {\r\n          newErrors.form = t('validation_form_error.required');\r\n        } else {\r\n          newErrors.form = t('validation_form_error.other');\r\n        }\r\n\r\n        setErrors(newErrors as FormErrors<T>);\r\n      }\r\n    }\r\n\r\n    return false;\r\n  };\r\n\r\n  const handleSubmit: UseFormSubmitHandler = async (event) => {\r\n    event.preventDefault();\r\n\r\n    if (!onSubmit || submitting) return;\r\n\r\n    // reset errors before submitting\r\n    setErrors({});\r\n    setValidationSchemaError(false);\r\n\r\n    // validate values with schema\r\n    if (validationSchema && !validate(validationSchema)) {\r\n      setValidationSchemaError(true);\r\n      return;\r\n    }\r\n\r\n    // start submitting\r\n    setSubmitting(true);\r\n\r\n    try {\r\n      await onSubmit(values, { setValue, setErrors, setSubmitting, setValidationSchemaError, validate });\r\n      onSubmitSuccess?.(values);\r\n    } catch (error: unknown) {\r\n      const newErrors: Record<string, string> = {};\r\n\r\n      if (error instanceof FormValidationError) {\r\n        Object.entries(error.errors).forEach(([key, value]) => {\r\n          if (key && value && !newErrors[key]) {\r\n            newErrors[key] = value.join(',');\r\n          }\r\n        });\r\n      } else if (error instanceof Error) {\r\n        newErrors.form = error.message;\r\n      } else {\r\n        newErrors.form = t('unknown_error');\r\n      }\r\n      setErrors(newErrors as FormErrors<T>);\r\n\r\n      onSubmitError?.({\r\n        error,\r\n        resetValue: (key: keyof T) => setValue(key, ''),\r\n      });\r\n    }\r\n\r\n    setSubmitting(false);\r\n  };\r\n\r\n  return {\r\n    values,\r\n    errors,\r\n    validationSchemaError,\r\n    handleChange,\r\n    handleBlur,\r\n    handleSubmit,\r\n    submitting,\r\n    setValue,\r\n    setErrors,\r\n    setSubmitting,\r\n    setValidationSchemaError,\r\n    reset,\r\n  };\r\n}\r\n","import { useState } from 'react';\r\n\r\nconst useToggle = (initialState: boolean = false): [boolean, (forceValue?: boolean) => void] => {\r\n  const [state, setState] = useState(initialState);\r\n\r\n  const toggle = (forceValue?: boolean) => setState((current) => (typeof forceValue !== 'undefined' ? forceValue : !current));\r\n\r\n  return [state, toggle];\r\n};\r\n\r\nexport default useToggle;\r\n","import * as React from \"react\";\nconst SvgVisibility = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z\" }));\nexport default SvgVisibility;\n","import * as React from \"react\";\nconst SvgVisibilityOff = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M11.83,9L15,12.16C15,12.11 15,12.05 15,12A3,3 0 0,0 12,9C11.94,9 11.89,9 11.83,9M7.53,9.8L9.08,11.35C9.03,11.56 9,11.77 9,12A3,3 0 0,0 12,15C12.22,15 12.44,14.97 12.65,14.92L14.2,16.47C13.53,16.8 12.79,17 12,17A5,5 0 0,1 7,12C7,11.21 7.2,10.47 7.53,9.8M2,4.27L4.28,6.55L4.73,7C3.08,8.3 1.78,10 1,12C2.73,16.39 7,19.5 12,19.5C13.55,19.5 15.03,19.2 16.38,18.66L16.81,19.08L19.73,22L21,20.73L3.27,3M12,7A5,5 0 0,1 17,12C17,12.64 16.87,13.26 16.64,13.82L19.57,16.75C21.07,15.5 22.27,13.86 23,12C21.27,7.61 17,4.5 12,4.5C10.6,4.5 9.26,4.75 8,5.2L10.17,7.35C10.74,7.13 11.35,7 12,7Z\" }));\nexport default SvgVisibilityOff;\n","import { IS_TEST_MODE } from '@jwp/ott-common/src/utils/common';\r\nimport { useEffect, useState } from 'react';\r\n\r\nconst generateId = (prefix?: string, suffix?: string) => {\r\n  // This test code ensures that ID's in snapshots are always the same.\r\n  // Ideally it would be mocked in the test setup but there seems to be a bug with vitest if you mock Math.random\r\n  const randomId = IS_TEST_MODE ? 1235 : Math.random() * 10000;\r\n\r\n  return [prefix, Math.round(randomId), suffix]\r\n    .filter(Boolean)\r\n    .join('_')\r\n    .replace(/[\\s.]+/g, '_')\r\n    .toLowerCase();\r\n};\r\n\r\nconst useOpaqueId = (prefix?: string, suffix?: string, override?: string): string => {\r\n  const [id, setId] = useState(override || generateId(prefix, suffix));\r\n\r\n  useEffect(() => {\r\n    setId(override || generateId(prefix, suffix));\r\n  }, [override, prefix, suffix]);\r\n\r\n  return id;\r\n};\r\n\r\nexport default useOpaqueId;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport styles from './HelperText.module.scss';\r\n\r\ntype Props = {\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  error?: boolean;\r\n  id?: string;\r\n};\r\n\r\nconst HelperText: React.FC<Props> = ({ children, className, error, id }: Props) => {\r\n  const helperId = useOpaqueId('helper_text', undefined, id);\r\n\r\n  return children ? (\r\n    <div id={helperId} className={classNames(styles.helperText, { [styles.error]: error }, className)}>\r\n      {children}\r\n    </div>\r\n  ) : null;\r\n};\r\n\r\nexport default HelperText;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport HelperText from '../HelperText/HelperText';\r\nimport type { FormControlProps } from '../../types/form';\r\n\r\nimport styles from './FormField.module.scss';\r\n\r\ntype RenderInputProps = {\r\n  helperTextId: string;\r\n  id: string;\r\n};\r\n\r\ntype Props = {\r\n  helperText?: React.ReactNode;\r\n  renderInput: (fieldProps: RenderInputProps) => React.ReactElement;\r\n} & Omit<FormControlProps, 'value' | 'placeholder'>;\r\n\r\nexport const FormField = ({ className, renderInput, required, label, error, helperText, testId, editing = true, name }: Props) => {\r\n  const formFieldClassName = classNames(styles.formField, className);\r\n  const id = useOpaqueId('text-field', name);\r\n  const helperTextId = useOpaqueId('helper_text', name);\r\n\r\n  return (\r\n    <div className={formFieldClassName} data-testid={testId}>\r\n      {!!label && (\r\n        <label htmlFor={id} className={styles.label}>\r\n          {label}\r\n          {required && editing ? <span aria-hidden=\"true\">*</span> : null}\r\n        </label>\r\n      )}\r\n      {renderInput({ helperTextId, id })}\r\n      {editing && (\r\n        <HelperText id={helperTextId} error={error}>\r\n          {helperText}\r\n        </HelperText>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n","import React, { type InputHTMLAttributes, type RefObject, type TextareaHTMLAttributes } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport type { FormControlProps } from '../../types/form';\r\n\r\nimport styles from './Input.module.scss';\r\n\r\ntype CommonProps = {\r\n  id?: string;\r\n  helperTextId?: string;\r\n  leftControl?: React.ReactNode;\r\n  rightControl?: React.ReactNode;\r\n  multiline?: boolean;\r\n} & FormControlProps;\r\n\r\ntype HTMLInputProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\ntype HTMLTextAreaProps = Omit<TextareaHTMLAttributes<HTMLTextAreaElement>, 'size'>;\r\n\r\ntype InputProps = HTMLInputProps & {\r\n  type?: InputHTMLAttributes<HTMLInputElement>['type'];\r\n  multiline?: boolean;\r\n  inputRef?: RefObject<HTMLInputElement>;\r\n  textAreaRef?: never;\r\n} & CommonProps;\r\ntype TextAreaProps = HTMLTextAreaProps & { type?: never; multiline: true; inputRef?: never; textAreaRef?: RefObject<HTMLTextAreaElement> } & CommonProps;\r\n\r\nexport type Props = InputProps | TextAreaProps;\r\n\r\nconst isTextArea = (_props: HTMLInputProps | HTMLTextAreaProps, multiline?: boolean): _props is HTMLTextAreaProps => !!multiline;\r\n\r\nconst Input = ({\r\n  required,\r\n  className,\r\n  disabled,\r\n  editing = true,\r\n  value,\r\n  id,\r\n  name,\r\n  multiline,\r\n  error,\r\n  helperTextId,\r\n  type,\r\n  textAreaRef,\r\n  inputRef,\r\n  leftControl,\r\n  rightControl,\r\n  ...inputProps\r\n}: Props) => {\r\n  // Default to 'text' if 'type' property is absent, which occurs in textareas.\r\n  const inputType = type || 'text';\r\n  const containerClassName = classNames(\r\n    styles.container,\r\n    {\r\n      [styles.error]: error,\r\n      [styles.disabled]: disabled,\r\n      [styles.leftControl]: !!leftControl,\r\n      [styles.rightControl]: !!rightControl,\r\n    },\r\n    className,\r\n  );\r\n\r\n  const ariaAttributes = {\r\n    'aria-required': !!required,\r\n    'aria-invalid': Boolean(required && error && value !== ''),\r\n    'aria-describedby': helperTextId,\r\n  } as const;\r\n\r\n  const commonProps: HTMLInputProps | HTMLTextAreaProps = {\r\n    id,\r\n    name,\r\n    value,\r\n    disabled,\r\n    rows: multiline ? 3 : undefined,\r\n    className: styles.input,\r\n    readOnly: !editing,\r\n    required: required,\r\n    ...ariaAttributes,\r\n    ...inputProps,\r\n  };\r\n\r\n  const input = isTextArea(commonProps, multiline) ? (\r\n    <textarea {...commonProps} ref={textAreaRef} />\r\n  ) : (\r\n    <input {...commonProps} type={inputType} ref={inputRef} />\r\n  );\r\n\r\n  return editing ? (\r\n    <div className={containerClassName}>\r\n      {leftControl ? <div className={styles.control}>{leftControl}</div> : null}\r\n      {input}\r\n      {rightControl ? <div className={styles.control}>{rightControl}</div> : null}\r\n    </div>\r\n  ) : (\r\n    input\r\n  );\r\n};\r\n\r\nexport default Input;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport { FormField } from '../../FormField/FormField';\r\nimport Input from '../../Input/Input';\r\nimport type { FormControlProps } from '../../../types/form';\r\n\r\nimport styles from './TextField.module.scss';\r\n\r\ntype InputProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\n\r\ntype Props = InputProps & {\r\n  helperText?: React.ReactNode;\r\n  multiline?: boolean;\r\n  leftControl?: React.ReactNode;\r\n  rightControl?: React.ReactNode;\r\n} & FormControlProps;\r\n\r\nconst TextField: React.FC<Props> = ({ className, helperText, label, error, required, editing = true, testId, name, ...inputProps }) => {\r\n  return (\r\n    <FormField\r\n      className={classNames(styles.textField, className)}\r\n      error={error}\r\n      helperText={helperText}\r\n      label={label}\r\n      required={required}\r\n      editing={editing}\r\n      testId={testId}\r\n      name={name}\r\n      renderInput={(fieldProps) => <Input editing={editing} error={error} name={name} required={required} {...fieldProps} {...inputProps} />}\r\n    />\r\n  );\r\n};\r\n\r\nexport default TextField;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport styles from './PasswordStrength.module.scss';\r\n\r\ntype Props = {\r\n  password: string;\r\n};\r\n\r\nconst PASSWORD_REGEX = /^(?=.*[a-z])(?=.*[0-9]).{8,}$/;\r\n\r\nconst PasswordStrength: React.FC<Props> = ({ password }: Props) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  const passwordStrength = (password: string) => {\r\n    let strength = 0;\r\n\r\n    if (!password.match(PASSWORD_REGEX)) return strength;\r\n\r\n    if (password.match(/[A-Z]+/)) {\r\n      strength += 1;\r\n    }\r\n\r\n    if (password.match(/(\\d.*\\d)/)) {\r\n      strength += 1;\r\n    }\r\n\r\n    if (password.match(/[!,@#$%^&*?_~]/)) {\r\n      strength += 1;\r\n    }\r\n\r\n    if (password.match(/([!,@#$%^&*?_~].*[!,@#$%^&*?_~])/)) {\r\n      strength += 1;\r\n    }\r\n\r\n    return strength;\r\n  };\r\n  const strength = passwordStrength(password);\r\n  const labels = [\r\n    t('registration.password_strength.invalid'),\r\n    t('registration.password_strength.weak'),\r\n    t('registration.password_strength.fair'),\r\n    t('registration.password_strength.strong'),\r\n    t('registration.password_strength.very_strong'),\r\n  ];\r\n\r\n  if (!strength) return null;\r\n\r\n  return (\r\n    <div className={styles.passwordStrength} data-strength={strength}>\r\n      <div className={styles.passwordStrengthBar}>\r\n        <div className={styles.passwordStrengthFill} />\r\n      </div>\r\n      <span className=\"hidden\">{t('registration.password_strength_prefix')}</span> <span className={styles.label}>{labels[strength]}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PasswordStrength;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport useToggle from '@jwp/ott-hooks-react/src/useToggle';\r\nimport Visibility from '@jwp/ott-theme/assets/icons/visibility.svg?react';\r\nimport VisibilityOff from '@jwp/ott-theme/assets/icons/visibility_off.svg?react';\r\n\r\nimport TextField from '../TextField/TextField';\r\nimport PasswordStrength from '../../PasswordStrength/PasswordStrength';\r\nimport IconButton from '../../IconButton/IconButton';\r\nimport Icon from '../../Icon/Icon';\r\nimport type { FormControlProps } from '../../../types/form';\r\n\r\ntype InputProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\n\r\ntype Props = InputProps & {\r\n  helperText?: React.ReactNode;\r\n  showToggleView?: boolean;\r\n  showHelperText?: boolean;\r\n} & FormControlProps;\r\n\r\nconst PasswordField: React.FC<Props> = ({ value, showToggleView = true, helperText, showHelperText = true, ...props }: Props) => {\r\n  const { t } = useTranslation('account');\r\n  const [viewPassword, toggleViewPassword] = useToggle();\r\n\r\n  return (\r\n    <TextField\r\n      {...props}\r\n      helperText={\r\n        helperText ??\r\n        (showHelperText ? (\r\n          <React.Fragment>\r\n            <PasswordStrength password={value || ''} />\r\n            {t('reset.password_helper_text')}\r\n          </React.Fragment>\r\n        ) : null)\r\n      }\r\n      type={viewPassword ? 'text' : 'password'}\r\n      rightControl={\r\n        showToggleView ? (\r\n          <IconButton aria-label={t('reset.view_password')} onClick={() => toggleViewPassword()} aria-pressed={viewPassword}>\r\n            <Icon icon={viewPassword ? Visibility : VisibilityOff} />\r\n          </IconButton>\r\n        ) : null\r\n      }\r\n      required\r\n    />\r\n  );\r\n};\r\n\r\nexport default PasswordField;\r\n","import { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport type { DeleteAccountFormData } from '@jwp/ott-common/types/account';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useMutation } from 'react-query';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { object, string } from 'yup';\r\nimport { FormValidationError } from '@jwp/ott-common/src/errors/FormValidationError';\r\nimport classNames from 'classnames';\r\n\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\nimport Button from '../Button/Button';\r\nimport PasswordField from '../form-fields/PasswordField/PasswordField';\r\nimport useQueryParam from '../../hooks/useQueryParam';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './DeleteAccountModal.module.scss';\r\n\r\nconst DeleteAccountModal = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t } = useTranslation('user');\r\n  const announce = useAriaAnnouncer();\r\n  const u = useQueryParam('u');\r\n\r\n  const [enteredPassword, setEnteredPassword] = useState<string>('');\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const {\r\n    handleSubmit,\r\n    handleChange,\r\n    values,\r\n    errors,\r\n    setErrors,\r\n    reset: resetForm,\r\n  } = useForm<DeleteAccountFormData>({\r\n    initialValues: { password: '' },\r\n    validationSchema: object().shape({ password: string().required(t('login.field_required')) }),\r\n    onSubmit: (values) => {\r\n      setEnteredPassword(values.password);\r\n      navigate(modalURLFromLocation(location, 'delete-account-confirmation'), { replace: true });\r\n    },\r\n  });\r\n\r\n  const deleteAccount = useMutation(accountController.deleteAccountData, {\r\n    onSuccess: async () => {\r\n      navigate('/');\r\n      await accountController.logout();\r\n      announce(t('account.delete_account.success'), 'success');\r\n    },\r\n    onError: (error: unknown) => {\r\n      if (error instanceof FormValidationError) {\r\n        setErrors(error.errors);\r\n        navigate(modalURLFromLocation(location, 'delete-account'), { replace: true });\r\n      }\r\n      setEnteredPassword('');\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    // when the user navigates directly to the confirmation step\r\n    if (u === 'delete-account-confirmation' && !enteredPassword) {\r\n      navigate(modalURLFromLocation(location, 'delete-account'), { replace: true });\r\n    }\r\n  }, [location, u, navigate, enteredPassword, deleteAccount, resetForm]);\r\n\r\n  const handleCancel = useCallback(() => {\r\n    navigate(modalURLFromLocation(location, null), { replace: true });\r\n  }, [location, navigate]);\r\n\r\n  // step 2: delete account confirmation\r\n  if (enteredPassword) {\r\n    return (\r\n      <div>\r\n        <h2 className={styles.heading}>{t('account.delete_account.title')}</h2>\r\n        <div className={styles.disclaimer}>\r\n          <p>{t('account.delete_account.modal.text_data_erasure')}</p>\r\n          <p>{t('account.delete_account.modal.text_revoked_access')}</p>\r\n          <div className={styles.warningBox}>\r\n            <p>{t('account.delete_account.modal.warning')}</p>\r\n          </div>\r\n          <p>\r\n            {t('account.delete_account.modal.text_cant_be_undone')} <br />\r\n            {t('account.delete_account.modal.text_contacts')}\r\n          </p>\r\n        </div>\r\n        <div className={styles.buttons}>\r\n          <Button disabled={deleteAccount.isLoading} variant=\"text\" label={t('account.cancel')} onClick={handleCancel} />\r\n          <Button\r\n            disabled={deleteAccount.isLoading}\r\n            variant=\"delete\"\r\n            label={t('account.delete_account.title')}\r\n            onClick={() => {\r\n              deleteAccount.mutate(enteredPassword);\r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // step 1: enter your password\r\n  return (\r\n    <form onSubmit={handleSubmit}>\r\n      <h2 className={styles.heading}>{t('account.delete_account.title')}</h2>\r\n      <p className={styles.paragraph}>{t('account.delete_account.modal.description')}</p>\r\n      {errors.form && <FormFeedback variant=\"error\">{errors.form}</FormFeedback>}\r\n      <PasswordField\r\n        value={values.password}\r\n        onChange={handleChange}\r\n        label={t('account.password')}\r\n        placeholder={t('account.delete_account.modal.placeholder')}\r\n        error={!!errors.password || !!errors.form}\r\n        helperText={errors.password}\r\n        name=\"password\"\r\n        showHelperText={false}\r\n      />\r\n      <div className={classNames(styles.buttons, styles.stacked)}>\r\n        <Button type=\"submit\" color=\"primary\" label={t('account.continue')} fullWidth />\r\n        <Button type=\"button\" onClick={handleCancel} variant=\"text\" label={t('account.cancel')} fullWidth />\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default DeleteAccountModal;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\n\r\nimport Button from '../Button/Button';\r\nimport Spinner from '../Spinner/Spinner';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport styles from './FinalizePayment.module.scss';\r\n\r\nconst FinalizePayment = () => {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const { accessModel } = useConfigStore(({ accessModel }) => ({ accessModel }));\r\n  const [searchParams] = useSearchParams();\r\n  const redirectResult = searchParams.get('redirectResult');\r\n  const orderIdQueryParam = searchParams.get('orderId');\r\n\r\n  const [errorMessage, setErrorMessage] = useState<string>();\r\n\r\n  const paymentSuccessUrl = useMemo(() => {\r\n    return modalURLFromLocation(location, accessModel === ACCESS_MODEL.SVOD ? 'welcome' : null);\r\n  }, [accessModel, location]);\r\n\r\n  const checkPaymentResult = useEventCallback(async (redirectResult: string) => {\r\n    const orderId = orderIdQueryParam ? parseInt(orderIdQueryParam, 10) : undefined;\r\n\r\n    try {\r\n      await checkoutController.finalizeAdyenPayment({ redirectResult: decodeURI(redirectResult) }, orderId);\r\n      await accountController.reloadSubscriptions({ retry: 10 });\r\n\r\n      announce(t('checkout.payment_success'), 'success');\r\n      navigate(paymentSuccessUrl);\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        setErrorMessage(error.message);\r\n      }\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!redirectResult) return;\r\n\r\n    checkPaymentResult(redirectResult);\r\n  }, [checkPaymentResult, redirectResult]);\r\n\r\n  return (\r\n    <div className={styles.container}>\r\n      {errorMessage ? (\r\n        <>\r\n          <h2 className={styles.title}>{errorMessage}</h2>\r\n          <Button\r\n            label={t('checkout.go_back_to_checkout')}\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            size=\"large\"\r\n            onClick={() => navigate(modalURLFromLocation(location, 'checkout'))}\r\n            fullWidth\r\n          />\r\n        </>\r\n      ) : (\r\n        <div>\r\n          <Spinner />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FinalizePayment;\r\n","import { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\n\r\ntype IntervalCheckAccessPayload = {\r\n  interval?: number;\r\n  iterations?: number;\r\n  offerId?: string;\r\n  callback?: ({ hasAccess, offerId }: { hasAccess: boolean; offerId: string }) => void;\r\n};\r\n\r\nconst useCheckAccess = () => {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const intervalRef = useRef<number>();\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\r\n  const { t } = useTranslation('user');\r\n\r\n  const offers = checkoutController.getSubscriptionOfferIds();\r\n\r\n  const intervalCheckAccess = useCallback(\r\n    ({ interval = 3000, iterations = 5, offerId = offers?.[0], callback }: IntervalCheckAccessPayload) => {\r\n      if (!offerId) {\r\n        callback?.({ hasAccess: false, offerId: '' });\r\n        return;\r\n      }\r\n\r\n      intervalRef.current = window.setInterval(async () => {\r\n        const hasAccess = await accountController.checkEntitlements(offerId);\r\n\r\n        if (hasAccess) {\r\n          window.clearInterval(intervalRef.current);\r\n          // No duplicate retry mechanism. This can also be a TVOD offer which isn't validated using the\r\n          // reloadSubscriptions method.\r\n          await accountController.reloadSubscriptions();\r\n          callback?.({ hasAccess: true, offerId: offerId || '' });\r\n        } else if (--iterations === 0) {\r\n          window.clearInterval(intervalRef.current);\r\n          setErrorMessage(t('payment.longer_than_usual'));\r\n          callback?.({ hasAccess: false, offerId: offerId || '' });\r\n        }\r\n      }, interval);\r\n    },\r\n    [offers, t, accountController],\r\n  );\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      window.clearInterval(intervalRef.current);\r\n    };\r\n  }, []);\r\n\r\n  return { intervalCheckAccess, errorMessage };\r\n};\r\n\r\nexport default useCheckAccess;\r\n","import React, { useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport useCheckAccess from '@jwp/ott-hooks-react/src/useCheckAccess';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\n\r\nimport Spinner from '../Spinner/Spinner';\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\nimport useQueryParam from '../../hooks/useQueryParam';\r\n\r\nimport styles from './WaitingForPayment.module.scss';\r\n\r\nconst WaitingForPayment = () => {\r\n  const { t } = useTranslation('account');\r\n  const offerId = useQueryParam('offerId') || undefined;\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const announce = useAriaAnnouncer();\r\n  const { intervalCheckAccess, errorMessage } = useCheckAccess();\r\n\r\n  useEffect(() => {\r\n    intervalCheckAccess({\r\n      interval: 3000,\r\n      iterations: 5,\r\n      offerId,\r\n      callback: ({ hasAccess, offerId }) => {\r\n        if (!hasAccess) return;\r\n\r\n        announce(t('checkout.payment_success'), 'success');\r\n\r\n        // close the modal for PPV/TVOD offers\r\n        if (offerId.startsWith('C') || offerId.startsWith('P')) {\r\n          // @TODO should we show a dedicated modal for TVOD access?\r\n          navigate(modalURLFromLocation(location, null));\r\n        } else {\r\n          navigate(modalURLFromLocation(location, 'welcome'));\r\n        }\r\n      },\r\n    });\r\n    //eslint-disable-next-line\r\n  }, []);\r\n  return (\r\n    <div className={styles.center}>\r\n      {errorMessage ? (\r\n        <h2>{errorMessage}</h2>\r\n      ) : (\r\n        <>\r\n          <Spinner />\r\n          <h2>{t('checkout.waiting_for_payment')}</h2>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default WaitingForPayment;\r\n","import React, { useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\nimport { type AriaAnnouncerVariant, useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport styles from './UpgradeSubscription.module.scss';\r\n\r\ntype Props = {\r\n  type: 'error' | 'success' | 'pending';\r\n  onCloseButtonClick: () => void;\r\n};\r\n\r\nconst UpgradeSubscription: React.FC<Props> = ({ type, onCloseButtonClick }: Props) => {\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n\r\n  // these comments exist for extracting dynamic i18n keys\r\n  // t('account:checkout.upgrade_success');\r\n  // t('account:checkout.upgrade_success_message');\r\n  // t('account:checkout.upgrade_pending');\r\n  // t('account:checkout.upgrade_pending_message');\r\n  // t('account:checkout.upgrade_error');\r\n  // t('account:checkout.upgrade_error_message');\r\n  const title = t(`checkout.upgrade_${type}`);\r\n  const message = t(`checkout.upgrade_${type}_message`);\r\n\r\n  useEffect(() => {\r\n    const typeToAnnounce = { error: 'error', success: 'succes', pending: 'info' }[type] as AriaAnnouncerVariant;\r\n\r\n    announce(message, typeToAnnounce);\r\n  }, [announce, message, type]);\r\n\r\n  return (\r\n    <div>\r\n      <h2 className={styles.title}>{title}</h2>\r\n      <p className={styles.message}>{message}</p>\r\n      <div>\r\n        <Button label={t('checkout.close')} onClick={onCloseButtonClick} color=\"primary\" variant=\"contained\" size=\"large\" fullWidth />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UpgradeSubscription;\r\n","import { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { useCallback, useState } from 'react';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\nimport styles from './DeleteAccountPasswordWarning.module.scss';\r\n\r\nconst DeleteAccountPasswordWarning = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t } = useTranslation('user');\r\n  const email = useAccountStore((state) => state.user?.email);\r\n  const [errorMessage, setErrorMessage] = useState<string>();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const handleCancel = useCallback(() => {\r\n    navigate(modalURLFromLocation(location, null), { replace: true });\r\n  }, [location, navigate]);\r\n  const proceedToAddPasswordClickHandler = async () => {\r\n    try {\r\n      if (email) {\r\n        await accountController.resetPassword(email, '');\r\n        navigate(modalURLFromLocation(location, 'add-password'));\r\n      }\r\n    } catch (error: unknown) {\r\n      setErrorMessage(t('account.add_password_error'));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={styles.formContainer}>\r\n      {errorMessage && (\r\n        <div className={styles.formFeedback}>\r\n          <FormFeedback variant=\"error\">{errorMessage}</FormFeedback>\r\n        </div>\r\n      )}\r\n      <h2 className={styles.heading}>{t('account.delete_account_password_warning.title')}</h2>\r\n      <p className={styles.paragraph}>{t('account.delete_account_password_warning.text')}</p>\r\n      <div className={styles.passwordButtonsContainer}>\r\n        <Button\r\n          type=\"submit\"\r\n          onClick={proceedToAddPasswordClickHandler}\r\n          className={styles.button}\r\n          color=\"primary\"\r\n          fullWidth\r\n          label={t('account.proceed_to_adding_a_password')}\r\n        />\r\n        <Button type=\"button\" onClick={handleCancel} className={styles.button} variant=\"text\" fullWidth label={t('account.cancel')} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DeleteAccountPasswordWarning;\r\n","import * as React from \"react\";\nconst SvgCreditcard = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { fill: \"currentColor\", d: \"M20,8H4V6H20M20,18H4V12H20M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z\" }));\nexport default SvgCreditcard;\n","import * as React from \"react\";\nconst SvgPaypal = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M7.37083 12.6026c-.70164 0-1.28549-.0571-1.72496-.1142l-1.34375 6.9595H.179688L3.83225.516163C5.08988.201006 7.07827 0 8.97801 0c1.75279 0 3.79949.286619 5.23309 1.28917 1.3172.88839 2.1354 2.23464 2.1354 4.0958 0 2.4344-1.1386 4.26703-2.6901 5.44083-1.6084 1.2333-3.8881 1.7768-6.28557 1.7768zm1.72496-9.30834c-.78902 0-1.34375.05832-1.69457.14393L6.28924 9.13832c.43821.08561.90681.14269 1.60845.14269 2.54311 0 4.20851-1.60433 4.20851-3.52257 0-1.8624-1.3741-2.46418-3.01041-2.46418zm7.22271.21844c.523.18487 1.0195.4169 1.4552.72213 1.3158.88715 2.1353 2.23339 2.1365 4.09456 0 2.43441-1.1398 4.26701-2.69 5.44201-1.6084 1.2321-3.8869 1.7756-6.2856 1.7756-.7016 0-1.28676-.0571-1.72497-.1154l-1.34501 6.9595H3.74219l.31915-1.6577h1.30702l1.34502-6.9582c.4382.057 1.02206.1141 1.72496.1141 2.39746 0 4.67586-.5447 6.28556-1.7755 1.549-1.1738 2.6888-3.00769 2.6888-5.44209 0-1.29909-.4053-2.34258-1.0942-3.15901z\" }));\nexport default SvgPaypal;\n","import React, { useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { PaymentMethod } from '@jwp/ott-common/types/checkout';\r\nimport CreditCard from '@jwp/ott-theme/assets/icons/creditcard.svg?react';\r\nimport PayPal from '@jwp/ott-theme/assets/icons/paypal.svg?react';\r\n\r\nimport Button from '../Button/Button';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport Icon from '../Icon/Icon';\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport styles from './PaymentMethodForm.module.scss';\r\n\r\ntype Props = {\r\n  paymentMethodId?: number;\r\n  onCloseButtonClick: () => void;\r\n  paymentMethods?: PaymentMethod[];\r\n  onPaymentMethodChange: React.ChangeEventHandler<HTMLInputElement>;\r\n  renderPaymentMethod?: () => JSX.Element | null;\r\n  submitting: boolean;\r\n  updateSuccess: boolean;\r\n};\r\n\r\nconst PaymentMethodForm: React.FC<Props> = ({\r\n  paymentMethodId,\r\n  paymentMethods,\r\n  onCloseButtonClick,\r\n  onPaymentMethodChange,\r\n  renderPaymentMethod,\r\n  submitting,\r\n  updateSuccess,\r\n}) => {\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  // t('payment.longer_than_usual');\r\n\r\n  const cardPaymentMethod = paymentMethods?.find((method) => method.methodName === 'card');\r\n  const paypalPaymentMethod = paymentMethods?.find((method) => method.methodName === 'paypal');\r\n\r\n  useEffect(() => {\r\n    updateSuccess && announce(t('checkout.payment_success'), 'success');\r\n  }, [updateSuccess, announce, t]);\r\n\r\n  return (\r\n    <>\r\n      <h1 className={styles.title}>{t('payment.update_payment_details')}</h1>\r\n      {updateSuccess ? (\r\n        <>\r\n          <p className={styles.success}>{t('payment.update_payment_success')}</p>\r\n          <Button label={t('payment.back_to_profile')} onClick={onCloseButtonClick} color=\"primary\" fullWidth />\r\n        </>\r\n      ) : (\r\n        <>\r\n          <div className={styles.paymentMethodsInputs}>\r\n            {cardPaymentMethod ? (\r\n              <div className={styles.paymentMethod}>\r\n                <input\r\n                  className={styles.radio}\r\n                  type=\"radio\"\r\n                  name=\"paymentMethod\"\r\n                  value={cardPaymentMethod.id}\r\n                  id=\"card\"\r\n                  checked={paymentMethodId === cardPaymentMethod.id}\r\n                  onChange={onPaymentMethodChange}\r\n                />\r\n                <label className={styles.paymentMethodLabel} htmlFor=\"card\">\r\n                  <Icon icon={CreditCard} />\r\n                  {t('payment.credit_card')}\r\n                </label>\r\n              </div>\r\n            ) : null}\r\n            {paypalPaymentMethod ? (\r\n              <div className={styles.paymentMethod}>\r\n                <input\r\n                  className={styles.radio}\r\n                  type=\"radio\"\r\n                  name=\"paymentMethod\"\r\n                  value={paypalPaymentMethod.id}\r\n                  id=\"paypal\"\r\n                  checked={paymentMethodId === paypalPaymentMethod.id}\r\n                  onChange={onPaymentMethodChange}\r\n                />\r\n                <label className={styles.paymentMethodLabel} htmlFor=\"paypal\">\r\n                  <Icon icon={PayPal} /> {t('payment.paypal')}\r\n                </label>\r\n              </div>\r\n            ) : null}\r\n          </div>\r\n          <div>{renderPaymentMethod ? renderPaymentMethod() : null}</div>\r\n          {submitting && <LoadingOverlay transparentBackground inline />}\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PaymentMethodForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './PayPal.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit?: () => void;\r\n  error: string | null;\r\n};\r\n\r\nconst PayPal: React.FC<Props> = ({ onSubmit, error }) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  return (\r\n    <div className={styles.payPal}>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <p>{t('checkout.paypal_instructions')}</p>\r\n      <Button label={t('checkout.continue')} variant=\"contained\" color=\"primary\" size=\"large\" onClick={onSubmit} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PayPal;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport AdyenCheckout from '@adyen/adyen-web';\r\nimport type { CoreOptions } from '@adyen/adyen-web/dist/types/core/types';\r\nimport type { PaymentMethods } from '@adyen/adyen-web/dist/types/types';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './Adyen.module.scss';\r\nimport '@adyen/adyen-web/dist/adyen.css';\r\nimport './AdyenForm.scss';\r\n\r\ntype Props = {\r\n  configuration: CoreOptions;\r\n  error?: string;\r\n  type: AdyenPaymentMethodType;\r\n};\r\n\r\nconst Adyen: React.FC<Props> = ({ configuration, error, type }) => {\r\n  const { t } = useTranslation('account');\r\n  const checkoutElementRef = useRef(null);\r\n  const checkoutRef = useRef<InstanceType<PaymentMethods[typeof type]>>();\r\n\r\n  useEffect(() => {\r\n    if (!checkoutElementRef.current || !configuration.session) {\r\n      return;\r\n    }\r\n\r\n    const createCheckout = async () => {\r\n      const checkout = await AdyenCheckout(configuration);\r\n\r\n      if (checkoutElementRef.current) {\r\n        checkoutRef.current = checkout.create(type);\r\n        checkoutRef.current?.mount(checkoutElementRef.current);\r\n      }\r\n    };\r\n\r\n    createCheckout();\r\n\r\n    return () => {\r\n      checkoutRef.current?.unmount();\r\n    };\r\n  }, [configuration, type]);\r\n\r\n  return (\r\n    <div className={styles.adyen}>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <div className={styles.container} ref={checkoutElementRef} />\r\n      <Button\r\n        label={t('checkout.continue')}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        size=\"large\"\r\n        onClick={() => {\r\n          checkoutRef.current && checkoutRef.current.submit();\r\n        }}\r\n        fullWidth\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Adyen;\r\n","import type { CoreOptions } from '@adyen/adyen-web/dist/types/core/types';\r\nimport { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport type DropinElement from '@adyen/adyen-web/dist/types/components/Dropin/Dropin';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport type { AdyenPaymentSession } from '@jwp/ott-common/types/checkout';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport { modalURLFromLocation, modalURLFromWindowLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { ADYEN_LIVE_CLIENT_KEY, ADYEN_TEST_CLIENT_KEY } from '@jwp/ott-common/src/constants';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Adyen from '../../components/Adyen/Adyen';\r\nimport { useAriaAnnouncer } from '../AnnouncementProvider/AnnoucementProvider';\r\n\r\ntype Props = {\r\n  setProcessing: (loading: boolean) => void;\r\n  setPaymentError: (errorMessage?: string) => void;\r\n  paymentMethodId: number;\r\n  type: AdyenPaymentMethodType;\r\n  error?: string;\r\n};\r\n\r\nexport default function AdyenPaymentDetails({ setProcessing, type, setPaymentError, error, paymentMethodId }: Props) {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const isSandbox = accountController.getSandbox();\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [session, setSession] = useState<AdyenPaymentSession>();\r\n\r\n  const redirectResult = useQueryParam('redirectResult');\r\n  const finalize = !!redirectResult;\r\n  const paymentSuccessUrl = modalURLFromLocation(location, 'payment-method-success');\r\n\r\n  const finalizePaymentDetails = useEventCallback(async (redirectResult: string) => {\r\n    try {\r\n      setProcessing(true);\r\n\r\n      await checkoutController.finalizeAdyenPaymentDetails({ redirectResult: decodeURI(redirectResult) }, paymentMethodId);\r\n      await accountController.reloadSubscriptions({ retry: 10 });\r\n\r\n      setProcessing(false);\r\n\r\n      announce(t('checkout.payment_success'), 'success');\r\n      navigate(paymentSuccessUrl);\r\n    } catch (error: unknown) {\r\n      setProcessing(false);\r\n\r\n      if (error instanceof Error) {\r\n        setPaymentError(error.message);\r\n        navigate(modalURLFromLocation(location, 'payment-method'), { replace: true });\r\n      }\r\n    }\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!redirectResult) return;\r\n\r\n    finalizePaymentDetails(redirectResult);\r\n  }, [finalizePaymentDetails, redirectResult]);\r\n\r\n  useEffect(() => {\r\n    if (finalize) return;\r\n\r\n    const createSession = async () => {\r\n      setProcessing(true);\r\n\r\n      try {\r\n        const session = await checkoutController.createAdyenPaymentSession(window.origin, false);\r\n\r\n        setSession(session);\r\n      } catch (error: unknown) {\r\n        if (error instanceof Error) {\r\n          setPaymentError(error.message);\r\n        }\r\n      }\r\n\r\n      setProcessing(false);\r\n    };\r\n\r\n    createSession();\r\n  }, [setProcessing, setPaymentError, finalize, navigate, location, checkoutController]);\r\n\r\n  const onSubmit = useCallback(\r\n    async (state: AdyenEventData, handleAction: DropinElement['handleAction']) => {\r\n      if (!state.isValid) return;\r\n\r\n      try {\r\n        setProcessing(true);\r\n        setPaymentError(undefined);\r\n\r\n        const returnUrl = modalURLFromWindowLocation('payment-method', { paymentMethodId: `${paymentMethodId}` });\r\n        const result = await checkoutController.addAdyenPaymentDetails(state.data.paymentMethod, paymentMethodId, returnUrl);\r\n\r\n        if ('action' in result) {\r\n          handleAction(result.action);\r\n        }\r\n\r\n        await accountController.reloadSubscriptions({ retry: 5 });\r\n\r\n        navigate(paymentSuccessUrl, { replace: true });\r\n      } catch (error: unknown) {\r\n        if (error instanceof Error) {\r\n          setPaymentError(error.message);\r\n        }\r\n      }\r\n\r\n      setProcessing(false);\r\n    },\r\n    [navigate, paymentMethodId, paymentSuccessUrl, setPaymentError, setProcessing, accountController, checkoutController],\r\n  );\r\n\r\n  const adyenConfiguration: CoreOptions = useMemo(\r\n    () => ({\r\n      session,\r\n      showPayButton: false,\r\n      environment: isSandbox ? 'test' : 'live',\r\n      clientKey: isSandbox ? ADYEN_TEST_CLIENT_KEY : ADYEN_LIVE_CLIENT_KEY,\r\n      paymentMethodsConfiguration: {\r\n        card: {\r\n          hasHolderName: true,\r\n          holderNameRequired: true,\r\n        },\r\n      },\r\n      onAdditionalDetails: async (state: AdyenAdditionalEventData) => {\r\n        try {\r\n          setProcessing(true);\r\n\r\n          await checkoutController.finalizeAdyenPayment(state.data.details, paymentMethodId);\r\n\r\n          navigate(paymentSuccessUrl, { replace: true });\r\n        } catch (error: unknown) {\r\n          if (error instanceof Error) {\r\n            setPaymentError(error.message);\r\n            setProcessing(false);\r\n          }\r\n        }\r\n      },\r\n      onSubmit: (state: AdyenEventData, component: DropinElement) => onSubmit(state, component.handleAction),\r\n      onError: (error: Error) => setPaymentError(error.message),\r\n    }),\r\n    [session, isSandbox, setProcessing, paymentMethodId, navigate, paymentSuccessUrl, setPaymentError, onSubmit, checkoutController],\r\n  );\r\n\r\n  return <Adyen configuration={adyenConfiguration} type={type} error={error} />;\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useCheckoutStore } from '@jwp/ott-common/src/stores/CheckoutStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\n\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport PaymentMethodForm from '../../components/PaymentMethodForm/PaymentMethodForm';\r\nimport PayPal from '../../components/PayPal/PayPal';\r\nimport AdyenPaymentDetails from '../AdyenPaymentDetails/AdyenPaymentDetails';\r\nimport { modalURLFromWindowLocation } from '../../utils/location';\r\n\r\ntype Props = {\r\n  onCloseButtonClick: () => void;\r\n};\r\n\r\nconst UpdatePaymentMethod = ({ onCloseButtonClick }: Props) => {\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const updateSuccess = useQueryParam('u') === 'payment-method-success';\r\n  const paymentMethodIdQueryParam = useQueryParam('paymentMethodId');\r\n  const parsedPaymentMethodId = paymentMethodIdQueryParam ? parseInt(paymentMethodIdQueryParam) : undefined;\r\n\r\n  const activePayment = useAccountStore((state) => state.activePayment);\r\n  const currentPaymentId = activePayment?.id;\r\n  const [paymentError, setPaymentError] = useState<string | undefined>(undefined);\r\n  const [paymentMethodId, setPaymentMethodId] = useState<number | undefined>(parsedPaymentMethodId);\r\n\r\n  const paymentMethods = useCheckoutStore((state) => state.paymentMethods);\r\n\r\n  const [processing, setProcessing] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    checkoutController.getPaymentMethods();\r\n  }, [checkoutController]);\r\n\r\n  const handlePaymentMethodChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const toPaymentMethodId = parseInt(event.target.value);\r\n\r\n    setPaymentMethodId(toPaymentMethodId);\r\n    setPaymentError(undefined);\r\n  };\r\n\r\n  const handlePayPalSubmit = async () => {\r\n    setProcessing(true);\r\n\r\n    try {\r\n      setPaymentError(undefined);\r\n\r\n      const successUrl = modalURLFromWindowLocation('payment-method-success');\r\n      const waitingUrl = modalURLFromWindowLocation('waiting-for-payment');\r\n      const cancelUrl = modalURLFromWindowLocation('payment-cancelled');\r\n      const errorUrl = modalURLFromWindowLocation('payment-error');\r\n\r\n      const response = await checkoutController.updatePayPalPaymentMethod(\r\n        successUrl,\r\n        waitingUrl,\r\n        cancelUrl,\r\n        errorUrl,\r\n        paymentMethodId as number,\r\n        currentPaymentId,\r\n      );\r\n\r\n      if (response) {\r\n        window.location.href = response.redirectUrl;\r\n      }\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        setPaymentError(error.message);\r\n      }\r\n    }\r\n    setProcessing(false);\r\n  };\r\n\r\n  const renderPaymentMethod = () => {\r\n    const paymentMethod = paymentMethods?.find((method) => method.id === paymentMethodId);\r\n\r\n    if (paymentMethod?.methodName === 'card') {\r\n      return (\r\n        <AdyenPaymentDetails\r\n          paymentMethodId={paymentMethod.id}\r\n          setPaymentError={setPaymentError}\r\n          setProcessing={setProcessing}\r\n          error={paymentError}\r\n          type=\"card\"\r\n        />\r\n      );\r\n    } else if (paymentMethod?.methodName === 'paypal') {\r\n      return <PayPal onSubmit={handlePayPalSubmit} error={paymentError || null} />;\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  // loading state\r\n  if (!paymentMethods) {\r\n    return (\r\n      <div style={{ height: 300 }}>\r\n        <LoadingOverlay inline />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PaymentMethodForm\r\n      onCloseButtonClick={onCloseButtonClick}\r\n      paymentMethods={paymentMethods}\r\n      paymentMethodId={paymentMethodId}\r\n      onPaymentMethodChange={handlePaymentMethodChange}\r\n      renderPaymentMethod={renderPaymentMethod}\r\n      updateSuccess={updateSuccess}\r\n      submitting={processing}\r\n    />\r\n  );\r\n};\r\n\r\nexport default UpdatePaymentMethod;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\n\r\nimport styles from './EditCardDetailsForm.module.scss';\r\n\r\ntype Props = {\r\n  renderPaymentMethod?: () => JSX.Element | null;\r\n  submitting: boolean;\r\n  onCancel: () => void;\r\n};\r\n\r\nconst EditCardDetailsForm: React.FC<Props> = ({ renderPaymentMethod, submitting, onCancel }) => {\r\n  const { t } = useTranslation(['common', 'user']);\r\n  return (\r\n    <div>\r\n      <div className={styles.title}>\r\n        <h1>{t('user:payment.add_card_details')}</h1>\r\n      </div>\r\n      <div>{renderPaymentMethod ? renderPaymentMethod() : null}</div>\r\n      <Button onClick={onCancel} className={styles.cancelButton} fullWidth label={t('common:confirmation_dialog.close')} />\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditCardDetailsForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport TextField from '../TextField/TextField';\r\n\r\ntype Props = {\r\n  onChange?: React.ChangeEventHandler<HTMLInputElement>;\r\n  onBlur?: React.FocusEventHandler<HTMLInputElement>;\r\n  error?: string;\r\n  value?: string;\r\n};\r\n\r\nconst CreditCardCVCField: React.FC<Props> = ({ value, onChange, error, ...props }: Props) => {\r\n  const { t } = useTranslation('user');\r\n  const formatCVC: React.ChangeEventHandler<HTMLInputElement> = (e) => {\r\n    const clearValue = e.target.value.replace(/\\D+/g, '');\r\n    if (onChange) {\r\n      e.target.value = clearValue.slice(0, 4);\r\n      onChange(e);\r\n    }\r\n  };\r\n  return (\r\n    <TextField\r\n      label={t('payment.security_code')}\r\n      aria-label={t('payment.security_code')}\r\n      {...props}\r\n      error={!!error}\r\n      helperText={error ? error : null}\r\n      name=\"cardCVC\"\r\n      className=\"directPostSecurityCode\"\r\n      type=\"text\"\r\n      value={value}\r\n      onChange={formatCVC}\r\n      pattern=\"\\d*\"\r\n      placeholder=\"###\"\r\n      autoComplete=\"cc-csc\"\r\n      required\r\n    />\r\n  );\r\n};\r\n\r\nexport default CreditCardCVCField;\r\n","import React from 'react';\r\n\r\nimport TextField from '../TextField/TextField';\r\n\r\ntype Props = {\r\n  onChange?: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  onBlur?: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  error?: string;\r\n  value?: string;\r\n};\r\n\r\nconst CreditCardExpiryField: React.FC<Props> = ({ value, onChange, error, ...props }: Props) => {\r\n  const formatExpirationDate: React.ChangeEventHandler<HTMLInputElement> = (e) => {\r\n    let clearValue = e.target.value.replace(/\\D+/g, '');\r\n\r\n    if (clearValue.length === 1) {\r\n      if (Number(clearValue) > 1) {\r\n        clearValue = '0' + clearValue;\r\n      }\r\n    } else if (clearValue.length === 2) {\r\n      if (Number(clearValue) > 12) {\r\n        clearValue = '12';\r\n      }\r\n    }\r\n\r\n    if (clearValue.length >= 3) {\r\n      e.target.value = `${clearValue.slice(0, 2)}/${clearValue.slice(2, 4)}`;\r\n    } else {\r\n      e.target.value = clearValue;\r\n    }\r\n    if (onChange) {\r\n      onChange(e);\r\n    }\r\n  };\r\n  return (\r\n    <TextField\r\n      label={`Expiry date`}\r\n      {...props}\r\n      name=\"cardExpiry\"\r\n      className=\"directPostExpiryDate\"\r\n      value={value}\r\n      error={!!error}\r\n      helperText={error ? error : null}\r\n      onChange={formatExpirationDate}\r\n      type=\"text\"\r\n      pattern=\"\\d*\"\r\n      placeholder=\"MM/YY\"\r\n      autoComplete=\"cc-exp\"\r\n      required\r\n    />\r\n  );\r\n};\r\n\r\nexport default CreditCardExpiryField;\r\n","import React, { useState } from 'react';\r\nimport Payment from 'payment';\r\n\r\nimport TextField from '../TextField/TextField';\r\n\r\nimport styles from './CreditCardNumberField.module.scss';\r\n\r\ntype Props = {\r\n  onChange?: React.ChangeEventHandler<HTMLInputElement>;\r\n  onBlur?: React.FocusEventHandler<HTMLInputElement>;\r\n  error?: string;\r\n  value?: string;\r\n};\r\n\r\nconst cardIssuers: { [key: string]: string } = {\r\n  visa: '/images/payments/visa.svg',\r\n  mastercard: '/images/payments/mastercard.svg',\r\n  maestro: '/images/payments/maestro.svg',\r\n  amex: '/images/payments/amex.svg',\r\n  discover: '/images/payments/discover.svg',\r\n  diners: '/images/payments/diners.svg',\r\n  dinersclub: '/images/payments/diners.svg',\r\n  unionpay: '/images/payments/unionpay.svg',\r\n  hiper: '/images/payments/hiper.svg',\r\n};\r\n\r\nconst CreditCardNumberField: React.FC<Props> = ({ value, error, onChange, onBlur, ...props }: Props) => {\r\n  const [cardIssuer, setCardIssuer] = useState<JSX.Element | null>(null);\r\n\r\n  const formatCreditCardNumber: React.ChangeEventHandler<HTMLInputElement> = (e) => {\r\n    const issuer = Payment.fns.cardType(e.target?.value);\r\n    const clearValue = e.target?.value.replace(/\\D+/g, '');\r\n\r\n    let nextValue;\r\n    setCardIssuer(\r\n      cardIssuers?.[issuer] ? (\r\n        <div className={styles.cardTypeWrapper}>\r\n          <img src={cardIssuers[issuer]} alt={issuer} height=\"25\" />\r\n        </div>\r\n      ) : null,\r\n    );\r\n\r\n    switch (issuer) {\r\n      case 'amex':\r\n        nextValue = `${clearValue.slice(0, 4)} ${clearValue.slice(4, 10)} ${clearValue.slice(10, 15)}`;\r\n        break;\r\n      case 'dinersclub':\r\n        nextValue = `${clearValue.slice(0, 4)} ${clearValue.slice(4, 10)} ${clearValue.slice(10, 14)}`;\r\n        break;\r\n      default:\r\n        nextValue = `${clearValue.slice(0, 4)} ${clearValue.slice(4, 8)} ${clearValue.slice(8, 12)} ${clearValue.slice(12, 16)}`;\r\n        break;\r\n    }\r\n\r\n    if (onChange) {\r\n      e.target.value = nextValue.trim();\r\n      onChange(e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <TextField\r\n      value={value}\r\n      name=\"cardNumber\"\r\n      label={`Card number`}\r\n      className=\"directPostCreditCardNumber\"\r\n      onChange={formatCreditCardNumber}\r\n      onBlur={onBlur}\r\n      error={!!error}\r\n      helperText={error ? error : null}\r\n      pattern=\"\\d*\"\r\n      {...props}\r\n      type=\"text\"\r\n      placeholder=\"1234 5678 9012 3456\"\r\n      rightControl={cardIssuer}\r\n      autoComplete=\"cc-number\"\r\n      required\r\n    />\r\n  );\r\n};\r\n\r\nexport default CreditCardNumberField;\r\n","import { useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Payment from 'payment';\r\nimport { object, string } from 'yup';\r\nimport { useMutation } from 'react-query';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\n\r\nimport Button from '../Button/Button';\r\nimport CreditCardCVCField from '../form-fields/CreditCardCVCField/CreditCardCVCField';\r\nimport CreditCardExpiryField from '../form-fields/CreditCardExpiryField/CreditCardExpiryField';\r\nimport CreditCardNumberField from '../form-fields/CreditCardNumberField/CreditCardNumberField';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport styles from './EditCardPaymentForm.module.scss';\r\n\r\ntype EditCardPaymentFormData = {\r\n  cardholderName: string;\r\n  cardNumber: string;\r\n  cardExpiry: string;\r\n  cardCVC: string;\r\n  cardExpMonth: string;\r\n  cardExpYear: string;\r\n};\r\n\r\ntype Props = {\r\n  onCancel: () => void;\r\n  setUpdatingCardDetails: (e: boolean) => void;\r\n};\r\n\r\nconst EditCardPaymentForm: React.FC<Props> = ({ onCancel, setUpdatingCardDetails }) => {\r\n  const accountController = getModule(AccountController);\r\n  const announce = useAriaAnnouncer();\r\n\r\n  const { t } = useTranslation('account');\r\n  const { mutate: mutateCardDetails, isLoading } = useMutation(accountController.updateCardDetails);\r\n  const { activePayment } = useAccountStore(({ activePayment }) => ({ activePayment }), shallow);\r\n\r\n  const paymentData = useForm<EditCardPaymentFormData>({\r\n    initialValues: { cardholderName: '', cardNumber: '', cardExpiry: '', cardCVC: '', cardExpMonth: '', cardExpYear: '' },\r\n    validationSchema: object().shape({\r\n      cardholderName: string().required(),\r\n      cardNumber: string()\r\n        .required()\r\n        .test('card number validation', t('checkout.invalid_card_number'), (value) => {\r\n          return Payment.fns.validateCardNumber(value as string);\r\n        }),\r\n      cardExpiry: string()\r\n        .required()\r\n        .test('card expiry validation', t('checkout.invalid_card_expiry'), (value) => {\r\n          return Payment.fns.validateCardExpiry(value as string);\r\n        }),\r\n      cardCVC: string()\r\n        .required()\r\n        .test('cvc validation', t('checkout.invalid_cvc_number'), (value) => {\r\n          const issuer = Payment.fns.cardType(paymentData?.values?.cardNumber);\r\n\r\n          return Payment.fns.validateCardCVC(value as string, issuer);\r\n        }),\r\n      cardExpMonth: string().required(),\r\n      cardExpYear: string().required(),\r\n    }),\r\n    validateOnBlur: true,\r\n    onSubmit: async () => {\r\n      setUpdatingCardDetails(true);\r\n      mutateCardDetails(\r\n        {\r\n          cardName: paymentData.values.cardholderName,\r\n          cardNumber: paymentData.values.cardNumber.replace(/\\s+/g, ''),\r\n          cvc: parseInt(paymentData.values.cardCVC),\r\n          expMonth: parseInt(paymentData.values.cardExpMonth),\r\n          expYear: parseInt(paymentData.values.cardExpYear),\r\n          currency: activePayment?.currency || '',\r\n        },\r\n        {\r\n          onSettled: () => onCancel(),\r\n          onSuccess: () => {\r\n            announce(t('checkout.card_details_updated'), 'success');\r\n          },\r\n        },\r\n      );\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (paymentData.values.cardExpiry) {\r\n      const expiry = Payment.fns.cardExpiryVal(paymentData.values.cardExpiry);\r\n      if (expiry.month) {\r\n        paymentData.setValue('cardExpMonth', expiry.month.toString());\r\n      }\r\n      if (expiry.year) {\r\n        paymentData.setValue('cardExpYear', expiry.year.toString());\r\n      }\r\n    }\r\n    //eslint-disable-next-line\r\n  }, [paymentData.values.cardExpiry]);\r\n\r\n  return (\r\n    <div className={styles.paymentForm}>\r\n      <div>\r\n        <TextField\r\n          label={t('checkout.card_holder_name')}\r\n          name=\"cardholderName\"\r\n          value={paymentData?.values?.cardholderName}\r\n          onChange={paymentData?.handleChange}\r\n          onBlur={paymentData?.handleBlur}\r\n          placeholder={t('checkout.credit_card_name')}\r\n          autoComplete=\"cc-name\"\r\n          required\r\n        />\r\n      </div>\r\n      <div>\r\n        <CreditCardNumberField\r\n          value={paymentData?.values?.cardNumber?.toString()}\r\n          error={paymentData?.errors?.cardNumber}\r\n          onBlur={paymentData?.handleBlur}\r\n          onChange={paymentData?.handleChange}\r\n        />\r\n      </div>\r\n      <div className={styles.columns}>\r\n        <div>\r\n          <CreditCardExpiryField\r\n            value={paymentData?.values?.cardExpiry}\r\n            onBlur={paymentData?.handleBlur}\r\n            onChange={paymentData?.handleChange}\r\n            error={paymentData?.errors?.cardExpiry}\r\n          />\r\n        </div>\r\n        <div>\r\n          <CreditCardCVCField\r\n            value={paymentData?.values?.cardCVC}\r\n            onBlur={paymentData?.handleBlur}\r\n            onChange={paymentData?.handleChange}\r\n            error={paymentData?.errors?.cardCVC}\r\n          />\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <Button\r\n          disabled={isLoading}\r\n          label={t('checkout.save')}\r\n          variant=\"contained\"\r\n          onClick={paymentData.handleSubmit as () => void}\r\n          type=\"submit\"\r\n          color=\"primary\"\r\n          size=\"large\"\r\n          fullWidth\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditCardPaymentForm;\r\n","import React, { useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\n\r\nimport EditCardDetailsForm from '../../../components/EditForm/EditCardDetailsForm';\r\nimport EditCardPaymentForm from '../../../components/EditCardPaymentForm/EditCardPaymentForm';\r\n\r\nconst EditCardDetails = () => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const [updatingCardDetails, setUpdatingCardDetails] = useState(false);\r\n\r\n  const closeHandler = () => {\r\n    navigate(modalURLFromLocation(location, null), { replace: false });\r\n  };\r\n\r\n  const renderPaymentMethod = () => {\r\n    return <EditCardPaymentForm onCancel={closeHandler} setUpdatingCardDetails={setUpdatingCardDetails} />;\r\n  };\r\n\r\n  return <EditCardDetailsForm onCancel={closeHandler} renderPaymentMethod={renderPaymentMethod} submitting={updatingCardDetails} />;\r\n};\r\n\r\nexport default EditCardDetails;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { EditPasswordFormData } from '@jwp/ott-common/types/account';\r\nimport type { FormErrors } from '@jwp/ott-common/types/form';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport PasswordField from '../form-fields/PasswordField/PasswordField';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\n\r\nimport styles from './EditPasswordForm.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  setValue?: (key: keyof EditPasswordFormData, value: string) => void;\r\n  onBlur: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  error?: string;\r\n  errors: FormErrors<EditPasswordFormData>;\r\n  value: EditPasswordFormData;\r\n  validationError?: boolean;\r\n  submitting: boolean;\r\n  showOldPasswordField?: boolean;\r\n  showResetTokenField?: boolean;\r\n  email?: string;\r\n  onResendEmailClick?: () => void;\r\n};\r\n\r\nconst EditPasswordForm: React.FC<Props> = ({\r\n  onSubmit,\r\n  onChange,\r\n  onBlur,\r\n  showOldPasswordField,\r\n  showResetTokenField,\r\n  value,\r\n  errors,\r\n  submitting,\r\n  validationError,\r\n  email,\r\n  onResendEmailClick,\r\n}: Props) => {\r\n  const { t } = useTranslation(['account', 'user']);\r\n  return (\r\n    <form onSubmit={onSubmit} data-testid={testId('forgot-password-form')} noValidate>\r\n      {errors.form && (\r\n        <FormFeedback variant=\"error\" visible={!validationError}>\r\n          {errors.form}\r\n        </FormFeedback>\r\n      )}\r\n      <h2 className={styles.title}>{showOldPasswordField && showResetTokenField ? t('user:account.add_password') : t('reset.password_reset')}</h2>\r\n      {showOldPasswordField && showResetTokenField && (\r\n        <p className={styles.paragraph}>\r\n          {t('user:account.add_password_modal_text', { email: email })}\r\n          <a className={styles.resendLink} onClick={onResendEmailClick}>\r\n            {t('user:account.resend_mail')}\r\n          </a>\r\n        </p>\r\n      )}\r\n      {showOldPasswordField && !showResetTokenField && (\r\n        <PasswordField\r\n          value={value.oldPassword}\r\n          onChange={onChange}\r\n          onBlur={onBlur}\r\n          label={t('reset.old_password')}\r\n          placeholder={t('reset.old_password')}\r\n          error={!!errors.oldPassword}\r\n          name=\"oldPassword\"\r\n          showToggleView={false}\r\n          showHelperText={false}\r\n          autoComplete=\"current-password\"\r\n          required\r\n        />\r\n      )}\r\n      {showResetTokenField && (\r\n        <TextField\r\n          className={styles.textField}\r\n          value={value.resetPasswordToken || ''}\r\n          onChange={onChange}\r\n          onBlur={onBlur}\r\n          label={t('reset.reset_password_token')}\r\n          placeholder={t('reset.reset_password_token')}\r\n          name=\"resetPasswordToken\"\r\n          type=\"text\"\r\n          autoComplete=\"\"\r\n          required\r\n        />\r\n      )}\r\n\r\n      <PasswordField\r\n        value={value.password}\r\n        onChange={onChange}\r\n        onBlur={onBlur}\r\n        label={t('reset.new_password')}\r\n        placeholder={t('reset.password')}\r\n        error={!!errors.password}\r\n        name=\"password\"\r\n        autoComplete=\"new-password\"\r\n        required\r\n      />\r\n\r\n      <PasswordField\r\n        value={value.passwordConfirmation}\r\n        onChange={onChange}\r\n        onBlur={onBlur}\r\n        label={t('reset.repeat_new_password')}\r\n        placeholder={t('reset.repeat_new_password')}\r\n        error={!!errors.passwordConfirmation}\r\n        name=\"passwordConfirmation\"\r\n        autoComplete=\"new-password\"\r\n        showHelperText={false}\r\n        required\r\n      />\r\n\r\n      <Button type=\"submit\" className={styles.button} fullWidth color=\"primary\" disabled={submitting} label={t('reset.confirm')} />\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default EditPasswordForm;\r\n","import React from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { object, string } from 'yup';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { EditPasswordFormData } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport useForm, { type UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\n\r\nimport EditPasswordForm from '../../../components/EditPasswordForm/EditPasswordForm';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst ResetPassword = ({ type }: { type?: 'add' }) => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const resetPasswordTokenParam = useQueryParam('resetPasswordToken');\r\n  const emailParam = useQueryParam('email');\r\n  const email = useAccountStore((state) => state.user?.email);\r\n  const user = useAccountStore.getState().user;\r\n\r\n  const passwordSubmitHandler: UseFormOnSubmitHandler<EditPasswordFormData> = async (formData, { setErrors, setSubmitting }) => {\r\n    const { oldPassword, password, passwordConfirmation, resetPasswordToken } = formData;\r\n    if (password !== passwordConfirmation) {\r\n      setErrors({ form: t('reset.passwords_do_not_match') });\r\n\r\n      return setSubmitting(false);\r\n    }\r\n    let resetToken = resetPasswordTokenParam;\r\n    if (resetPasswordToken) {\r\n      resetToken = resetPasswordToken;\r\n    }\r\n    try {\r\n      if (user && !resetToken) {\r\n        await accountController.changePasswordWithOldPassword(oldPassword || '', password, passwordConfirmation);\r\n      } else {\r\n        if (!resetToken) {\r\n          setErrors({ form: t('reset.invalid_link') });\r\n\r\n          return setSubmitting(false);\r\n        }\r\n        await accountController.changePasswordWithToken(emailParam || '', password, resetToken, passwordConfirmation);\r\n      }\r\n\r\n      announce(t('reset.password_reset_success'), 'success');\r\n      await accountController.logout();\r\n      navigate(modalURLFromLocation(location, 'login'));\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        if (error.message.includes('invalid param password')) {\r\n          setErrors({ password: t('reset.invalid_password') });\r\n        } else if (error.message.includes('resetPasswordToken is not valid')) {\r\n          setErrors({ form: t('reset.invalid_reset_link') });\r\n        } else if (error.message.includes('score does not match standards')) {\r\n          setErrors({ form: t('reset.password_strength') });\r\n        } else if (error.message.includes('old password does not match')) {\r\n          setErrors({ form: t('reset.old_password_does_not_match') });\r\n        } else if (error.message.includes('password could not be set')) {\r\n          setErrors({ form: t('reset.invalid_token') });\r\n        }\r\n      }\r\n    }\r\n    setSubmitting(false);\r\n  };\r\n\r\n  const passwordForm = useForm<EditPasswordFormData>({\r\n    initialValues: { password: '', passwordConfirmation: '' },\r\n    validationSchema: object().shape({\r\n      email: string(),\r\n      oldPassword: string(),\r\n      password: string()\r\n        .matches(/^(?=.*[a-z])(?=.*[0-9]).{8,}$/, t('registration.invalid_password'))\r\n        .required(t('login.field_required', { field: t('login.password') })),\r\n      passwordConfirmation: string().required(),\r\n      resetPasswordToken: string(),\r\n    }),\r\n    validateOnBlur: true,\r\n    onSubmit: passwordSubmitHandler,\r\n  });\r\n\r\n  const resendEmailClickHandler = async () => {\r\n    try {\r\n      if (email) {\r\n        await accountController.resetPassword(email, '');\r\n      }\r\n    } catch (error: unknown) {\r\n      passwordForm.setErrors({ form: t('user:account.resend_mail_error') });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <EditPasswordForm\r\n      value={passwordForm.values}\r\n      submitting={passwordForm.submitting}\r\n      onChange={passwordForm.handleChange}\r\n      onBlur={passwordForm.handleBlur}\r\n      errors={passwordForm.errors}\r\n      onSubmit={passwordForm.handleSubmit}\r\n      validationError={passwordForm.validationSchemaError}\r\n      showOldPasswordField={!!(user && !resetPasswordTokenParam)}\r\n      showResetTokenField={type === 'add' || (!user && !resetPasswordTokenParam)}\r\n      email={emailParam || email}\r\n      onResendEmailClick={resendEmailClickHandler}\r\n    />\r\n  );\r\n};\r\n\r\nexport default ResetPassword;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { Customer } from '@jwp/ott-common/types/account';\r\nimport type { Subscription } from '@jwp/ott-common/types/subscription';\r\nimport { formatLocalizedDate, formatPrice } from '@jwp/ott-common/src/utils/formatting';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './RenewSubscriptionForm.module.scss';\r\n\r\ntype Props = {\r\n  subscription: Subscription;\r\n  customer: Customer;\r\n  error: string | null;\r\n  submitting: boolean;\r\n  onConfirm: () => void;\r\n  onClose: () => void;\r\n};\r\n\r\nconst RenewSubscriptionForm: React.FC<Props> = ({ subscription, customer, error, submitting, onConfirm, onClose }: Props) => {\r\n  const { t, i18n } = useTranslation('account');\r\n\r\n  return (\r\n    <div>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <h2 className={styles.title}>{t('renew_subscription.renew_your_subscription')}</h2>\r\n      <p className={styles.paragraph}>{t('renew_subscription.explanation')}</p>\r\n      <div className={styles.infoBox}>\r\n        <p>\r\n          <strong>{subscription.offerTitle}</strong> <br />\r\n          {t('renew_subscription.next_billing_date_on', { date: formatLocalizedDate(new Date(subscription.expiresAt * 1000), i18n.language) })}\r\n        </p>\r\n        <p className={styles.price}>\r\n          <strong>{formatPrice(subscription.nextPaymentPrice, subscription.nextPaymentCurrency, customer.country)}</strong>\r\n          <small>/{t(`periods.${subscription.period}`)}</small>\r\n        </p>\r\n      </div>\r\n      <Button\r\n        className={styles.confirmButton}\r\n        color=\"primary\"\r\n        variant=\"contained\"\r\n        label={t('renew_subscription.renew_subscription')}\r\n        onClick={onConfirm}\r\n        fullWidth\r\n        disabled={submitting}\r\n        type=\"submit\"\r\n      />\r\n      <Button label={t('renew_subscription.no_thanks')} onClick={onClose} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RenewSubscriptionForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { Subscription } from '@jwp/ott-common/types/subscription';\r\nimport type { Customer } from '@jwp/ott-common/types/account';\r\nimport { formatLocalizedDate, formatPrice } from '@jwp/ott-common/src/utils/formatting';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './SubscriptionRenewed.module.scss';\r\n\r\ntype Props = {\r\n  customer: Customer;\r\n  subscription: Subscription;\r\n  onClose: () => void;\r\n};\r\n\r\nconst SubscriptionRenewed: React.FC<Props> = ({ onClose, customer, subscription }: Props) => {\r\n  const { t, i18n } = useTranslation('account');\r\n  const date = formatLocalizedDate(new Date(subscription.expiresAt * 1000), i18n.language);\r\n  const price = formatPrice(subscription.nextPaymentPrice, subscription.nextPaymentCurrency, customer.country);\r\n\r\n  return (\r\n    <div>\r\n      <h2 className={styles.title}>{t('subscription_renewed.title')}</h2>\r\n      <p className={styles.paragraph}>{t('subscription_renewed.message', { date, price })}</p>\r\n      <Button label={t('subscription_renewed.back_to_profile')} onClick={onClose} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SubscriptionRenewed;\r\n","import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\n\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\nimport RenewSubscriptionForm from '../../../components/RenewSubscriptionForm/RenewSubscriptionForm';\r\nimport SubscriptionRenewed from '../../../components/SubscriptionRenewed/SubscriptionRenewed';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst RenewSubscription = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const { subscription, user } = useAccountStore(({ subscription, user }) => ({ subscription, user }), shallow);\r\n  const [renewed, setRenewed] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const renewSubscriptionConfirmHandler = async () => {\r\n    setSubmitting(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await accountController.updateSubscription('active');\r\n      announce(t('renew_subscription.success'), 'success');\r\n      setRenewed(true);\r\n    } catch (error: unknown) {\r\n      setError(t('renew_subscription.unknown_error_occurred'));\r\n    }\r\n\r\n    setSubmitting(false);\r\n  };\r\n\r\n  const closeHandler = () => {\r\n    navigate(modalURLFromLocation(location, null), { replace: true });\r\n  };\r\n\r\n  if (!subscription || !user) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {renewed ? (\r\n        <SubscriptionRenewed onClose={closeHandler} subscription={subscription} customer={user} />\r\n      ) : (\r\n        <RenewSubscriptionForm\r\n          subscription={subscription}\r\n          customer={user}\r\n          error={error}\r\n          onConfirm={renewSubscriptionConfirmHandler}\r\n          onClose={closeHandler}\r\n          submitting={submitting}\r\n        />\r\n      )}\r\n      {submitting ? <LoadingOverlay inline /> : null}\r\n    </React.Fragment>\r\n  );\r\n};\r\nexport default RenewSubscription;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './CancelSubscriptionForm.module.scss';\r\n\r\ntype Props = {\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n  error: string | null;\r\n  submitting: boolean;\r\n};\r\n\r\nconst CancelSubscriptionForm: React.FC<Props> = ({ onConfirm, onCancel, error, submitting }: Props) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  return (\r\n    <div>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <h2 className={styles.title}>{t('cancel_subscription.title')}</h2>\r\n      <p className={styles.paragraph}>{t('cancel_subscription.explanation')}</p>\r\n      <Button\r\n        className={styles.confirmButton}\r\n        label={t('cancel_subscription.unsubscribe')}\r\n        color=\"primary\"\r\n        variant=\"contained\"\r\n        onClick={onConfirm}\r\n        fullWidth\r\n        disabled={submitting}\r\n        type=\"submit\"\r\n      />\r\n      <Button label={t('cancel_subscription.no_thanks')} variant=\"outlined\" onClick={onCancel} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CancelSubscriptionForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './SubscriptionCancelled.module.scss';\r\n\r\ntype Props = {\r\n  expiresDate: string;\r\n  onClose: () => void;\r\n};\r\n\r\nconst SubscriptionCancelled: React.FC<Props> = ({ expiresDate, onClose }: Props) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  return (\r\n    <div className={styles.SubscriptionCancelled}>\r\n      <h2 className={styles.title}>{t('subscription_cancelled.title')}</h2>\r\n      <p className={styles.paragraph}>{t('subscription_cancelled.message', { date: expiresDate })}</p>\r\n      <Button label={t('subscription_cancelled.return_to_profile')} variant=\"outlined\" onClick={onClose} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SubscriptionCancelled;\r\n","import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { formatLocalizedDate } from '@jwp/ott-common/src/utils/formatting';\r\n\r\nimport CancelSubscriptionForm from '../../../components/CancelSubscriptionForm/CancelSubscriptionForm';\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\nimport SubscriptionCancelled from '../../../components/SubscriptionCancelled/SubscriptionCancelled';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst CancelSubscription = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t, i18n } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const subscription = useAccountStore((s) => s.subscription);\r\n  const [cancelled, setCancelled] = useState(false);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const expirationDateFormatted = subscription?.expiresAt ? formatLocalizedDate(new Date(subscription.expiresAt * 1000), i18n.language) : '';\r\n\r\n  const cancelSubscriptionConfirmHandler = async () => {\r\n    setSubmitting(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await accountController.updateSubscription('cancelled');\r\n\r\n      if (expirationDateFormatted) {\r\n        announce(t('subscription_cancelled.message', { date: expirationDateFormatted }), 'success');\r\n      }\r\n\r\n      setCancelled(true);\r\n    } catch (error: unknown) {\r\n      setError(t('cancel_subscription.unknown_error_occurred'));\r\n    }\r\n\r\n    setSubmitting(false);\r\n  };\r\n\r\n  const closeHandler = () => {\r\n    navigate(modalURLFromLocation(location, null), { replace: true });\r\n  };\r\n\r\n  if (!subscription) return null;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {cancelled ? (\r\n        <SubscriptionCancelled expiresDate={expirationDateFormatted} onClose={closeHandler} />\r\n      ) : (\r\n        <CancelSubscriptionForm onConfirm={cancelSubscriptionConfirmHandler} onCancel={closeHandler} submitting={submitting} error={error} />\r\n      )}\r\n      {submitting ? <LoadingOverlay transparentBackground inline /> : null}\r\n    </React.Fragment>\r\n  );\r\n};\r\nexport default CancelSubscription;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './ResetPasswordForm.module.scss';\r\n\r\ntype Props = {\r\n  onCancel: () => void;\r\n  onReset: () => void;\r\n  submitting: boolean;\r\n};\r\n\r\nconst ResetPasswordForm: React.FC<Props> = ({ onCancel, onReset, submitting }: Props) => {\r\n  const { t } = useTranslation('account');\r\n  return (\r\n    <div>\r\n      <h1 className={styles.title}>{t('reset.reset_password')}</h1>\r\n      <p className={styles.text}>{t('reset.text')}</p>\r\n      <Button onClick={onReset} className={styles.button} fullWidth color=\"primary\" label={t('reset.yes')} type=\"submit\" disabled={submitting} />\r\n      <Button onClick={onCancel} fullWidth label={t('reset.no')} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetPasswordForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { ForgotPasswordFormData } from '@jwp/ott-common/types/account';\r\nimport type { FormErrors } from '@jwp/ott-common/types/form';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport Button from '../Button/Button';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './ForgotPasswordForm.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  onBlur: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  error?: string;\r\n  errors: FormErrors<ForgotPasswordFormData>;\r\n  value: ForgotPasswordFormData;\r\n  submitting: boolean;\r\n};\r\n\r\nconst ForgotPasswordForm: React.FC<Props> = ({ onSubmit, onChange, value, errors, submitting, onBlur }: Props) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  return (\r\n    <form onSubmit={onSubmit} data-testid={testId('forgot-password-form')} noValidate>\r\n      <h2 className={styles.title}>{t('reset.forgot_password')}</h2>\r\n      {errors.form ? <FormFeedback variant=\"error\">{errors.form}</FormFeedback> : null}\r\n      <p className={styles.text}>{t('reset.forgot_text')}</p>\r\n      <TextField\r\n        value={value.email}\r\n        onChange={onChange}\r\n        onBlur={onBlur}\r\n        label={t('reset.email')}\r\n        placeholder={t('reset.email')}\r\n        error={!!errors.email || !!errors.form}\r\n        helperText={errors.email}\r\n        name=\"email\"\r\n        type=\"email\"\r\n        autoComplete=\"email\"\r\n        required\r\n      />\r\n      <Button type=\"submit\" className={styles.button} fullWidth color=\"primary\" disabled={submitting} label={t('reset.email_me')} />\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default ForgotPasswordForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Link, useLocation } from 'react-router-dom';\r\n\r\nimport Button from '../Button/Button';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\nimport styles from './ConfirmationForm.module.scss';\r\n\r\ntype Props = {\r\n  email?: string;\r\n  loggedIn?: boolean;\r\n  onBackToLogin: () => void;\r\n};\r\n\r\nconst ConfirmationForm: React.FC<Props> = ({ email, onBackToLogin, loggedIn }: Props) => {\r\n  const { t } = useTranslation('account');\r\n  const location = useLocation();\r\n\r\n  return (\r\n    <div className={styles.forgotPasswordForm}>\r\n      <h2 className={styles.title}>{t('reset.link_sent')}</h2>\r\n      <p className={styles.text}>{t('reset.link_sent_text', { email: email })}</p>\r\n      <Button onClick={onBackToLogin} className={styles.button} fullWidth color=\"primary\" label={t('reset.back_login')} />\r\n      {!loggedIn && (\r\n        <React.Fragment>\r\n          <span className={styles.notSure}>{t('reset.not_sure')}</span>\r\n          <Link className={styles.link} to={modalURLFromLocation(location, 'forgot-password')}>\r\n            {t('reset.try_again')}\r\n          </Link>\r\n        </React.Fragment>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ConfirmationForm;\r\n","import React, { useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { object, string } from 'yup';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { ForgotPasswordFormData } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { logDev } from '@jwp/ott-common/src/utils/common';\r\nimport useForm, { type UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\n\r\nimport ResetPasswordForm from '../../../components/ResetPasswordForm/ResetPasswordForm';\r\nimport ForgotPasswordForm from '../../../components/ForgotPasswordForm/ForgotPasswordForm';\r\nimport ConfirmationForm from '../../../components/ConfirmationForm/ConfirmationForm';\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\n\r\ntype Prop = {\r\n  type: 'confirmation' | 'forgot' | 'reset' | 'edit';\r\n};\r\n\r\nconst ResetPassword: React.FC<Prop> = ({ type }: Prop) => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t } = useTranslation('account');\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [resetPasswordSubmitting, setResetPasswordSubmitting] = useState<boolean>(false);\r\n\r\n  const { canChangePasswordWithOldPassword } = accountController.getFeatures();\r\n  const { customer: user } = useAccountStore(\r\n    ({ user }) => ({\r\n      customer: user,\r\n    }),\r\n    shallow,\r\n  );\r\n  const cancelClickHandler = () => {\r\n    navigate(modalURLFromLocation(location, null));\r\n  };\r\n\r\n  const backToLoginClickHandler = async () => {\r\n    navigate(\r\n      {\r\n        pathname: '/',\r\n        search: 'u=login',\r\n      },\r\n      { replace: true },\r\n    );\r\n\r\n    if (user) {\r\n      await accountController.logout();\r\n    }\r\n  };\r\n\r\n  const resetPasswordClickHandler = async () => {\r\n    const resetUrl = `${window.location.origin}/?u=edit-password`;\r\n    try {\r\n      if (!user?.email) {\r\n        logDev('invalid param email');\r\n        return;\r\n      }\r\n\r\n      setResetPasswordSubmitting(true);\r\n\r\n      await accountController.resetPassword(user.email, resetUrl);\r\n\r\n      setResetPasswordSubmitting(false);\r\n      navigate(modalURLFromLocation(location, 'send-confirmation'));\r\n    } catch (error: unknown) {\r\n      logDev(error instanceof Error ? error.message : error);\r\n    }\r\n  };\r\n\r\n  const emailSubmitHandler: UseFormOnSubmitHandler<ForgotPasswordFormData> = async (formData, { setErrors, setSubmitting }) => {\r\n    const resetUrl = `${window.location.origin}/?u=edit-password`;\r\n\r\n    try {\r\n      await accountController.resetPassword(formData.email, resetUrl);\r\n      const modal = canChangePasswordWithOldPassword ? 'edit-password' : 'send-confirmation';\r\n      navigate(modalURLFromLocation(location, modal));\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        if (error.message.toLowerCase().includes('invalid param email')) {\r\n          setErrors({ email: t('reset.wrong_email') });\r\n        } else {\r\n          setErrors({ form: error.message });\r\n        }\r\n      }\r\n    }\r\n    setSubmitting(false);\r\n  };\r\n\r\n  const emailForm = useForm<ForgotPasswordFormData>({\r\n    initialValues: { email: '' },\r\n    validationSchema: object().shape({\r\n      email: string()\r\n        .email(t('login.field_is_not_valid_email'))\r\n        .required(t('login.field_required', { field: t('login.email') })),\r\n    }),\r\n    validateOnBlur: true,\r\n    onSubmit: emailSubmitHandler,\r\n  });\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {type === 'reset' && <ResetPasswordForm submitting={resetPasswordSubmitting} onCancel={cancelClickHandler} onReset={resetPasswordClickHandler} />}\r\n      {type === 'forgot' && (\r\n        <ForgotPasswordForm\r\n          value={emailForm.values}\r\n          submitting={emailForm.submitting}\r\n          onChange={emailForm.handleChange}\r\n          errors={emailForm.errors}\r\n          onSubmit={emailForm.handleSubmit}\r\n          onBlur={emailForm.handleBlur}\r\n        />\r\n      )}\r\n      {type === 'confirmation' && <ConfirmationForm loggedIn={!!user} email={user?.email || emailForm.values.email} onBackToLogin={backToLoginClickHandler} />}\r\n      {(emailForm.submitting || resetPasswordSubmitting) && <LoadingOverlay transparentBackground inline />}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default ResetPassword;\r\n","import AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport type { FormValidationError } from '@jwp/ott-common/src/errors/FormValidationError';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useCheckoutStore } from '@jwp/ott-common/src/stores/CheckoutStore';\r\nimport { isSVODOffer } from '@jwp/ott-common/src/utils/offers';\r\nimport type { CardPaymentData, Offer, OfferType, Payment } from '@jwp/ott-common/types/checkout';\r\nimport { useEffect } from 'react';\r\nimport { useMutation } from 'react-query';\r\n\r\ntype Props = {\r\n  onUpdateOrderSuccess?: () => void;\r\n  onSubmitPaymentWithoutDetailsSuccess: () => void;\r\n  onSubmitPaypalPaymentSuccess: (response: { redirectUrl: string }) => void;\r\n  onSubmitStripePaymentSuccess: () => void;\r\n};\r\n\r\nconst useCheckout = ({ onUpdateOrderSuccess, onSubmitPaymentWithoutDetailsSuccess, onSubmitPaypalPaymentSuccess, onSubmitStripePaymentSuccess }: Props) => {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const { order, selectedOffer, paymentMethods, setOrder } = useCheckoutStore(({ order, selectedOffer, paymentMethods, setOrder }) => ({\r\n    order,\r\n    selectedOffer,\r\n    paymentMethods,\r\n    setOrder,\r\n  }));\r\n\r\n  const offerType: OfferType = selectedOffer && isSVODOffer(selectedOffer) ? 'svod' : 'tvod';\r\n\r\n  const initialiseOrder = useMutation<void, FormValidationError, { offer: Offer }>({\r\n    mutationKey: ['initialiseOrder'],\r\n    mutationFn: async ({ offer }) => !!offer && checkoutController.initialiseOrder(offer),\r\n  });\r\n\r\n  const updateOrder = useMutation<void, string, { paymentMethodId: number; couponCode: string }>({\r\n    mutationKey: ['updateOrder'],\r\n    mutationFn: async ({ paymentMethodId, couponCode }) => {\r\n      if (!order || !paymentMethodId) return;\r\n\r\n      return await checkoutController.updateOrder(order, paymentMethodId, couponCode);\r\n    },\r\n    onSuccess: onUpdateOrderSuccess,\r\n  });\r\n\r\n  const submitPaymentWithoutDetails = useMutation<Payment, Error>({\r\n    mutationKey: ['submitPaymentWithoutDetails'],\r\n    mutationFn: checkoutController.paymentWithoutDetails,\r\n    onSuccess: async () => {\r\n      await accountController.reloadSubscriptions({ retry: 10 });\r\n      onSubmitPaymentWithoutDetailsSuccess();\r\n    },\r\n  });\r\n\r\n  const submitPaymentPaypal = useMutation<\r\n    { redirectUrl: string },\r\n    Error,\r\n    { successUrl: string; waitingUrl: string; cancelUrl: string; errorUrl: string; couponCode: string }\r\n  >({\r\n    mutationKey: ['submitPaymentPaypal'],\r\n    mutationFn: checkoutController.paypalPayment,\r\n    onSuccess: onSubmitPaypalPaymentSuccess,\r\n  });\r\n\r\n  const submitPaymentStripe = useMutation<boolean, Error, { cardPaymentPayload: CardPaymentData; referrer: string; returnUrl: string }>({\r\n    mutationKey: ['submitPaymentStripe'],\r\n    mutationFn: checkoutController.directPostCardPayment,\r\n    onSuccess: onSubmitStripePaymentSuccess,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (selectedOffer && !order && !initialiseOrder.isLoading && !initialiseOrder.isError) {\r\n      initialiseOrder.mutate({ offer: selectedOffer });\r\n    }\r\n  }, [selectedOffer, order, initialiseOrder]);\r\n\r\n  // Clear the order when unmounted\r\n  useEffect(() => {\r\n    return () => setOrder(null);\r\n  }, [setOrder]);\r\n\r\n  const isSubmitting =\r\n    initialiseOrder.isLoading ||\r\n    updateOrder.isLoading ||\r\n    submitPaymentWithoutDetails.isLoading ||\r\n    submitPaymentPaypal.isLoading ||\r\n    submitPaymentStripe.isLoading;\r\n\r\n  return {\r\n    selectedOffer,\r\n    offerType,\r\n    paymentMethods,\r\n    order,\r\n    isSubmitting,\r\n    updateOrder,\r\n    submitPaymentWithoutDetails,\r\n    submitPaymentPaypal,\r\n    submitPaymentStripe,\r\n  };\r\n};\r\n\r\nexport default useCheckout;\r\n","import * as React from \"react\";\nconst SvgArrowLeft = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z\" }));\nexport default SvgArrowLeft;\n","import React from 'react';\r\nimport ArrowLeft from '@jwp/ott-theme/assets/icons/arrow_left.svg?react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Icon from '../Icon/Icon';\r\nimport IconButton from '../IconButton/IconButton';\r\n\r\nimport styles from './DialogBackButton.module.scss';\r\n\r\ntype Props = {\r\n  onClick?: () => void;\r\n};\r\n\r\nconst DialogBackButton: React.FC<Props> = ({ onClick }: Props) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <IconButton onClick={onClick} className={styles.dialogBackButton} aria-label={t('common:back')}>\r\n      <Icon icon={ArrowLeft} />\r\n    </IconButton>\r\n  );\r\n};\r\n\r\nexport default DialogBackButton;\r\n","import React, { type ReactNode } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport type { Offer, OfferType, Order, PaymentMethod } from '@jwp/ott-common/types/checkout';\r\nimport { formatPrice } from '@jwp/ott-common/src/utils/formatting';\r\nimport Close from '@jwp/ott-theme/assets/icons/close.svg?react';\r\nimport PayPal from '@jwp/ott-theme/assets/icons/paypal.svg?react';\r\nimport CreditCard from '@jwp/ott-theme/assets/icons/creditcard.svg?react';\r\n\r\nimport Button from '../Button/Button';\r\nimport IconButton from '../IconButton/IconButton';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport DialogBackButton from '../DialogBackButton/DialogBackButton';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './CheckoutForm.module.scss';\r\n\r\ntype Props = {\r\n  paymentMethodId?: string;\r\n  onBackButtonClick: () => void;\r\n  paymentMethods?: PaymentMethod[];\r\n  onPaymentMethodChange: React.ChangeEventHandler<HTMLInputElement>;\r\n  onCouponFormSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onCouponInputChange: React.ChangeEventHandler<HTMLInputElement>;\r\n  onRedeemCouponButtonClick: () => void;\r\n  onCloseCouponFormClick: () => void;\r\n  error?: string;\r\n  couponFormOpen: boolean;\r\n  couponFormError?: string;\r\n  couponFormApplied?: boolean;\r\n  couponFormSubmitting?: boolean;\r\n  couponInputValue: string;\r\n  order: Order;\r\n  offer: Offer;\r\n  offerType: OfferType;\r\n  children: ReactNode;\r\n  submitting: boolean;\r\n};\r\n\r\nconst CheckoutForm: React.FC<Props> = ({\r\n  paymentMethodId,\r\n  paymentMethods,\r\n  order,\r\n  offer,\r\n  offerType,\r\n  onBackButtonClick,\r\n  onPaymentMethodChange,\r\n  error,\r\n  couponFormOpen,\r\n  couponInputValue,\r\n  couponFormError,\r\n  couponFormApplied,\r\n  couponFormSubmitting,\r\n  onCouponInputChange,\r\n  onCloseCouponFormClick,\r\n  onCouponFormSubmit,\r\n  onRedeemCouponButtonClick,\r\n  children,\r\n  submitting,\r\n}) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  const getOfferPeriod = () => {\r\n    // t('periods.day', { count })\r\n    // t('periods.week', { count })\r\n    // t('periods.month', { count })\r\n    // t('periods.year', { count })\r\n    return offer ? t(`periods.${offer.period}`) : '';\r\n  };\r\n\r\n  const getFreeTrialText = (offer: Offer) => {\r\n    if (offer.freeDays) {\r\n      return t('checkout.days_trial', { count: offer.freeDays });\r\n    } else if (offer.freePeriods) {\r\n      // t('periods.day', { count })\r\n      // t('periods.week', { count })\r\n      // t('periods.month', { count })\r\n      // t('periods.year', { count })\r\n      const period = t(`periods.${offer.period}`, { count: offer.freePeriods });\r\n\r\n      return t('checkout.periods_trial', { count: offer.freePeriods, period });\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  const cardPaymentMethod = paymentMethods?.find((method) => method.methodName === 'card');\r\n  const paypalPaymentMethod = paymentMethods?.find((method) => method.methodName === 'paypal');\r\n\r\n  const orderTitle = offerType === 'svod' ? (offer.period === 'month' ? t('checkout.monthly') : t('checkout.yearly')) : offer.offerTitle;\r\n  return (\r\n    <div>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <h1 className={styles.title}>{t('checkout.payment_method')}</h1>\r\n      <div className={styles.order}>\r\n        <div className={styles.orderInfo}>\r\n          <p className={classNames(styles.orderTitle, { [styles.orderTitleMargin]: offerType === 'svod' })}>{orderTitle}</p>\r\n          {order.discount?.type === 'trial' ? <p className={styles.orderBillingDate}>{getFreeTrialText(offer)}</p> : null}\r\n        </div>\r\n        <div className={styles.orderPrice}>\r\n          <span>{formatPrice(offer.customerPriceInclTax, order.currency, offer.customerCountry)}</span>\r\n          {offerType === 'svod' && <small>/{getOfferPeriod()}</small>}\r\n        </div>\r\n      </div>\r\n      <div className={styles.couponForm}>\r\n        {couponFormOpen ? (\r\n          <form onSubmit={onCouponFormSubmit} noValidate>\r\n            <div className={styles.redeemCoupon}>\r\n              <IconButton aria-label=\"Close coupon form\" onClick={onCloseCouponFormClick}>\r\n                <Icon icon={Close} />\r\n              </IconButton>\r\n              <input\r\n                className={styles.couponInput}\r\n                name=\"couponCode\"\r\n                type=\"text\"\r\n                placeholder=\"Coupon code\"\r\n                value={couponInputValue}\r\n                onChange={onCouponInputChange}\r\n              />\r\n              <Button variant=\"outlined\" label=\"Apply\" type=\"submit\" disabled={couponFormSubmitting} />\r\n            </div>\r\n            {couponFormError ? <FormFeedback variant=\"error\">{couponFormError}</FormFeedback> : null}\r\n            {couponFormApplied ? <FormFeedback variant=\"success\">{t('checkout.coupon_applied')}</FormFeedback> : null}\r\n          </form>\r\n        ) : (\r\n          <Button variant=\"outlined\" label={t('checkout.redeem_coupon')} onClick={onRedeemCouponButtonClick} />\r\n        )}\r\n      </div>\r\n      <div>\r\n        <table className={styles.orderTotals}>\r\n          <tbody>\r\n            {order.discount?.applied && order.discount?.type === 'coupon' ? (\r\n              <tr>\r\n                <td className={styles.couponCell}>\r\n                  {t('checkout.coupon_discount')}\r\n                  <br />\r\n                  {!!offer.period && offerType === 'svod' && (\r\n                    <small>\r\n                      {t('checkout.discount_period', {\r\n                        count: order.discount?.periods,\r\n                        period: t(`periods.${offer.period}`, { count: order.discount?.periods }),\r\n                      })}\r\n                    </small>\r\n                  )}\r\n                </td>\r\n                <td>{formatPrice(-order.priceBreakdown.discountAmount * (1 + order.taxRate), order.currency, offer.customerCountry)}</td>\r\n              </tr>\r\n            ) : null}\r\n            {order.discount?.applied && order.discount?.type === 'trial' ? (\r\n              <tr>\r\n                <td className={styles.couponCell}>{t('checkout.free_trial_discount')}</td>\r\n                <td>{formatPrice(-offer.customerPriceInclTax, order.currency, offer.customerCountry)}</td>\r\n              </tr>\r\n            ) : null}\r\n            {order.priceBreakdown.paymentMethodFee > 0 && (\r\n              <tr>\r\n                <td>{t('checkout.payment_method_fee')}</td>\r\n                <td>{formatPrice(order.priceBreakdown.paymentMethodFee, order.currency, offer.customerCountry)}</td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n          <tfoot>\r\n            <tr>\r\n              <td>{t('checkout.total_price')}</td>\r\n              <td>{formatPrice(order.totalPrice, order.currency, offer.customerCountry)}</td>\r\n            </tr>\r\n            {order.priceBreakdown.taxValue > 0 && (\r\n              <tr>\r\n                <td>{t('checkout.applicable_tax', { taxRate: Math.round(order.taxRate * 100) })}</td>\r\n                <td>{formatPrice(order.priceBreakdown.taxValue, order.currency, offer.customerCountry)}</td>\r\n              </tr>\r\n            )}\r\n          </tfoot>\r\n        </table>\r\n      </div>\r\n      <hr className={styles.divider} />\r\n      {order.requiredPaymentDetails ? (\r\n        <div className={styles.paymentMethods}>\r\n          {cardPaymentMethod ? (\r\n            <div className={styles.paymentMethod}>\r\n              <input\r\n                className={styles.radio}\r\n                type=\"radio\"\r\n                name=\"paymentMethodId\"\r\n                value={cardPaymentMethod.id}\r\n                id=\"card\"\r\n                checked={paymentMethodId === cardPaymentMethod.id.toString()}\r\n                onChange={onPaymentMethodChange}\r\n              />\r\n              <label className={styles.paymentMethodLabel} htmlFor=\"card\">\r\n                <Icon icon={CreditCard} /> {t('checkout.credit_card')}\r\n              </label>\r\n            </div>\r\n          ) : null}\r\n          {paypalPaymentMethod ? (\r\n            <div className={styles.paymentMethod}>\r\n              <input\r\n                className={styles.radio}\r\n                type=\"radio\"\r\n                name=\"paymentMethodId\"\r\n                value={paypalPaymentMethod.id}\r\n                id=\"paypal\"\r\n                checked={paymentMethodId === paypalPaymentMethod.id.toString()}\r\n                onChange={onPaymentMethodChange}\r\n              />\r\n              <label className={styles.paymentMethodLabel} htmlFor=\"paypal\">\r\n                <Icon icon={PayPal} /> {t('checkout.paypal')}\r\n              </label>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      ) : null}\r\n      {children ? <div>{children}</div> : null}\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n      <DialogBackButton onClick={onBackButtonClick} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CheckoutForm;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './NoPaymentRequired.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit?: () => void;\r\n  error: string | null;\r\n};\r\n\r\nconst NoPaymentRequired: React.FC<Props> = ({ onSubmit, error }) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  return (\r\n    <div className={styles.noPaymentRequired}>\r\n      {error ? <FormFeedback variant=\"error\">{error}</FormFeedback> : null}\r\n      <p>{t('checkout.no_payment_needed')}</p>\r\n      <Button label={t('checkout.continue')} variant=\"contained\" color=\"primary\" size=\"large\" onClick={onSubmit} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NoPaymentRequired;\r\n","import { useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Payment from 'payment';\r\nimport { object, string } from 'yup';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport Button from '../Button/Button';\r\nimport CreditCardCVCField from '../form-fields/CreditCardCVCField/CreditCardCVCField';\r\nimport CreditCardExpiryField from '../form-fields/CreditCardExpiryField/CreditCardExpiryField';\r\nimport CreditCardNumberField from '../form-fields/CreditCardNumberField/CreditCardNumberField';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './PaymentForm.module.scss';\r\n\r\nexport type PaymentFormData = {\r\n  cardholderName: string;\r\n  cardNumber: string;\r\n  cardExpiry: string;\r\n  cardCVC: string;\r\n  cardExpMonth: string;\r\n  cardExpYear: string;\r\n};\r\n\r\ntype Props = {\r\n  onPaymentFormSubmit: (values: PaymentFormData) => void;\r\n};\r\n\r\nconst PaymentForm: React.FC<Props> = ({ onPaymentFormSubmit }) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  const { values, errors, setValue, handleChange, handleBlur, handleSubmit } = useForm<PaymentFormData>({\r\n    initialValues: { cardholderName: '', cardNumber: '', cardExpiry: '', cardCVC: '', cardExpMonth: '', cardExpYear: '' },\r\n    validationSchema: object()\r\n      .required()\r\n      .shape({\r\n        cardholderName: string().required(),\r\n        cardNumber: string()\r\n          .required()\r\n          .test('card number validation', t('checkout.invalid_card_number'), (value) => Payment.fns.validateCardNumber(value as string)),\r\n        cardExpiry: string()\r\n          .required()\r\n          .test('card expiry validation', t('checkout.invalid_card_expiry'), (value) => Payment.fns.validateCardExpiry(value as string)),\r\n        cardCVC: string()\r\n          .required()\r\n          .test('cvc validation', t('checkout.invalid_cvc_number'), (value, context) => {\r\n            const issuer = Payment.fns.cardType(context.parent.cardNumber);\r\n\r\n            return Payment.fns.validateCardCVC(value as string, issuer);\r\n          }),\r\n        cardExpMonth: string().required(),\r\n        cardExpYear: string().required(),\r\n      }),\r\n    validateOnBlur: true,\r\n    onSubmit: onPaymentFormSubmit,\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (values.cardExpiry) {\r\n      const expiry = Payment.fns.cardExpiryVal(values.cardExpiry);\r\n      if (expiry.month) {\r\n        setValue('cardExpMonth', expiry.month.toString());\r\n      }\r\n      if (expiry.year) {\r\n        setValue('cardExpYear', expiry.year.toString());\r\n      }\r\n    }\r\n    //eslint-disable-next-line\r\n  }, [values.cardExpiry]);\r\n\r\n  return (\r\n    <div className={styles.paymentForm}>\r\n      <form onSubmit={handleSubmit} data-testid={testId('payment_form')} noValidate>\r\n        {errors.form ? (\r\n          <div className={styles.formError}>\r\n            <FormFeedback variant=\"error\">{errors.form}</FormFeedback>\r\n          </div>\r\n        ) : null}\r\n        <div>\r\n          <TextField\r\n            label={t('checkout.card_holder_name')}\r\n            name=\"cardholderName\"\r\n            value={values.cardholderName}\r\n            onChange={handleChange}\r\n            onBlur={handleBlur}\r\n            placeholder={t('checkout.credit_card_name')}\r\n            autoComplete=\"cc-name\"\r\n            required\r\n          />\r\n        </div>\r\n        <div>\r\n          <CreditCardNumberField value={values.cardNumber.toString()} error={errors.cardNumber} onBlur={handleBlur} onChange={handleChange} />\r\n        </div>\r\n        <div className={styles.columns}>\r\n          <div>\r\n            <CreditCardExpiryField value={values.cardExpiry} onBlur={handleBlur} onChange={handleChange} error={errors.cardExpiry} />\r\n          </div>\r\n          <div>\r\n            <CreditCardCVCField value={values.cardCVC} onBlur={handleBlur} onChange={handleChange} error={errors.cardCVC} />\r\n          </div>\r\n        </div>\r\n        <div>\r\n          <Button label={t('checkout.continue')} variant=\"contained\" color=\"primary\" type=\"submit\" size=\"large\" fullWidth />\r\n        </div>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentForm;\r\n","import type { CoreOptions } from '@adyen/adyen-web/dist/types/core/types';\r\nimport { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport type DropinElement from '@adyen/adyen-web/dist/types/components/Dropin/Dropin';\r\nimport { useNavigate } from 'react-router';\r\nimport type { AdyenPaymentSession } from '@jwp/ott-common/types/checkout';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { ADYEN_LIVE_CLIENT_KEY, ADYEN_TEST_CLIENT_KEY } from '@jwp/ott-common/src/constants';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Adyen from '../../components/Adyen/Adyen';\r\nimport { useAriaAnnouncer } from '../AnnouncementProvider/AnnoucementProvider';\r\n\r\ntype Props = {\r\n  setUpdatingOrder: (loading: boolean) => void;\r\n  type: AdyenPaymentMethodType;\r\n  paymentSuccessUrl: string;\r\n  orderId?: number;\r\n};\r\n\r\nexport default function AdyenInitialPayment({ setUpdatingOrder, type, paymentSuccessUrl, orderId }: Props) {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n  const { t } = useTranslation(['account', 'error']);\r\n  const announce = useAriaAnnouncer();\r\n\r\n  const [error, setError] = useState<string>();\r\n  const [session, setSession] = useState<AdyenPaymentSession>();\r\n\r\n  const isSandbox = accountController.getSandbox();\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const createSession = async () => {\r\n      setUpdatingOrder(true);\r\n\r\n      try {\r\n        const session = await checkoutController.createAdyenPaymentSession(window.origin);\r\n\r\n        setSession(session);\r\n      } catch (error: unknown) {\r\n        if (error instanceof Error) {\r\n          setError(error.message);\r\n        }\r\n      }\r\n\r\n      setUpdatingOrder(false);\r\n    };\r\n\r\n    createSession();\r\n  }, [setUpdatingOrder, checkoutController]);\r\n\r\n  const onSubmit = useCallback(\r\n    async (state: AdyenEventData, handleAction: DropinElement['handleAction']) => {\r\n      if (!state.isValid) return;\r\n\r\n      try {\r\n        setUpdatingOrder(true);\r\n        setError(undefined);\r\n\r\n        if (orderId === undefined) {\r\n          setError(t('error:adyen_order_unknown'));\r\n          return;\r\n        }\r\n\r\n        const returnUrl = createURL(window.location.href, {\r\n          u: 'finalize-payment',\r\n          orderId: orderId,\r\n        });\r\n        const result = await checkoutController.initialAdyenPayment(state.data.paymentMethod, returnUrl);\r\n\r\n        if ('action' in result) {\r\n          handleAction(result.action);\r\n        }\r\n\r\n        await accountController.reloadSubscriptions({ retry: 10 });\r\n        announce(t('account:checkout.payment_success'), 'success');\r\n        navigate(paymentSuccessUrl, { replace: true });\r\n      } catch (error: unknown) {\r\n        if (error instanceof Error) {\r\n          setError(error.message);\r\n        }\r\n      }\r\n\r\n      setUpdatingOrder(false);\r\n    },\r\n    [setUpdatingOrder, orderId, checkoutController, accountController, announce, t, navigate, paymentSuccessUrl],\r\n  );\r\n\r\n  const adyenConfiguration: CoreOptions = useMemo(\r\n    () => ({\r\n      session: session,\r\n      showPayButton: false,\r\n      environment: isSandbox ? 'test' : 'live',\r\n      clientKey: isSandbox ? ADYEN_TEST_CLIENT_KEY : ADYEN_LIVE_CLIENT_KEY,\r\n      paymentMethodsConfiguration: {\r\n        card: {\r\n          hasHolderName: true,\r\n          holderNameRequired: true,\r\n        },\r\n      },\r\n      onAdditionalDetails: async (state: AdyenAdditionalEventData) => {\r\n        try {\r\n          setUpdatingOrder(true);\r\n\r\n          const data = state.data.details as number | undefined;\r\n          await checkoutController.finalizeAdyenPayment(orderId, data);\r\n\r\n          announce(t('account:checkout.payment_success'), 'success');\r\n          navigate(paymentSuccessUrl, { replace: true });\r\n        } catch (error: unknown) {\r\n          if (error instanceof Error) {\r\n            setError(error.message);\r\n            setUpdatingOrder(false);\r\n          }\r\n        }\r\n      },\r\n      onSubmit: (state: AdyenEventData, component: DropinElement) => onSubmit(state, component.handleAction),\r\n      onError: (error: Error) => setError(error.message),\r\n    }),\r\n    [session, isSandbox, setUpdatingOrder, checkoutController, orderId, announce, t, navigate, paymentSuccessUrl, onSubmit],\r\n  );\r\n\r\n  return <Adyen configuration={adyenConfiguration} type={type} error={error} />;\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport useCheckout from '@jwp/ott-hooks-react/src/useCheckout';\r\nimport { modalURLFromLocation, modalURLFromWindowLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { FormValidationError } from '@jwp/ott-common/src/errors/FormValidationError';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport CheckoutForm from '../../../components/CheckoutForm/CheckoutForm';\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\nimport PayPal from '../../../components/PayPal/PayPal';\r\nimport NoPaymentRequired from '../../../components/NoPaymentRequired/NoPaymentRequired';\r\nimport PaymentForm, { type PaymentFormData } from '../../../components/PaymentForm/PaymentForm';\r\nimport AdyenInitialPayment from '../../AdyenInitialPayment/AdyenInitialPayment';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst Checkout = () => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const [adyenUpdating, setAdyenUpdating] = useState(false); // @todo: integrate AdyenInitialPayment into useCheckout\r\n\r\n  const [couponFormOpen, setCouponFormOpen] = useState(false);\r\n  const [showCouponCodeSuccess, setShowCouponCodeSuccess] = useState(false);\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n\r\n  const chooseOfferUrl = modalURLFromLocation(location, 'choose-offer');\r\n  const welcomeUrl = modalURLFromLocation(location, 'welcome');\r\n  const closeModalUrl = modalURLFromLocation(location, null);\r\n\r\n  const backButtonClickHandler = () => navigate(chooseOfferUrl);\r\n\r\n  const { selectedOffer, offerType, paymentMethods, order, isSubmitting, updateOrder, submitPaymentWithoutDetails, submitPaymentPaypal, submitPaymentStripe } =\r\n    useCheckout({\r\n      onUpdateOrderSuccess: () => !!couponCode && setShowCouponCodeSuccess(true),\r\n      onSubmitPaymentWithoutDetailsSuccess: () => {\r\n        announce(t('checkout.payment_success'), 'success');\r\n\r\n        return navigate(offerType === 'svod' ? welcomeUrl : closeModalUrl, { replace: true });\r\n      },\r\n      onSubmitPaypalPaymentSuccess: ({ redirectUrl }) => {\r\n        window.location.href = redirectUrl;\r\n      },\r\n      onSubmitStripePaymentSuccess: () => navigate(modalURLFromLocation(location, 'waiting-for-payment'), { replace: true }),\r\n    });\r\n\r\n  const {\r\n    values: { couponCode, paymentMethodId },\r\n    setValue,\r\n    submitting: couponFormSubmitting,\r\n    errors,\r\n    handleChange,\r\n    handleSubmit,\r\n  } = useForm({\r\n    initialValues: { couponCode: '', paymentMethodId: paymentMethods?.[0]?.id?.toString() || '' },\r\n    onSubmit: ({ couponCode, paymentMethodId }) => {\r\n      setShowCouponCodeSuccess(false);\r\n\r\n      return updateOrder.mutateAsync({ couponCode, paymentMethodId: parseInt(paymentMethodId) });\r\n    },\r\n    onSubmitSuccess: ({ couponCode }): void => setShowCouponCodeSuccess(!!couponCode),\r\n    onSubmitError: ({ error }) => {\r\n      if (error instanceof FormValidationError && error.errors.order?.includes(`Order with id ${order?.id} not found`)) {\r\n        navigate(modalURLFromLocation(location, 'choose-offer'), { replace: true });\r\n      }\r\n    },\r\n  });\r\n\r\n  const handlePaymentMethodChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    handleChange(event);\r\n\r\n    // Always send payment method to backend\r\n    updateOrder.mutateAsync({ couponCode, paymentMethodId: parseInt(event.target.value) });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!selectedOffer) {\r\n      return navigate(chooseOfferUrl, { replace: true });\r\n    }\r\n  }, [navigate, chooseOfferUrl, selectedOffer]);\r\n\r\n  // Pre-select first payment method\r\n  useEffect(() => {\r\n    if (!paymentMethods?.length) return;\r\n\r\n    setValue('paymentMethodId', paymentMethods[0].id.toString());\r\n  }, [paymentMethods, setValue]);\r\n\r\n  // clear after closing the checkout modal\r\n  useEffect(() => {\r\n    return () => setShowCouponCodeSuccess(false);\r\n  }, []);\r\n\r\n  // loading state\r\n  if (!selectedOffer || !order || !paymentMethods || !offerType) {\r\n    return (\r\n      <div style={{ height: 300 }}>\r\n        <LoadingOverlay inline />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const cancelUrl = modalURLFromWindowLocation('payment-cancelled');\r\n  const waitingUrl = modalURLFromWindowLocation('waiting-for-payment', { offerId: selectedOffer?.offerId });\r\n  const errorUrl = modalURLFromWindowLocation('payment-error');\r\n  const successUrlPaypal = offerType === 'svod' ? waitingUrl : createURL(window.location.href, { u: '' });\r\n  const referrer = window.location.href;\r\n\r\n  const paymentMethod = paymentMethods?.find((method) => method.id === parseInt(paymentMethodId));\r\n  const noPaymentRequired = !order?.requiredPaymentDetails;\r\n  const isStripePayment = paymentMethod?.methodName === 'card' && paymentMethod?.provider === 'stripe';\r\n  const isAdyenPayment = paymentMethod?.methodName === 'card' && paymentMethod?.paymentGateway === 'adyen';\r\n  const isPayPalPayment = paymentMethod?.methodName === 'paypal';\r\n\r\n  return (\r\n    <CheckoutForm\r\n      order={order}\r\n      offer={selectedOffer}\r\n      offerType={offerType}\r\n      error={errors.form}\r\n      onBackButtonClick={backButtonClickHandler}\r\n      paymentMethods={paymentMethods}\r\n      paymentMethodId={paymentMethodId}\r\n      onPaymentMethodChange={handlePaymentMethodChange}\r\n      onCouponFormSubmit={handleSubmit}\r\n      onCouponInputChange={handleChange}\r\n      onRedeemCouponButtonClick={() => setCouponFormOpen(true)}\r\n      onCloseCouponFormClick={() => setCouponFormOpen(false)}\r\n      couponInputValue={couponCode}\r\n      couponFormOpen={couponFormOpen}\r\n      couponFormApplied={showCouponCodeSuccess}\r\n      couponFormSubmitting={couponFormSubmitting}\r\n      couponFormError={errors.couponCode}\r\n      submitting={isSubmitting || adyenUpdating}\r\n    >\r\n      {noPaymentRequired && <NoPaymentRequired onSubmit={submitPaymentWithoutDetails.mutateAsync} error={submitPaymentWithoutDetails.error?.message || null} />}\r\n      {isStripePayment && (\r\n        <PaymentForm\r\n          onPaymentFormSubmit={async (cardPaymentPayload: PaymentFormData) =>\r\n            await submitPaymentStripe.mutateAsync({ cardPaymentPayload, referrer, returnUrl: waitingUrl })\r\n          }\r\n        />\r\n      )}\r\n      {isAdyenPayment && (\r\n        <>\r\n          <AdyenInitialPayment\r\n            paymentSuccessUrl={offerType === 'svod' ? welcomeUrl : closeModalUrl}\r\n            setUpdatingOrder={setAdyenUpdating}\r\n            orderId={order.id}\r\n            type=\"card\"\r\n          />\r\n        </>\r\n      )}\r\n      {isPayPalPayment && (\r\n        <PayPal\r\n          onSubmit={() => submitPaymentPaypal.mutate({ successUrl: successUrlPaypal, waitingUrl, cancelUrl, errorUrl, couponCode })}\r\n          error={submitPaymentPaypal.error?.message || null}\r\n        />\r\n      )}\r\n    </CheckoutForm>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n","import { useMutation, useQuery } from 'react-query';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useCheckoutStore } from '@jwp/ott-common/src/stores/CheckoutStore';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport type { OfferType } from '@jwp/ott-common/types/checkout';\r\n\r\nconst useOffers = () => {\r\n  const checkoutController = getModule(CheckoutController);\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { mediaOffers, subscriptionOffers, switchSubscriptionOffers, requestedMediaOffers } = useCheckoutStore(\r\n    ({ mediaOffers, subscriptionOffers, switchSubscriptionOffers, requestedMediaOffers }) => ({\r\n      mediaOffers,\r\n      subscriptionOffers,\r\n      switchSubscriptionOffers,\r\n      requestedMediaOffers,\r\n    }),\r\n    shallow,\r\n  );\r\n\r\n  const { isLoading: isInitialisationLoading } = useQuery<void>({\r\n    queryKey: ['initialiseOffers', requestedMediaOffers],\r\n    queryFn: checkoutController.initialiseOffers,\r\n  });\r\n\r\n  const chooseOffer = useMutation({\r\n    mutationKey: ['chooseOffer'],\r\n    mutationFn: checkoutController.chooseOffer,\r\n  });\r\n\r\n  const switchSubscription = useMutation({\r\n    mutationKey: ['switchSubscription'],\r\n    mutationFn: checkoutController.switchSubscription,\r\n    onSuccess: () => accountController.reloadSubscriptions({ delay: 3000, retry: 10 }), // A subscription switch usually takes at least 3 secs\r\n  });\r\n\r\n  const hasMediaOffers = mediaOffers.length > 0;\r\n  const hasSubscriptionOffers = subscriptionOffers.length > 0;\r\n  const hasPremierOffers = requestedMediaOffers.some((mediaOffer) => mediaOffer.premier);\r\n  const hasMultipleOfferTypes = (subscriptionOffers.length > 0 || switchSubscriptionOffers.length > 0) && hasMediaOffers && !hasPremierOffers;\r\n  const defaultOfferType: OfferType = hasPremierOffers || !hasSubscriptionOffers ? 'tvod' : 'svod';\r\n\r\n  return {\r\n    isLoading: isInitialisationLoading || chooseOffer.isLoading,\r\n    mediaOffers,\r\n    subscriptionOffers,\r\n    switchSubscriptionOffers,\r\n    chooseOffer,\r\n    switchSubscription,\r\n    hasMultipleOfferTypes,\r\n    defaultOfferType,\r\n  };\r\n};\r\n\r\nexport default useOffers;\r\n","import * as React from \"react\";\nconst SvgCheckCircle = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z\" }));\nexport default SvgCheckCircle;\n","import React, { type FC, type SVGProps } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport type { FormErrors } from '@jwp/ott-common/types/form';\r\nimport type { Offer, ChooseOfferFormData } from '@jwp/ott-common/types/checkout';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { getOfferPrice, isSVODOffer } from '@jwp/ott-common/src/utils/offers';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport CheckCircle from '@jwp/ott-theme/assets/icons/check_circle.svg?react';\r\n\r\nimport Button from '../Button/Button';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport DialogBackButton from '../DialogBackButton/DialogBackButton';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './ChooseOfferForm.module.scss';\r\n\r\ntype OfferBoxProps = {\r\n  offer: Offer;\r\n  selected: boolean;\r\n} & Pick<Props, 'onChange'>;\r\n\r\nconst OfferBox: React.FC<OfferBoxProps> = ({ offer, selected, onChange }: OfferBoxProps) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  const getFreeTrialText = (offer: Offer) => {\r\n    if (offer.freeDays) {\r\n      return t('choose_offer.benefits.first_days_free', { count: offer.freeDays });\r\n    } else if (offer.freePeriods) {\r\n      // t('periods.day', { count })\r\n      // t('periods.week', { count })\r\n      // t('periods.month', { count })\r\n      // t('periods.year', { count })\r\n      const period = t(`periods.${offer.period}`, { count: offer.freePeriods });\r\n\r\n      return t('choose_offer.benefits.first_periods_free', { count: offer.freePeriods, period });\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  const renderListItem = (text: string, icon: FC<SVGProps<SVGSVGElement>>) => (\r\n    <li>\r\n      <Icon icon={icon} />\r\n      {text}\r\n      <span className=\"hidden\">.</span>\r\n    </li>\r\n  );\r\n\r\n  const renderOption = ({ title, periodString, secondBenefit }: { title: string; periodString?: string; secondBenefit?: string }) => (\r\n    <div className={styles.offer} aria-labelledby={`title-${offer.offerId}`}>\r\n      <input\r\n        className={styles.radio}\r\n        onChange={onChange}\r\n        type=\"radio\"\r\n        name={'selectedOfferId'}\r\n        value={offer.offerId}\r\n        id={offer.offerId}\r\n        checked={selected}\r\n        data-testid={testId(offer.offerId)}\r\n      />\r\n      <div className={styles.label}>\r\n        <label htmlFor={offer.offerId}>\r\n          <h2 className={styles.offerTitle} id={`title-${offer.offerId}`}>\r\n            {title}\r\n          </h2>\r\n          <span className=\"hidden\">.</span>\r\n          <hr className={styles.offerDivider} aria-hidden={true} />\r\n          <ul className={styles.offerBenefits}>\r\n            {offer.freeDays || offer.freePeriods ? renderListItem(getFreeTrialText(offer) || '', CheckCircle) : null}\r\n            {!!secondBenefit && renderListItem(secondBenefit, CheckCircle)}\r\n            {renderListItem(t('choose_offer.benefits.watch_on_all_devices'), CheckCircle)}\r\n          </ul>\r\n          <div className={styles.fill} />\r\n          <div className={styles.offerPrice}>\r\n            {getOfferPrice(offer)} {!!periodString && <small>/{periodString}</small>}\r\n          </div>\r\n        </label>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (isSVODOffer(offer)) {\r\n    const isMonthly = offer.period === 'month';\r\n\r\n    return renderOption({\r\n      title: isMonthly ? t('choose_offer.monthly') : t('choose_offer.yearly'),\r\n      secondBenefit: t('choose_offer.benefits.cancel_anytime'),\r\n      periodString: isMonthly ? t('periods.month') : t('periods.year'),\r\n    });\r\n  }\r\n\r\n  return renderOption({\r\n    title: offer.offerTitle,\r\n    secondBenefit:\r\n      !!offer.durationPeriod && !!offer.durationAmount\r\n        ? t('choose_offer.tvod_access', { period: offer.durationPeriod, count: offer.durationAmount })\r\n        : undefined,\r\n  });\r\n};\r\n\r\ntype Props = {\r\n  values: ChooseOfferFormData;\r\n  errors: FormErrors<ChooseOfferFormData>;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  onSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onBackButtonClickHandler?: () => void;\r\n  offers: Offer[];\r\n  showOfferTypeSwitch: boolean;\r\n  submitting: boolean;\r\n};\r\n\r\nconst ChooseOfferForm: React.FC<Props> = ({ values, errors, submitting, offers, showOfferTypeSwitch, onChange, onSubmit, onBackButtonClickHandler }: Props) => {\r\n  const siteName = useConfigStore((s) => s.config.siteName);\r\n  const { t } = useTranslation('account');\r\n  const { selectedOfferType, selectedOfferId } = values;\r\n\r\n  return (\r\n    <form onSubmit={onSubmit} data-testid={testId('choose-offer-form')} noValidate>\r\n      {onBackButtonClickHandler ? <DialogBackButton onClick={onBackButtonClickHandler} /> : null}\r\n      <h1 className={styles.title}>{t('choose_offer.title')}</h1>\r\n      <p className={styles.subtitle}>{t('choose_offer.watch_this_on_platform', { siteName })}</p>\r\n      {errors.form ? <FormFeedback variant=\"error\">{errors.form}</FormFeedback> : null}\r\n      {showOfferTypeSwitch && (\r\n        <div className={styles.offerGroupSwitch}>\r\n          <input\r\n            className={styles.radio}\r\n            onChange={onChange}\r\n            type=\"radio\"\r\n            name=\"selectedOfferType\"\r\n            id=\"svod\"\r\n            value=\"svod\"\r\n            checked={selectedOfferType === 'svod'}\r\n          />\r\n          <label className={classNames(styles.label, styles.offerGroupLabel)} htmlFor=\"svod\">\r\n            {t('choose_offer.subscription')}\r\n          </label>\r\n          <input\r\n            className={styles.radio}\r\n            onChange={onChange}\r\n            type=\"radio\"\r\n            name=\"selectedOfferType\"\r\n            id=\"tvod\"\r\n            value=\"tvod\"\r\n            checked={selectedOfferType === 'tvod'}\r\n          />\r\n          <label className={classNames(styles.label, styles.offerGroupLabel)} htmlFor=\"tvod\">\r\n            {t('choose_offer.one_time_only')}\r\n          </label>\r\n        </div>\r\n      )}\r\n      <div className={styles.offers}>\r\n        {!offers.length ? (\r\n          <p>{t('choose_offer.no_pricing_available')}</p>\r\n        ) : (\r\n          offers.map((offer) => <OfferBox key={offer.offerId} offer={offer} selected={selectedOfferId === offer.offerId} onChange={onChange} />)\r\n        )}\r\n      </div>\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n      <Button label={t('choose_offer.continue')} disabled={submitting || !offers.length} variant=\"contained\" color=\"primary\" type=\"submit\" fullWidth />\r\n    </form>\r\n  );\r\n};\r\nexport default ChooseOfferForm;\r\n","import React, { useEffect } from 'react';\r\nimport { mixed, object } from 'yup';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport type { ChooseOfferFormData, OfferType } from '@jwp/ott-common/types/checkout';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useOffers from '@jwp/ott-hooks-react/src/useOffers';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\n\r\nimport ChooseOfferForm from '../../../components/ChooseOfferForm/ChooseOfferForm';\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\nimport useQueryParam from '../../../hooks/useQueryParam';\r\n\r\nconst ChooseOffer = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { t } = useTranslation('account');\r\n  const isSwitch = useQueryParam('u') === 'upgrade-subscription';\r\n  const isPendingOffer = useAccountStore(({ pendingOffer }) => ({ isPendingOffer: !!pendingOffer }));\r\n\r\n  const { isLoading, mediaOffers, subscriptionOffers, switchSubscriptionOffers, defaultOfferType, hasMultipleOfferTypes, chooseOffer, switchSubscription } =\r\n    useOffers();\r\n\r\n  const checkoutUrl = modalURLFromLocation(location, 'checkout');\r\n  const upgradePendingUrl = modalURLFromLocation(location, 'upgrade-subscription-pending');\r\n  const upgradeSuccessUrl = modalURLFromLocation(location, 'upgrade-subscription-success');\r\n  const upgradeErrorUrl = modalURLFromLocation(location, 'upgrade-subscription-error');\r\n\r\n  const { values, errors, submitting, setValue, handleSubmit, handleChange } = useForm<ChooseOfferFormData>({\r\n    initialValues: { selectedOfferType: defaultOfferType, selectedOfferId: undefined },\r\n    validationSchema: object().shape({\r\n      selectedOfferId: mixed<string>().required(t('choose_offer.field_required')),\r\n      selectedOfferType: mixed<OfferType>().required(t('choose_offer.field_required')),\r\n    }),\r\n    onSubmit: async ({ selectedOfferType, selectedOfferId }) => {\r\n      if (!selectedOfferType || !selectedOfferId) return;\r\n\r\n      const offer = visibleOffers.find((offer) => offer.offerId === selectedOfferId);\r\n\r\n      if (!offer) return;\r\n\r\n      await chooseOffer.mutateAsync(offer);\r\n\r\n      if (isSwitch) {\r\n        return await switchSubscription.mutateAsync();\r\n      }\r\n    },\r\n    onSubmitSuccess: async () => {\r\n      if (isSwitch && isPendingOffer) return navigate(upgradePendingUrl);\r\n      if (isSwitch) return navigate(upgradeSuccessUrl);\r\n\r\n      navigate(checkoutUrl);\r\n    },\r\n    onSubmitError: () => navigate(upgradeErrorUrl),\r\n  });\r\n\r\n  const visibleOffers = values.selectedOfferType === 'tvod' ? mediaOffers : isSwitch ? switchSubscriptionOffers : subscriptionOffers;\r\n\r\n  useEffect(() => {\r\n    if (isLoading || !visibleOffers.length) return;\r\n\r\n    const offerId = visibleOffers[visibleOffers.length - 1]?.offerId;\r\n\r\n    setValue('selectedOfferId', offerId);\r\n  }, [visibleOffers, values.selectedOfferType, setValue, isLoading]);\r\n\r\n  useEffect(() => {\r\n    if (isLoading || !defaultOfferType) return;\r\n\r\n    setValue('selectedOfferType', defaultOfferType);\r\n  }, [isLoading, defaultOfferType, setValue]);\r\n\r\n  // loading state\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ height: 300 }}>\r\n        <LoadingOverlay inline />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <ChooseOfferForm\r\n      onSubmit={handleSubmit}\r\n      onChange={handleChange}\r\n      values={values}\r\n      errors={errors}\r\n      submitting={submitting}\r\n      offers={visibleOffers}\r\n      showOfferTypeSwitch={hasMultipleOfferTypes}\r\n    />\r\n  );\r\n};\r\n\r\nexport default ChooseOffer;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport type { FormControlProps } from '../../types/form';\r\n\r\nimport styles from './Select.module.scss';\r\n\r\ntype HTMLSelectProps = Omit<InputHTMLAttributes<HTMLSelectElement>, 'size'>;\r\n\r\ntype Props = HTMLSelectProps & {\r\n  id?: string;\r\n  helperTextId?: string;\r\n  options?: (string | { value: string; label: string })[];\r\n  optionsStyle?: string;\r\n  defaultLabel?: string;\r\n} & FormControlProps;\r\n\r\nconst Select = ({\r\n  required,\r\n  className,\r\n  disabled,\r\n  defaultLabel,\r\n  options,\r\n  optionsStyle,\r\n  editing = true,\r\n  value,\r\n  onChange,\r\n  id,\r\n  name,\r\n  error,\r\n  helperTextId,\r\n  type,\r\n  ...rest\r\n}: Props) => {\r\n  const handleChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\r\n    if (!editing) {\r\n      return event.preventDefault();\r\n    }\r\n    onChange?.(event);\r\n  };\r\n\r\n  // Default to 'text' if 'type' property is absent, which occurs in textareas.\r\n  const containerClassName = classNames(\r\n    styles.container,\r\n    {\r\n      [styles.error]: error,\r\n      [styles.disabled]: disabled,\r\n    },\r\n    className,\r\n  );\r\n\r\n  const ariaAttributes = {\r\n    'aria-required': !!required,\r\n    'aria-invalid': Boolean(required && error && value !== ''),\r\n    'aria-describedby': helperTextId,\r\n  } as const;\r\n\r\n  const inputProps: HTMLSelectProps = {\r\n    id,\r\n    name,\r\n    value,\r\n    disabled,\r\n    className: styles.select,\r\n    readOnly: !editing,\r\n    required: required,\r\n    ...ariaAttributes,\r\n    ...rest,\r\n  };\r\n\r\n  return (\r\n    <div className={classNames({ [containerClassName]: editing })}>\r\n      <select {...inputProps} onChange={handleChange}>\r\n        {defaultLabel && (\r\n          <option className={classNames(styles.option, optionsStyle)} value=\"\" disabled={required}>\r\n            {defaultLabel}\r\n          </option>\r\n        )}\r\n        {options &&\r\n          options.map((option) => (\r\n            <option\r\n              className={classNames(styles.option, optionsStyle)}\r\n              key={typeof option === 'string' ? option : option.value}\r\n              value={typeof option === 'string' ? option : option.value}\r\n            >\r\n              {typeof option === 'string' ? option : option.label}\r\n            </option>\r\n          ))}\r\n      </select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Select;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\n\r\nimport { FormField } from '../../FormField/FormField';\r\nimport Select from '../../Select/Select';\r\nimport type { FormControlProps } from '../../../types/form';\r\n\r\ntype SelectProps = Omit<InputHTMLAttributes<HTMLSelectElement>, 'size'>;\r\n\r\ntype Props = SelectProps & {\r\n  defaultLabel?: string;\r\n  options?: (string | { value: string; label: string })[];\r\n  optionsStyle?: string;\r\n  helperText?: React.ReactNode;\r\n} & FormControlProps;\r\n\r\nconst Dropdown: React.FC<Props> = ({\r\n  name,\r\n  className,\r\n  label,\r\n  error,\r\n  helperText,\r\n  editing = true,\r\n  required = false,\r\n  size = 'medium',\r\n  testId,\r\n  lang,\r\n  ...inputProps\r\n}) => {\r\n  return (\r\n    <FormField\r\n      className={className}\r\n      error={error}\r\n      helperText={helperText}\r\n      label={label}\r\n      required={required}\r\n      editing={editing}\r\n      testId={testId}\r\n      name={name}\r\n      size={size}\r\n      lang={lang}\r\n      renderInput={(fieldProps) => <Select name={name} required={required} editing={editing} error={error} size={size} {...fieldProps} {...inputProps} />}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Dropdown;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport { FormField } from '../../FormField/FormField';\r\nimport type { FormControlProps } from '../../../types/form';\r\n\r\nimport styles from './Checkbox.module.scss';\r\n\r\ntype HTMLCheckboxProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\n\r\ntype Props = HTMLCheckboxProps & {\r\n  checkboxLabel?: React.ReactNode;\r\n  helperText?: React.ReactNode;\r\n} & FormControlProps;\r\n\r\nconst Checkbox: React.FC<Props> = ({\r\n  className,\r\n  label,\r\n  checkboxLabel,\r\n  name,\r\n  onChange,\r\n  editing = true,\r\n  value,\r\n  helperText,\r\n  error,\r\n  required,\r\n  lang,\r\n  size,\r\n  ...rest\r\n}) => {\r\n  const fieldClassName = classNames(styles.checkbox, { [styles.error]: error }, className);\r\n  const handleChange: React.ChangeEventHandler<HTMLInputElement> = (event) => {\r\n    if (!editing) {\r\n      return event.preventDefault();\r\n    }\r\n    onChange?.(event);\r\n  };\r\n\r\n  return (\r\n    <FormField\r\n      className={fieldClassName}\r\n      name={name}\r\n      label={label}\r\n      editing={editing}\r\n      required={required}\r\n      error={error}\r\n      helperText={helperText}\r\n      renderInput={({ id, helperTextId }) => (\r\n        <div className={styles.row}>\r\n          <input\r\n            name={name}\r\n            type=\"checkbox\"\r\n            id={id}\r\n            value={value}\r\n            aria-required={required}\r\n            aria-describedby={helperTextId}\r\n            {...rest}\r\n            onChange={handleChange}\r\n            readOnly={!editing}\r\n          />\r\n          <label htmlFor={id} lang={lang}>\r\n            {required ? (\r\n              <span role=\"presentation\" aria-hidden=\"true\">\r\n                *\r\n              </span>\r\n            ) : (\r\n              ''\r\n            )}\r\n            {checkboxLabel}\r\n          </label>\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Checkbox;\r\n","import React, { type InputHTMLAttributes } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport type { FormControlProps } from '../../../types/form';\r\nimport { FormField } from '../../FormField/FormField';\r\n\r\nimport styles from './Radio.module.scss';\r\n\r\ntype HTMLRadioProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\n\r\ntype Props = HTMLRadioProps & {\r\n  values: { value: string; label: string }[];\r\n  helperText?: React.ReactNode;\r\n} & FormControlProps;\r\n\r\nconst Radio: React.FC<Props> = ({ name, onChange, label, value, editing = true, size, values, helperText, error, required, disabled, lang, ...rest }) => {\r\n  const handleChange: React.ChangeEventHandler<HTMLInputElement> = (event) => {\r\n    if (!editing) {\r\n      return event.preventDefault();\r\n    }\r\n    onChange?.(event);\r\n  };\r\n\r\n  return (\r\n    <FormField\r\n      name={name}\r\n      label={label}\r\n      error={error}\r\n      helperText={helperText}\r\n      required={required}\r\n      renderInput={({ id, helperTextId }) => (\r\n        <div id={id}>\r\n          {values.map(({ value: optionValue, label: optionLabel }, index) => (\r\n            <div className={classNames(styles.radio, { [styles.error]: error })} key={index} lang={lang}>\r\n              <input\r\n                value={optionValue}\r\n                name={name}\r\n                type=\"radio\"\r\n                id={id + index}\r\n                onChange={handleChange}\r\n                checked={value === optionValue}\r\n                required={required}\r\n                disabled={disabled}\r\n                aria-describedby={helperTextId}\r\n                {...rest}\r\n              />\r\n              <label htmlFor={id + index}>{optionLabel}</label>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Radio;\r\n","import React, { type InputHTMLAttributes, useRef, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport { FormField } from '../../FormField/FormField';\r\nimport type { FormControlProps } from '../../../types/form';\r\n\r\nimport styles from './DateField.module.scss';\r\n\r\ntype InputProps = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'>;\r\n\r\ntype Props = InputProps & {\r\n  format?: string;\r\n  helperText?: React.ReactNode;\r\n} & FormControlProps;\r\n\r\nconst parseDateString = (dateString: string | undefined) => {\r\n  if (!dateString) return null;\r\n\r\n  const date = new Date(dateString);\r\n\r\n  return isNaN(date.getTime()) ? null : date;\r\n};\r\n\r\nconst padLeft = (value: number) => {\r\n  return value > 0 && value < 10 ? `0${value}` : value.toString();\r\n};\r\n\r\nconst clamp = (value: number, min: number, max: number) => Math.min(max, Math.max(min, value));\r\n\r\nconst parseBlurValue = (value: string, min: number, max: number) => {\r\n  const parsed = clamp(parseInt(value), min, max);\r\n  if (isNaN(parsed)) return '';\r\n\r\n  return value.length > 0 && parsed < 10 ? padLeft(parsed) : parsed.toString();\r\n};\r\n\r\nconst parseInputValue = (value: string, min: number, max: number) => {\r\n  const parsed = clamp(parseInt(value), min, max);\r\n  if (isNaN(parsed)) return '';\r\n\r\n  return value.length > 1 && parsed < 10 ? padLeft(parsed) : parsed.toString();\r\n};\r\n\r\nconst DateField: React.FC<Props> = ({\r\n  className,\r\n  label,\r\n  error,\r\n  helperText,\r\n  value,\r\n  onChange,\r\n  format = 'YYYY-MM-DD',\r\n  name,\r\n  editing,\r\n  lang,\r\n  required,\r\n  onFocus,\r\n  testId,\r\n}: Props) => {\r\n  const parsedDate = parseDateString(value);\r\n\r\n  const [values, setValues] = useState({\r\n    date: parsedDate?.getDate().toString() || '',\r\n    month: parsedDate ? (parsedDate.getMonth() + 1).toString() : '',\r\n    year: parsedDate?.getFullYear().toString() || '',\r\n  });\r\n\r\n  const id = useOpaqueId('text-field', name);\r\n  const helperTextId = useOpaqueId('helper_text', name);\r\n\r\n  const hiddenInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const dateFieldClassName = classNames(\r\n    styles.dateField,\r\n    {\r\n      [styles.error]: error,\r\n    },\r\n    className,\r\n  );\r\n\r\n  const handleFocus = (event: React.FocusEvent<HTMLInputElement>) => {\r\n    event.currentTarget.select();\r\n    onFocus?.(event);\r\n  };\r\n\r\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (event.key === 'Backspace' && values[event.currentTarget.name as 'date' | 'month' | 'year'] === '') {\r\n      (event.currentTarget.previousElementSibling as HTMLElement)?.focus();\r\n\r\n      return event.preventDefault();\r\n    }\r\n\r\n    if (!/^[0-9]$/.test(event.key) && event.key !== 'Tab' && event.key !== 'Backspace') {\r\n      return event.preventDefault();\r\n    }\r\n  };\r\n\r\n  const handleBlur = (event: React.FocusEvent<HTMLInputElement>) => {\r\n    const { name, value } = event.target;\r\n\r\n    setValues((current) => {\r\n      const date = name === 'date' ? parseBlurValue(value, 1, 31) : current.date;\r\n      const month = name === 'month' ? parseBlurValue(value, 1, 12) : current.month;\r\n      const year = name === 'year' ? parseBlurValue(value, 1900, 2100) : current.year;\r\n\r\n      return { date, month, year };\r\n    });\r\n  };\r\n\r\n  const triggerChangeEvent = (date: string, month: string, year: string) => {\r\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value')?.set;\r\n\r\n    const newValue = date && month && year ? format.replace('YYYY', year).replace('MM', month).replace('DD', date) : '';\r\n\r\n    nativeInputValueSetter?.call(hiddenInputRef.current, newValue);\r\n\r\n    const inputEvent = new Event('input', { bubbles: true });\r\n\r\n    hiddenInputRef.current?.dispatchEvent(inputEvent);\r\n  };\r\n\r\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = event.target;\r\n    const nextSibling = event.currentTarget?.nextElementSibling as HTMLInputElement;\r\n\r\n    const date = name === 'date' ? parseInputValue(value, 0, 31) : values.date;\r\n    const month = name === 'month' ? parseInputValue(value, 0, 12) : values.month;\r\n    const year = name === 'year' ? parseInputValue(value, 0, 2100).slice(0, 4) : values.year;\r\n\r\n    setValues({ date, month, year });\r\n\r\n    triggerChangeEvent(date, month, year);\r\n\r\n    if ((nextSibling && name === 'month' && month.length === 2) || (name === 'date' && date.length === 2)) {\r\n      setTimeout(() => nextSibling.focus(), 1);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <FormField\r\n      className={dateFieldClassName}\r\n      name={name}\r\n      helperText={helperText}\r\n      error={error}\r\n      label={label}\r\n      editing={editing}\r\n      lang={lang}\r\n      required={required}\r\n      testId={testId}\r\n      renderInput={() => (\r\n        <div className={styles.container}>\r\n          {/* don't be tempted to make it type=\"hidden\", onChange will practically be ignored that way */}\r\n          <input\r\n            ref={hiddenInputRef}\r\n            id={`${id}-hidden`}\r\n            className={styles.hiddenInput}\r\n            name={name}\r\n            onChange={onChange}\r\n            aria-invalid={error}\r\n            aria-describedby={helperTextId}\r\n          />\r\n          <input\r\n            className={styles.input}\r\n            name=\"date\"\r\n            placeholder=\"dd\"\r\n            value={values.date}\r\n            onFocus={handleFocus}\r\n            onBlur={handleBlur}\r\n            onChange={handleChange}\r\n            onKeyDown={handleKeyDown}\r\n            maxLength={2}\r\n            type=\"number\"\r\n            id={`${id}-date`}\r\n            autoComplete=\"bday-day\"\r\n          />\r\n          {' / '}\r\n          <input\r\n            className={styles.input}\r\n            name=\"month\"\r\n            placeholder=\"mm\"\r\n            value={values.month}\r\n            onFocus={handleFocus}\r\n            onBlur={handleBlur}\r\n            onChange={handleChange}\r\n            onKeyDown={handleKeyDown}\r\n            maxLength={2}\r\n            type=\"number\"\r\n            id={`${id}-month`}\r\n            autoComplete=\"bday-month\"\r\n          />\r\n          {' / '}\r\n          <input\r\n            className={styles.input}\r\n            name=\"year\"\r\n            placeholder=\"yyyy\"\r\n            value={values.year}\r\n            onFocus={handleFocus}\r\n            onBlur={handleBlur}\r\n            onChange={handleChange}\r\n            onKeyDown={handleKeyDown}\r\n            maxLength={4}\r\n            type=\"number\"\r\n            id={`${id}-year`}\r\n            autoComplete=\"bday-year\"\r\n          />\r\n        </div>\r\n      )}\r\n    />\r\n  );\r\n};\r\n\r\nexport default DateField;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { CleengCaptureField, CleengCaptureQuestionField, PersonalDetailsFormData } from '@jwp/ott-common/types/account';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport useForm, { type UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\n\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Button from '../Button/Button';\r\nimport Dropdown from '../form-fields/Dropdown/Dropdown';\r\nimport Checkbox from '../form-fields/Checkbox/Checkbox';\r\nimport Radio from '../form-fields/Radio/Radio';\r\nimport DateField from '../form-fields/DateField/DateField';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\n\r\nimport styles from './PersonalDetailsForm.module.scss';\r\n\r\ntype Props = {\r\n  initialValues: PersonalDetailsFormData;\r\n  onSubmit: UseFormOnSubmitHandler<PersonalDetailsFormData>;\r\n  error?: string;\r\n  fields: Record<string, CleengCaptureField>;\r\n  questions: CleengCaptureQuestionField[];\r\n  onQuestionChange: React.ChangeEventHandler;\r\n  questionValues: Record<string, string>;\r\n  questionErrors: Record<string, string>;\r\n};\r\n\r\nconst PersonalDetailsForm: React.FC<Props> = ({ initialValues, onSubmit, fields, questions, onQuestionChange, questionValues, questionErrors }: Props) => {\r\n  const { t } = useTranslation('account');\r\n\r\n  const { setValue, handleSubmit, handleChange, values, errors, validationSchemaError, submitting } = useForm<PersonalDetailsFormData>({\r\n    initialValues,\r\n    onSubmit,\r\n  });\r\n\r\n  const renderQuestion = ({ value, key, question, required, enabled }: CleengCaptureQuestionField) => {\r\n    if (!enabled) {\r\n      return null;\r\n    }\r\n\r\n    const values = value?.split(';').map((question) => {\r\n      const [value, label = value] = question.split(':');\r\n\r\n      return { value, label };\r\n    });\r\n\r\n    const props = {\r\n      name: key,\r\n      onChange: onQuestionChange,\r\n      error: !!questionErrors[key],\r\n      helperText: questionErrors[key],\r\n      required,\r\n      key,\r\n    };\r\n\r\n    // The rendered field is determined by the given available options for each question:\r\n    // TextField <- when there is exactly 1 option and the value is empty (e.g. \"\")\r\n    // Checkbox  <- when there is exactly 1 option and the value is not empty (e.g. \"accepted\")\r\n    // Radio     <- when there are exactly 2 options\r\n    // Dropdown  <- when there are more than 2 options\r\n\r\n    if (values.length === 1 && values[0].value === '') {\r\n      return <TextField value={questionValues[key]} label={question} {...props} />;\r\n    } else if (values.length === 1) {\r\n      return <Checkbox checked={!!questionValues[key]} value={values[0].value} label={question} checkboxLabel={values[0].label} {...props} />;\r\n    } else if (values.length === 2) {\r\n      return <Radio values={values} value={questionValues[key]} label={question} {...props} />;\r\n    } else if (values.length > 2) {\r\n      return <Dropdown options={values} value={questionValues[key]} label={question} defaultLabel={t('personal_details.select_answer')} {...props} />;\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} data-testid={testId('personal_details-form')} noValidate>\r\n      <h2 className={styles.title}>{t('personal_details.title')}</h2>\r\n      {errors.form ? (\r\n        <FormFeedback variant=\"error\" visible={!validationSchemaError}>\r\n          {errors.form}\r\n        </FormFeedback>\r\n      ) : null}\r\n      {fields.firstNameLastName?.enabled ? (\r\n        <React.Fragment>\r\n          <TextField\r\n            value={values.firstName}\r\n            onChange={handleChange}\r\n            label={t('personal_details.fist_name')}\r\n            placeholder={t('personal_details.fist_name')}\r\n            error={!!errors.firstName}\r\n            helperText={errors.firstName}\r\n            required={fields.firstNameLastName.required}\r\n            name=\"firstName\"\r\n            autoComplete=\"given-name\"\r\n          />\r\n          <TextField\r\n            value={values.lastName}\r\n            onChange={handleChange}\r\n            label={t('personal_details.last_name')}\r\n            placeholder={t('personal_details.last_name')}\r\n            error={!!errors.lastName}\r\n            helperText={errors.lastName}\r\n            required={fields.firstNameLastName.required}\r\n            name=\"lastName\"\r\n            autoComplete=\"family-name\"\r\n          />\r\n        </React.Fragment>\r\n      ) : null}\r\n      {fields.companyName?.enabled ? (\r\n        <TextField\r\n          value={values.companyName}\r\n          onChange={handleChange}\r\n          label={t('personal_details.company_name')}\r\n          placeholder={t('personal_details.company_name')}\r\n          error={!!errors.companyName}\r\n          helperText={errors.companyName}\r\n          required={fields.companyName.required}\r\n          name=\"companyName\"\r\n          autoComplete=\"organization\"\r\n        />\r\n      ) : null}\r\n      {fields.address?.enabled ? (\r\n        <React.Fragment>\r\n          <TextField\r\n            value={values.address}\r\n            onChange={handleChange}\r\n            label={t('personal_details.address')}\r\n            placeholder={t('personal_details.address')}\r\n            error={!!errors.address}\r\n            helperText={errors.address}\r\n            required={fields.address.required}\r\n            name=\"address\"\r\n            autoComplete=\"address-line1\"\r\n          />\r\n          <TextField\r\n            value={values.address2}\r\n            onChange={handleChange}\r\n            label={t('personal_details.address2')}\r\n            placeholder={t('personal_details.address2')}\r\n            error={!!errors.address2}\r\n            helperText={errors.address2}\r\n            name=\"address2\"\r\n            autoComplete=\"address-line2\"\r\n          />\r\n          <TextField\r\n            value={values.city}\r\n            onChange={handleChange}\r\n            label={t('personal_details.city')}\r\n            placeholder={t('personal_details.city')}\r\n            error={!!errors.city}\r\n            helperText={errors.city}\r\n            required={fields.address.required}\r\n            name=\"city\"\r\n            autoComplete=\"address-level2\"\r\n          />\r\n          <TextField\r\n            value={values.state}\r\n            onChange={handleChange}\r\n            label={t('personal_details.state')}\r\n            placeholder={t('personal_details.state')}\r\n            error={!!errors.state}\r\n            helperText={errors.state}\r\n            required={fields.address.required}\r\n            name=\"state\"\r\n            autoComplete=\"address-level1\"\r\n          />\r\n          <TextField\r\n            value={values.postCode}\r\n            onChange={handleChange}\r\n            label={t('personal_details.post_code')}\r\n            placeholder={t('personal_details.post_code')}\r\n            error={!!errors.postCode}\r\n            helperText={errors.postCode}\r\n            required={fields.address.required}\r\n            name=\"postCode\"\r\n            autoComplete=\"postal-code\"\r\n          />\r\n        </React.Fragment>\r\n      ) : null}\r\n      {fields.phoneNumber?.enabled ? (\r\n        <TextField\r\n          value={values.phoneNumber}\r\n          onChange={handleChange}\r\n          label={t('personal_details.phone_number')}\r\n          placeholder={t('personal_details.phone_number')}\r\n          error={!!errors.phoneNumber}\r\n          helperText={errors.phoneNumber}\r\n          required={fields.phoneNumber.required}\r\n          name=\"phoneNumber\"\r\n        />\r\n      ) : null}\r\n      {fields.birthDate?.enabled ? (\r\n        <DateField\r\n          value={values.birthDate}\r\n          onChange={(event) => setValue('birthDate', event.currentTarget.value)}\r\n          label={t('personal_details.birth_date')}\r\n          error={!!errors.birthDate}\r\n          helperText={errors.birthDate}\r\n          required={fields.birthDate.required}\r\n          name=\"birthDate\"\r\n        />\r\n      ) : null}\r\n      {questions.map((question) => renderQuestion(question))}\r\n      <Button\r\n        className={styles.continue}\r\n        type=\"submit\"\r\n        label={t('personal_details.continue')}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        size=\"large\"\r\n        disabled={submitting}\r\n        fullWidth\r\n      />\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default PersonalDetailsForm;\r\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { mixed, object, string } from 'yup';\r\nimport { useQuery } from 'react-query';\r\nimport type { CaptureCustomAnswer, CleengCaptureQuestionField, PersonalDetailsFormData } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport { type UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\nimport useOffers from '@jwp/ott-hooks-react/src/useOffers';\r\n\r\nimport PersonalDetailsForm from '../../../components/PersonalDetailsForm/PersonalDetailsForm';\r\nimport LoadingOverlay from '../../../components/LoadingOverlay/LoadingOverlay';\r\n\r\nconst yupConditional = (required: boolean, message: string) => {\r\n  return required ? string().required(message) : mixed().notRequired();\r\n};\r\n\r\nconst PersonalDetails = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { t } = useTranslation('account');\r\n  const accessModel = useConfigStore((s) => s.accessModel);\r\n  const { data, isLoading } = useQuery('captureStatus', accountController.getCaptureStatus);\r\n  const { mediaOffers } = useOffers();\r\n  const hasMediaOffers = mediaOffers.length > 0;\r\n  const [questionValues, setQuestionValues] = useState<Record<string, string>>({});\r\n  const [questionErrors, setQuestionErrors] = useState<Record<string, string>>({});\r\n\r\n  const fields = useMemo(() => Object.fromEntries(data?.settings.map((item) => [item.key, item]) || []), [data]);\r\n\r\n  const questions = useMemo(\r\n    () => (data?.settings.filter((item) => !!(item as CleengCaptureQuestionField).question) as CleengCaptureQuestionField[]) || [],\r\n    [data],\r\n  );\r\n\r\n  const nextStep = useCallback(() => {\r\n    const hasOffers = accessModel === ACCESS_MODEL.SVOD || (accessModel === ACCESS_MODEL.AUTHVOD && hasMediaOffers);\r\n\r\n    navigate(modalURLFromLocation(location, hasOffers ? 'choose-offer' : 'welcome'), { replace: true });\r\n  }, [navigate, location, accessModel, hasMediaOffers]);\r\n\r\n  useEffect(() => {\r\n    if (!data) return;\r\n\r\n    if (!data.isCaptureEnabled || !data.shouldCaptureBeDisplayed) {\r\n      nextStep();\r\n    }\r\n\r\n    if (questions) {\r\n      setQuestionValues(Object.fromEntries(questions.map((question) => [question.key, ''])));\r\n    }\r\n  }, [data, nextStep, questions]);\r\n\r\n  const initialValues: PersonalDetailsFormData = useMemo(() => {\r\n    const [firstName, lastName] = (() => {\r\n      if (fields.firstNameLastName?.enabled) {\r\n        const firstNameLastName = fields.firstNameLastName?.answer as Record<string, string | null>;\r\n        return [firstNameLastName?.firstName || '', firstNameLastName?.lastName || ''];\r\n      }\r\n\r\n      return ['', ''];\r\n    })();\r\n\r\n    return {\r\n      firstName,\r\n      lastName,\r\n      birthDate: '',\r\n      companyName: '',\r\n      phoneNumber: '',\r\n      address: '',\r\n      address2: '',\r\n      city: '',\r\n      state: '',\r\n      postCode: '',\r\n      country: '',\r\n    };\r\n  }, [fields]);\r\n\r\n  const questionChangeHandler = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = event.target.type === 'checkbox' && !event.target.checked ? '' : event.target.value;\r\n\r\n    setQuestionValues((current) => ({ ...current, [event.target.name]: value }));\r\n  };\r\n\r\n  const submitHandler: UseFormOnSubmitHandler<PersonalDetailsFormData> = async (formData, { setErrors, setSubmitting, setValidationSchemaError, validate }) => {\r\n    const requiredMessage = t('personal_details.this_field_is_required');\r\n    const schema = object().shape({\r\n      firstName: yupConditional(!!fields.firstNameLastName?.required, requiredMessage),\r\n      lastName: yupConditional(!!fields.firstNameLastName?.required, requiredMessage),\r\n      address1: yupConditional(!!fields.address?.required, requiredMessage),\r\n      address2: yupConditional(!!fields.address?.required, requiredMessage),\r\n      postCode: yupConditional(!!fields.address?.required, requiredMessage),\r\n      state: yupConditional(!!fields.address?.required, requiredMessage),\r\n      city: yupConditional(!!fields.address?.required, requiredMessage),\r\n      companyName: yupConditional(!!fields.companyName?.required, requiredMessage),\r\n      birthDate: fields.birthDate?.required\r\n        ? string()\r\n            .required(requiredMessage)\r\n            .matches(/\\d{4}-\\d{2}-\\d{2}/, t('personal_details.birth_date_not_valid'))\r\n        : mixed().notRequired(),\r\n      phoneNumber: yupConditional(!!fields.phoneNumber?.required, requiredMessage),\r\n    });\r\n\r\n    const errors: Record<string, string> = {};\r\n\r\n    questions.forEach((question) => {\r\n      if (question.enabled && question.required && !questionValues[question.key]) {\r\n        errors[question.key] = t('personal_details.this_field_is_required');\r\n      }\r\n    });\r\n\r\n    setQuestionErrors(errors);\r\n\r\n    // we have validation errors\r\n    if (!validate(schema) || Object.keys(errors).length) {\r\n      setSubmitting(false);\r\n      setValidationSchemaError(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const removeEmpty = (obj: Record<string, unknown>) =>\r\n        Object.fromEntries(\r\n          Object.keys(obj)\r\n            .filter((key) => obj[key] !== '')\r\n            .map((key) => [key, obj[key]]),\r\n        );\r\n      const customAnswers = questions.map(\r\n        (question) =>\r\n          ({\r\n            question: question.question,\r\n            questionId: question.key,\r\n            value: questionValues[question.key],\r\n          } as CaptureCustomAnswer),\r\n      );\r\n\r\n      await accountController.updateCaptureAnswers(removeEmpty({ ...formData, customAnswers }));\r\n\r\n      nextStep();\r\n    } catch (error: unknown) {\r\n      if (error instanceof Error) {\r\n        setErrors({ form: error.message });\r\n      }\r\n    }\r\n\r\n    setSubmitting(false);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ height: 400 }}>\r\n        <LoadingOverlay inline />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PersonalDetailsForm\r\n      initialValues={initialValues}\r\n      fields={fields}\r\n      questions={questions}\r\n      onQuestionChange={questionChangeHandler}\r\n      questionValues={questionValues}\r\n      questionErrors={questionErrors}\r\n      onSubmit={submitHandler}\r\n    />\r\n  );\r\n};\r\n\r\nexport default PersonalDetails;\r\n","import { useMemo } from 'react';\r\nimport { useQuery } from 'react-query';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\n\r\nexport type SocialLoginURLs = Record<string, string>;\r\n\r\nexport default function useSocialLoginUrls(url: string) {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { data, error } = useQuery(['socialUrls', url], () => accountController.getSocialLoginUrls(url), {\r\n    enabled: accountController.getFeatures().hasSocialURLs,\r\n    retry: false,\r\n  });\r\n\r\n  const urls = useMemo(() => {\r\n    if (!data) return null;\r\n\r\n    return data.reduce((acc, url) => ({ ...acc, ...url }), {} as SocialLoginURLs);\r\n  }, [data]);\r\n\r\n  if (error || !urls) {\r\n    return null;\r\n  }\r\n\r\n  return urls;\r\n}\r\n","import { type ChangeEventHandler, type FC, type ReactNode, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { RegisterFieldOptions } from '@inplayer-org/inplayer.js';\r\nimport type { CustomRegisterFieldVariant } from '@jwp/ott-common/types/account';\r\nimport { isTruthyCustomParamValue, testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport Checkbox from '../form-fields/Checkbox/Checkbox';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Radio from '../form-fields/Radio/Radio';\r\nimport Dropdown from '../form-fields/Dropdown/Dropdown';\r\nimport DateField from '../form-fields/DateField/DateField';\r\n\r\nexport type CustomRegisterFieldCommonProps = {\r\n  type?: CustomRegisterFieldVariant;\r\n  name: string;\r\n  value: string | boolean;\r\n  onChange: ChangeEventHandler;\r\n} & Partial<{\r\n  label: ReactNode;\r\n  placeholder: string;\r\n  error: boolean;\r\n  helperText: string;\r\n  disabled: boolean;\r\n  required: boolean;\r\n  options: RegisterFieldOptions;\r\n  editing: boolean;\r\n  lang: string;\r\n}>;\r\n\r\nconst CustomRegisterField: FC<CustomRegisterFieldCommonProps> = ({ type, value = '', label, options, editing, lang, ...props }) => {\r\n  const { t, i18n } = useTranslation();\r\n\r\n  const optionsList = useMemo(() => {\r\n    if (type && ['country', 'us_state'].includes(type)) {\r\n      const codes = Object.keys(i18n.getResourceBundle(i18n.language, type));\r\n\r\n      return codes.map((code) => ({\r\n        value: code,\r\n        label: t(`${type}:${code}`),\r\n      }));\r\n    }\r\n\r\n    if (options) {\r\n      return Object.entries(options).map(([value, label]) => ({ value, label }));\r\n    }\r\n\r\n    return [];\r\n  }, [type, options, i18n, t]);\r\n\r\n  switch (type) {\r\n    case 'input':\r\n      return <TextField {...props} value={String(value)} label={label} testId={testId(`crf-${type}`)} />;\r\n    case 'radio':\r\n      return <Radio {...props} label={label} values={optionsList} value={String(value)} data-testid={testId(`crf-${type}`)} lang={lang} />;\r\n    case 'select':\r\n    case 'country':\r\n    case 'us_state':\r\n      return (\r\n        <Dropdown\r\n          {...props}\r\n          options={optionsList}\r\n          value={String(value)}\r\n          label={label}\r\n          defaultLabel={props.placeholder}\r\n          testId={testId(`crf-${type}`)}\r\n          lang={lang}\r\n        />\r\n      );\r\n    case 'datepicker':\r\n      return <DateField {...props} value={String(value)} label={label} testId={testId(`crf-${type}`)} />;\r\n    default:\r\n      return <Checkbox {...props} checkboxLabel={label} checked={isTruthyCustomParamValue(value)} data-testid={testId(`crf-${type}`)} lang={lang} />;\r\n  }\r\n};\r\n\r\nexport default CustomRegisterField;\r\n","import React, { type MouseEventHandler } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './Link.module.scss';\r\n\r\ntype Props = {\r\n  className?: string;\r\n  href?: string;\r\n  to?: string;\r\n  target?: string;\r\n  children?: React.ReactNode;\r\n  onClick?: MouseEventHandler<HTMLElement>;\r\n  onBlur?: () => void;\r\n  onFocus?: () => void;\r\n};\r\n\r\nconst Link: React.FC<Props> = ({ to, href, children, className, onClick, target, ...rest }: Props) => {\r\n  const linkClassName = classNames(styles.link, className);\r\n\r\n  if (to) {\r\n    return (\r\n      <RouterLink to={to} className={linkClassName} onClick={onClick} {...rest}>\r\n        {children}\r\n      </RouterLink>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <a\r\n      href={href}\r\n      className={linkClassName}\r\n      onClick={onClick}\r\n      target={target}\r\n      rel={\r\n        // Security thingy for old browsers.\r\n        // See https://mathiasbynens.github.io/rel-noopener/#recommendations\r\n        target === '_blank' ? 'noreferrer' : undefined\r\n      }\r\n      {...rest}\r\n    >\r\n      {children}\r\n    </a>\r\n  );\r\n};\r\n\r\nexport default Link;\r\n","import React, { type ChangeEventHandler, useEffect, useRef } from 'react';\r\nimport { useLocation } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport DOMPurify from 'dompurify';\r\nimport type { FormErrors } from '@jwp/ott-common/types/form';\r\nimport type { CustomFormField, RegistrationFormData } from '@jwp/ott-common/types/account';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport type { SocialLoginURLs } from '@jwp/ott-hooks-react/src/useSocialLoginUrls';\r\nimport env from '@jwp/ott-common/src/env';\r\n\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Button from '../Button/Button';\r\nimport CustomRegisterField from '../CustomRegisterField/CustomRegisterField';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport Link from '../Link/Link';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\nimport PasswordField from '../form-fields/PasswordField/PasswordField';\r\n\r\nimport styles from './RegistrationForm.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  onBlur: React.FocusEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  onConsentChange: ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  errors: FormErrors<RegistrationFormData>;\r\n  values: RegistrationFormData;\r\n  loading: boolean;\r\n  consentValues: Record<string, string | boolean>;\r\n  consentErrors: string[];\r\n  submitting: boolean;\r\n  validationError?: boolean;\r\n  publisherConsents: CustomFormField[] | null;\r\n  socialLoginURLs: SocialLoginURLs | null;\r\n};\r\n\r\nconst RegistrationForm: React.FC<Props> = ({\r\n  onSubmit,\r\n  onChange,\r\n  onBlur,\r\n  values,\r\n  errors,\r\n  submitting,\r\n  validationError,\r\n  loading,\r\n  publisherConsents,\r\n  consentValues,\r\n  onConsentChange,\r\n  consentErrors,\r\n}: Props) => {\r\n  const { t, i18n } = useTranslation('account');\r\n  const location = useLocation();\r\n\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const htmlLang = i18n.language !== env.APP_DEFAULT_LANGUAGE ? env.APP_DEFAULT_LANGUAGE : undefined;\r\n\r\n  const formatConsentLabel = (label: string): string | JSX.Element => {\r\n    const sanitizedLabel = DOMPurify.sanitize(label);\r\n    const hasHrefOpenTag = /<a(.|\\n)*?>/.test(sanitizedLabel);\r\n    const hasHrefCloseTag = /<\\/a(.|\\n)*?>/.test(sanitizedLabel);\r\n\r\n    if (hasHrefOpenTag && hasHrefCloseTag) {\r\n      return <span dangerouslySetInnerHTML={{ __html: label }} />;\r\n    }\r\n\r\n    return label;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (errors.form) {\r\n      ref.current?.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });\r\n    }\r\n  }, [errors.form]);\r\n\r\n  return (\r\n    <form onSubmit={onSubmit} data-testid={testId('registration-form')} noValidate>\r\n      <div ref={ref}>\r\n        {errors.form ? (\r\n          <FormFeedback variant=\"error\" visible={!validationError}>\r\n            {errors.form}\r\n          </FormFeedback>\r\n        ) : null}\r\n      </div>\r\n      <h2 className={styles.title}>{t('registration.sign_up')}</h2>\r\n      <TextField\r\n        value={values.email}\r\n        onChange={onChange}\r\n        onBlur={onBlur}\r\n        label={t('registration.email')}\r\n        placeholder={t('registration.email')}\r\n        error={!!errors.email}\r\n        helperText={errors.email}\r\n        name=\"email\"\r\n        type=\"email\"\r\n        autoComplete=\"email\"\r\n        required\r\n      />\r\n      <PasswordField\r\n        value={values.password}\r\n        onChange={onChange}\r\n        onBlur={onBlur}\r\n        label={t('registration.password')}\r\n        placeholder={t('registration.password')}\r\n        error={!!errors.password}\r\n        name=\"password\"\r\n        autoComplete=\"new-password\"\r\n        required\r\n      />\r\n      {publisherConsents && (\r\n        <div className={styles.customFields} data-testid=\"custom-reg-fields\">\r\n          {publisherConsents.map((consent) => {\r\n            const consentError = consentErrors.find((error) => error === consent.name);\r\n\r\n            return (\r\n              <CustomRegisterField\r\n                key={consent.name}\r\n                type={consent.type}\r\n                name={consent.name}\r\n                options={consent.options}\r\n                label={formatConsentLabel(consent.label)}\r\n                placeholder={consent.placeholder}\r\n                value={consentValues[consent.name] || ''}\r\n                required={consent.required}\r\n                error={!!consentError}\r\n                helperText={consentError ? t('registration.field_required') : undefined}\r\n                onChange={onConsentChange}\r\n                lang={htmlLang}\r\n              />\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n      <Button\r\n        className={styles.continue}\r\n        type=\"submit\"\r\n        label={t('registration.continue')}\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        size=\"large\"\r\n        disabled={submitting}\r\n        fullWidth\r\n      />\r\n      <p className={styles.bottom}>\r\n        {t('registration.already_account')} <Link to={modalURLFromLocation(location, 'login')}>{t('login.sign_in')}</Link>\r\n      </p>\r\n      {(loading || submitting) && <LoadingOverlay transparentBackground inline />}\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default RegistrationForm;\r\n","import React, { useEffect, useState, type ChangeEventHandler } from 'react';\r\nimport { object, string } from 'yup';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport type { RegistrationFormData } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { checkConsentsFromValues, extractConsentValues, formatConsentsFromValues } from '@jwp/ott-common/src/utils/collection';\r\nimport useSocialLoginUrls from '@jwp/ott-hooks-react/src/useSocialLoginUrls';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { modalURLFromLocation, modalURLFromWindowLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\n\r\nimport RegistrationForm from '../../../components/RegistrationForm/RegistrationForm';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst Registration = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n  const [consentValues, setConsentValues] = useState<Record<string, string | boolean>>({});\r\n  const [consentErrors, setConsentErrors] = useState<string[]>([]);\r\n\r\n  const { publisherConsents, publisherConsentsLoading, loading } = useAccountStore(({ publisherConsents, publisherConsentsLoading, loading }) => ({\r\n    publisherConsents,\r\n    publisherConsentsLoading,\r\n    loading,\r\n  }));\r\n\r\n  const handleChangeConsent: ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement> = ({ currentTarget }) => {\r\n    if (!currentTarget) return;\r\n\r\n    const { name, type } = currentTarget;\r\n    const value = type === 'checkbox' ? (currentTarget as HTMLInputElement).checked : currentTarget.value;\r\n\r\n    setConsentValues((current) => ({\r\n      ...current,\r\n      [name]: value,\r\n    }));\r\n\r\n    // Clear the errors for any checkbox that's toggled\r\n    setConsentErrors((errors) => errors.filter((e) => e !== name));\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!publisherConsents) {\r\n      accountController.getPublisherConsents();\r\n\r\n      return;\r\n    }\r\n\r\n    setConsentValues(extractConsentValues(publisherConsents));\r\n  }, [accountController, publisherConsents]);\r\n\r\n  const socialLoginURLs = useSocialLoginUrls(modalURLFromWindowLocation('personal-details'));\r\n\r\n  const { handleSubmit, handleChange, handleBlur, values, errors, validationSchemaError, submitting } = useForm<RegistrationFormData>({\r\n    initialValues: { email: '', password: '' },\r\n    validationSchema: object().shape({\r\n      email: string()\r\n        .email(t('registration.field_is_not_valid_email'))\r\n        .required(t('registration.field_required', { field: t('registration.email') })),\r\n      password: string()\r\n        .matches(/^(?=.*[a-z])(?=.*[0-9]).{8,}$/, t('registration.invalid_password', { field: t('registration.password') }))\r\n        .required(t('registration.field_required', { field: t('registration.password') })),\r\n    }),\r\n    validateOnBlur: true,\r\n    onSubmit: async ({ email, password }) => {\r\n      const { consentsErrors } = checkConsentsFromValues(publisherConsents || [], consentValues);\r\n\r\n      if (consentsErrors.length) {\r\n        setConsentErrors(consentsErrors);\r\n        throw new Error(t('registration.consents_error'));\r\n      }\r\n\r\n      await accountController.register(email, password, window.location.href, formatConsentsFromValues(publisherConsents, consentValues));\r\n    },\r\n    onSubmitSuccess: () => {\r\n      announce(t('registration.success'), 'success');\r\n      navigate(modalURLFromLocation(location, 'personal-details'));\r\n    },\r\n  });\r\n\r\n  return (\r\n    <RegistrationForm\r\n      onSubmit={handleSubmit}\r\n      onChange={handleChange}\r\n      onConsentChange={handleChangeConsent}\r\n      onBlur={handleBlur}\r\n      values={values}\r\n      errors={errors}\r\n      consentErrors={consentErrors}\r\n      validationError={validationSchemaError}\r\n      submitting={submitting}\r\n      consentValues={consentValues}\r\n      publisherConsents={publisherConsents}\r\n      loading={loading || publisherConsentsLoading}\r\n      socialLoginURLs={socialLoginURLs}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Registration;\r\n","import React from 'react';\r\nimport { useLocation } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { FormErrors } from '@jwp/ott-common/types/form';\r\nimport type { LoginFormData } from '@jwp/ott-common/types/account';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport useToggle from '@jwp/ott-hooks-react/src/useToggle';\r\nimport type { SocialLoginURLs } from '@jwp/ott-hooks-react/src/useSocialLoginUrls';\r\nimport Visibility from '@jwp/ott-theme/assets/icons/visibility.svg?react';\r\nimport VisibilityOff from '@jwp/ott-theme/assets/icons/visibility_off.svg?react';\r\n\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Button from '../Button/Button';\r\nimport Link from '../Link/Link';\r\nimport IconButton from '../IconButton/IconButton';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport Icon from '../Icon/Icon';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\nimport styles from './LoginForm.module.scss';\r\n\r\ntype Props = {\r\n  onSubmit: React.FormEventHandler<HTMLFormElement>;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  error?: string;\r\n  errors: FormErrors<LoginFormData>;\r\n  values: LoginFormData;\r\n  validationError?: boolean;\r\n  submitting: boolean;\r\n  socialLoginURLs: SocialLoginURLs | null;\r\n  siteName?: string;\r\n};\r\n\r\nconst LoginForm: React.FC<Props> = ({ onSubmit, onChange, values, errors, validationError, submitting, siteName }: Props) => {\r\n  const [viewPassword, toggleViewPassword] = useToggle();\r\n  const { t } = useTranslation('account');\r\n  const location = useLocation();\r\n\r\n  return (\r\n    <form onSubmit={onSubmit} data-testid={testId('login-form')} noValidate>\r\n      {errors.form ? (\r\n        <FormFeedback variant=\"error\" visible={!validationError}>\r\n          {errors.form}\r\n        </FormFeedback>\r\n      ) : null}\r\n      <h2 className={styles.title}>{t('login.sign_in')}</h2>\r\n      <TextField\r\n        value={values.email}\r\n        onChange={onChange}\r\n        label={t('login.email')}\r\n        placeholder={t('login.email')}\r\n        error={!!errors.email}\r\n        helperText={errors.email}\r\n        name=\"email\"\r\n        type=\"email\"\r\n        required\r\n        testId=\"login-email-input\"\r\n        autoComplete=\"email\"\r\n      />\r\n      <TextField\r\n        value={values.password}\r\n        onChange={onChange}\r\n        label={t('login.password')}\r\n        placeholder={t('login.password')}\r\n        error={!!errors.password}\r\n        helperText={errors.password}\r\n        name=\"password\"\r\n        type={viewPassword ? 'text' : 'password'}\r\n        rightControl={\r\n          <IconButton aria-label={t('login.view_password')} onClick={() => toggleViewPassword()} aria-pressed={viewPassword}>\r\n            <Icon icon={viewPassword ? Visibility : VisibilityOff} />\r\n          </IconButton>\r\n        }\r\n        required\r\n        testId=\"login-password-input\"\r\n        autoComplete=\"current-password\"\r\n      />\r\n      {submitting && <LoadingOverlay transparentBackground inline />}\r\n      <Link className={styles.link} to={modalURLFromLocation(location, 'forgot-password')}>\r\n        {t('login.forgot_password')}\r\n      </Link>\r\n      <Button type=\"submit\" label={t('login.sign_in')} variant=\"contained\" color=\"primary\" size=\"large\" disabled={submitting} fullWidth />\r\n      <p className={styles.bottom}>\r\n        {t('login.not_registered', { siteName })} <Link to={modalURLFromLocation(location, 'create-account')}>{t('login.sign_up')}</Link>\r\n      </p>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default LoginForm;\r\n","import React from 'react';\r\nimport { object, string } from 'yup';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport useForm from '@jwp/ott-hooks-react/src/useForm';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useSocialLoginUrls from '@jwp/ott-hooks-react/src/useSocialLoginUrls';\r\nimport type { LoginFormData } from '@jwp/ott-common/types/account';\r\n\r\nimport LoginForm from '../../../components/LoginForm/LoginForm';\r\nimport { useAriaAnnouncer } from '../../AnnouncementProvider/AnnoucementProvider';\r\n\r\nconst Login = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { siteName } = useConfigStore((s) => s.config);\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { t } = useTranslation('account');\r\n  const announce = useAriaAnnouncer();\r\n\r\n  const socialLoginURLs = useSocialLoginUrls(window.location.href.split('?')[0]);\r\n\r\n  const { values, errors, submitting, validationSchemaError, handleSubmit, handleChange } = useForm<LoginFormData>({\r\n    initialValues: { email: '', password: '' },\r\n    validationSchema: object().shape({\r\n      email: string()\r\n        .email(t('login.field_is_not_valid_email'))\r\n        .required(t('login.field_required', { field: t('login.email') })),\r\n      password: string().required(t('login.field_required', { field: t('login.password') })),\r\n    }),\r\n    onSubmit: ({ email, password }) => accountController.login(email, password, window.location.href),\r\n    onSubmitSuccess: () => {\r\n      announce(t('login.sign_in_success'), 'success');\r\n\r\n      navigate(modalURLFromLocation(location, null));\r\n    },\r\n    onSubmitError: ({ resetValue }) => resetValue('password'),\r\n  });\r\n\r\n  return (\r\n    <LoginForm\r\n      values={values}\r\n      validationError={validationSchemaError}\r\n      errors={errors}\r\n      submitting={submitting}\r\n      siteName={siteName}\r\n      socialLoginURLs={socialLoginURLs}\r\n      onSubmit={handleSubmit}\r\n      onChange={handleChange}\r\n    />\r\n  );\r\n};\r\n\r\nexport default Login;\r\n","import React, { useEffect, useMemo, useRef } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { modalURLFromLocation, createURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\n\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport Welcome from '../../components/Welcome/Welcome';\r\nimport PaymentFailed from '../../components/PaymentFailed/PaymentFailed';\r\nimport Dialog from '../../components/Dialog/Dialog';\r\nimport DeleteAccountModal from '../../components/DeleteAccountModal/DeleteAccountModal';\r\nimport FinalizePayment from '../../components/FinalizePayment/FinalizePayment';\r\nimport WaitingForPayment from '../../components/WaitingForPayment/WaitingForPayment';\r\nimport UpgradeSubscription from '../../components/UpgradeSubscription/UpgradeSubscription';\r\nimport DeleteAccountPasswordWarning from '../../components/DeleteAccountPasswordWarning/DeleteAccountPasswordWarning';\r\nimport UpdatePaymentMethod from '../UpdatePaymentMethod/UpdatePaymentMethod';\r\n\r\nimport EditCardDetails from './forms/EditCardDetails';\r\nimport EditPassword from './forms/EditPassword';\r\nimport RenewSubscription from './forms/RenewSubscription';\r\nimport CancelSubscription from './forms/CancelSubscription';\r\nimport ResetPassword from './forms/ResetPassword';\r\nimport Checkout from './forms/Checkout';\r\nimport ChooseOffer from './forms/ChooseOffer';\r\nimport PersonalDetails from './forms/PersonalDetails';\r\nimport Registration from './forms/Registration';\r\nimport Login from './forms/Login';\r\nimport styles from './AccountModal.module.scss';\r\n\r\n// @todo: connect with route typings\r\nconst PUBLIC_VIEWS = ['login', 'create-account', 'forgot-password', 'reset-password', 'send-confirmation', 'edit-password'];\r\n\r\nexport type AccountModals = {\r\n  login: 'login';\r\n  'create-account': 'create-account';\r\n  'personal-details': 'personal-details';\r\n  'choose-offer': 'choose-offer';\r\n  'edit-card': 'edit-card';\r\n  'upgrade-subscription': 'upgrade-subscription';\r\n  'upgrade-subscription-error': 'upgrade-subscription-error';\r\n  'upgrade-subscription-success': 'upgrade-subscription-success';\r\n  'upgrade-subscription-pending': 'upgrade-subscription-pending';\r\n  checkout: 'checkout';\r\n  'payment-error': 'payment-error';\r\n  'payment-cancelled': 'payment-cancelled';\r\n  welcome: 'welcome';\r\n  'reset-password': 'reset-password';\r\n  'forgot-password': 'forgot-password';\r\n  'add-password': 'add-password';\r\n  'delete-account': 'delete-account';\r\n  'delete-account-confirmation': 'delete-account-confirmation';\r\n  'warning-account-deletion': 'warning-account-deletion';\r\n  'send-confirmation': 'send-confirmation';\r\n  'edit-password': 'edit-password';\r\n  unsubscribe: 'unsubscribe';\r\n  'renew-subscription': 'renew-subscription';\r\n  'payment-method': 'payment-method';\r\n  'payment-method-success': 'payment-method-success';\r\n  'waiting-for-payment': 'waiting-for-payment';\r\n  'finalize-payment': 'finalize-payment';\r\n};\r\n\r\nconst AccountModal = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const viewParam = useQueryParam('u');\r\n  const viewParamRef = useRef(viewParam);\r\n  const message = useQueryParam('message');\r\n  const { loading, user } = useAccountStore(({ loading, user }) => ({ loading, user }), shallow);\r\n  const config = useConfigStore((s) => s.config);\r\n  const {\r\n    assets: { banner },\r\n    siteName,\r\n  } = config;\r\n  const isPublicView = viewParam && PUBLIC_VIEWS.includes(viewParam);\r\n\r\n  const toLogin = useEventCallback(() => {\r\n    navigate(modalURLFromLocation(location, 'login'));\r\n  });\r\n\r\n  // make sure the last view is rendered even when the modal gets closed\r\n  const view = useMemo(() => {\r\n    if (viewParam) viewParamRef.current = viewParam;\r\n    return viewParamRef.current;\r\n  }, [viewParam]);\r\n\r\n  useEffect(() => {\r\n    if (!!viewParam && !loading && !user && !isPublicView) {\r\n      toLogin();\r\n    }\r\n  }, [viewParam, loading, isPublicView, user, toLogin]);\r\n\r\n  const closeHandler = useEventCallback(() => {\r\n    navigate(createURLFromLocation(location, { u: null, message: null }));\r\n  });\r\n\r\n  const renderForm = () => {\r\n    if (!user && loading && !isPublicView) {\r\n      return (\r\n        <div style={{ height: 300 }}>\r\n          <LoadingOverlay inline />\r\n        </div>\r\n      );\r\n    }\r\n\r\n    switch (view) {\r\n      case 'login':\r\n        return <Login />;\r\n      case 'create-account':\r\n        return <Registration />;\r\n      case 'personal-details':\r\n        return <PersonalDetails />;\r\n      case 'choose-offer':\r\n        return <ChooseOffer />;\r\n      case 'edit-card':\r\n        return <EditCardDetails />;\r\n      case 'upgrade-subscription':\r\n        return <ChooseOffer />;\r\n      case 'upgrade-subscription-error':\r\n        return <UpgradeSubscription type=\"error\" onCloseButtonClick={closeHandler} />;\r\n      case 'upgrade-subscription-success':\r\n        return <UpgradeSubscription type=\"success\" onCloseButtonClick={closeHandler} />;\r\n      case 'upgrade-subscription-pending':\r\n        return <UpgradeSubscription type=\"pending\" onCloseButtonClick={closeHandler} />;\r\n      case 'checkout':\r\n        return <Checkout />;\r\n      case 'payment-error':\r\n        return <PaymentFailed type=\"error\" message={message} onCloseButtonClick={closeHandler} />;\r\n      case 'payment-cancelled':\r\n        return <PaymentFailed type=\"cancelled\" message={message} onCloseButtonClick={closeHandler} />;\r\n      case 'welcome':\r\n        return <Welcome onCloseButtonClick={closeHandler} onCountdownCompleted={closeHandler} siteName={siteName} />;\r\n      case 'reset-password':\r\n        return <ResetPassword type=\"reset\" />;\r\n      case 'forgot-password':\r\n        return <ResetPassword type=\"forgot\" />;\r\n      case 'add-password':\r\n        return <EditPassword type=\"add\" />;\r\n      case 'delete-account':\r\n      case 'delete-account-confirmation':\r\n        return <DeleteAccountModal />;\r\n      case 'warning-account-deletion':\r\n        return <DeleteAccountPasswordWarning />;\r\n      case 'send-confirmation':\r\n        return <ResetPassword type=\"confirmation\" />;\r\n      case 'edit-password':\r\n        return <EditPassword />;\r\n      case 'unsubscribe':\r\n        return <CancelSubscription />;\r\n      case 'renew-subscription':\r\n        return <RenewSubscription />;\r\n      case 'payment-method':\r\n      case 'payment-method-success':\r\n        return <UpdatePaymentMethod onCloseButtonClick={closeHandler} />;\r\n      case 'waiting-for-payment':\r\n        return <WaitingForPayment />;\r\n      case 'finalize-payment':\r\n        return <FinalizePayment />;\r\n    }\r\n  };\r\n\r\n  const shouldShowBanner = !['delete-account', 'delete-account-confirmation', 'edit-card', 'warning-account-deletion'].includes(view ?? '');\r\n  const dialogSize = ['delete-account-confirmation'].includes(view ?? '') ? 'large' : 'small';\r\n\r\n  return (\r\n    <Dialog size={dialogSize} open={!!viewParam} onClose={closeHandler}>\r\n      {shouldShowBanner && banner && (\r\n        <div className={styles.banner}>\r\n          <img src={banner} alt=\"\" />\r\n        </div>\r\n      )}\r\n      {renderForm()}\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AccountModal;\r\n","export interface TestConfig {\r\n  id: string;\r\n  label: string;\r\n}\r\n\r\nexport const testConfigs = {\r\n  jwpAuth: {\r\n    id: '9qqwmnbx',\r\n    label: 'JWP AUTHVOD',\r\n  },\r\n  jwpSvod: {\r\n    id: 'a2kbjdv0',\r\n    label: 'JWP SVOD',\r\n  },\r\n  jwpAuthNoWatchlist: {\r\n    id: 'oqrsyxin',\r\n    label: 'JWP Authvod (No WL)',\r\n  },\r\n  basicNoAuth: {\r\n    id: 'gnnuzabk',\r\n    label: 'Demo App (No Auth)',\r\n  },\r\n  noStyling: {\r\n    id: 'kujzeu1b',\r\n    label: 'No Styling (No Auth)',\r\n  },\r\n  inlinePlayer: {\r\n    id: 'ata6ucb8',\r\n    label: 'Inline Player',\r\n  },\r\n  cleengAuthvod: {\r\n    id: 'nvqkufhy',\r\n    label: 'Cleeng Authvod',\r\n  },\r\n  cleengAuthvodNoWatchlist: {\r\n    id: '7weyqrua',\r\n    label: 'Cleeng Authvod (No WL)',\r\n  },\r\n  svod: {\r\n    id: 'ozylzc5m',\r\n    label: 'Cleeng SVOD',\r\n  },\r\n};\r\n\r\nexport const jwDevEnvConfigs = {\r\n  basicNoAuth: {\r\n    id: 'uzcyv8xh',\r\n    label: 'JW-Dev Basic Demo',\r\n  } as TestConfig,\r\n};\r\n","import { type ChangeEvent, useCallback } from 'react';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { CONFIG_QUERY_KEY } from '@jwp/ott-common/src/constants';\r\nimport { jwDevEnvConfigs, testConfigs } from '@jwp/ott-testing/constants';\r\n\r\nimport Select from '../Select/Select';\r\n\r\nimport styles from './DevConfigSelector.module.scss';\r\n\r\ninterface Props {\r\n  selectedConfig: string | undefined;\r\n}\r\n\r\nconst configs = __mode__ === 'jwdev' ? jwDevEnvConfigs : testConfigs;\r\nconst configOptions: { value: string; label: string }[] = [\r\n  { label: 'Select an App Config', value: '' },\r\n  ...Object.values(configs).map(({ id, label }) => ({ value: id, label: `${id.length > 8 ? 'ext-json' : id} - ${label}` })),\r\n];\r\n\r\nconst DevConfigSelector = ({ selectedConfig }: Props) => {\r\n  const onChange = useCallback((event: ChangeEvent<HTMLSelectElement>) => {\r\n    window.location.href = createURL(window.location.href, { [CONFIG_QUERY_KEY]: event.target.value });\r\n  }, []);\r\n\r\n  return (\r\n    <Select\r\n      className={styles.dropdown}\r\n      size=\"small\"\r\n      options={configOptions}\r\n      name=\"config-select\"\r\n      value={selectedConfig || ''}\r\n      onChange={onChange}\r\n      required={true}\r\n      aria-hidden={true}\r\n    />\r\n  );\r\n};\r\n\r\nexport default DevConfigSelector;\r\n","import { useQuery, useQueryClient } from 'react-query';\r\nimport type { Config } from '@jwp/ott-common/types/config';\r\nimport type { Settings } from '@jwp/ott-common/types/settings';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AppController from '@jwp/ott-common/src/controllers/AppController';\r\nimport type { AppError } from '@jwp/ott-common/src/utils/error';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\n\r\nconst applicationController = getModule(AppController);\r\n\r\ntype Resources = {\r\n  config: Config;\r\n  configSource: string | undefined;\r\n  settings: Settings;\r\n};\r\n\r\nexport type OnReadyCallback = (config: Config | undefined) => void;\r\n\r\nexport const useBootstrapApp = (url: string, onReady: OnReadyCallback) => {\r\n  const queryClient = useQueryClient();\r\n  const refreshEntitlements = () => queryClient.invalidateQueries({ queryKey: ['entitlements'] });\r\n\r\n  const { data, isLoading, error, isSuccess, refetch } = useQuery<Resources, Error | AppError>(\r\n    'config-init',\r\n    () => applicationController.initializeApp(url, refreshEntitlements),\r\n    {\r\n      refetchInterval: false,\r\n      retry: 1,\r\n      onSettled: (query) => onReady(query?.config),\r\n      cacheTime: CACHE_TIME,\r\n      staleTime: STALE_TIME,\r\n    },\r\n  );\r\n\r\n  return {\r\n    data,\r\n    isLoading,\r\n    error,\r\n    isSuccess,\r\n    refetch,\r\n  };\r\n};\r\n\r\nexport type BootstrapData = ReturnType<typeof useBootstrapApp>;\r\n","import type { Config } from '@jwp/ott-common/types/config';\r\nimport { calculateContrastColor } from '@jwp/ott-common/src/utils/common';\r\nimport env from '@jwp/ott-common/src/env';\r\n\r\nexport const setThemingVariables = (config: Config) => {\r\n  const root = document.querySelector(':root') as HTMLElement;\r\n  const { backgroundColor, highlightColor, headerBackground } = config.styling || {};\r\n  const bodyFont = env.APP_BODY_FONT;\r\n  const bodyAltFont = env.APP_BODY_ALT_FONT;\r\n\r\n  if (!root) return;\r\n\r\n  root.style.setProperty('--highlight-color', highlightColor || '#fff');\r\n  root.style.setProperty('--highlight-contrast-color', highlightColor ? calculateContrastColor(highlightColor) : '#000');\r\n\r\n  if (headerBackground) {\r\n    root.style.setProperty('--header-background', headerBackground);\r\n    root.style.setProperty('--header-contrast-color', calculateContrastColor(headerBackground));\r\n  }\r\n\r\n  if (backgroundColor) {\r\n    root.style.setProperty('--body-background-color', backgroundColor);\r\n    root.style.setProperty('--background-contrast-color', calculateContrastColor(backgroundColor));\r\n  }\r\n  if (bodyFont) {\r\n    root.style.setProperty('--body-font-family', bodyFont);\r\n  }\r\n  if (bodyAltFont) {\r\n    root.style.setProperty('--body-alt-font-family', bodyAltFont);\r\n  }\r\n};\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Dialog from '../Dialog/Dialog';\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './ConfirmationDialog.module.scss';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  title: string;\r\n  body: string;\r\n  onConfirm: () => void;\r\n  onClose: () => void;\r\n  busy?: boolean;\r\n};\r\n\r\nconst ConfirmationDialog: React.FC<Props> = ({ open, title, body, onConfirm, onClose, busy }: Props) => {\r\n  const { t } = useTranslation('common');\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} role=\"alertdialog\">\r\n      <h2 className={styles.title}>{title}</h2>\r\n      <p className={styles.body}>{body}</p>\r\n      <Button\r\n        className={styles.confirmButton}\r\n        label={t('confirmation_dialog.confirm')}\r\n        variant={'contained'}\r\n        color={busy ? 'default' : 'primary'}\r\n        onClick={onConfirm}\r\n        fullWidth\r\n        disabled={busy}\r\n        busy={busy}\r\n      />\r\n      <Button label={t('confirmation_dialog.close')} variant=\"outlined\" onClick={onClose} fullWidth disabled={busy} />\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ConfirmationDialog;\r\n","import React from 'react';\r\nimport { useRouteError } from 'react-router';\r\n\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\n\r\nconst RootErrorPage: React.FC = () => {\r\n  const error = useRouteError() as Error;\r\n\r\n  return <ErrorPage error={error} />;\r\n};\r\n\r\nexport default RootErrorPage;\r\n","import React, { useMemo } from 'react';\r\nimport DOMPurify from 'dompurify';\r\nimport { marked } from 'marked';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './MarkdownComponent.module.scss';\r\n\r\nconst renderer = {\r\n  link(href: string, title: string, text: string) {\r\n    const externalLink = /^(https?|www\\.|\\/\\/)/.test(href || '');\r\n    const targetAttr = externalLink ? 'target=\"_blank\"' : undefined;\r\n    const relAttr = externalLink ? 'rel=\"noopener\"' : undefined;\r\n    const titleAttr = title ? `title=\"${title}\"` : undefined;\r\n    const attributes = [targetAttr, relAttr, titleAttr].filter(Boolean);\r\n\r\n    return `<a href=\"${href}\" ${attributes.join(' ')}>${text}</a>`;\r\n  },\r\n};\r\n\r\nmarked.use({ renderer });\r\n\r\ntype Props = {\r\n  markdownString: string;\r\n  className?: string;\r\n  inline?: boolean;\r\n  tag?: string;\r\n};\r\n\r\nconst MarkdownComponent: React.FC<Props> = ({ markdownString, className, tag = 'div', inline = false }) => {\r\n  const sanitizedHTMLString = useMemo(() => {\r\n    const parseDelegate = inline ? marked.parseInline : marked.parse;\r\n    const dirtyHTMLString = parseDelegate(markdownString);\r\n\r\n    return DOMPurify.sanitize(dirtyHTMLString, { ADD_ATTR: ['target'] });\r\n  }, [inline, markdownString]);\r\n\r\n  return React.createElement(tag, { dangerouslySetInnerHTML: { __html: sanitizedHTMLString }, className: classNames(styles.markdown, className) });\r\n};\r\n\r\nexport default MarkdownComponent;\r\n","import React from 'react';\r\n\r\nimport MarkdownComponent from '../../components/MarkdownComponent/MarkdownComponent';\r\n\r\nimport styles from './About.module.scss';\r\n\r\nconst About = () => {\r\n  const markdownPage = `# About JW OTT Webapp\r\n  \r\nJW OTT Webapp is an open-source, dynamically generated video website built around JW Player and JW Platform services. It enables you to easily publish your JW Player-hosted video content with no coding and minimal configuration.\r\n\r\nTo see an example of JW OTT Webapp in action, see [https://app-preview.jwplayer.com/](https://app-preview.jwplayer.com/).\r\n\r\n## Supported Features\r\n\r\n- Works with any JW Player edition, from Free to Enterprise (note that usage will count against your monthly JW streaming limits). Only cloud-hosted JW Players are supported.\r\n- It looks great on any device. The responsive UI automatically optimizes itself for desktop, tablet, and mobile screens.\r\n- Populates your site's media content using JSON feeds. If you are using JW Platform, this happens auto-magically based on playlists that you specify. Using feeds from other sources will require you to hack the source code.\r\n- Video titles, descriptions and hero images are populated from JW Platform JSON feed metadata.\r\n- Playback of HLS video content from the JW Platform CDN. You can add external URLs (for example, URLS from your own server or CDN) to your playlists in the Content section of your JW Player account dashboard, but they must be HLS streams (\\`.m3u8\\` files).\r\n- Support for live video streams (must be registered as external .m3u8 URLs in your JW Dashboard).\r\n- Customize the user interface with your own branding. The default app is configured for JW Player branding and content, but you can easily change this to use your own assets by modifying the \\`config.json\\` file. Advanced customization is possible (for example, editing the CSS files), but you will need to modify the source code and build from source.\r\n- Site-wide video search and related video recommendations powered by [JW Recommendations](https://docs.jwplayer.com/platform/docs/vdh-learn-about-recommendations).\r\n- Basic playback analytics is reported to your JW Dashboard.\r\n- Ad integrations (VAST, VPAID, GoogleIMA, etc.). These features require a JW Player Ads Edition license. For more information, see the [JW Player pricing page](https://www.jwplayer.com/pricing/).\r\n- A \"Favorites\" feature for users to save videos for watching later. A separate list for \"Continue Watching\" is also kept so users can resume watching videos from where they left off. The lists are per-browser at this time (i.e., lists do not sync across user's browsers or devices). The \"Continue Watching\" list can be disabled in your JW OTT Webapp's \\`config.json\\` file.\r\n- A grid view for a particular playlist of videos, with the ability to deep-link to the playlist through a static URL.\r\n- Social sharing options using the device native sharing dialog.\r\n\r\n## Unsupported Features\r\n\r\n- Security-related features (encrypted HLS, DRM, signed URLs)\r\n- Self-hosted JW Players`;\r\n\r\n  return <MarkdownComponent className={styles.about} markdownString={markdownPage} />;\r\n};\r\n\r\nexport default About;\r\n","import { PersonalShelf, PersonalShelves, PLAYLIST_LIMIT } from '@jwp/ott-common/src/constants';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useFavoritesStore } from '@jwp/ott-common/src/stores/FavoritesStore';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { generatePlaylistPlaceholder } from '@jwp/ott-common/src/utils/collection';\r\nimport { isTruthyCustomParamValue } from '@jwp/ott-common/src/utils/common';\r\nimport { isScheduledOrLiveMedia } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport type { Content } from '@jwp/ott-common/types/config';\r\nimport type { Playlist } from '@jwp/ott-common/types/playlist';\r\nimport { useQueries, useQueryClient } from 'react-query';\r\n\r\nconst placeholderData = generatePlaylistPlaceholder(30);\r\n\r\ntype UsePlaylistResult = {\r\n  data: Playlist | undefined;\r\n  isSuccess?: boolean;\r\n  error?: unknown;\r\n  isPlaceholderData?: boolean;\r\n}[];\r\n\r\nconst usePlaylists = (content: Content[], rowsToLoad: number | undefined = undefined) => {\r\n  const page_limit = PLAYLIST_LIMIT.toString();\r\n  const queryClient = useQueryClient();\r\n  const apiService = getModule(ApiService);\r\n\r\n  const favorites = useFavoritesStore((state) => state.getPlaylist());\r\n  const watchHistory = useWatchHistoryStore((state) => state.getPlaylist());\r\n\r\n  const playlistQueries = useQueries(\r\n    content.map(({ contentId, type }, index) => ({\r\n      enabled: !!contentId && (!rowsToLoad || rowsToLoad > index) && !PersonalShelves.some((pType) => pType === type),\r\n      queryKey: ['playlist', contentId],\r\n      queryFn: async () => {\r\n        const playlist = await apiService.getPlaylistById(contentId, { page_limit });\r\n\r\n        // This pre-caches all playlist items and makes navigating a lot faster.\r\n        playlist?.playlist?.forEach((playlistItem) => {\r\n          queryClient.setQueryData(['media', playlistItem.mediaid], playlistItem);\r\n        });\r\n\r\n        return playlist;\r\n      },\r\n      placeholderData: !!contentId && placeholderData,\r\n      refetchInterval: (data: Playlist | undefined) => {\r\n        if (!data) return false;\r\n\r\n        const autoRefetch = isTruthyCustomParamValue(data.refetch) || data.playlist.some(isScheduledOrLiveMedia);\r\n\r\n        return autoRefetch ? 1000 * 30 : false;\r\n      },\r\n      retry: false,\r\n    })),\r\n  );\r\n\r\n  const result: UsePlaylistResult = content.map(({ type }, index) => {\r\n    if (type === PersonalShelf.Favorites) return { data: favorites, isLoading: false, isSuccess: true };\r\n    if (type === PersonalShelf.ContinueWatching) return { data: watchHistory, isLoading: false, isSuccess: true };\r\n\r\n    const { data, isSuccess, error, isPlaceholderData } = playlistQueries[index];\r\n\r\n    return {\r\n      data,\r\n      isSuccess,\r\n      error,\r\n      isPlaceholderData,\r\n    };\r\n  });\r\n\r\n  return result;\r\n};\r\n\r\nexport default usePlaylists;\r\n","import * as React from \"react\";\nconst SvgChevronLeft = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z\" }));\nexport default SvgChevronLeft;\n","import * as React from \"react\";\nconst SvgChevronRight = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z\" }));\nexport default SvgChevronRight;\n","/**\r\n * Add change event listener to given MediaQueryList instance\r\n * @param mediaQuery\r\n * @param callback\r\n */\r\nexport const addMediaQueryListChangeListener = (mediaQuery: MediaQueryList, callback: (event: MediaQueryListEvent) => void): void => {\r\n  if (typeof mediaQuery.addEventListener === 'undefined') {\r\n    mediaQuery.addListener(callback);\r\n  } else {\r\n    mediaQuery.addEventListener('change', callback);\r\n  }\r\n};\r\n\r\n/**\r\n * Remove change event listener from given MediaQueryList instance\r\n * @param mediaQuery\r\n * @param callback\r\n */\r\nexport const removeMediaQueryListChangeListener = (mediaQuery: MediaQueryList, callback: (event: MediaQueryListEvent) => void): void => {\r\n  if (typeof mediaQuery.removeEventListener === 'undefined') {\r\n    mediaQuery.removeListener(callback);\r\n  } else {\r\n    mediaQuery.removeEventListener('change', callback);\r\n  }\r\n};\r\n","import { useEffect, useState } from 'react';\r\n\r\nimport { addMediaQueryListChangeListener, removeMediaQueryListChangeListener } from '../utils/matchMedia';\r\n\r\nconst XS_MATCH_MEDIA: MediaQueryList = matchMedia('screen and (max-width: 479px)'); // mobile\r\nconst SM_MATCH_MEDIA: MediaQueryList = matchMedia('screen and (min-width: 480px) and (max-width: 767px)'); // tablet\r\nconst MD_MATCH_MEDIA: MediaQueryList = matchMedia('screen and (min-width: 768px) and (max-width: 1023px)'); // tablet large\r\nconst LG_MATCH_MEDIA: MediaQueryList = matchMedia('screen and (min-width: 1024px) and (max-width: 1199px)'); // desktop\r\n\r\nexport enum Breakpoint {\r\n  xs,\r\n  sm,\r\n  md,\r\n  lg,\r\n  xl,\r\n}\r\n\r\nexport type Breakpoints = {\r\n  [Breakpoint.xs]: number;\r\n  [Breakpoint.sm]: number;\r\n  [Breakpoint.md]: number;\r\n  [Breakpoint.lg]: number;\r\n  [Breakpoint.xl]: number;\r\n};\r\n\r\nconst getScreenSize = (): Breakpoint => {\r\n  if (XS_MATCH_MEDIA.matches) return Breakpoint.xs;\r\n  if (SM_MATCH_MEDIA.matches) return Breakpoint.sm;\r\n  if (MD_MATCH_MEDIA.matches) return Breakpoint.md;\r\n  if (LG_MATCH_MEDIA.matches) return Breakpoint.lg;\r\n  else return Breakpoint.xl;\r\n};\r\n\r\nconst useBreakpoint = (): Breakpoint => {\r\n  const [breakpoint, setBreakpoint] = useState<Breakpoint>(() => getScreenSize());\r\n\r\n  useEffect(() => {\r\n    const changeEventHandler = (): void => setBreakpoint(getScreenSize());\r\n\r\n    addMediaQueryListChangeListener(XS_MATCH_MEDIA, changeEventHandler);\r\n    addMediaQueryListChangeListener(SM_MATCH_MEDIA, changeEventHandler);\r\n    addMediaQueryListChangeListener(MD_MATCH_MEDIA, changeEventHandler);\r\n    addMediaQueryListChangeListener(LG_MATCH_MEDIA, changeEventHandler);\r\n\r\n    return () => {\r\n      removeMediaQueryListChangeListener(XS_MATCH_MEDIA, changeEventHandler);\r\n      removeMediaQueryListChangeListener(SM_MATCH_MEDIA, changeEventHandler);\r\n      removeMediaQueryListChangeListener(MD_MATCH_MEDIA, changeEventHandler);\r\n      removeMediaQueryListChangeListener(LG_MATCH_MEDIA, changeEventHandler);\r\n    };\r\n  }, []);\r\n\r\n  return breakpoint;\r\n};\r\n\r\nexport default useBreakpoint;\r\n","import classNames from 'classnames';\r\nimport React, { type ReactNode, useCallback, useLayoutEffect, useMemo, useRef, useState } from 'react';\r\n\r\nimport styles from './TileDock.module.scss';\r\n\r\nexport type CycleMode = 'stop' | 'restart' | 'endless';\r\ntype Direction = 'left' | 'right';\r\ntype Position = { x: number; y: number };\r\n\r\nexport type TileDockProps<T> = {\r\n  items: T[];\r\n  cycleMode?: CycleMode;\r\n  tilesToShow?: number;\r\n  spacing?: number;\r\n  tileHeight?: number;\r\n  minimalTouchMovement?: number;\r\n  showControls?: boolean;\r\n  showDots?: boolean;\r\n  animationModeOverride?: boolean;\r\n  wrapWithEmptyTiles?: boolean;\r\n  transitionTime?: string;\r\n  renderTile: (item: T, isInView: boolean) => ReactNode;\r\n  renderLeftControl?: (handleClick: () => void) => ReactNode;\r\n  renderRightControl?: (handleClick: () => void) => ReactNode;\r\n  renderPaginationDots?: (index: number, pageIndex: number) => ReactNode;\r\n  renderPageIndicator?: (pageIndex: number, pages: number) => ReactNode;\r\n};\r\n\r\ntype Tile<T> = {\r\n  item: T;\r\n  key: string;\r\n};\r\n\r\nconst makeTiles = <T,>(originalList: T[], slicedItems: T[]): Tile<T>[] => {\r\n  const itemIndices: string[] = [];\r\n\r\n  return slicedItems.map((item) => {\r\n    let key = `tile_${originalList.indexOf(item)}`;\r\n    while (itemIndices.includes(key)) {\r\n      key += '_';\r\n    }\r\n    itemIndices.push(key);\r\n    return { item, key };\r\n  });\r\n};\r\n\r\nconst sliceItems = <T,>(items: T[], isMultiPage: boolean, index: number, tilesToShow: number, cycleMode: CycleMode): Tile<T>[] => {\r\n  if (!isMultiPage) return makeTiles(items, items);\r\n\r\n  const sliceFrom: number = index;\r\n  const sliceTo: number = index + tilesToShow * 3;\r\n\r\n  const cycleModeEndlessCompensation: number = cycleMode === 'endless' ? tilesToShow : 0;\r\n  const listStartClone: T[] = items.slice(0, tilesToShow + cycleModeEndlessCompensation + 1);\r\n  const listEndClone: T[] = items.slice(0 - (tilesToShow + cycleModeEndlessCompensation + 1));\r\n\r\n  const itemsWithClones: T[] = [...listEndClone, ...items, ...listStartClone];\r\n  const itemsSlice: T[] = itemsWithClones.slice(sliceFrom, sliceTo + 2);\r\n\r\n  return makeTiles(items, itemsSlice);\r\n};\r\n\r\nfunction TileDock<T>({\r\n  items,\r\n  tilesToShow = 6,\r\n  cycleMode = 'endless',\r\n  spacing = 12,\r\n  minimalTouchMovement = 30,\r\n  showControls = true,\r\n  animationModeOverride,\r\n  transitionTime = '0.6s',\r\n  wrapWithEmptyTiles = false,\r\n  showDots = false,\r\n  renderTile,\r\n  renderLeftControl,\r\n  renderRightControl,\r\n  renderPaginationDots,\r\n  renderPageIndicator,\r\n}: TileDockProps<T>) {\r\n  const [index, setIndex] = useState(0);\r\n  const [slideToIndex, setSlideToIndex] = useState(0);\r\n  const [transform, setTransform] = useState(-100);\r\n  // Prevent animation mode from changing after first load\r\n  const [isAnimated] = useState(animationModeOverride ?? !window.matchMedia('(prefers-reduced-motion)').matches);\r\n  const [isAnimationDone, setIsAnimationDone] = useState(false);\r\n  const [isAnimationRunning, setIsAnimationRunning] = useState(false);\r\n\r\n  const frameRef = useRef<HTMLUListElement>() as React.MutableRefObject<HTMLUListElement>;\r\n  const tileWidth: number = 100 / tilesToShow;\r\n  const isMultiPage: boolean = items?.length > tilesToShow;\r\n  const transformWithOffset: number = isMultiPage ? 100 - tileWidth * (tilesToShow + 1) + transform : wrapWithEmptyTiles ? -100 : 0;\r\n  const pages = items.length / tilesToShow;\r\n  const tileList: Tile<T>[] = useMemo(() => {\r\n    return sliceItems<T>(items, isMultiPage, index, tilesToShow, cycleMode);\r\n  }, [items, isMultiPage, index, tilesToShow, cycleMode]);\r\n\r\n  const transitionBasis: string = isMultiPage && isAnimated && isAnimationRunning ? `transform ${transitionTime} ease` : '';\r\n\r\n  const needControls: boolean = showControls && isMultiPage;\r\n  const showLeftControl: boolean = needControls && !(cycleMode === 'stop' && index === 0);\r\n  const showRightControl: boolean = needControls && !(cycleMode === 'stop' && index === items.length - tilesToShow);\r\n\r\n  const slide = useCallback(\r\n    (direction: Direction): void => {\r\n      // Debounce slide events based on if the animation is running\r\n      if (isAnimationRunning) {\r\n        return;\r\n      }\r\n\r\n      const directionFactor = direction === 'right' ? 1 : -1;\r\n      let nextIndex: number = index + tilesToShow * directionFactor;\r\n\r\n      if (nextIndex < 0) {\r\n        if (cycleMode === 'stop') nextIndex = 0;\r\n        if (cycleMode === 'restart') nextIndex = index === 0 ? 0 - tilesToShow : 0;\r\n      }\r\n\r\n      if (nextIndex > items.length - tilesToShow) {\r\n        if (cycleMode === 'stop') nextIndex = items.length - tilesToShow;\r\n        if (cycleMode === 'restart') nextIndex = index >= items.length - tilesToShow ? items.length : items.length - tilesToShow;\r\n      }\r\n\r\n      const steps: number = Math.abs(index - nextIndex);\r\n      const movement: number = steps * tileWidth * (0 - directionFactor);\r\n\r\n      setSlideToIndex(nextIndex);\r\n      setTransform(-100 + movement);\r\n\r\n      // If this is an animated slider, start the animation 'slide'\r\n      if (isAnimated) {\r\n        setIsAnimationRunning(true);\r\n      }\r\n      // If not anmiated, trigger the post animation code right away\r\n      else {\r\n        setIsAnimationDone(true);\r\n      }\r\n    },\r\n    [isAnimated, cycleMode, index, items.length, tileWidth, tilesToShow, isAnimationRunning],\r\n  );\r\n\r\n  const handleTouchStart = useCallback(\r\n    (event: React.TouchEvent): void => {\r\n      const touchPosition: Position = {\r\n        x: event.touches[0].clientX,\r\n        y: event.touches[0].clientY,\r\n      };\r\n\r\n      function handleTouchMove(this: Document, event: TouchEvent): void {\r\n        const newPosition: Position = {\r\n          x: event.changedTouches[0].clientX,\r\n          y: event.changedTouches[0].clientY,\r\n        };\r\n        const movementX: number = Math.abs(newPosition.x - touchPosition.x);\r\n        const movementY: number = Math.abs(newPosition.y - touchPosition.y);\r\n\r\n        if (movementX > movementY && movementX > 10) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n        }\r\n      }\r\n\r\n      function handleTouchEnd(this: Document, event: TouchEvent): void {\r\n        const newPosition = {\r\n          x: event.changedTouches[0].clientX,\r\n          y: event.changedTouches[0].clientY,\r\n        };\r\n\r\n        const movementX: number = Math.abs(newPosition.x - touchPosition.x);\r\n        const movementY: number = Math.abs(newPosition.y - touchPosition.y);\r\n        const direction: Direction = newPosition.x < touchPosition.x ? 'right' : 'left';\r\n\r\n        if (movementX > minimalTouchMovement && movementX > movementY) {\r\n          slide(direction);\r\n        }\r\n\r\n        cleanup();\r\n      }\r\n\r\n      function handleTouchCancel() {\r\n        cleanup();\r\n      }\r\n\r\n      function cleanup() {\r\n        document.removeEventListener('touchmove', handleTouchMove);\r\n        document.removeEventListener('touchend', handleTouchEnd);\r\n        document.removeEventListener('touchcancel', handleTouchCancel);\r\n      }\r\n\r\n      document.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n      document.addEventListener('touchend', handleTouchEnd);\r\n      document.addEventListener('touchcancel', handleTouchCancel);\r\n    },\r\n    [minimalTouchMovement, slide],\r\n  );\r\n\r\n  // Run code after the slide animation to set the new index\r\n  useLayoutEffect(() => {\r\n    const postAnimationCleanup = (): void => {\r\n      let resetIndex: number = slideToIndex;\r\n\r\n      resetIndex = resetIndex >= items.length ? slideToIndex - items.length : resetIndex;\r\n      resetIndex = resetIndex < 0 ? items.length + slideToIndex : resetIndex;\r\n\r\n      if (resetIndex !== slideToIndex) {\r\n        setSlideToIndex(resetIndex);\r\n      }\r\n\r\n      setIndex(resetIndex);\r\n      setTransform(-100);\r\n      setIsAnimationRunning(false);\r\n      setIsAnimationDone(false);\r\n    };\r\n\r\n    if (isAnimationDone) {\r\n      postAnimationCleanup();\r\n    }\r\n  }, [isAnimationDone, index, items.length, slideToIndex, tileWidth, tilesToShow, transitionBasis]);\r\n\r\n  const handleTransitionEnd = (event: React.TransitionEvent<HTMLUListElement>) => {\r\n    if (event.target === frameRef.current) {\r\n      setIsAnimationDone(true);\r\n    }\r\n  };\r\n\r\n  const ulStyle = {\r\n    transform: `translate3d(${transformWithOffset}%, 0, 0)`,\r\n    // prettier-ignore\r\n    'WebkitTransform': `translate3d(${transformWithOffset}%, 0, 0)`,\r\n    transition: transitionBasis,\r\n    marginLeft: -spacing / 2,\r\n    marginRight: -spacing / 2,\r\n  };\r\n\r\n  const slideOffset = index - slideToIndex;\r\n\r\n  const paginationDots = () => {\r\n    if (showDots && isMultiPage && !!renderPaginationDots) {\r\n      const length = pages;\r\n\r\n      // Using aria-hidden=\"true\" due to virtualization issues, making pagination purely visual for now. This is a temporary fix pending a more accessible solution.\r\n      return (\r\n        <div aria-hidden=\"true\" className={styles.dots}>\r\n          {Array.from({ length }, (_, pageIndex) => {\r\n            return renderPaginationDots(index, pageIndex);\r\n          })}\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div className={styles.tileDock}>\r\n        {showLeftControl && !!renderLeftControl && <div className={styles.leftControl}>{renderLeftControl(() => slide('left'))}</div>}\r\n        <ul ref={frameRef} style={ulStyle} onTouchStart={handleTouchStart} onTransitionEnd={handleTransitionEnd}>\r\n          {wrapWithEmptyTiles ? (\r\n            <li\r\n              className={styles.emptyTile}\r\n              aria-hidden=\"true\"\r\n              style={{\r\n                width: `${tileWidth}%`,\r\n                paddingLeft: spacing / 2,\r\n                paddingRight: spacing / 2,\r\n                boxSizing: 'border-box',\r\n              }}\r\n            />\r\n          ) : null}\r\n          {tileList.map((tile: Tile<T>, listIndex) => {\r\n            const isInView = !isMultiPage || (listIndex > tilesToShow - slideOffset && listIndex < tilesToShow * 2 + 1 - slideOffset);\r\n\r\n            return (\r\n              <li\r\n                key={tile.key}\r\n                aria-hidden={!isInView}\r\n                className={classNames({ [styles.notInView]: !isInView })}\r\n                style={{\r\n                  width: `${tileWidth}%`,\r\n                  paddingLeft: spacing / 2,\r\n                  paddingRight: spacing / 2,\r\n                  boxSizing: 'border-box',\r\n                  transition: !isInView ? 'opacity .2s ease-in 0s' : '',\r\n                }}\r\n              >\r\n                {renderTile(tile.item, isInView)}\r\n              </li>\r\n            );\r\n          })}\r\n          {wrapWithEmptyTiles ? (\r\n            <li\r\n              className={styles.emptyTile}\r\n              aria-hidden=\"true\"\r\n              style={{\r\n                width: `${tileWidth}%`,\r\n                paddingLeft: spacing / 2,\r\n                paddingRight: spacing / 2,\r\n                boxSizing: 'border-box',\r\n              }}\r\n            />\r\n          ) : null}\r\n        </ul>\r\n        {showRightControl && !!renderRightControl && <div className={styles.rightControl}>{renderRightControl(() => slide('right'))}</div>}\r\n      </div>\r\n      {paginationDots()}\r\n      {isMultiPage && renderPageIndicator && renderPageIndicator(Math.ceil(index / tilesToShow), Math.ceil(pages))}\r\n    </React.Fragment>\r\n  );\r\n}\r\n\r\nexport default TileDock;\r\n","import * as React from \"react\";\nconst SvgLock = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { fill: \"currentColor\", d: \"M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z\" }));\nexport default SvgLock;\n","import * as React from \"react\";\nconst SvgToday = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M0 0h24v24H0z\", fill: \"none\" }), /* @__PURE__ */ React.createElement(\"path\", { d: \"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z\" }));\nexport default SvgToday;\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport styles from './Image.module.scss';\r\n\r\ntype Props = {\r\n  className?: string;\r\n  image?: string;\r\n  onLoad?: () => void;\r\n  alt?: string;\r\n  width?: number;\r\n};\r\n\r\nconst setWidth = (url: string, width: number) => {\r\n  return createURL(url, { width });\r\n};\r\n\r\nconst Image = ({ className, image, onLoad, alt = '', width = 640 }: Props) => {\r\n  const handleLoad = () => {\r\n    if (onLoad) onLoad();\r\n  };\r\n\r\n  if (!image) return null;\r\n\r\n  return <img className={classNames(className, styles.image)} src={setWidth(image, width)} onLoad={handleLoad} alt={alt} />;\r\n};\r\n\r\nexport default React.memo(Image);\r\n","import React, { memo, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Link } from 'react-router-dom';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { formatDurationTag, formatLocalizedDateTime, formatSeriesMetaString } from '@jwp/ott-common/src/utils/formatting';\r\nimport { isLiveChannel, isSeries } from '@jwp/ott-common/src/utils/media';\r\nimport { isLiveEvent, MediaStatus } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport Lock from '@jwp/ott-theme/assets/icons/lock.svg?react';\r\nimport Today from '@jwp/ott-theme/assets/icons/today.svg?react';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport type { PosterAspectRatio } from '@jwp/ott-common/src/utils/collection';\r\n\r\nimport Image from '../Image/Image';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './Card.module.scss';\r\n\r\ntype ReplaceColon<T> = T extends `${infer Left}:${infer Right}` ? `${Left}${Right}` : T;\r\ntype PosterAspectRatioClass = ReplaceColon<PosterAspectRatio>;\r\n\r\ntype CardProps = {\r\n  item: PlaylistItem;\r\n  onHover?: () => void;\r\n  progress?: number;\r\n  posterAspect?: PosterAspectRatio;\r\n  featured?: boolean;\r\n  disabled?: boolean;\r\n  loading?: boolean;\r\n  isCurrent?: boolean;\r\n  isLocked?: boolean;\r\n  currentLabel?: string;\r\n  url: string;\r\n  headingLevel?: number;\r\n  tabIndex?: number;\r\n};\r\n\r\nfunction Card({\r\n  onHover,\r\n  progress,\r\n  item,\r\n  posterAspect = '16:9',\r\n  featured = false,\r\n  disabled = false,\r\n  loading = false,\r\n  isCurrent = false,\r\n  isLocked = true,\r\n  currentLabel,\r\n  headingLevel = 3,\r\n  url,\r\n  tabIndex = 0,\r\n}: CardProps): JSX.Element {\r\n  const { title, duration, episodeNumber, seasonNumber, cardImage: image, mediaStatus, scheduledStart } = item;\r\n  const {\r\n    t,\r\n    i18n: { language },\r\n  } = useTranslation(['common', 'video']);\r\n  // t('play_item')\r\n\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n  const cardClassName = classNames(styles.card, {\r\n    [styles.featured]: featured,\r\n    [styles.disabled]: disabled,\r\n  });\r\n  const aspectRatioClass = posterAspect ? styles[`aspect${posterAspect.replace(':', '') as PosterAspectRatioClass}`] : undefined;\r\n  const posterClassNames = classNames(styles.poster, aspectRatioClass, {\r\n    [styles.current]: isCurrent,\r\n  });\r\n  const posterImageClassNames = classNames(styles.posterImage, {\r\n    [styles.visible]: imageLoaded,\r\n  });\r\n\r\n  const isSeriesItem = isSeries(item);\r\n  const isLive = mediaStatus === MediaStatus.LIVE || isLiveChannel(item);\r\n  const isScheduled = mediaStatus === MediaStatus.SCHEDULED;\r\n\r\n  const renderTag = () => {\r\n    if (loading || disabled || !title) return null;\r\n\r\n    if (isSeriesItem) {\r\n      return <div className={styles.tag}>{t('video:series')}</div>;\r\n    } else if (episodeNumber) {\r\n      return <div className={styles.tag}>{formatSeriesMetaString(seasonNumber, episodeNumber)}</div>;\r\n    } else if (duration) {\r\n      return <div className={styles.tag}>{formatDurationTag(duration)}</div>;\r\n    } else if (isLive) {\r\n      return <div className={classNames(styles.tag, styles.live)}>{t('live')}</div>;\r\n    } else if (isScheduled) {\r\n      return (\r\n        <div className={styles.tag}>\r\n          <Icon icon={Today} className={styles.scheduled} />\r\n          {t('scheduled')}\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  const heading = React.createElement(`h${headingLevel}`, { className: classNames(styles.title, { [styles.loading]: loading }) }, loading ? '' : title);\r\n\r\n  return (\r\n    <Link\r\n      role=\"button\"\r\n      to={url}\r\n      className={cardClassName}\r\n      onClick={disabled ? (e) => e.preventDefault() : undefined}\r\n      onMouseEnter={onHover}\r\n      tabIndex={disabled ? -1 : tabIndex}\r\n      data-testid={testId(title)}\r\n    >\r\n      {!featured && !disabled && (\r\n        <div className={styles.titleContainer}>\r\n          {heading}\r\n          {!!scheduledStart && isLiveEvent(item) && (\r\n            <div className={classNames(styles.scheduledStart, { [styles.loading]: loading })}>{formatLocalizedDateTime(scheduledStart, language)}</div>\r\n          )}\r\n        </div>\r\n      )}\r\n      <div className={posterClassNames}>\r\n        <Image className={posterImageClassNames} image={image} width={featured ? 640 : 320} onLoad={() => setImageLoaded(true)} alt=\"\" />\r\n        {!loading && (\r\n          <div className={styles.meta}>\r\n            {featured && !disabled && heading}\r\n            <div className={styles.tags}>\r\n              {isLocked && (\r\n                <div className={classNames(styles.tag, styles.lock)} aria-label={t('card_lock')} role=\"img\">\r\n                  <Icon icon={Lock} />\r\n                </div>\r\n              )}\r\n              {renderTag()}\r\n            </div>\r\n          </div>\r\n        )}\r\n        {isCurrent && <div className={styles.currentLabel}>{currentLabel}</div>}\r\n        {progress ? (\r\n          <div className={styles.progressContainer}>\r\n            <div className={styles.progressBar} style={{ width: `${Math.round(progress * 100)}%` }} />\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    </Link>\r\n  );\r\n}\r\n\r\nexport default memo(Card);\r\n","import React, { useCallback, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { AccessModel, ContentType } from '@jwp/ott-common/types/config';\r\nimport { isLocked } from '@jwp/ott-common/src/utils/entitlements';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { PersonalShelf } from '@jwp/ott-common/src/constants';\r\nimport ChevronLeft from '@jwp/ott-theme/assets/icons/chevron_left.svg?react';\r\nimport ChevronRight from '@jwp/ott-theme/assets/icons/chevron_right.svg?react';\r\nimport useBreakpoint, { Breakpoint, type Breakpoints } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport type { PosterAspectRatio } from '@jwp/ott-common/src/utils/collection';\r\n\r\nimport TileDock from '../TileDock/TileDock';\r\nimport Card from '../Card/Card';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './Shelf.module.scss';\r\n\r\nexport const tileBreakpoints: Breakpoints = {\r\n  [Breakpoint.xs]: 1,\r\n  [Breakpoint.sm]: 2,\r\n  [Breakpoint.md]: 3,\r\n  [Breakpoint.lg]: 4,\r\n  [Breakpoint.xl]: 5,\r\n};\r\n\r\nexport const featuredTileBreakpoints: Breakpoints = {\r\n  [Breakpoint.xs]: 1,\r\n  [Breakpoint.sm]: 1,\r\n  [Breakpoint.md]: 1,\r\n  [Breakpoint.lg]: 1,\r\n  [Breakpoint.xl]: 1,\r\n};\r\n\r\nexport type ShelfProps = {\r\n  playlist: Playlist;\r\n  type: ContentType;\r\n  onCardHover?: (playlistItem: PlaylistItem) => void;\r\n  watchHistory?: { [key: string]: number };\r\n  enableTitle?: boolean;\r\n  enableCardTitles?: boolean;\r\n  featured?: boolean;\r\n  loading?: boolean;\r\n  error?: unknown;\r\n  title?: string;\r\n  accessModel: AccessModel;\r\n  isLoggedIn: boolean;\r\n  hasSubscription: boolean;\r\n  posterAspect?: PosterAspectRatio;\r\n  visibleTilesDelta?: number;\r\n};\r\n\r\nconst Shelf = ({\r\n  playlist,\r\n  type,\r\n  onCardHover,\r\n  title,\r\n  watchHistory,\r\n  featured = false,\r\n  loading = false,\r\n  error = null,\r\n  accessModel,\r\n  isLoggedIn,\r\n  hasSubscription,\r\n  posterAspect,\r\n  visibleTilesDelta = 0,\r\n}: ShelfProps) => {\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const { t } = useTranslation('common');\r\n  const [didSlideBefore, setDidSlideBefore] = useState(false);\r\n  const tilesToShow: number = (featured ? featuredTileBreakpoints[breakpoint] : tileBreakpoints[breakpoint]) + visibleTilesDelta;\r\n\r\n  const renderTile = useCallback(\r\n    (item: PlaylistItem, isInView: boolean) => {\r\n      const url = mediaURL({ media: item, playlistId: playlist.feedid, play: type === PersonalShelf.ContinueWatching });\r\n\r\n      return (\r\n        <Card\r\n          key={item.mediaid}\r\n          progress={watchHistory ? watchHistory[item.mediaid] : undefined}\r\n          onHover={typeof onCardHover === 'function' ? () => onCardHover(item) : undefined}\r\n          featured={featured}\r\n          disabled={!isInView}\r\n          loading={loading}\r\n          isLocked={isLocked(accessModel, isLoggedIn, hasSubscription, item)}\r\n          posterAspect={posterAspect}\r\n          item={item}\r\n          url={url}\r\n        />\r\n      );\r\n    },\r\n    [watchHistory, onCardHover, featured, loading, accessModel, isLoggedIn, hasSubscription, posterAspect, playlist.feedid, type],\r\n  );\r\n\r\n  const renderRightControl = useCallback(\r\n    (doSlide: () => void) => (\r\n      <div\r\n        className={styles.chevron}\r\n        role=\"button\"\r\n        tabIndex={0}\r\n        aria-label={t('slide_next')}\r\n        onKeyDown={(event: React.KeyboardEvent) => (event.key === 'Enter' || event.key === ' ') && handleSlide(doSlide)}\r\n        onClick={() => handleSlide(doSlide)}\r\n      >\r\n        <Icon icon={ChevronRight} />\r\n      </div>\r\n    ),\r\n    [t],\r\n  );\r\n\r\n  const renderLeftControl = useCallback(\r\n    (doSlide: () => void) => (\r\n      <div\r\n        className={classNames(styles.chevron, {\r\n          [styles.disabled]: !didSlideBefore,\r\n        })}\r\n        role=\"button\"\r\n        tabIndex={didSlideBefore ? 0 : -1}\r\n        aria-label={t('slide_previous')}\r\n        onKeyDown={(event: React.KeyboardEvent) => (event.key === 'Enter' || event.key === ' ') && handleSlide(doSlide)}\r\n        onClick={() => handleSlide(doSlide)}\r\n      >\r\n        <Icon icon={ChevronLeft} />\r\n      </div>\r\n    ),\r\n    [didSlideBefore, t],\r\n  );\r\n\r\n  const renderPaginationDots = (index: number, pageIndex: number) => (\r\n    <span key={pageIndex} className={classNames(styles.dot, { [styles.active]: index === pageIndex })} />\r\n  );\r\n\r\n  const renderPageIndicator = (pageIndex: number, pages: number) => (\r\n    <div aria-live=\"polite\" className=\"hidden\">\r\n      {t('slide_indicator', { page: pageIndex + 1, pages })}\r\n    </div>\r\n  );\r\n\r\n  const handleSlide = (doSlide: () => void): void => {\r\n    setDidSlideBefore(true);\r\n    doSlide();\r\n  };\r\n\r\n  if (error || !playlist?.playlist) return <h2 className={styles.error}>Could not load items</h2>;\r\n\r\n  return (\r\n    <div className={classNames(styles.shelf)}>\r\n      {featured ? null : loading ? <div className={styles.loadingTitle} /> : <h2 className={classNames(styles.title)}>{title || playlist.title}</h2>}\r\n      <TileDock<PlaylistItem>\r\n        items={playlist.playlist}\r\n        tilesToShow={tilesToShow}\r\n        wrapWithEmptyTiles={featured && playlist.playlist.length === 1}\r\n        cycleMode={'restart'}\r\n        showControls={!loading}\r\n        showDots={featured}\r\n        transitionTime={'0.3s'}\r\n        spacing={8}\r\n        renderLeftControl={renderLeftControl}\r\n        renderRightControl={renderRightControl}\r\n        renderPaginationDots={renderPaginationDots}\r\n        renderPageIndicator={renderPageIndicator}\r\n        renderTile={renderTile}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Shelf;\r\n","import React from 'react';\r\n\r\nimport Spinner from '../Spinner/Spinner';\r\n\r\nimport styles from './InfiniteScrollLoader.module.scss';\r\n\r\nconst InfiniteScrollLoader = () => {\r\n  return (\r\n    <div className={styles.infiniteScrollLoader}>\r\n      <Spinner />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InfiniteScrollLoader;\r\n","import React, { useEffect, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport type { Content } from '@jwp/ott-common/types/config';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { slugify } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { parseAspectRatio, parseTilesDelta } from '@jwp/ott-common/src/utils/collection';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport { PersonalShelf } from '@jwp/ott-common/src/constants';\r\nimport usePlaylists from '@jwp/ott-hooks-react/src/usePlaylists';\r\n\r\nimport Shelf from '../../components/Shelf/Shelf';\r\nimport InfiniteScrollLoader from '../../components/InfiniteScrollLoader/InfiniteScrollLoader';\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\n\r\nimport styles from './ShelfList.module.scss';\r\n\r\nconst INITIAL_ROWS_TO_LOAD = 6;\r\nconst ROWS_TO_LOAD_STEP = 4;\r\n\r\ntype Props = {\r\n  rows: Content[];\r\n};\r\n\r\nconst ShelfList = ({ rows }: Props) => {\r\n  const { accessModel } = useConfigStore(({ accessModel }) => ({ accessModel }), shallow);\r\n  const [rowsToLoad, setRowsToLoad] = useState(INITIAL_ROWS_TO_LOAD);\r\n  const { t } = useTranslation('error');\r\n\r\n  const watchHistoryDictionary = useWatchHistoryStore((state) => state.getDictionaryWithSeries());\r\n\r\n  // User\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n\r\n  // Todo: move to more common package?\r\n\r\n  const playlists = usePlaylists(rows, rowsToLoad);\r\n\r\n  useEffect(() => {\r\n    // reset row count when the page changes\r\n    return () => setRowsToLoad(INITIAL_ROWS_TO_LOAD);\r\n  }, [rows]);\r\n\r\n  // If all playlists are empty (most probably due to geo restrictions), we show an empty shelves error\r\n  const allPlaylistsEmpty = playlists.every(({ data, isSuccess }) => isSuccess && !data?.playlist?.length);\r\n\r\n  if (allPlaylistsEmpty) {\r\n    return <ErrorPage title={t('empty_shelves_heading')} message={t('empty_shelves_description')} />;\r\n  }\r\n\r\n  return (\r\n    <div className={styles.shelfList}>\r\n      <InfiniteScroll\r\n        style={{ overflow: 'hidden' }}\r\n        loadMore={() => setRowsToLoad((current) => current + ROWS_TO_LOAD_STEP)}\r\n        hasMore={rowsToLoad < rows.length}\r\n        loader={<InfiniteScrollLoader key=\"loader\" />}\r\n        useWindow={false}\r\n      >\r\n        {rows.slice(0, rowsToLoad).map(({ type, featured, title }, index) => {\r\n          const { data: playlist, isPlaceholderData, error } = playlists[index];\r\n\r\n          if (!playlist?.playlist?.length) return null;\r\n\r\n          const posterAspect = parseAspectRatio(playlist.cardImageAspectRatio || playlist.shelfImageAspectRatio);\r\n          const visibleTilesDelta = parseTilesDelta(posterAspect);\r\n\r\n          return (\r\n            <section\r\n              key={`${index}_${playlist.id}`}\r\n              className={classNames(styles.shelfContainer, { [styles.featured]: featured })}\r\n              data-testid={testId(`shelf-${featured ? 'featured' : type === 'playlist' ? slugify(title || playlist?.title) : type}`)}\r\n              aria-label={title || playlist?.title}\r\n            >\r\n              <Shelf\r\n                loading={isPlaceholderData}\r\n                error={error}\r\n                type={type}\r\n                playlist={playlist}\r\n                watchHistory={type === PersonalShelf.ContinueWatching ? watchHistoryDictionary : undefined}\r\n                title={title || playlist?.title}\r\n                featured={featured}\r\n                accessModel={accessModel}\r\n                isLoggedIn={!!user}\r\n                hasSubscription={!!subscription}\r\n                posterAspect={posterAspect}\r\n                visibleTilesDelta={visibleTilesDelta}\r\n              />\r\n            </section>\r\n          );\r\n        })}\r\n      </InfiniteScroll>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ShelfList;\r\n","import React from 'react';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { Content } from '@jwp/ott-common/types/config';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport ShelfList from '../../containers/ShelfList/ShelfList';\r\n\r\nconst Home = () => {\r\n  const { config } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const content: Content[] = config?.content;\r\n  const { t } = useTranslation('common');\r\n\r\n  return (\r\n    <>\r\n      <h1 className=\"hideUntilFocus\">{t('home')}</h1>\r\n      <ShelfList rows={content} />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n","import { createStore } from './utils';\r\n\r\ntype UIState = {\r\n  searchQuery: string;\r\n  searchActive: boolean;\r\n  userMenuOpen: boolean;\r\n  sideBarOpen: boolean;\r\n  languageMenuOpen: boolean;\r\n  preSearchPage?: string;\r\n};\r\n\r\nexport const useUIStore = createStore<UIState>('UIStore', () => ({\r\n  searchQuery: '',\r\n  searchActive: false,\r\n  userMenuOpen: false,\r\n  sideBarOpen: false,\r\n  languageMenuOpen: false,\r\n}));\r\n","import { useEffect, useRef } from 'react';\r\n\r\nconst useFirstRender = () => {\r\n  const firstRenderRef = useRef(true);\r\n\r\n  useEffect(() => {\r\n    firstRenderRef.current = false;\r\n  }, []);\r\n\r\n  return firstRenderRef.current;\r\n};\r\n\r\nexport default useFirstRender;\r\n","import { type MutableRefObject, useEffect, useRef } from 'react';\r\nimport { debounce } from '@jwp/ott-common/src/utils/common';\r\n\r\nconst useDebounce = <T extends (...args: any[]) => unknown>(callback: T, time: number) => {\r\n  const fnRef = useRef() as MutableRefObject<T | undefined>;\r\n  const debounceRef = useRef(\r\n    debounce((...rest) => {\r\n      if (fnRef.current) fnRef.current(...rest);\r\n    }, time),\r\n  );\r\n\r\n  useEffect(() => {\r\n    fnRef.current = callback;\r\n  }, [callback]);\r\n\r\n  return debounceRef.current;\r\n};\r\n\r\nexport default useDebounce;\r\n","import { useCallback } from 'react';\r\nimport { useNavigate } from 'react-router';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\nimport useDebounce from '@jwp/ott-hooks-react/src/useDebounce';\r\n\r\n// Manages the query of the Search bar\r\nconst useSearchQueryUpdater = () => {\r\n  const navigate = useNavigate();\r\n\r\n  const updateSearchPath = useDebounce((query: string) => {\r\n    navigate(`/q/${encodeURIComponent(query)}`);\r\n  }, 350);\r\n  const updateSearchQuery = useCallback(\r\n    (query: string) => {\r\n      useUIStore.setState({\r\n        searchQuery: query,\r\n      });\r\n      updateSearchPath(query);\r\n    },\r\n    [updateSearchPath],\r\n  );\r\n  const resetSearchQuery = useCallback(() => {\r\n    const returnPage = useUIStore.getState().preSearchPage;\r\n\r\n    useUIStore.setState({\r\n      searchQuery: '',\r\n      preSearchPage: undefined,\r\n    });\r\n\r\n    navigate(returnPage || '/');\r\n  }, [navigate]);\r\n\r\n  return { updateSearchQuery, resetSearchQuery };\r\n};\r\n\r\nexport default useSearchQueryUpdater;\r\n","import { useQuery, useQueryClient } from 'react-query';\r\nimport type { GetPlaylistParams, Playlist } from '@jwp/ott-common/types/playlist';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { generatePlaylistPlaceholder } from '@jwp/ott-common/src/utils/collection';\r\nimport { isScheduledOrLiveMedia } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport { isTruthyCustomParamValue } from '@jwp/ott-common/src/utils/common';\r\nimport type { ApiError } from '@jwp/ott-common/src/utils/api';\r\n\r\nconst placeholderData = generatePlaylistPlaceholder(30);\r\n\r\nexport default function usePlaylist(playlistId?: string, params: GetPlaylistParams = {}, enabled: boolean = true, usePlaceholderData: boolean = true) {\r\n  const apiService = getModule(ApiService);\r\n  const queryClient = useQueryClient();\r\n\r\n  const callback = async (playlistId?: string, params?: GetPlaylistParams) => {\r\n    const playlist = await apiService.getPlaylistById(playlistId, { ...params });\r\n\r\n    // This pre-caches all playlist items and makes navigating a lot faster.\r\n    playlist?.playlist?.forEach((playlistItem) => {\r\n      queryClient.setQueryData(['media', playlistItem.mediaid], playlistItem);\r\n    });\r\n\r\n    return playlist;\r\n  };\r\n\r\n  const queryKey = ['playlist', playlistId, params];\r\n  const isEnabled = !!playlistId && enabled;\r\n\r\n  return useQuery<Playlist | undefined, ApiError>(queryKey, () => callback(playlistId, params), {\r\n    enabled: isEnabled,\r\n    placeholderData: usePlaceholderData && isEnabled ? placeholderData : undefined,\r\n    refetchInterval: (data, _) => {\r\n      if (!data) return false;\r\n\r\n      const autoRefetch = isTruthyCustomParamValue(data.refetch) || data.playlist.some(isScheduledOrLiveMedia);\r\n\r\n      return autoRefetch ? 1000 * 30 : false;\r\n    },\r\n    retry: false,\r\n  });\r\n}\r\n","import { useQuery, type UseQueryResult } from 'react-query';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport type { ApiError } from '@jwp/ott-common/src/utils/api';\r\nimport usePlaylist from '@jwp/ott-hooks-react/src/usePlaylist';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { isTruthyCustomParamValue } from '@jwp/ott-common/src/utils/common';\r\nimport type { Playlist } from '@jwp/ott-common/types/playlist';\r\nimport { generatePlaylistPlaceholder } from '@jwp/ott-common/src/utils/collection';\r\n\r\nconst placeholderData = generatePlaylistPlaceholder(30);\r\n\r\nconst useAppContentSearch = ({ siteId, enabled, query }: { query: string; siteId: string; enabled: boolean }) => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const appContentSearchQuery: UseQueryResult<Playlist | undefined, ApiError> = useQuery(\r\n    ['app-search', query],\r\n    async () => {\r\n      const searchResult = await apiService.getAppContentSearch(siteId, query);\r\n\r\n      return searchResult;\r\n    },\r\n    {\r\n      placeholderData: enabled ? placeholderData : undefined,\r\n      enabled: enabled,\r\n      staleTime: STALE_TIME,\r\n      cacheTime: CACHE_TIME,\r\n    },\r\n  );\r\n\r\n  return appContentSearchQuery;\r\n};\r\n\r\nexport const useSearch = (query: string) => {\r\n  const { config } = useConfigStore(({ config }) => ({ config }), shallow);\r\n\r\n  const siteId = config?.siteId;\r\n  const searchPlaylist = config?.features?.searchPlaylist;\r\n  const hasAppContentSearch = isTruthyCustomParamValue(config?.custom?.appContentSearch);\r\n\r\n  const playlistQuery = usePlaylist(searchPlaylist || '', { search: query || '' }, !hasAppContentSearch, !!query);\r\n  // New app content search flow\r\n  const appContentSearchQuery = useAppContentSearch({ siteId, enabled: hasAppContentSearch, query });\r\n\r\n  return hasAppContentSearch\r\n    ? { data: appContentSearchQuery.data, isFetching: appContentSearchQuery.isFetching, error: appContentSearchQuery.error }\r\n    : {\r\n        isFetching: playlistQuery.isFetching,\r\n        error: playlistQuery.error,\r\n        data: playlistQuery.data,\r\n      };\r\n};\r\n","import { throttle } from '@jwp/ott-common/src/utils/common';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport { useEffect, useRef, useState } from 'react';\r\n\r\nimport styles from './LayoutGrid.module.scss';\r\n\r\ntype Props<Item> = {\r\n  className?: string;\r\n  columnCount: number;\r\n  data: Item[];\r\n  renderCell: (item: Item, tabIndex: number) => JSX.Element;\r\n};\r\n\r\nconst scrollIntoViewThrottled = throttle(function (focusedElement: HTMLElement) {\r\n  focusedElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n}, 300);\r\n\r\n// Keyboard-accessible grid layout, with focus management\r\nconst LayoutGrid = <Item extends object>({ className, columnCount, data, renderCell }: Props<Item>) => {\r\n  const [currentRowIndex, setCurrentRowIndex] = useState(0);\r\n  const [currentColumnIndex, setCurrentColumnIndex] = useState(0);\r\n  const gridRef = useRef<HTMLDivElement>(null);\r\n  const rowCount = Math.ceil(data.length / columnCount);\r\n\r\n  const focusGridCell = (rowIndex: number, columnIndex: number) => {\r\n    const gridCell = document.getElementById(`layout_grid_${rowIndex}-${columnIndex}`) as HTMLDivElement | null;\r\n    const focusableElement = gridCell?.querySelector('button, a, input, [tabindex]:not([tabindex=\"-1\"])') as HTMLElement | null;\r\n    const elementToFocus = focusableElement || gridCell;\r\n\r\n    setCurrentRowIndex(rowIndex);\r\n    setCurrentColumnIndex(columnIndex);\r\n\r\n    if (!elementToFocus) return;\r\n\r\n    elementToFocus.focus({ preventScroll: true });\r\n    scrollIntoViewThrottled(elementToFocus);\r\n  };\r\n\r\n  const handleKeyDown = useEventCallback((event: React.KeyboardEvent<HTMLDivElement>) => {\r\n    const { key, ctrlKey } = event;\r\n\r\n    if (!['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Home', 'End', 'PageUp', 'PageDown'].includes(key)) return;\r\n\r\n    event.preventDefault();\r\n\r\n    const maxRow = rowCount - 1;\r\n    const isOnFirstColumn = currentColumnIndex === 0;\r\n    const isOnLastColumn = currentColumnIndex === columnCount - 1;\r\n    const isOnFirstRow = currentRowIndex === 0;\r\n    const isOnLastRow = currentRowIndex === maxRow;\r\n    const maxRightLastRow = (data.length % columnCount || columnCount) - 1; // Never go beyond last item\r\n    const maxRight = isOnLastRow ? maxRightLastRow : columnCount - 1;\r\n\r\n    const nextRowIndex = Math.min(currentRowIndex + 1, maxRow);\r\n    const previousRowIndex = Math.max(currentRowIndex - 1, 0);\r\n\r\n    switch (key) {\r\n      case 'ArrowLeft':\r\n        if (isOnFirstColumn && !isOnFirstRow) {\r\n          // Move to last of previous row\r\n          return focusGridCell(previousRowIndex, columnCount - 1);\r\n        }\r\n        return focusGridCell(currentRowIndex, Math.max(currentColumnIndex - 1, 0));\r\n      case 'ArrowRight':\r\n        if (isOnLastColumn && !isOnLastRow) {\r\n          // Move to first of next row\r\n          return focusGridCell(nextRowIndex, 0);\r\n        }\r\n        return focusGridCell(currentRowIndex, Math.min(currentColumnIndex + 1, maxRight));\r\n      case 'ArrowUp':\r\n        return focusGridCell(previousRowIndex, currentColumnIndex);\r\n      case 'ArrowDown':\r\n        return focusGridCell(nextRowIndex, nextRowIndex === maxRow ? Math.min(currentColumnIndex, maxRightLastRow) : currentColumnIndex);\r\n      case 'Home':\r\n        if (ctrlKey) {\r\n          return focusGridCell(0, 0);\r\n        }\r\n        return focusGridCell(currentRowIndex, 0);\r\n      case 'End':\r\n        if (ctrlKey) {\r\n          return focusGridCell(maxRow, maxRightLastRow);\r\n        }\r\n        return focusGridCell(currentRowIndex, maxRight);\r\n      case 'PageUp':\r\n        return focusGridCell(previousRowIndex, currentColumnIndex);\r\n      case 'PageDown':\r\n        return focusGridCell(nextRowIndex, nextRowIndex === maxRow ? Math.min(maxRightLastRow, currentColumnIndex) : currentColumnIndex);\r\n      default:\r\n        return;\r\n    }\r\n  });\r\n\r\n  // When the window size changes, correct indexes if necessary\r\n  useEffect(() => {\r\n    // the focused element is not within the grid element\r\n    if (!gridRef.current?.contains(document.activeElement)) {\r\n      return;\r\n    }\r\n\r\n    const maxRightLastRow = (data.length % columnCount || columnCount) - 1; // Never go beyond last item\r\n\r\n    if (currentColumnIndex > columnCount - 1) {\r\n      return focusGridCell(currentRowIndex, columnCount - 1);\r\n    }\r\n\r\n    if (currentRowIndex === rowCount - 1 && currentColumnIndex > maxRightLastRow) {\r\n      return focusGridCell(currentRowIndex, maxRightLastRow);\r\n    }\r\n    // this logic should only react when the column count changes\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [columnCount]);\r\n\r\n  return (\r\n    <div role=\"grid\" ref={gridRef} aria-rowcount={rowCount} className={className} onKeyDown={handleKeyDown}>\r\n      {Array.from({ length: rowCount }).map((_, rowIndex) => (\r\n        <div role=\"row\" key={rowIndex} aria-rowindex={rowIndex} className={styles.row}>\r\n          {data.slice(rowIndex * columnCount, rowIndex * columnCount + columnCount).map((item, columnIndex) => (\r\n            <div\r\n              role=\"gridcell\"\r\n              id={`layout_grid_${rowIndex}-${columnIndex}`}\r\n              key={columnIndex}\r\n              aria-colindex={columnIndex}\r\n              className={styles.cell}\r\n              style={{ width: `${Math.round(100 / columnCount)}%` }}\r\n            >\r\n              {renderCell(item, currentRowIndex === rowIndex && currentColumnIndex === columnIndex ? 0 : -1)}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LayoutGrid;\r\n","import React, { useEffect, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { AccessModel } from '@jwp/ott-common/types/config';\r\nimport { isLocked } from '@jwp/ott-common/src/utils/entitlements';\r\nimport { parseAspectRatio, parseTilesDelta } from '@jwp/ott-common/src/utils/collection';\r\nimport useBreakpoint, { Breakpoint, type Breakpoints } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport Card from '../Card/Card';\r\nimport InfiniteScrollLoader from '../InfiniteScrollLoader/InfiniteScrollLoader';\r\nimport LayoutGrid from '../LayoutGrid/LayoutGrid';\r\n\r\nimport styles from './CardGrid.module.scss';\r\n\r\nconst INITIAL_ROW_COUNT = 6;\r\nconst LOAD_ROWS_COUNT = 4;\r\n\r\ntype VisibleTiles = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10;\r\n\r\nconst defaultCols: Breakpoints = {\r\n  [Breakpoint.xs]: 2,\r\n  [Breakpoint.sm]: 2,\r\n  [Breakpoint.md]: 3,\r\n  [Breakpoint.lg]: 4,\r\n  [Breakpoint.xl]: 5,\r\n};\r\n\r\ntype CardGridProps = {\r\n  playlist: Playlist;\r\n  watchHistory?: { [key: string]: number };\r\n  isLoading: boolean;\r\n  cols?: Breakpoints;\r\n  currentCardItem?: PlaylistItem;\r\n  currentCardLabel?: string;\r\n  accessModel: AccessModel;\r\n  isLoggedIn: boolean;\r\n  hasSubscription: boolean;\r\n  hasMore?: boolean;\r\n  headingLevel?: number;\r\n  loadMore?: () => void;\r\n  onCardHover?: (item: PlaylistItem) => void;\r\n  getUrl: (item: PlaylistItem) => string;\r\n};\r\n\r\nfunction CardGrid({\r\n  playlist,\r\n  watchHistory,\r\n  isLoading = false,\r\n  cols = defaultCols,\r\n  currentCardItem,\r\n  currentCardLabel,\r\n  accessModel,\r\n  isLoggedIn,\r\n  hasSubscription,\r\n  hasMore,\r\n  getUrl,\r\n  loadMore,\r\n  onCardHover,\r\n  headingLevel,\r\n}: CardGridProps) {\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const posterAspect = parseAspectRatio(playlist.cardImageAspectRatio || playlist.shelfImageAspectRatio);\r\n  const visibleTiles = (cols[breakpoint] + parseTilesDelta(posterAspect)) as VisibleTiles;\r\n  const [rowCount, setRowCount] = useState(INITIAL_ROW_COUNT);\r\n\r\n  const defaultLoadMore = () => setRowCount((current) => current + LOAD_ROWS_COUNT);\r\n  const defaultHasMore = rowCount * visibleTiles < playlist.playlist.length;\r\n\r\n  useEffect(() => {\r\n    // reset row count when the page changes\r\n    setRowCount(INITIAL_ROW_COUNT);\r\n  }, [playlist.feedid]);\r\n\r\n  return (\r\n    <InfiniteScroll\r\n      pageStart={0}\r\n      loadMore={loadMore ?? defaultLoadMore}\r\n      hasMore={hasMore ?? defaultHasMore}\r\n      loader={<InfiniteScrollLoader key=\"loader\" />}\r\n      useWindow={false}\r\n    >\r\n      <LayoutGrid\r\n        className={classNames(styles.container, styles[`cols-${visibleTiles}`])}\r\n        data={loadMore ? playlist.playlist : playlist.playlist.slice(0, rowCount * visibleTiles)}\r\n        columnCount={visibleTiles}\r\n        renderCell={(playlistItem: PlaylistItem, tabIndex: number) => (\r\n          <Card\r\n            tabIndex={tabIndex}\r\n            progress={watchHistory ? watchHistory[playlistItem.mediaid] : undefined}\r\n            url={getUrl(playlistItem)}\r\n            onHover={typeof onCardHover === 'function' ? () => onCardHover(playlistItem) : undefined}\r\n            loading={isLoading}\r\n            isCurrent={currentCardItem && currentCardItem.mediaid === playlistItem.mediaid}\r\n            currentLabel={currentCardLabel}\r\n            isLocked={isLocked(accessModel, isLoggedIn, hasSubscription, playlistItem)}\r\n            posterAspect={posterAspect}\r\n            item={playlistItem}\r\n            headingLevel={headingLevel}\r\n          />\r\n        )}\r\n      />\r\n    </InfiniteScroll>\r\n  );\r\n}\r\n\r\nexport default CardGrid;\r\n","import React, { useEffect, useMemo } from 'react';\r\nimport { useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport useFirstRender from '@jwp/ott-hooks-react/src/useFirstRender';\r\nimport useSearchQueryUpdater from '@jwp/ott-ui-react/src/hooks/useSearchQueryUpdater';\r\nimport { useSearch } from '@jwp/ott-hooks-react/src/useSearch';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport CardGrid from '../../components/CardGrid/CardGrid';\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\n\r\nimport styles from './Search.module.scss';\r\n\r\nconst Search = () => {\r\n  const { t } = useTranslation('search');\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const { siteName, features } = config;\r\n  const headingId = useOpaqueId('search_heading');\r\n\r\n  const firstRender = useFirstRender();\r\n  const searchQuery = useUIStore((state) => state.searchQuery);\r\n  const { updateSearchQuery } = useSearchQueryUpdater();\r\n  const params = useParams();\r\n  const query = params['*'];\r\n  const { isFetching, error, data: playlist } = useSearch(query || '');\r\n\r\n  // User\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n\r\n  const getURL = (playlistItem: PlaylistItem) =>\r\n    mediaURL({\r\n      media: playlistItem,\r\n      playlistId: features?.searchPlaylist,\r\n    });\r\n\r\n  const title = useMemo(() => {\r\n    if (isFetching) return t('heading');\r\n    if (!query) return t('start_typing');\r\n    if (!playlist?.playlist.length) return t('no_results_heading', { query });\r\n\r\n    return t('title', { count: playlist.playlist.length, query });\r\n  }, [isFetching, playlist?.playlist.length, query, t]);\r\n\r\n  // Update the search bar query to match the route param on mount\r\n  useEffect(() => {\r\n    if (!firstRender) {\r\n      return;\r\n    }\r\n\r\n    if (query && query !== searchQuery) {\r\n      updateSearchQuery(query);\r\n    }\r\n  }, [firstRender, query, searchQuery, updateSearchQuery]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      useUIStore.setState({\r\n        searchQuery: '',\r\n        searchActive: false,\r\n      });\r\n    };\r\n  }, []);\r\n\r\n  if ((error || !playlist) && !isFetching) {\r\n    return (\r\n      <ErrorPage title={t('error_heading')}>\r\n        <h2 className={styles.subHeading}>{t('error_subheading')}</h2>\r\n        <p>{t('error_description')}</p>\r\n      </ErrorPage>\r\n    );\r\n  }\r\n\r\n  if (!query) {\r\n    return <ErrorPage title={title} />;\r\n  }\r\n\r\n  if (!playlist?.playlist.length) {\r\n    return (\r\n      <>\r\n        <Helmet>\r\n          <title>\r\n            {title} - {siteName}\r\n          </title>\r\n        </Helmet>\r\n        <ErrorPage title={title}>\r\n          <h2 className={styles.subHeading}>{t('suggestions')}</h2>\r\n          <ul>\r\n            <li>{t('tip_one')}</li>\r\n            <li>{t('tip_two')}</li>\r\n            <li>{t('tip_three')}</li>\r\n          </ul>\r\n        </ErrorPage>\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={styles.search}>\r\n      <Helmet>\r\n        <title>\r\n          {title} - {siteName}\r\n        </title>\r\n      </Helmet>\r\n      <header className={styles.header}>\r\n        <h2 id={headingId} aria-live={isFetching ? undefined : 'polite'}>\r\n          {title}\r\n        </h2>\r\n      </header>\r\n      <CardGrid\r\n        aria-labelledby={headingId}\r\n        getUrl={getURL}\r\n        playlist={playlist}\r\n        isLoading={firstRender}\r\n        accessModel={accessModel}\r\n        isLoggedIn={!!user}\r\n        hasSubscription={!!subscription}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Search;\r\n","import type { ProfilesData } from '@inplayer-org/inplayer.js';\r\nimport { useMutation, useQuery, type UseMutationOptions, type UseQueryOptions } from 'react-query';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { GenericFormErrors } from '@jwp/ott-common/types/form';\r\nimport type { CommonAccountResponse } from '@jwp/ott-common/types/account';\r\nimport type { ListProfilesResponse, ProfileDetailsPayload, ProfileFormSubmitError, ProfileFormValues, ProfilePayload } from '@jwp/ott-common/types/profiles';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useProfileStore } from '@jwp/ott-common/src/stores/ProfileStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport ProfileController from '@jwp/ott-common/src/controllers/ProfileController';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { logDev } from '@jwp/ott-common/src/utils/common';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\n\r\nexport const useSelectProfile = (options?: { onSuccess: () => void; onError: () => void }) => {\r\n  const accountController = getModule(AccountController, false);\r\n  const profileController = getModule(ProfileController, false);\r\n\r\n  return useMutation(async (vars: { id: string; pin?: number; avatarUrl: string }) => profileController?.enterProfile({ id: vars.id, pin: vars.pin }), {\r\n    onMutate: ({ avatarUrl }) => {\r\n      useProfileStore.setState({ selectingProfileAvatar: avatarUrl });\r\n    },\r\n    onSuccess: async () => {\r\n      useProfileStore.setState({ selectingProfileAvatar: null });\r\n      await accountController?.loadUserData();\r\n      options?.onSuccess?.();\r\n    },\r\n    onError: () => {\r\n      useProfileStore.setState({ selectingProfileAvatar: null });\r\n      logDev('Unable to enter profile');\r\n      options?.onError?.();\r\n    },\r\n  });\r\n};\r\n\r\nexport const useCreateProfile = (options?: UseMutationOptions<ProfilesData | undefined, unknown, ProfilePayload, unknown>) => {\r\n  const { query: listProfiles } = useProfiles();\r\n\r\n  const profileController = getModule(ProfileController, false);\r\n\r\n  return useMutation<ProfilesData | undefined, unknown, ProfilePayload, unknown>(async (data) => profileController?.createProfile(data), {\r\n    ...options,\r\n    onSuccess: (data, variables, context) => {\r\n      listProfiles.refetch();\r\n\r\n      options?.onSuccess?.(data, variables, context);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateProfile = (options?: UseMutationOptions<ProfilesData | undefined, unknown, ProfilePayload, unknown>) => {\r\n  const { query: listProfiles } = useProfiles();\r\n\r\n  const profileController = getModule(ProfileController, false);\r\n\r\n  return useMutation(async (data) => profileController?.updateProfile(data), {\r\n    ...options,\r\n    onSettled: (...args) => {\r\n      listProfiles.refetch();\r\n\r\n      options?.onSettled?.(...args);\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteProfile = (options?: UseMutationOptions<CommonAccountResponse | undefined, unknown, ProfileDetailsPayload, unknown>) => {\r\n  const { query: listProfiles } = useProfiles();\r\n\r\n  const profileController = getModule(ProfileController, false);\r\n\r\n  return useMutation<CommonAccountResponse | undefined, unknown, ProfileDetailsPayload, unknown>(async (id) => profileController?.deleteProfile(id), {\r\n    ...options,\r\n    onSuccess: (...args) => {\r\n      listProfiles.refetch();\r\n\r\n      options?.onSuccess?.(...args);\r\n    },\r\n  });\r\n};\r\n\r\nexport const isProfileFormSubmitError = (e: unknown): e is ProfileFormSubmitError => {\r\n  return !!e && typeof e === 'object' && 'message' in e;\r\n};\r\n\r\nexport const useProfileErrorHandler = () => {\r\n  const { t } = useTranslation('user');\r\n\r\n  return (e: unknown, setErrors: (errors: Partial<ProfileFormValues & GenericFormErrors>) => void) => {\r\n    if (isProfileFormSubmitError(e) && e.message.includes('409')) {\r\n      setErrors({ name: t('profile.validation.name.already_exists') });\r\n      return;\r\n    }\r\n    setErrors({ form: t('profile.form_error') });\r\n  };\r\n};\r\n\r\nexport const useProfiles = (options?: UseQueryOptions<ListProfilesResponse | undefined, unknown, ListProfilesResponse | undefined, string[]>) => {\r\n  const user = useAccountStore((state) => state.user);\r\n  const accessModel = useConfigStore((state) => state.accessModel);\r\n  const { profile } = useProfileStore();\r\n  const isLoggedIn = !!user;\r\n\r\n  const profileController = getModule(ProfileController);\r\n\r\n  const profilesEnabled = profileController.isEnabled();\r\n\r\n  const query = useQuery(['listProfiles', user?.id || ''], () => profileController.listProfiles(), {\r\n    ...options,\r\n    enabled: isLoggedIn && profilesEnabled,\r\n  });\r\n\r\n  const shouldManageProfiles = !!user && profilesEnabled && query.data?.canManageProfiles && !profile && (accessModel === 'SVOD' || accessModel === 'AUTHVOD');\r\n\r\n  return {\r\n    query,\r\n    shouldManageProfiles,\r\n    profilesEnabled: !!query.data?.canManageProfiles,\r\n  };\r\n};\r\n","import * as React from \"react\";\nconst SvgAccountCircle = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12,19.2C9.5,19.2 7.29,17.92 6,16C6.03,14 10,12.9 12,12.9C14,12.9 17.97,14 18,16C16.71,17.92 14.5,19.2 12,19.2M12,5A3,3 0 0,1 15,8A3,3 0 0,1 12,11A3,3 0 0,1 9,8A3,3 0 0,1 12,5M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z\" }));\nexport default SvgAccountCircle;\n","import * as React from \"react\";\nconst SvgBalanceWallet = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M5,3C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V16.72C21.59,16.37 22,15.74 22,15V9C22,8.26 21.59,7.63 21,7.28V5A2,2 0 0,0 19,3H5M5,5H19V7H13A2,2 0 0,0 11,9V15A2,2 0 0,0 13,17H19V19H5V5M13,9H20V15H13V9M16,10.5A1.5,1.5 0 0,0 14.5,12A1.5,1.5 0 0,0 16,13.5A1.5,1.5 0 0,0 17.5,12A1.5,1.5 0 0,0 16,10.5Z\" }));\nexport default SvgBalanceWallet;\n","import * as React from \"react\";\nconst SvgExit = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M19,3H5C3.89,3 3,3.89 3,5V9H5V5H19V19H5V15H3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10.08,15.58L11.5,17L16.5,12L11.5,7L10.08,8.41L12.67,11H3V13H12.67L10.08,15.58Z\" }));\nexport default SvgExit;\n","import * as React from \"react\";\nconst SvgFavorite = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\" }));\nexport default SvgFavorite;\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport Dialog from '../Dialog/Dialog';\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './Alert.module.scss';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  message: string | null;\r\n  onClose: () => void;\r\n  isSuccess?: boolean;\r\n  actionsOverride?: React.ReactNode;\r\n  titleOverride?: string;\r\n};\r\n\r\nconst Alert: React.FC<Props> = ({ open, message, onClose, isSuccess, actionsOverride, titleOverride }: Props) => {\r\n  const { t } = useTranslation('common');\r\n  const headingId = useOpaqueId('alert-heading');\r\n\r\n  return (\r\n    <Dialog open={open} onClose={onClose} role=\"alertdialog\" aria-modal=\"true\" aria-labelledby={headingId}>\r\n      <h2 id={headingId} className={styles.title}>\r\n        {titleOverride ?? (isSuccess ? t('alert.success') : t('alert.title'))}\r\n      </h2>\r\n      <p className={styles.body}>{message}</p>\r\n      {actionsOverride ?? <Button label={t('alert.close')} variant=\"outlined\" onClick={onClose} fullWidth />}\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default Alert;\r\n","import React, { useCallback, useContext, type ReactElement, type ReactNode } from 'react';\r\nimport type { GenericFormValues } from '@jwp/ott-common/types/form';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\n\r\nimport Button from '../Button/Button';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\n\r\nimport styles from './Form.module.scss';\r\nimport { FormContext } from './Form';\r\n\r\nexport interface FormSectionContentArgs<T extends GenericFormValues, TErrors> {\r\n  values: T;\r\n  isEditing: boolean;\r\n  isBusy: boolean;\r\n  onChange: React.ChangeEventHandler<HTMLInputElement | HTMLTextAreaElement>;\r\n  errors?: TErrors | undefined;\r\n}\r\n\r\nexport interface FormSectionProps<TData extends GenericFormValues, TErrors> {\r\n  className?: string;\r\n  panelHeaderClassName?: string;\r\n  label: string;\r\n  editButton?: string | ReactElement;\r\n  saveButton?: string;\r\n  cancelButton?: string;\r\n  onSubmit?: (values: TData) => Promise<{ errors?: string[] }>;\r\n  content?: (args: FormSectionContentArgs<TData, TErrors>) => ReactNode;\r\n  children?: never;\r\n  readOnly?: boolean;\r\n}\r\n\r\nexport function FormSection<TData extends GenericFormValues>({\r\n  className,\r\n  panelHeaderClassName,\r\n  label,\r\n  editButton,\r\n  saveButton,\r\n  cancelButton,\r\n  onSubmit,\r\n  content,\r\n  readOnly = false,\r\n}: FormSectionProps<TData, string[]>): ReactElement<FormSectionProps<TData, string[]>> | null {\r\n  const sectionId = useOpaqueId(label);\r\n  const {\r\n    formState: { values, activeSectionId, errors: formErrors, isBusy },\r\n    setFormState,\r\n    isLoading,\r\n    onCancel,\r\n  } = useContext(FormContext) as FormContext<TData>;\r\n\r\n  const isEditing = sectionId === activeSectionId;\r\n\r\n  const onChange = useCallback(\r\n    ({ currentTarget }: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>) => {\r\n      if (!currentTarget) return;\r\n\r\n      const { name, type } = currentTarget;\r\n      const value = type === 'checkbox' ? (currentTarget as HTMLInputElement).checked : currentTarget.value;\r\n\r\n      if (!isEditing) {\r\n        onCancel();\r\n      }\r\n\r\n      setFormState((oldState) => {\r\n        const newValues = { ...oldState.values };\r\n\r\n        // This logic handles nested names like 'consents.terms'\r\n        name.split('.').reduce((parent, field, index, arr) => {\r\n          if (index === arr.length - 1) {\r\n            parent[field] = value;\r\n          } else {\r\n            parent[field] = { ...parent[field] } || {};\r\n          }\r\n\r\n          return parent[field];\r\n        }, newValues);\r\n\r\n        return {\r\n          ...oldState,\r\n          values: newValues,\r\n          activeSectionId: sectionId,\r\n        };\r\n      });\r\n    },\r\n    [isEditing, onCancel, sectionId, setFormState],\r\n  );\r\n\r\n  const handleSubmit = useCallback(\r\n    async function handleSubmit(event?: React.FormEvent) {\r\n      event && event.preventDefault();\r\n\r\n      if (onSubmit) {\r\n        let response: { errors?: string[] };\r\n\r\n        try {\r\n          setFormState((s) => {\r\n            return { ...s, isBusy: true, errors: [] };\r\n          });\r\n          response = await onSubmit(values);\r\n        } catch (error: unknown) {\r\n          response = { errors: Array.of(error instanceof Error ? error.message : (error as string)) };\r\n        }\r\n\r\n        // Don't leave edit mode if there are errors\r\n        if (response?.errors?.length) {\r\n          setFormState((s) => {\r\n            return {\r\n              ...s,\r\n              errors: response?.errors,\r\n              isBusy: false,\r\n            };\r\n          });\r\n\r\n          return;\r\n        }\r\n      }\r\n\r\n      setFormState((s) => {\r\n        return {\r\n          ...s,\r\n          activeSectionId: undefined,\r\n          isBusy: false,\r\n        };\r\n      });\r\n    },\r\n    [onSubmit, setFormState, values],\r\n  );\r\n\r\n  const onEdit = useCallback(\r\n    function onEdit() {\r\n      if (!isEditing) {\r\n        onCancel();\r\n        setFormState((s) => {\r\n          return {\r\n            ...s,\r\n            activeSectionId: sectionId,\r\n          };\r\n        });\r\n      }\r\n    },\r\n    [isEditing, onCancel, sectionId, setFormState],\r\n  );\r\n\r\n  return (\r\n    <section aria-labelledby={sectionId} className={className}>\r\n      <div className={panelHeaderClassName}>\r\n        <h2 id={sectionId}>{label}</h2>\r\n      </div>\r\n      {isBusy && isEditing && <LoadingOverlay transparentBackground />}\r\n      {content && (\r\n        <form className={styles.flexBox} noValidate onSubmit={(event) => event.preventDefault()}>\r\n          {content({\r\n            values,\r\n            isEditing,\r\n            isBusy,\r\n            onChange,\r\n            ...(isEditing ? { errors: formErrors } : {}),\r\n          })}\r\n        </form>\r\n      )}\r\n      {(saveButton || editButton || cancelButton) && (\r\n        <div className={styles.controls}>\r\n          {isEditing ? (\r\n            <>\r\n              {saveButton && <Button label={saveButton} type=\"submit\" onClick={handleSubmit} disabled={isLoading} />}\r\n              {cancelButton && <Button label={cancelButton} type=\"reset\" variant=\"text\" onClick={onCancel} />}\r\n            </>\r\n          ) : (\r\n            !readOnly &&\r\n            editButton &&\r\n            (typeof editButton === 'object' ? (\r\n              (editButton as ReactElement)\r\n            ) : (\r\n              <Button label={editButton as string} type=\"button\" onClick={onEdit} disabled={isLoading} />\r\n            ))\r\n          )}\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n","import React, { createContext, useCallback, useEffect, useState, type SetStateAction } from 'react';\r\nimport type { GenericFormValues } from '@jwp/ott-common/types/form';\r\n\r\nimport type { FormSectionProps } from './FormSection';\r\nimport { FormSection } from './FormSection';\r\n\r\ninterface Props<TData> {\r\n  initialValues: TData;\r\n  isLoading?: boolean;\r\n  onReset?: () => void;\r\n  children?: FormSectionProps<TData, string[]>[];\r\n}\r\n\r\nexport interface FormContext<TData> {\r\n  isLoading?: boolean;\r\n  onCancel: () => void;\r\n  formState: FormState<TData>;\r\n  setFormState: React.Dispatch<SetStateAction<FormState<TData>>>;\r\n}\r\n\r\ninterface FormState<TData> {\r\n  values: TData;\r\n  activeSectionId: string | undefined;\r\n  isDirty: boolean;\r\n  isBusy: boolean;\r\n  errors?: string[];\r\n}\r\n\r\nexport const FormContext = createContext<FormContext<GenericFormValues> | undefined>(undefined);\r\n\r\nfunction Form<TData extends GenericFormValues>({ isLoading, initialValues, onReset, children }: Props<TData>): JSX.Element {\r\n  const [state, setState] = useState<FormState<TData>>({\r\n    values: initialValues,\r\n    activeSectionId: undefined,\r\n    isDirty: false,\r\n    isBusy: false,\r\n  });\r\n\r\n  const onCancel = useCallback(\r\n    function onCancel() {\r\n      setState((s) => {\r\n        return {\r\n          ...s,\r\n          values: initialValues,\r\n          isDirty: false,\r\n          activeSectionId: undefined,\r\n          success: false,\r\n          errors: undefined,\r\n        };\r\n      });\r\n      onReset && onReset();\r\n    },\r\n    [initialValues, onReset],\r\n  );\r\n\r\n  useEffect(() => {\r\n    // Don't overwrite values if a section is being edited, since that would wipe out anything the user has entered\r\n    if (!state.activeSectionId) {\r\n      setState((s) => {\r\n        return {\r\n          ...s,\r\n          values: initialValues,\r\n        };\r\n      });\r\n    }\r\n  }, [initialValues, state.activeSectionId]);\r\n\r\n  return (\r\n    <FormContext.Provider\r\n      value={{\r\n        isLoading,\r\n        onCancel,\r\n        formState: state,\r\n        setFormState: setState,\r\n      }}\r\n    >\r\n      {children?.map((props, i) => (\r\n        <FormSection<TData> key={i} {...props} />\r\n      ))}\r\n    </FormContext.Provider>\r\n  );\r\n}\r\n\r\nexport default Form;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Trans, useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport DOMPurify from 'dompurify';\r\nimport { useMutation } from 'react-query';\r\nimport type { CustomFormField } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { isTruthy, isTruthyCustomParamValue, logDev, testId } from '@jwp/ott-common/src/utils/common';\r\nimport { formatConsents, formatConsentsFromValues, formatConsentsToRegisterFields, formatConsentValues } from '@jwp/ott-common/src/utils/collection';\r\nimport useToggle from '@jwp/ott-hooks-react/src/useToggle';\r\nimport Visibility from '@jwp/ott-theme/assets/icons/visibility.svg?react';\r\nimport VisibilityOff from '@jwp/ott-theme/assets/icons/visibility_off.svg?react';\r\nimport env from '@jwp/ott-common/src/env';\r\n\r\nimport type { FormSectionContentArgs, FormSectionProps } from '../Form/FormSection';\r\nimport Alert from '../Alert/Alert';\r\nimport Button from '../Button/Button';\r\nimport Form from '../Form/Form';\r\nimport IconButton from '../IconButton/IconButton';\r\nimport FormFeedback from '../FormFeedback/FormFeedback';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Checkbox from '../form-fields/Checkbox/Checkbox';\r\nimport CustomRegisterField from '../CustomRegisterField/CustomRegisterField';\r\nimport Icon from '../Icon/Icon';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\nimport { useAriaAnnouncer } from '../../containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport styles from './Account.module.scss';\r\n\r\ntype Props = {\r\n  panelClassName?: string;\r\n  panelHeaderClassName?: string;\r\n  canUpdateEmail?: boolean;\r\n};\r\n\r\ninterface FormErrors {\r\n  email?: string;\r\n  confirmationPassword?: string;\r\n  firstName?: string;\r\n  lastName?: string;\r\n  form?: string;\r\n}\r\n\r\nconst Account = ({ panelClassName, panelHeaderClassName, canUpdateEmail = true }: Props): JSX.Element => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { t, i18n } = useTranslation('user');\r\n  const announce = useAriaAnnouncer();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [viewPassword, toggleViewPassword] = useToggle();\r\n  const exportData = useMutation(accountController.exportAccountData);\r\n  const [isAlertVisible, setIsAlertVisible] = useState(false);\r\n  const exportDataMessage = exportData.isSuccess ? t('account.export_data_success') : t('account.export_data_error');\r\n  const htmlLang = i18n.language !== env.APP_DEFAULT_LANGUAGE ? env.APP_DEFAULT_LANGUAGE : undefined;\r\n\r\n  useEffect(() => {\r\n    if (exportData.isSuccess || exportData.isError) {\r\n      setIsAlertVisible(true);\r\n    }\r\n  }, [exportData.isSuccess, exportData.isError]);\r\n\r\n  const { customer, customerConsents, publisherConsents } = useAccountStore(\r\n    ({ user, customerConsents, publisherConsents }) => ({\r\n      customer: user,\r\n      customerConsents,\r\n      publisherConsents,\r\n    }),\r\n    shallow,\r\n  );\r\n\r\n  const { canChangePasswordWithOldPassword, canExportAccountData, canDeleteAccount } = accountController.getFeatures();\r\n  // users authenticated with social (register_source: facebook, google, twitter) do not have password by default\r\n  const registerSource = customer?.metadata?.register_source;\r\n  const isSocialLogin = (registerSource && registerSource !== 'inplayer') || false;\r\n  const shouldAddPassword = (isSocialLogin && !customer?.metadata?.has_password) || false;\r\n\r\n  // load consents (move to `useConsents` hook?)\r\n  useEffect(() => {\r\n    if (!publisherConsents) {\r\n      accountController.getPublisherConsents();\r\n\r\n      return;\r\n    }\r\n  }, [accountController, publisherConsents]);\r\n\r\n  const [termsConsents, nonTermsConsents] = useMemo(() => {\r\n    const terms: CustomFormField[] = [];\r\n    const nonTerms: CustomFormField[] = [];\r\n\r\n    publisherConsents?.forEach((consent) => {\r\n      if (!consent?.type || consent?.type === 'checkbox') {\r\n        terms.push(consent);\r\n      } else {\r\n        nonTerms.push(consent);\r\n      }\r\n    });\r\n\r\n    return [terms, nonTerms];\r\n  }, [publisherConsents]);\r\n\r\n  const consents = useMemo(() => formatConsents(publisherConsents, customerConsents), [publisherConsents, customerConsents]);\r\n\r\n  const consentsValues = useMemo(() => formatConsentValues(publisherConsents, customerConsents), [publisherConsents, customerConsents]);\r\n\r\n  const initialValues = useMemo(\r\n    () => ({\r\n      ...customer,\r\n      consents,\r\n      consentsValues,\r\n      confirmationPassword: '',\r\n    }),\r\n    [customer, consents, consentsValues],\r\n  );\r\n\r\n  const formatConsentLabel = (label: string): string | JSX.Element => {\r\n    const sanitizedLabel = DOMPurify.sanitize(label);\r\n    const hasHrefOpenTag = /<a(.|\\n)*?>/.test(sanitizedLabel);\r\n    const hasHrefCloseTag = /<\\/a(.|\\n)*?>/.test(sanitizedLabel);\r\n\r\n    if (hasHrefOpenTag && hasHrefCloseTag) {\r\n      return <span dangerouslySetInnerHTML={{ __html: label }} />;\r\n    }\r\n\r\n    return label;\r\n  };\r\n\r\n  function translateErrors(errors?: string[]): FormErrors {\r\n    const formErrors: FormErrors = {};\r\n    // Some errors are combined in a single CSV string instead of one string per error\r\n    errors\r\n      ?.flatMap((e) => e.split(','))\r\n      .forEach((error) => {\r\n        switch (error.trim()) {\r\n          case 'Invalid param email':\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.email = t('account.errors.invalid_param_email');\r\n            break;\r\n          case 'Customer email already exists':\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.email = t('account.errors.email_exists');\r\n            break;\r\n          case 'Please enter a valid e-mail address.':\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.email = t('account.errors.please_enter_valid_email');\r\n            break;\r\n          case 'Invalid confirmationPassword': {\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.confirmationPassword = t('account.errors.invalid_password');\r\n            break;\r\n          }\r\n          case 'firstName can have max 50 characters.': {\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.firstName = t('account.errors.first_name_too_long');\r\n            break;\r\n          }\r\n          case 'lastName can have max 50 characters.': {\r\n            formErrors.form = t('account.errors.validation_error');\r\n            formErrors.lastName = t('account.errors.last_name_too_long');\r\n            break;\r\n          }\r\n          case 'Email update not supported': {\r\n            formErrors.form = t('account.errors.email_update_not_supported');\r\n            break;\r\n          }\r\n          case 'Wrong email/password combination': {\r\n            formErrors.form = t('account.errors.wrong_combination');\r\n            break;\r\n          }\r\n          default: {\r\n            formErrors.form = t('account.errors.unknown_error');\r\n            logDev('Unknown error', error);\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n    return formErrors;\r\n  }\r\n\r\n  function formSection(props: FormSectionProps<typeof initialValues, FormErrors>) {\r\n    return {\r\n      ...props,\r\n      className: panelClassName,\r\n      panelHeaderClassName: panelHeaderClassName,\r\n      saveButton: t('account.save'),\r\n      cancelButton: t('account.cancel'),\r\n      content: (args: FormSectionContentArgs<typeof initialValues, string[]>) => {\r\n        // This function just allows the sections below to use the FormError type instead of an array of errors\r\n        const formErrors = translateErrors(args.errors);\r\n\r\n        // Render the section content, but also add a warning text if there's a form level error\r\n        return (\r\n          <>\r\n            {formErrors?.form ? <FormFeedback variant=\"error\">{formErrors.form}</FormFeedback> : null}\r\n            {props.content?.({ ...args, errors: formErrors })}\r\n          </>\r\n        );\r\n      },\r\n    };\r\n  }\r\n\r\n  const editPasswordClickHandler = async () => {\r\n    if (!customer) {\r\n      return;\r\n    }\r\n    if (isSocialLogin && shouldAddPassword) {\r\n      await accountController.resetPassword(customer.email, '');\r\n      return navigate(modalURLFromLocation(location, 'add-password'));\r\n    }\r\n\r\n    navigate(modalURLFromLocation(location, canChangePasswordWithOldPassword ? 'edit-password' : 'reset-password'));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <h1 className=\"hideUntilFocus\">{t('nav.account')}</h1>\r\n\r\n      <Form initialValues={initialValues}>\r\n        {[\r\n          formSection({\r\n            label: t('account.about_you'),\r\n            editButton: t('account.edit_information'),\r\n            onSubmit: async (values) => {\r\n              const consents = formatConsentsFromValues(publisherConsents, { ...values.metadata, ...values.consentsValues });\r\n\r\n              const response = await accountController.updateUser({\r\n                firstName: values.firstName || '',\r\n                lastName: values.lastName || '',\r\n                metadata: {\r\n                  ...values.metadata,\r\n                  ...formatConsentsToRegisterFields(consents),\r\n                  consents: JSON.stringify(consents),\r\n                },\r\n              });\r\n\r\n              announce(t('account.update_success', { section: t('account.about_you') }), 'success');\r\n\r\n              return response;\r\n            },\r\n            content: (section) => (\r\n              <>\r\n                <TextField\r\n                  name=\"firstName\"\r\n                  label={t('account.firstname')}\r\n                  value={section.values.firstName || ''}\r\n                  onChange={section.onChange}\r\n                  error={!!section.errors?.firstName}\r\n                  helperText={section.errors?.firstName}\r\n                  disabled={section.isBusy}\r\n                  editing={section.isEditing}\r\n                  autoComplete=\"given-name\"\r\n                  lang={htmlLang}\r\n                />\r\n                <TextField\r\n                  name=\"lastName\"\r\n                  label={t('account.lastname')}\r\n                  value={section.values.lastName || ''}\r\n                  onChange={section.onChange}\r\n                  error={!!section.errors?.lastName}\r\n                  helperText={section.errors?.lastName}\r\n                  disabled={section.isBusy}\r\n                  editing={section.isEditing}\r\n                  autoComplete=\"family-name\"\r\n                  lang={htmlLang}\r\n                />\r\n              </>\r\n            ),\r\n          }),\r\n          formSection({\r\n            label: t('account.email'),\r\n            onSubmit: async (values) => {\r\n              if (!values.email || !values.confirmationPassword) {\r\n                throw new Error('Wrong email/password combination');\r\n              }\r\n              const response = await accountController.updateUser({\r\n                email: values.email || '',\r\n                confirmationPassword: values.confirmationPassword,\r\n              });\r\n\r\n              announce(t('account.update_success', { section: t('account.email') }), 'success');\r\n\r\n              return response;\r\n            },\r\n            editButton: t('account.edit_account'),\r\n            readOnly: !canUpdateEmail,\r\n            content: (section) => (\r\n              <>\r\n                <TextField\r\n                  name=\"email\"\r\n                  label={t('account.email')}\r\n                  value={section.values.email || ''}\r\n                  onChange={section.onChange}\r\n                  error={!!section.errors?.email}\r\n                  helperText={section.errors?.email}\r\n                  disabled={section.isBusy}\r\n                  editing={section.isEditing}\r\n                  autoComplete=\"email\"\r\n                  required\r\n                />\r\n                {section.isEditing && (\r\n                  <TextField\r\n                    name=\"confirmationPassword\"\r\n                    label={t('account.confirm_password')}\r\n                    value={section.values.confirmationPassword}\r\n                    onChange={section.onChange}\r\n                    error={!!section.errors?.confirmationPassword}\r\n                    helperText={section.errors?.confirmationPassword}\r\n                    type={viewPassword ? 'text' : 'password'}\r\n                    disabled={section.isBusy}\r\n                    autoComplete=\"current-password\"\r\n                    rightControl={\r\n                      <IconButton aria-label={t('account.view_password')} onClick={() => toggleViewPassword()} aria-pressed={viewPassword}>\r\n                        <Icon icon={viewPassword ? Visibility : VisibilityOff} />\r\n                      </IconButton>\r\n                    }\r\n                    required\r\n                  />\r\n                )}\r\n              </>\r\n            ),\r\n          }),\r\n          formSection({\r\n            label: t('account.security'),\r\n            editButton: (\r\n              <Button\r\n                label={shouldAddPassword ? t('account.add_password') : t('account.edit_password')}\r\n                type=\"button\"\r\n                onClick={() => (customer ? editPasswordClickHandler() : null)}\r\n              />\r\n            ),\r\n          }),\r\n          formSection({\r\n            label: t('account.terms_and_tracking'),\r\n            saveButton: t('account.update_consents'),\r\n            onSubmit: async (values) => {\r\n              const response = await accountController.updateConsents(formatConsentsFromValues(publisherConsents, values.consentsValues));\r\n\r\n              announce(t('account.update_success', { section: t('account.terms_and_tracking') }), 'success');\r\n\r\n              return response;\r\n            },\r\n            content: (section) => (\r\n              <>\r\n                {termsConsents?.map((consent, index) => (\r\n                  <Checkbox\r\n                    key={index}\r\n                    name={`consentsValues.${consent.name}`}\r\n                    checked={isTruthyCustomParamValue(section.values.consentsValues?.[consent.name])}\r\n                    onChange={section.onChange}\r\n                    checkboxLabel={formatConsentLabel(consent.label)}\r\n                    disabled={consent.required || section.isBusy}\r\n                    required={consent.required}\r\n                    lang={htmlLang}\r\n                  />\r\n                ))}\r\n              </>\r\n            ),\r\n          }),\r\n          nonTermsConsents?.length &&\r\n            formSection({\r\n              label: t('account.other_registration_details'),\r\n              saveButton: t('account.update_consents'),\r\n              onSubmit: (values) => accountController.updateConsents(formatConsentsFromValues(publisherConsents, values.consentsValues)),\r\n              content: (section) => (\r\n                <div className={styles.customFields} data-testid={testId('custom-reg-fields')}>\r\n                  {nonTermsConsents.map((consent) => (\r\n                    <CustomRegisterField\r\n                      key={consent.name}\r\n                      type={consent.type}\r\n                      name={`consentsValues.${consent.name}`}\r\n                      options={consent.options}\r\n                      label={formatConsentLabel(consent.label)}\r\n                      placeholder={consent.placeholder}\r\n                      value={section.values.consentsValues[consent.name]}\r\n                      disabled={(consent.type === 'checkbox' && consent.required) || section.isBusy}\r\n                      onChange={section.onChange}\r\n                      required={consent.required}\r\n                    />\r\n                  ))}\r\n                </div>\r\n              ),\r\n            }),\r\n          canExportAccountData &&\r\n            formSection({\r\n              label: t('account.export_data_title'),\r\n              content: (section) => (\r\n                <div className={styles.textWithButtonContainer}>\r\n                  <div>\r\n                    <Trans t={t} i18nKey=\"account.export_data_body\" values={{ email: section.values.email }} />\r\n                  </div>\r\n                  <div>\r\n                    <Button\r\n                      label={t('account.export_data_title')}\r\n                      type=\"button\"\r\n                      disabled={exportData.isLoading}\r\n                      onClick={async () => {\r\n                        exportData.mutate();\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ),\r\n            }),\r\n          canDeleteAccount &&\r\n            formSection({\r\n              label: t('account.delete_account.title'),\r\n              content: () => (\r\n                <div className={styles.textWithButtonContainer}>\r\n                  <div>{t('account.delete_account.body')}</div>\r\n                  <div>\r\n                    <Button\r\n                      label={t('account.delete_account.title')}\r\n                      type=\"button\"\r\n                      variant=\"danger\"\r\n                      onClick={() => {\r\n                        navigate(modalURLFromLocation(location, shouldAddPassword ? 'warning-account-deletion' : 'delete-account'));\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              ),\r\n            }),\r\n        ].filter(isTruthy)}\r\n      </Form>\r\n      {canExportAccountData && (\r\n        <Alert open={isAlertVisible} message={exportDataMessage} onClose={() => setIsAlertVisible(false)} isSuccess={exportData.isSuccess} />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Account;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { AccessModel } from '@jwp/ott-common/types/config';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { Breakpoint, type Breakpoints } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport Button from '../Button/Button';\r\nimport CardGrid from '../CardGrid/CardGrid';\r\n\r\nimport styles from './Favorites.module.scss';\r\n\r\ntype Props = {\r\n  playlist: Playlist;\r\n  accessModel: AccessModel;\r\n  hasSubscription: boolean;\r\n  onCardHover?: (item: PlaylistItem) => void;\r\n  onClearFavoritesClick: () => void;\r\n};\r\n\r\nconst cols: Breakpoints = {\r\n  [Breakpoint.xs]: 2,\r\n  [Breakpoint.sm]: 3,\r\n  [Breakpoint.md]: 3,\r\n  [Breakpoint.lg]: 3,\r\n  [Breakpoint.xl]: 3,\r\n};\r\n\r\nconst Favorites = ({ playlist, accessModel, hasSubscription, onCardHover, onClearFavoritesClick }: Props): JSX.Element => {\r\n  const { t } = useTranslation('user');\r\n  const getURL = (playlistItem: PlaylistItem) => mediaURL({ media: playlistItem, playlistId: playlistItem.feedid });\r\n\r\n  return (\r\n    <div>\r\n      <div className={styles.header}>\r\n        <h1>{t('favorites.title')}</h1>\r\n        {playlist.playlist.length > 0 ? <Button label={t('favorites.clear')} onClick={onClearFavoritesClick} /> : null}\r\n      </div>\r\n      {playlist.playlist.length > 0 ? (\r\n        <CardGrid\r\n          getUrl={getURL}\r\n          playlist={playlist}\r\n          onCardHover={onCardHover}\r\n          cols={cols}\r\n          isLoading={false}\r\n          accessModel={accessModel}\r\n          isLoggedIn={true}\r\n          hasSubscription={hasSubscription}\r\n        />\r\n      ) : (\r\n        <p>{t('favorites.no_favorites')}</p>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Favorites;\r\n","import { useMutation } from 'react-query';\r\nimport type { Customer } from '@jwp/ott-common/types/account';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\n\r\nexport const useSubscriptionChange = (\r\n  isUpgradeOffer: boolean,\r\n  selectedOfferId: string | null,\r\n  customer: Customer | null,\r\n  activeSubscriptionId: string | number | undefined,\r\n) => {\r\n  const accountController = getModule(AccountController);\r\n  const checkoutController = getModule(CheckoutController);\r\n\r\n  const updateSubscriptionMetadata = useMutation(accountController.updateUser, {\r\n    onSuccess: () => {\r\n      useAccountStore.setState({\r\n        loading: false,\r\n      });\r\n    },\r\n  });\r\n\r\n  return useMutation(checkoutController.changeSubscription, {\r\n    onSuccess: () => {\r\n      if (!isUpgradeOffer && selectedOfferId) {\r\n        updateSubscriptionMetadata.mutate({\r\n          firstName: customer?.firstName || '',\r\n          lastName: customer?.lastName || '',\r\n          metadata: {\r\n            [`${activeSubscriptionId}_pending_downgrade`]: selectedOfferId,\r\n          },\r\n        });\r\n      }\r\n    },\r\n  });\r\n};\r\n","import * as React from \"react\";\nconst SvgExternalLink = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z\" }));\nexport default SvgExternalLink;\n","import classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { Offer } from '@jwp/ott-common/types/checkout';\r\nimport { formatLocalizedDate, formatPrice } from '@jwp/ott-common/src/utils/formatting';\r\n\r\nimport Checkbox from '../form-fields/Checkbox/Checkbox';\r\n\r\nimport styles from './OfferSwitch.module.scss';\r\n\r\ntype OfferSwitchProps = {\r\n  isCurrentOffer: boolean;\r\n  pendingDowngradeOfferId: string;\r\n  offer: Offer;\r\n  selected: boolean;\r\n  onChange: (offerId: string) => void;\r\n  expiresAt: number | undefined;\r\n};\r\n\r\nconst OfferSwitch = ({ isCurrentOffer, pendingDowngradeOfferId, offer, selected, onChange, expiresAt }: OfferSwitchProps) => {\r\n  const { t, i18n } = useTranslation(['user', 'account']);\r\n  const { customerPriceInclTax, customerCurrency, period } = offer;\r\n\r\n  const isPendingDowngrade = pendingDowngradeOfferId === offer.offerId;\r\n\r\n  return (\r\n    <div className={classNames(styles.offerSwitchContainer, { [styles.activeOfferSwitchContainer]: selected })}>\r\n      <Checkbox disabled={isPendingDowngrade} name={offer.offerId} checked={selected} onChange={() => onChange(offer.offerId)} />\r\n      <div className={styles.offerSwitchInfoContainer}>\r\n        {(isCurrentOffer || isPendingDowngrade) && (\r\n          <div className={classNames(styles.currentPlanHeading, { [styles.activeCurrentPlanHeading]: selected })}>\r\n            {isCurrentOffer && t('user:payment.current_plan').toUpperCase()}\r\n            {isPendingDowngrade && t('user:payment.pending_downgrade').toUpperCase()}\r\n          </div>\r\n        )}\r\n        <div className={styles.offerSwitchPlanContainer}>\r\n          <div>{t(`user:payment.${period === 'month' ? 'monthly' : 'annual'}_subscription`)}</div>\r\n          {(isCurrentOffer || isPendingDowngrade) && expiresAt && (\r\n            <div className={styles.nextBillingDate}>\r\n              {isCurrentOffer &&\r\n                !pendingDowngradeOfferId &&\r\n                t('user:payment.next_billing_date_on', { date: formatLocalizedDate(new Date(expiresAt * 1000), i18n.language) })}\r\n              {isPendingDowngrade && t('user:payment.downgrade_on', { date: formatLocalizedDate(new Date(expiresAt * 1000), i18n.language) })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      <div className={styles.price}>\r\n        {formatPrice(customerPriceInclTax, customerCurrency, undefined)}\r\n        <span className={styles.paymentFrequency}>/{t(`account:periods.${period}_one`)}</span>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OfferSwitch;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport type { AccessModel } from '@jwp/ott-common/types/config';\r\nimport type { Customer } from '@jwp/ott-common/types/account';\r\nimport type { Offer } from '@jwp/ott-common/types/checkout';\r\nimport type { PaymentDetail, Subscription, Transaction } from '@jwp/ott-common/types/subscription';\r\nimport { formatLocalizedDate, formatPrice } from '@jwp/ott-common/src/utils/formatting';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport ExternalLink from '@jwp/ott-theme/assets/icons/external_link.svg?react';\r\nimport PayPal from '@jwp/ott-theme/assets/icons/paypal.svg?react';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\nimport classNames from 'classnames';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Alert from '../Alert/Alert';\r\nimport Button from '../Button/Button';\r\nimport LoadingOverlay from '../LoadingOverlay/LoadingOverlay';\r\nimport OfferSwitch from '../OfferSwitch/OfferSwitch';\r\nimport TextField from '../form-fields/TextField/TextField';\r\nimport Icon from '../Icon/Icon';\r\nimport Link from '../Link/Link';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\nimport styles from './Payment.module.scss';\r\n\r\nconst VISIBLE_TRANSACTIONS = 4;\r\n\r\ntype Props = {\r\n  accessModel: AccessModel;\r\n  activeSubscription: Subscription | null;\r\n  activePaymentDetail: PaymentDetail | null;\r\n  transactions: Transaction[] | null;\r\n  customer: Customer;\r\n  pendingOffer: Offer | null;\r\n  isLoading: boolean;\r\n  offerSwitchesAvailable: boolean;\r\n  onShowReceiptClick: (transactionId: string) => void;\r\n  panelClassName?: string;\r\n  panelHeaderClassName?: string;\r\n  onShowAllTransactionsClick?: () => void;\r\n  onUpgradeSubscriptionClick?: () => void;\r\n  showAllTransactions: boolean;\r\n  canUpdatePaymentMethod: boolean;\r\n  canRenewSubscription?: boolean;\r\n  canShowReceipts?: boolean;\r\n  offers?: Offer[];\r\n  pendingDowngradeOfferId?: string;\r\n  changeSubscriptionPlan: {\r\n    isLoading: boolean;\r\n    isError: boolean;\r\n    isSuccess: boolean;\r\n    reset: () => void;\r\n  };\r\n  onChangePlanClick: () => void;\r\n  selectedOfferId: string | null;\r\n  setSelectedOfferId: (offerId: string | null) => void;\r\n  isUpgradeOffer: boolean | undefined;\r\n  setIsUpgradeOffer: (isUpgradeOffer: boolean | undefined) => void;\r\n  isExternalPaymentProvider: boolean;\r\n  paymentProvider?: string;\r\n  paymentProviderLink?: string;\r\n};\r\n\r\nconst Payment = ({\r\n  accessModel,\r\n  activePaymentDetail,\r\n  activeSubscription,\r\n  pendingOffer,\r\n  transactions,\r\n  customer,\r\n  isLoading,\r\n  panelClassName,\r\n  panelHeaderClassName,\r\n  onShowAllTransactionsClick,\r\n  showAllTransactions,\r\n  onShowReceiptClick,\r\n  canRenewSubscription = false,\r\n  canShowReceipts = false,\r\n  canUpdatePaymentMethod,\r\n  onUpgradeSubscriptionClick,\r\n  offerSwitchesAvailable,\r\n  offers = [],\r\n  pendingDowngradeOfferId = '',\r\n  changeSubscriptionPlan,\r\n  onChangePlanClick,\r\n  selectedOfferId,\r\n  setSelectedOfferId,\r\n  isUpgradeOffer,\r\n  setIsUpgradeOffer,\r\n  isExternalPaymentProvider,\r\n  paymentProvider,\r\n  paymentProviderLink,\r\n}: Props): JSX.Element => {\r\n  const subscriptionDetailsId = useOpaqueId('subscription-details');\r\n  const paymentMethodId = useOpaqueId('payment-method');\r\n  const billingHistoryId = useOpaqueId('billing-history');\r\n  const { t, i18n } = useTranslation(['user', 'account']);\r\n  const hiddenTransactionsCount = transactions ? transactions?.length - VISIBLE_TRANSACTIONS : 0;\r\n  const hasMoreTransactions = hiddenTransactionsCount > 0;\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const isGrantedSubscription = activeSubscription?.period === 'granted';\r\n  const breakpoint = useBreakpoint();\r\n  const isMobile = breakpoint === Breakpoint.xs;\r\n\r\n  const [isChangingOffer, setIsChangingOffer] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!isChangingOffer) {\r\n      setSelectedOfferId(activeSubscription?.accessFeeId ?? null);\r\n    }\r\n  }, [activeSubscription, isChangingOffer, setSelectedOfferId]);\r\n\r\n  useEffect(() => {\r\n    setIsChangingOffer(false);\r\n  }, [activeSubscription?.status, activeSubscription?.pendingSwitchId]);\r\n\r\n  useEffect(() => {\r\n    if (selectedOfferId && offers) {\r\n      setIsUpgradeOffer(\r\n        (offers.find((offer) => offer.offerId === selectedOfferId)?.customerPriceInclTax ?? 0) >\r\n          (offers.find((offer) => offer.offerId === activeSubscription?.accessFeeId)?.customerPriceInclTax ?? 0),\r\n      );\r\n    }\r\n  }, [selectedOfferId, offers, activeSubscription, setIsUpgradeOffer]);\r\n\r\n  function onCompleteSubscriptionClick() {\r\n    navigate(modalURLFromLocation(location, 'choose-offer'));\r\n  }\r\n\r\n  function onEditCardDetailsClick() {\r\n    navigate(modalURLFromLocation(location, 'edit-card'));\r\n  }\r\n\r\n  function onCancelSubscriptionClick() {\r\n    navigate(modalURLFromLocation(location, 'unsubscribe'));\r\n  }\r\n\r\n  function onRenewSubscriptionClick() {\r\n    navigate(modalURLFromLocation(location, 'renew-subscription'));\r\n  }\r\n\r\n  function getTitle(period: Subscription['period']) {\r\n    switch (period) {\r\n      case 'month':\r\n        return t('user:payment.monthly_subscription');\r\n      case 'year':\r\n        return t('user:payment.annual_subscription');\r\n      case 'day':\r\n        return t('user:payment.daily_subscription');\r\n      case 'week':\r\n        return t('user:payment.weekly_subscription');\r\n      case 'granted':\r\n        return t('user:payment.granted_subscription');\r\n      default:\r\n        return t('user:payment.other');\r\n    }\r\n  }\r\n\r\n  const showChangeSubscriptionButton = (!isExternalPaymentProvider && offerSwitchesAvailable) || (!isChangingOffer && !canRenewSubscription);\r\n\r\n  return (\r\n    <>\r\n      <Alert\r\n        isSuccess={!changeSubscriptionPlan.isError}\r\n        message={\r\n          !changeSubscriptionPlan.isError\r\n            ? isUpgradeOffer\r\n              ? t('user:payment.upgrade_plan_success')\r\n              : t('user:payment.downgrade_plan_success', {\r\n                  date: activeSubscription?.expiresAt && formatLocalizedDate(new Date(activeSubscription.expiresAt * 1000), i18n.language),\r\n                })\r\n            : t('user:payment.change_plan_error')\r\n        }\r\n        open={isChangingOffer && (changeSubscriptionPlan.isSuccess || changeSubscriptionPlan.isError)}\r\n        onClose={() => {\r\n          changeSubscriptionPlan.reset();\r\n          setIsChangingOffer(false);\r\n        }}\r\n      />\r\n      <h1 className=\"hideUntilFocus\">{t('nav.payments')}</h1>\r\n      {accessModel === ACCESS_MODEL.SVOD && (\r\n        <section aria-labelledby={subscriptionDetailsId} className={panelClassName}>\r\n          <div className={panelHeaderClassName}>\r\n            <h2 id={subscriptionDetailsId}>{isChangingOffer ? t('user:payment.change_plan') : t('user:payment.subscription_details')}</h2>\r\n          </div>\r\n          {activeSubscription ? (\r\n            <React.Fragment>\r\n              {!isChangingOffer && (\r\n                <div className={styles.infoBox} key={activeSubscription.subscriptionId}>\r\n                  <p>\r\n                    <strong>{getTitle(activeSubscription.period)}</strong> <br />\r\n                    {activeSubscription.status === 'active' && !isGrantedSubscription && !pendingDowngradeOfferId\r\n                      ? t('user:payment.next_billing_date_on', { date: formatLocalizedDate(new Date(activeSubscription.expiresAt * 1000), i18n.language) })\r\n                      : t('user:payment.subscription_expires_on', { date: formatLocalizedDate(new Date(activeSubscription.expiresAt * 1000), i18n.language) })}\r\n                    {(pendingOffer || pendingDowngradeOfferId) && activeSubscription.status !== 'cancelled' && (\r\n                      <span className={styles.pendingSwitch}>\r\n                        {t('user:payment.pending_offer_switch', {\r\n                          title: getTitle(pendingOffer?.period || offers.find((offer) => offer.offerId === pendingDowngradeOfferId)?.period || 'month'),\r\n                        })}\r\n                      </span>\r\n                    )}\r\n                  </p>\r\n                  {!isGrantedSubscription && (\r\n                    <p className={styles.price}>\r\n                      <strong>{formatPrice(activeSubscription.nextPaymentPrice, activeSubscription.nextPaymentCurrency, customer.country)}</strong>\r\n                      <small>/{t(`account:periods.${activeSubscription.period}`)}</small>\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              )}\r\n              {isExternalPaymentProvider ? (\r\n                <p className={styles.explanation}>\r\n                  {t('account:external_payment.explanation', { paymentProvider })}{' '}\r\n                  <Link href={paymentProviderLink} target=\"_blank\">\r\n                    {t('account:external_payment.manage_subscription')}\r\n                  </Link>\r\n                </p>\r\n              ) : (\r\n                showChangeSubscriptionButton && (\r\n                  <Button\r\n                    className={styles.upgradeSubscription}\r\n                    label={t('user:payment.change_subscription')}\r\n                    disabled={!canRenewSubscription && activeSubscription.status === 'cancelled'}\r\n                    onClick={() => {\r\n                      if (offers.length > 1 && !canRenewSubscription) {\r\n                        setIsChangingOffer(true);\r\n                      } else {\r\n                        onUpgradeSubscriptionClick?.();\r\n                      }\r\n                    }}\r\n                    fullWidth={isMobile}\r\n                    color=\"primary\"\r\n                    data-testid=\"change-subscription-button\"\r\n                  />\r\n                )\r\n              )}\r\n              {(activeSubscription.status === 'active' || activeSubscription.status === 'active_trial') &&\r\n              !isGrantedSubscription &&\r\n              !isChangingOffer &&\r\n              canRenewSubscription ? (\r\n                <Button\r\n                  label={t('user:payment.cancel_subscription')}\r\n                  onClick={onCancelSubscriptionClick}\r\n                  fullWidth={isMobile}\r\n                  data-testid=\"cancel-subscription-button\"\r\n                />\r\n              ) : canRenewSubscription ? (\r\n                <Button label={t('user:payment.renew_subscription')} onClick={onRenewSubscriptionClick} />\r\n              ) : null}\r\n            </React.Fragment>\r\n          ) : isLoading ? null : (\r\n            <React.Fragment>\r\n              <p>{t('user:payment.no_subscription')}</p>\r\n              <Button variant=\"contained\" color=\"primary\" label={t('user:payment.complete_subscription')} onClick={onCompleteSubscriptionClick} />\r\n            </React.Fragment>\r\n          )}\r\n          {isChangingOffer && (\r\n            <div className={styles.changePlanContainer}>\r\n              {offers\r\n                .filter((o) => o.planSwitchEnabled)\r\n                .map((offer) => (\r\n                  <OfferSwitch\r\n                    key={offer.offerId}\r\n                    isCurrentOffer={offer.offerId === activeSubscription?.accessFeeId}\r\n                    pendingDowngradeOfferId={pendingDowngradeOfferId}\r\n                    offer={offer}\r\n                    selected={selectedOfferId === offer.offerId}\r\n                    onChange={(offerId) => setSelectedOfferId(offerId)}\r\n                    expiresAt={activeSubscription?.expiresAt}\r\n                  />\r\n                ))}\r\n              <div className={styles.changePlanButtons}>\r\n                <Button\r\n                  label={t('user:account.save')}\r\n                  onClick={onChangePlanClick}\r\n                  disabled={selectedOfferId === activeSubscription?.accessFeeId || changeSubscriptionPlan.isLoading}\r\n                />\r\n                <Button label={t('user:account.cancel')} onClick={() => setIsChangingOffer(false)} variant=\"text\" />\r\n                {activeSubscription?.status !== 'cancelled' && (\r\n                  <Button\r\n                    className={styles.changePlanCancelButton}\r\n                    label={t('user:payment.cancel_subscription')}\r\n                    onClick={onCancelSubscriptionClick}\r\n                    variant=\"danger\"\r\n                    data-testid=\"cancel-subscription-button\"\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n      <section aria-labelledby={paymentMethodId} className={panelClassName}>\r\n        <div className={panelHeaderClassName}>\r\n          <h2 id={paymentMethodId}>{t('user:payment.payment_method')}</h2>\r\n        </div>\r\n        {activePaymentDetail ? (\r\n          activePaymentDetail.paymentMethod === 'paypal' ? (\r\n            <div>\r\n              <div className={styles.paypal}>\r\n                <Icon icon={PayPal} /> {t('account:payment.paypal')}\r\n              </div>\r\n\r\n              {activePaymentDetail.currency}\r\n            </div>\r\n          ) : (\r\n            <div key={activePaymentDetail.id}>\r\n              <TextField\r\n                label={t('user:payment.card_number')}\r\n                name=\"cardNumber\"\r\n                value={`•••• •••• •••• ${activePaymentDetail.paymentMethodSpecificParams.lastCardFourDigits || ''}`}\r\n                aria-label={t('user:payment.card_number_hidden', { number: activePaymentDetail.paymentMethodSpecificParams.lastCardFourDigits })}\r\n                editing={false}\r\n                autoComplete=\"cc-number\"\r\n              />\r\n              <div className={styles.cardDetails}>\r\n                <TextField\r\n                  label={t('user:payment.expiry_date')}\r\n                  name=\"cardExpiry\"\r\n                  value={activePaymentDetail.paymentMethodSpecificParams.cardExpirationDate}\r\n                  editing={false}\r\n                  autoComplete=\"cc-exp\"\r\n                />\r\n                <TextField\r\n                  label={t('user:payment.security_code')}\r\n                  name=\"cardSecurityCode\"\r\n                  value={'******'}\r\n                  editing={false}\r\n                  aria-label={t('user:payment.security_code_hidden')}\r\n                  autoComplete=\"cc-csc\"\r\n                />\r\n              </div>\r\n              <Button\r\n                className={classNames({ [styles.editCard]: canUpdatePaymentMethod })}\r\n                label={t('account:payment.edit_card')}\r\n                variant=\"outlined\"\r\n                onClick={onEditCardDetailsClick}\r\n              />\r\n            </div>\r\n          )\r\n        ) : (\r\n          <div>\r\n            <p>{!isLoading && t('user:payment.no_payment_methods')}</p>\r\n          </div>\r\n        )}\r\n        {canUpdatePaymentMethod && (\r\n          <Button label={t('user:payment.update_payment_details')} type=\"button\" onClick={() => navigate(modalURLFromLocation(location, 'payment-method'))} />\r\n        )}\r\n      </section>\r\n      <section aria-labelledby={billingHistoryId} className={panelClassName}>\r\n        <div className={panelHeaderClassName}>\r\n          <h2 id={billingHistoryId}>{t('user:payment.billing_history')}</h2>\r\n        </div>\r\n        {transactions?.length ? (\r\n          <React.Fragment>\r\n            {transactions?.slice(0, showAllTransactions ? 9999 : VISIBLE_TRANSACTIONS).map((transaction) => (\r\n              <div className={styles.infoBox} key={transaction.transactionId}>\r\n                <p className={styles.transactionItem}>\r\n                  <strong>{formatLocalizedDate(new Date(transaction.transactionDate * 1000), i18n.language)}</strong>\r\n                  <span>{transaction.offerTitle}</span>\r\n                  <span>{transaction.transactionId}</span>\r\n                </p>\r\n                <div className={styles.transactionDetails}>\r\n                  <div className={styles.transactionPrice}>\r\n                    {!isGrantedSubscription &&\r\n                      t('user:payment.price_paid_with', {\r\n                        price: formatPrice(parseFloat(transaction.transactionPriceInclTax), transaction.transactionCurrency, transaction.customerCountry),\r\n                        method: transaction.paymentMethod,\r\n                      })}\r\n                  </div>\r\n                  {canShowReceipts && (\r\n                    <IconButton\r\n                      aria-label={t('user:payment.show_receipt')}\r\n                      // JW integration specific: uses `trxToken` as the unique identifier for each transaction\r\n                      // Note: `transactionId` is shared with rebills and is not guaranteed to be unique\r\n                      onClick={() => !isLoading && onShowReceiptClick(transaction?.trxToken ?? transaction.transactionId)}\r\n                    >\r\n                      <Icon icon={ExternalLink} />\r\n                    </IconButton>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n            {!showAllTransactions && hasMoreTransactions ? (\r\n              <React.Fragment>\r\n                <p>{t('user:payment.hidden_transactions', { count: hiddenTransactionsCount })}</p>\r\n                <Button label={t('user:payment.show_all')} onClick={onShowAllTransactionsClick} />\r\n              </React.Fragment>\r\n            ) : null}\r\n          </React.Fragment>\r\n        ) : (\r\n          <div>\r\n            <p>{!isLoading && t('user:payment.no_transactions')}</p>\r\n          </div>\r\n        )}\r\n      </section>\r\n      {isLoading && <LoadingOverlay inline />}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Payment;\r\n","import { useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport useOffers from '@jwp/ott-hooks-react/src/useOffers';\r\nimport { useSubscriptionChange } from '@jwp/ott-hooks-react/src/useSubscriptionChange';\r\n\r\nimport styles from '../../pages/User/User.module.scss';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport Payment from '../../components/Payment/Payment';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\n/**\r\n * Handles billing receipts by either downloading the receipt directly if it is an instance of Blob,\r\n * or opening it in a new window if it is a string representation.\r\n *\r\n * @param {Blob | string} receipt - The billing receipt data. If a Blob, it will be downloaded; if a string,\r\n * it will be treated as an HTML representation and opened in a new window.\r\n * @param {string} transactionId - The unique identifier for the transaction associated with the receipt.\r\n *\r\n * @returns {void}\r\n *\r\n */\r\nconst processBillingReceipt = (receipt: Blob | string, transactionId: string) => {\r\n  if (receipt instanceof Blob) {\r\n    const url = window.URL.createObjectURL(new Blob([receipt]));\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.setAttribute('download', `receipt_${transactionId}.pdf`);\r\n    document.body.appendChild(link);\r\n    link.click();\r\n  } else {\r\n    const newWindow = window.open('', `Receipt ${transactionId}`, '');\r\n    const htmlString = window.atob(receipt as unknown as string);\r\n\r\n    if (newWindow) {\r\n      newWindow.opener = null;\r\n      newWindow.document.write(htmlString);\r\n      newWindow.document.close();\r\n    }\r\n  }\r\n};\r\n\r\nconst EXTERNAL_PAYMENT_METHODS = ['Apple In-App', 'Google In-App', 'Roku In-App'];\r\nconst STORE_LINKS: Record<string, string> = {\r\n  apple: 'https://support.apple.com/118428',\r\n  google: 'https://support.google.com/googleplay/answer/7018481',\r\n  roku: 'https://support.roku.com/article/208756478',\r\n};\r\n\r\nconst PaymentContainer = () => {\r\n  const accountController = getModule(AccountController);\r\n\r\n  const navigate = useNavigate();\r\n\r\n  const { accessModel } = useConfigStore(({ accessModel }) => ({ accessModel }), shallow);\r\n  const { user: customer, subscription: activeSubscription, transactions, activePayment, pendingOffer, loading } = useAccountStore();\r\n  const { canUpdatePaymentMethod, canShowReceipts, canRenewSubscription } = accountController.getFeatures();\r\n  const { subscriptionOffers, switchSubscriptionOffers } = useOffers();\r\n\r\n  const [showAllTransactions, setShowAllTransactions] = useState(false);\r\n  const [isLoadingReceipt, setIsLoadingReceipt] = useState(false);\r\n  const [selectedOfferId, setSelectedOfferId] = useState<string | null>(activeSubscription?.accessFeeId ?? null);\r\n  const [isUpgradeOffer, setIsUpgradeOffer] = useState<boolean | undefined>(undefined);\r\n\r\n  const location = useLocation();\r\n\r\n  const handleUpgradeSubscriptionClick = async () => navigate(modalURLFromLocation(location, 'upgrade-subscription'));\r\n\r\n  const handleShowReceiptClick = async (transactionId: string) => {\r\n    setIsLoadingReceipt(true);\r\n\r\n    try {\r\n      const receipt = await accountController.getReceipt(transactionId);\r\n      if (receipt) {\r\n        processBillingReceipt(receipt, transactionId);\r\n      }\r\n    } catch (error: unknown) {\r\n      throw new Error(\"Couldn't parse receipt. \" + (error instanceof Error ? error.message : ''));\r\n    }\r\n\r\n    setIsLoadingReceipt(false);\r\n  };\r\n\r\n  const changeSubscriptionPlan = useSubscriptionChange(isUpgradeOffer ?? false, selectedOfferId, customer, activeSubscription?.subscriptionId);\r\n\r\n  const onChangePlanClick = async () => {\r\n    if (selectedOfferId && activeSubscription?.subscriptionId) {\r\n      changeSubscriptionPlan.mutate({\r\n        accessFeeId: selectedOfferId.slice(1),\r\n        subscriptionId: `${activeSubscription.subscriptionId}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  if (!customer) {\r\n    return <LoadingOverlay />;\r\n  }\r\n\r\n  const pendingDowngradeOfferId = (customer.metadata?.[`${activeSubscription?.subscriptionId}_pending_downgrade`] as string) || '';\r\n  const isExternalPaymentProvider = !!activeSubscription && EXTERNAL_PAYMENT_METHODS.includes(activeSubscription.paymentMethod);\r\n  const paymentProvider = activeSubscription?.paymentMethod.split(' ')[0] || 'unknown';\r\n  const paymentProviderLink = STORE_LINKS[paymentProvider.toLowerCase()];\r\n\r\n  return (\r\n    <Payment\r\n      accessModel={accessModel}\r\n      activeSubscription={activeSubscription}\r\n      activePaymentDetail={activePayment}\r\n      transactions={transactions}\r\n      customer={customer}\r\n      pendingOffer={pendingOffer}\r\n      isLoading={loading || isLoadingReceipt}\r\n      panelClassName={styles.panel}\r\n      panelHeaderClassName={styles.panelHeader}\r\n      onShowAllTransactionsClick={() => setShowAllTransactions(true)}\r\n      showAllTransactions={showAllTransactions}\r\n      canUpdatePaymentMethod={canUpdatePaymentMethod}\r\n      canRenewSubscription={canRenewSubscription}\r\n      onUpgradeSubscriptionClick={handleUpgradeSubscriptionClick}\r\n      offerSwitchesAvailable={switchSubscriptionOffers.length > 0}\r\n      canShowReceipts={canShowReceipts}\r\n      onShowReceiptClick={handleShowReceiptClick}\r\n      offers={subscriptionOffers}\r\n      pendingDowngradeOfferId={pendingDowngradeOfferId}\r\n      changeSubscriptionPlan={changeSubscriptionPlan}\r\n      onChangePlanClick={onChangePlanClick}\r\n      selectedOfferId={selectedOfferId}\r\n      setSelectedOfferId={(offerId: string | null) => setSelectedOfferId(offerId)}\r\n      isUpgradeOffer={isUpgradeOffer}\r\n      setIsUpgradeOffer={(isUpgradeOffer: boolean | undefined) => setIsUpgradeOffer(isUpgradeOffer)}\r\n      isExternalPaymentProvider={isExternalPaymentProvider}\r\n      paymentProvider={paymentProvider}\r\n      paymentProviderLink={paymentProviderLink}\r\n    />\r\n  );\r\n};\r\n\r\nexport default PaymentContainer;\r\n","import { useEffect, useState } from 'react';\r\nimport { Navigate, useLocation, useNavigate, useParams } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\nimport { useDeleteProfile } from '@jwp/ott-hooks-react/src/useProfiles';\r\nimport { PATH_USER_PROFILES } from '@jwp/ott-common/src/paths';\r\n\r\nimport Button from '../../components/Button/Button';\r\nimport Dialog from '../../components/Dialog/Dialog';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport { createURLFromLocation } from '../../utils/location';\r\n\r\nimport styles from './Profiles.module.scss';\r\n\r\nconst DeleteProfile = () => {\r\n  const navigate = useNavigate();\r\n  const { id } = useParams();\r\n  const location = useLocation();\r\n\r\n  const { t } = useTranslation('user');\r\n\r\n  const viewParam = useQueryParam('action');\r\n  const [view, setView] = useState(viewParam);\r\n  const [isDeleting, setIsDeleting] = useState<boolean>(false);\r\n\r\n  const closeHandler = () => {\r\n    navigate(createURLFromLocation(location, { action: null }));\r\n  };\r\n\r\n  const deleteProfile = useDeleteProfile({\r\n    onMutate: closeHandler,\r\n    onSuccess: () => navigate(PATH_USER_PROFILES),\r\n    onError: () => setIsDeleting(false),\r\n  });\r\n\r\n  const deleteHandler = async () => id && deleteProfile.mutate({ id });\r\n\r\n  useEffect(() => {\r\n    // make sure the last view is rendered even when the modal gets closed\r\n    if (viewParam) setView(viewParam);\r\n  }, [viewParam]);\r\n\r\n  if (!id) {\r\n    return <Navigate to=\"/u/profiles\" />;\r\n  }\r\n\r\n  if (view !== 'delete-profile') return null;\r\n  return (\r\n    <div>\r\n      <Dialog open={!!viewParam} onClose={closeHandler} aria-labelledby=\"delete-profile-heading\">\r\n        {isDeleting && <LoadingOverlay />}\r\n        <div className={styles.deleteModal}>\r\n          <div>\r\n            <h2 id=\"delete-profile-heading\">{t('profile.delete')}</h2>\r\n            <p>{t('profile.delete_confirmation')}</p>\r\n          </div>\r\n          <div className={styles.deleteButtons}>\r\n            <Button label={t('account.delete')} color=\"delete\" variant=\"contained\" onClick={deleteHandler} />\r\n            <Button label={t('account.cancel')} variant=\"outlined\" onClick={closeHandler} />\r\n          </div>\r\n        </div>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DeleteProfile;\r\n","import * as React from \"react\";\nconst SvgEdit = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M26.8534 7.33334L11.6401 22.52C11.2299 22.8643 10.7008 23.0335 10.167 22.9911C9.63316 22.9487 9.13741 22.6981 8.78675 22.2933L5.70675 19.2133C5.30202 18.8627 5.05141 18.3669 5.009 17.8331C4.9666 17.2993 5.1358 16.7702 5.48008 16.36L20.6667 1.14667C21.0783 0.80566 21.6066 0.638566 22.1394 0.680891C22.6722 0.723217 23.1675 0.971626 23.5201 1.37334L26.6001 4.45334C27.0135 4.803 27.2721 5.30181 27.3195 5.84119C27.367 6.38058 27.1994 6.91687 26.8534 7.33334ZM1.33341 27.3333H6.40008C6.53057 27.3315 6.65764 27.2914 6.76556 27.218C6.87347 27.1447 6.95748 27.0412 7.00717 26.9206C7.05686 26.7999 7.07004 26.6673 7.04507 26.5392C7.02011 26.4111 6.95811 26.2932 6.86675 26.2L1.80008 21.1333C1.7069 21.042 1.58896 20.98 1.46087 20.955C1.33278 20.93 1.20018 20.9432 1.07952 20.9929C0.958848 21.0426 0.855416 21.1266 0.782043 21.2345C0.708669 21.3424 0.668581 21.4695 0.666748 21.6V26.6667C0.666748 26.8435 0.736986 27.0131 0.86201 27.1381C0.987035 27.2631 1.1566 27.3333 1.33341 27.3333Z\", fill: \"white\" }));\nexport default SvgEdit;\n","import * as React from \"react\";\nconst SvgCheck = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\" }));\nexport default SvgCheck;\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Edit from '@jwp/ott-theme/assets/icons/edit.svg?react';\r\nimport Check from '@jwp/ott-theme/assets/icons/check.svg?react';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './ProfileBox.module.scss';\r\n\r\ntype Props = {\r\n  name?: string;\r\n  image: string;\r\n  adult?: boolean;\r\n  editMode?: boolean;\r\n  onClick: () => void;\r\n  onEdit: () => void;\r\n  selected?: boolean;\r\n};\r\n\r\nconst ProfileBox = ({ name, image, editMode = false, onClick, onEdit, selected = false }: Props) => {\r\n  const { t } = useTranslation('user');\r\n  const keyDownHandler = (event: React.KeyboardEvent<HTMLDivElement>) => (event.key === 'Enter' || event.key === ' ') && onClick();\r\n\r\n  return (\r\n    <div className={styles.wrapper}>\r\n      <div className={classNames(styles.inner, selected && styles.selected)}>\r\n        <div onClick={onClick} className={styles.box} role=\"button\" tabIndex={0} onKeyDown={keyDownHandler}>\r\n          <img className={styles.image} src={image} alt=\"\" />\r\n        </div>\r\n        {editMode && (\r\n          <IconButton aria-label={t('profile.edit')} onClick={onEdit} className={styles.overlay}>\r\n            <Icon icon={Edit} />\r\n          </IconButton>\r\n        )}\r\n      </div>\r\n      {name && <h2 className={styles.title}>{name}</h2>}\r\n      {selected && (\r\n        <div className={styles.checkmarkContainer}>\r\n          <Icon icon={Check} className={styles.checkmark} />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileBox;\r\n","import { useEffect } from 'react';\r\nimport { number, object, string } from 'yup';\r\nimport { useNavigate } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport { useProfileStore } from '@jwp/ott-common/src/stores/ProfileStore';\r\nimport useForm, { type UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\nimport type { ProfileFormValues } from '@jwp/ott-common/types/profiles';\r\nimport { PATH_USER_PROFILES } from '@jwp/ott-common/src/paths';\r\n\r\nimport styles from '../../pages/User/User.module.scss';\r\nimport Button from '../../components/Button/Button';\r\nimport Dropdown from '../../components/form-fields/Dropdown/Dropdown';\r\nimport FormFeedback from '../../components/FormFeedback/FormFeedback';\r\nimport TextField from '../../components/form-fields/TextField/TextField';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport ProfileBox from '../../components/ProfileBox/ProfileBox';\r\n\r\nimport AVATARS from './avatarUrls.json';\r\nimport profileStyles from './Profiles.module.scss';\r\n\r\ntype Props = {\r\n  initialValues: ProfileFormValues;\r\n  formHandler: UseFormOnSubmitHandler<ProfileFormValues>;\r\n  selectedAvatar?: {\r\n    set: (avatarUrl: string) => void;\r\n    value: string;\r\n  };\r\n  showCancelButton?: boolean;\r\n  showContentRating?: boolean;\r\n  isMobile?: boolean;\r\n};\r\n\r\nconst Form = ({ initialValues, formHandler, selectedAvatar, showCancelButton = true, showContentRating = false, isMobile = false }: Props) => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation('user');\r\n  const { profile } = useProfileStore();\r\n\r\n  const options: { value: string; label: string }[] = [\r\n    { label: t('profile.adult'), value: 'true' },\r\n    { label: t('profile.kids'), value: 'false' },\r\n  ];\r\n\r\n  const { handleSubmit, handleChange, values, errors, submitting, setValue } = useForm<ProfileFormValues>({\r\n    initialValues,\r\n    validationSchema: object().shape({\r\n      id: string(),\r\n      name: string()\r\n        .trim()\r\n        .required(t('profile.validation.name.required'))\r\n        .min(3, t('profile.validation.name.too_short', { charactersCount: 3 }))\r\n        .max(30, t('profile.validation.name.too_long', { charactersCount: 30 }))\r\n        .matches(/^[a-zA-Z0-9\\s]*$/, t('profile.validation.name.invalid_characters')),\r\n      adult: string().required(),\r\n      avatar_url: string(),\r\n      pin: number(),\r\n    }),\r\n    onSubmit: formHandler,\r\n  });\r\n  useEffect(() => {\r\n    setValue('avatar_url', selectedAvatar?.value || profile?.avatar_url || '');\r\n  }, [profile?.avatar_url, selectedAvatar?.value, setValue]);\r\n\r\n  const formLabel = t('profile.info');\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} noValidate>\r\n      <div className={styles.panel}>\r\n        <div className={styles.panelHeader}>\r\n          <h2>{formLabel}</h2>\r\n        </div>\r\n        <div className={profileStyles.profileInfo}>{t('profile.description')}</div>\r\n        <div className={profileStyles.formFields}>\r\n          {errors.form ? <FormFeedback variant=\"error\">{errors.form}</FormFeedback> : null}\r\n          {submitting && <LoadingOverlay />}\r\n          <TextField\r\n            required\r\n            name=\"name\"\r\n            label={t('profile.name')}\r\n            value={values?.name}\r\n            onChange={handleChange}\r\n            error={!!errors.name}\r\n            helperText={errors.name}\r\n          />\r\n          {showContentRating && (\r\n            <Dropdown\r\n              required\r\n              name=\"adult\"\r\n              label={t('profile.content_rating')}\r\n              options={options}\r\n              value={values?.adult?.toString() || 'true'}\r\n              onChange={handleChange}\r\n            />\r\n          )}\r\n        </div>\r\n        <hr className={profileStyles.divider} />\r\n        <div className={classNames(styles.panelHeader, profileStyles.noBottomBorder)}>\r\n          <h3>{t('profile.avatar')}</h3>\r\n          <div className={profileStyles.avatarsContainer}>\r\n            {AVATARS.map((avatarUrl) => (\r\n              <ProfileBox\r\n                editMode={false}\r\n                onEdit={() => null}\r\n                onClick={() => selectedAvatar?.set(avatarUrl)}\r\n                selected={selectedAvatar?.value === avatarUrl}\r\n                key={avatarUrl}\r\n                adult={true}\r\n                image={avatarUrl}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <>\r\n          <Button type=\"submit\" label={t('account.save')} variant=\"outlined\" disabled={submitting} fullWidth={isMobile} />\r\n          {showCancelButton && <Button onClick={() => navigate(PATH_USER_PROFILES)} label={t('account.cancel')} variant=\"text\" fullWidth={isMobile} />}\r\n        </>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default Form;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useQuery } from 'react-query';\r\nimport { useLocation, useNavigate, useParams } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport ProfileController from '@jwp/ott-common/src/controllers/ProfileController';\r\nimport type { UseFormOnSubmitHandler } from '@jwp/ott-hooks-react/src/useForm';\r\nimport { useProfileErrorHandler, useUpdateProfile } from '@jwp/ott-hooks-react/src/useProfiles';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport type { ProfileFormValues } from '@jwp/ott-common/types/profiles';\r\nimport { PATH_USER_PROFILES } from '@jwp/ott-common/src/paths';\r\n\r\nimport styles from '../../pages/User/User.module.scss';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport Button from '../../components/Button/Button';\r\nimport { createURLFromLocation } from '../../utils/location';\r\n\r\nimport DeleteProfile from './DeleteProfile';\r\nimport Form from './Form';\r\nimport profileStyles from './Profiles.module.scss';\r\n\r\ntype EditProfileProps = {\r\n  contained?: boolean;\r\n};\r\n\r\nconst EditProfile = ({ contained = false }: EditProfileProps) => {\r\n  const params = useParams();\r\n  const { id } = params;\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation('user');\r\n\r\n  const profileController = getModule(ProfileController);\r\n\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const isMobile = breakpoint === Breakpoint.xs;\r\n\r\n  const {\r\n    data: profileDetails,\r\n    isLoading,\r\n    isFetching,\r\n  } = useQuery(['getProfileDetails'], () => profileController.getProfileDetails({ id: id || '' }), {\r\n    staleTime: 0,\r\n  });\r\n\r\n  const initialValues = useMemo(() => {\r\n    return {\r\n      id: profileDetails?.id || '',\r\n      name: profileDetails?.name || '',\r\n      adult: profileDetails?.adult ? 'true' : 'false',\r\n      avatar_url: profileDetails?.avatar_url || '',\r\n      pin: undefined,\r\n    };\r\n  }, [profileDetails?.id, profileDetails?.name, profileDetails?.adult, profileDetails?.avatar_url]);\r\n\r\n  const [selectedAvatar, setSelectedAvatar] = useState<string | undefined>(initialValues?.avatar_url);\r\n\r\n  useEffect(() => {\r\n    setSelectedAvatar(profileDetails?.avatar_url);\r\n  }, [profileDetails?.avatar_url]);\r\n\r\n  if (!id || (!isFetching && !isLoading && !profileDetails)) {\r\n    navigate(PATH_USER_PROFILES);\r\n  }\r\n\r\n  const updateProfile = useUpdateProfile({ onSuccess: () => navigate(PATH_USER_PROFILES) });\r\n\r\n  const handleErrors = useProfileErrorHandler();\r\n\r\n  const updateProfileHandler: UseFormOnSubmitHandler<ProfileFormValues> = async (formData, { setErrors, setSubmitting }) =>\r\n    updateProfile.mutate(\r\n      {\r\n        id: id,\r\n        name: formData.name,\r\n        adult: formData.adult === 'true',\r\n        avatar_url: formData.avatar_url || profileDetails?.avatar_url,\r\n      },\r\n      {\r\n        onError: (e: unknown) => handleErrors(e, setErrors),\r\n        onSettled: () => {\r\n          setSubmitting(false);\r\n        },\r\n      },\r\n    );\r\n\r\n  if (isLoading || isFetching) return <LoadingOverlay />;\r\n\r\n  return (\r\n    <div className={classNames(styles.user, contained && profileStyles.contained)}>\r\n      <div className={classNames(styles.mainColumn)}>\r\n        <Form\r\n          initialValues={initialValues}\r\n          formHandler={updateProfileHandler}\r\n          selectedAvatar={{\r\n            set: setSelectedAvatar,\r\n            value: selectedAvatar || '',\r\n          }}\r\n          showCancelButton={!contained}\r\n          isMobile={isMobile}\r\n        />\r\n        <div className={styles.panel}>\r\n          <div className={styles.panelHeader}>\r\n            <h2>{t('profile.delete')}</h2>\r\n          </div>\r\n          <div className={profileStyles.profileInfo}>{t(profileDetails?.default ? 'profile.delete_main' : 'profile.delete_description')}</div>\r\n          {!profileDetails?.default && (\r\n            <Button\r\n              onClick={() => navigate(createURLFromLocation(location, { action: 'delete-profile' }))}\r\n              label={t('profile.delete')}\r\n              variant=\"contained\"\r\n              color=\"delete\"\r\n              fullWidth={isMobile}\r\n            />\r\n          )}\r\n        </div>\r\n      </div>\r\n      <DeleteProfile />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EditProfile;\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Navigate, Route, Routes, useLocation, useNavigate } from 'react-router-dom';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport FavoritesController from '@jwp/ott-common/src/controllers/FavoritesController';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { useProfileStore } from '@jwp/ott-common/src/stores/ProfileStore';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport { useProfiles } from '@jwp/ott-hooks-react/src/useProfiles';\r\nimport AccountCircle from '@jwp/ott-theme/assets/icons/account_circle.svg?react';\r\nimport BalanceWallet from '@jwp/ott-theme/assets/icons/balance_wallet.svg?react';\r\nimport Exit from '@jwp/ott-theme/assets/icons/exit.svg?react';\r\nimport Favorite from '@jwp/ott-theme/assets/icons/favorite.svg?react';\r\nimport {\r\n  RELATIVE_PATH_USER_ACCOUNT,\r\n  RELATIVE_PATH_USER_FAVORITES,\r\n  RELATIVE_PATH_USER_MY_PROFILE,\r\n  RELATIVE_PATH_USER_PAYMENTS,\r\n} from '@jwp/ott-common/src/paths';\r\nimport { userProfileURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { useFavoritesStore } from '@jwp/ott-common/src/stores/FavoritesStore';\r\n\r\nimport AccountComponent from '../../components/Account/Account';\r\nimport Button from '../../components/Button/Button';\r\nimport ConfirmationDialog from '../../components/ConfirmationDialog/ConfirmationDialog';\r\nimport Favorites from '../../components/Favorites/Favorites';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport PaymentContainer from '../../containers/PaymentContainer/PaymentContainer';\r\nimport EditProfile from '../../containers/Profiles/EditProfile';\r\nimport Icon from '../../components/Icon/Icon';\r\n\r\nimport styles from './User.module.scss';\r\n\r\nconst User = (): JSX.Element => {\r\n  const favoritesController = getModule(FavoritesController);\r\n  const accountController = getModule(AccountController);\r\n\r\n  const { accessModel, favoritesList } = useConfigStore(\r\n    (s) => ({\r\n      accessModel: s.accessModel,\r\n      favoritesList: s.config.features?.favoritesList,\r\n    }),\r\n    shallow,\r\n  );\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation('user');\r\n  const breakpoint = useBreakpoint();\r\n  const [clearFavoritesOpen, setClearFavoritesOpen] = useState(false);\r\n  const location = useLocation();\r\n\r\n  const isLargeScreen = breakpoint > Breakpoint.md;\r\n  const { user: customer, subscription, loading } = useAccountStore();\r\n  const { canUpdateEmail } = accountController.getFeatures();\r\n  const { profile } = useProfileStore();\r\n  const favorites = useFavoritesStore((state) => state.getPlaylist());\r\n\r\n  const { profilesEnabled } = useProfiles();\r\n\r\n  const profileAndFavoritesPage = location.pathname?.includes('my-profile') || location.pathname.includes('favorites');\r\n\r\n  const onLogout = useCallback(async () => {\r\n    // Empty customer on a user page leads to navigate (code bellow), so we don't repeat it here\r\n    await accountController.logout();\r\n  }, [accountController]);\r\n\r\n  useEffect(() => {\r\n    if (!loading && !customer) {\r\n      navigate('/', { replace: true });\r\n    }\r\n  }, [navigate, customer, loading]);\r\n\r\n  if (!customer) {\r\n    return (\r\n      <div className={styles.user}>\r\n        <LoadingOverlay inline />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={styles.user}>\r\n      {isLargeScreen && (\r\n        <nav className={styles.leftColumn}>\r\n          <div className={styles.panel}>\r\n            <ul>\r\n              {accessModel === 'SVOD' && profilesEnabled && profileAndFavoritesPage && (\r\n                <li>\r\n                  <Button\r\n                    to={profile ? userProfileURL(profile.id, true) : undefined}\r\n                    label={profile?.name ?? t('nav.profile')}\r\n                    variant=\"text\"\r\n                    startIcon={<img className={styles.profileIcon} src={profile?.avatar_url} alt={profile?.name} />}\r\n                    className={styles.button}\r\n                  />\r\n                </li>\r\n              )}\r\n              {(!profilesEnabled || !profileAndFavoritesPage) && (\r\n                <li>\r\n                  <Button\r\n                    to={RELATIVE_PATH_USER_ACCOUNT}\r\n                    label={t('nav.account')}\r\n                    variant=\"text\"\r\n                    startIcon={<Icon icon={AccountCircle} />}\r\n                    className={styles.button}\r\n                  />\r\n                </li>\r\n              )}\r\n              {favoritesList && (!profilesEnabled || profileAndFavoritesPage) && (\r\n                <li>\r\n                  <Button\r\n                    to={RELATIVE_PATH_USER_FAVORITES}\r\n                    label={t('nav.favorites')}\r\n                    variant=\"text\"\r\n                    startIcon={<Icon icon={Favorite} />}\r\n                    className={styles.button}\r\n                  />\r\n                </li>\r\n              )}\r\n\r\n              {accessModel !== ACCESS_MODEL.AVOD && (!profilesEnabled || !profileAndFavoritesPage) && (\r\n                <li>\r\n                  <Button\r\n                    to={RELATIVE_PATH_USER_PAYMENTS}\r\n                    label={t('nav.payments')}\r\n                    variant=\"text\"\r\n                    startIcon={<Icon icon={BalanceWallet} />}\r\n                    className={styles.button}\r\n                  />\r\n                </li>\r\n              )}\r\n\r\n              {(!profilesEnabled || !profileAndFavoritesPage) && (\r\n                <li className={styles.logoutLi}>\r\n                  <Button onClick={onLogout} label={t('nav.logout')} variant=\"text\" startIcon={<Icon icon={Exit} />} className={styles.button} />\r\n                </li>\r\n              )}\r\n            </ul>\r\n          </div>\r\n        </nav>\r\n      )}\r\n      <div className={styles.mainColumn}>\r\n        <Routes>\r\n          <Route\r\n            path={RELATIVE_PATH_USER_ACCOUNT}\r\n            element={<AccountComponent panelClassName={styles.panel} panelHeaderClassName={styles.panelHeader} canUpdateEmail={canUpdateEmail} />}\r\n          />\r\n          {profilesEnabled && <Route path={RELATIVE_PATH_USER_MY_PROFILE} element={<EditProfile contained />} />}\r\n          {favoritesList && (\r\n            <Route\r\n              path={RELATIVE_PATH_USER_FAVORITES}\r\n              element={\r\n                <>\r\n                  <Favorites\r\n                    playlist={favorites}\r\n                    onClearFavoritesClick={() => setClearFavoritesOpen(true)}\r\n                    accessModel={accessModel}\r\n                    hasSubscription={!!subscription}\r\n                  />\r\n                  <ConfirmationDialog\r\n                    open={clearFavoritesOpen}\r\n                    title={t('favorites.clear_favorites_title')}\r\n                    body={t('favorites.clear_favorites_body')}\r\n                    onConfirm={async () => {\r\n                      await favoritesController.clear();\r\n                      setClearFavoritesOpen(false);\r\n                    }}\r\n                    onClose={() => setClearFavoritesOpen(false)}\r\n                  />\r\n                </>\r\n              }\r\n            />\r\n          )}\r\n          <Route\r\n            path={RELATIVE_PATH_USER_PAYMENTS}\r\n            element={accessModel !== ACCESS_MODEL.AVOD ? <PaymentContainer /> : <Navigate to={RELATIVE_PATH_USER_ACCOUNT} />}\r\n          />\r\n          <Route path=\"*\" element={<Navigate to={RELATIVE_PATH_USER_ACCOUNT} />} />\r\n        </Routes>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default User;\r\n","import type { Playlist, PlaylistItem } from '../../types/playlist';\r\n\r\nimport { formatDuration, formatVideoSchedule } from './formatting';\r\n\r\nexport const createVideoMetadata = (media: PlaylistItem, episodesLabel?: string) => {\r\n  const metaData = [];\r\n  const duration = formatDuration(media.duration);\r\n\r\n  if (media.pubdate) metaData.push(String(new Date(media.pubdate * 1000).getFullYear()));\r\n  if (!episodesLabel && duration) metaData.push(duration);\r\n  if (episodesLabel) metaData.push(episodesLabel);\r\n  if (media.genre) metaData.push(media.genre);\r\n  if (media.rating) metaData.push(media.rating);\r\n\r\n  return metaData;\r\n};\r\nexport const createPlaylistMetadata = (playlist: Playlist, episodesLabel?: string) => {\r\n  const metaData = [];\r\n\r\n  if (episodesLabel) metaData.push(episodesLabel);\r\n  if (playlist.genre) metaData.push(playlist.genre as string);\r\n  if (playlist.rating) metaData.push(playlist.rating as string);\r\n\r\n  return metaData;\r\n};\r\nexport const createLiveEventMetadata = (media: PlaylistItem, locale: string) => {\r\n  const metaData = [];\r\n  const scheduled = formatVideoSchedule(locale, media.scheduledStart, media.scheduledEnd);\r\n  const duration = formatDuration(media.duration);\r\n\r\n  if (scheduled) metaData.push(scheduled);\r\n  if (duration) metaData.push(duration);\r\n  if (media.genre) metaData.push(media.genre);\r\n  if (media.rating) metaData.push(media.rating);\r\n\r\n  return metaData;\r\n};\r\n","import { useQueries } from 'react-query';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { GetEntitlementsResponse } from '@jwp/ott-common/types/checkout';\r\nimport type { MediaOffer } from '@jwp/ott-common/types/media';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport CheckoutController from '@jwp/ott-common/src/controllers/CheckoutController';\r\nimport { isLocked } from '@jwp/ott-common/src/utils/entitlements';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\n\r\nexport type UseEntitlementResult = {\r\n  isEntitled: boolean;\r\n  isMediaEntitlementLoading: boolean;\r\n  mediaOffers: MediaOffer[];\r\n};\r\n\r\nexport type UseEntitlement = (playlistItem?: PlaylistItem) => UseEntitlementResult;\r\n\r\ntype QueryResult = {\r\n  responseData?: GetEntitlementsResponse;\r\n};\r\n\r\nconst notifyOnChangeProps = ['data' as const, 'isLoading' as const];\r\n\r\n/**\r\n * useEntitlement()\r\n *\r\n * Free items: Access\r\n * AVOD - Regular items free, TVOD items need entitlement\r\n * AuthVOD - For regular items user should be logged in, TVOD items need entitlement\r\n * SVOD - For regular items user should have subscription OR entitlement, premier items need entitlement\r\n *\r\n *  */\r\nconst useEntitlement: UseEntitlement = (playlistItem) => {\r\n  const { accessModel } = useConfigStore();\r\n  const { user, subscription } = useAccountStore(\r\n    ({ user, subscription }) => ({\r\n      user,\r\n      subscription,\r\n    }),\r\n    shallow,\r\n  );\r\n\r\n  const checkoutController = getModule(CheckoutController, false);\r\n\r\n  const isPreEntitled = playlistItem && !isLocked(accessModel, !!user, !!subscription, playlistItem);\r\n  const mediaOffers = playlistItem?.mediaOffers || [];\r\n\r\n  // this query is invalidated when the subscription gets reloaded\r\n  const mediaEntitlementQueries = useQueries(\r\n    mediaOffers.map(({ offerId }) => ({\r\n      queryKey: ['entitlements', offerId],\r\n      queryFn: () => checkoutController?.getEntitlements({ offerId }),\r\n      enabled: !!playlistItem && !!user && !!user.id && !!offerId && !isPreEntitled,\r\n      refetchOnMount: 'always' as const,\r\n      notifyOnChangeProps,\r\n    })),\r\n  );\r\n\r\n  // when the user is logged out the useQueries will be disabled but could potentially return its cached data\r\n  const isMediaEntitled = !!user && mediaEntitlementQueries.some((item) => item.isSuccess && (item.data as QueryResult)?.responseData?.accessGranted);\r\n  const isMediaEntitlementLoading = !isMediaEntitled && mediaEntitlementQueries.some((item) => item.isLoading);\r\n\r\n  const isEntitled = !!playlistItem && (isPreEntitled || isMediaEntitled);\r\n\r\n  return { isEntitled, isMediaEntitlementLoading, mediaOffers };\r\n};\r\n\r\nexport default useEntitlement;\r\n","import { useQuery, type UseBaseQueryResult } from 'react-query';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { isScheduledOrLiveMedia } from '@jwp/ott-common/src/utils/liveEvent';\r\n\r\nexport type UseMediaResult<TData = PlaylistItem, TError = unknown> = UseBaseQueryResult<TData, TError>;\r\n\r\nexport default function useMedia(mediaId: string, enabled: boolean = true): UseMediaResult {\r\n  const apiService = getModule(ApiService);\r\n\r\n  return useQuery(['media', mediaId], () => apiService.getMediaById(mediaId), {\r\n    enabled: !!mediaId && enabled,\r\n    refetchInterval: (data, _) => {\r\n      if (!data) return false;\r\n\r\n      const autoRefetch = isScheduledOrLiveMedia(data);\r\n\r\n      return autoRefetch ? 1000 * 30 : false;\r\n    },\r\n    staleTime: 60 * 1000 * 10, // 10 min\r\n  });\r\n}\r\n","import * as React from \"react\";\nconst SvgPlayTrailer = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M19,19H5V5H19M19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M10,8V16L15,12L10,8Z\" }));\nexport default SvgPlayTrailer;\n","import React, { type FC, Fragment } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport Select from '../Select/Select';\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './Filter.module.scss';\r\n\r\ntype FilterOption =\r\n  | {\r\n      label: string;\r\n      value: string;\r\n    }\r\n  | string;\r\n\r\ntype Props = {\r\n  name: string;\r\n  value: string;\r\n  defaultLabel: string;\r\n  options: FilterOption[];\r\n  forceDropdown?: boolean;\r\n  setValue: (value: string) => void;\r\n};\r\n\r\nconst Filter: FC<Props> = ({ name, value, defaultLabel, options, setValue, forceDropdown = false }) => {\r\n  const { t } = useTranslation('common');\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n\r\n  if (!options.length) {\r\n    return null;\r\n  }\r\n  const handleChange = (event: React.ChangeEvent<HTMLSelectElement>) => setValue(event.target.value);\r\n\r\n  const showFilterRow = !forceDropdown && breakpoint >= Breakpoint.md && options.length < 6;\r\n\r\n  return (\r\n    <Fragment>\r\n      {showFilterRow ? (\r\n        <div className={styles.filterRow} role=\"listbox\" aria-label={t('filter_videos_by', { name })}>\r\n          {options.map((option) => {\r\n            const optionLabel = typeof option === 'string' ? option : option.label;\r\n            const optionValue = typeof option === 'string' ? option : option.value;\r\n            const active = value === optionValue;\r\n\r\n            return <Button label={optionLabel} onClick={() => setValue(optionValue)} key={optionValue} active={active} role=\"option\" aria-selected={active} />;\r\n          })}\r\n          <Button label={defaultLabel} onClick={() => setValue('')} active={value === ''} key={defaultLabel} role=\"option\" aria-selected={value === ''} />\r\n        </div>\r\n      ) : (\r\n        <div className={styles.filterDropDown}>\r\n          <Select\r\n            className={styles.dropDown}\r\n            size=\"small\"\r\n            options={options}\r\n            defaultLabel={defaultLabel}\r\n            name={name}\r\n            value={value}\r\n            onChange={handleChange}\r\n            aria-label={t('filter_videos_by', { name })}\r\n          />\r\n        </div>\r\n      )}\r\n    </Fragment>\r\n  );\r\n};\r\n\r\nexport default Filter;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './TruncatedText.module.scss';\r\n\r\ntype TruncatedTextProps = {\r\n  text: string;\r\n  maximumLines: number;\r\n  className?: string;\r\n};\r\n\r\nconst TruncatedText: React.FC<TruncatedTextProps> = ({ text, maximumLines, className }) => {\r\n  return (\r\n    <div\r\n      className={classNames(styles.truncatedText, className)}\r\n      style={{\r\n        maxHeight: `calc(1.5em * ${maximumLines})`,\r\n        WebkitLineClamp: maximumLines,\r\n      }}\r\n    >\r\n      {text}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TruncatedText;\r\n","import classNames from 'classnames';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport ChevronRight from '@jwp/ott-theme/assets/icons/chevron_right.svg?react';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Icon from '../Icon/Icon';\r\nimport useBreakpoint from '../../hooks/useBreakpoint';\r\n\r\nimport styles from './CollapsibleText.module.scss';\r\n\r\ntype Props = {\r\n  text: string;\r\n  className?: string;\r\n};\r\n\r\nconst CollapsibleText: React.FC<Props> = ({ text, className }: Props) => {\r\n  const divRef = useRef<HTMLDivElement>() as React.MutableRefObject<HTMLDivElement>;\r\n  const breakpoint = useBreakpoint();\r\n  const [doesFlowOver, setDoesFlowOver] = useState(false);\r\n  const [expanded, setExpanded] = useState(false);\r\n\r\n  const ariaLabel = expanded ? 'Collapse' : 'Expand';\r\n\r\n  const clippablePixels = 4;\r\n  const maxHeight = 60;\r\n\r\n  useEffect(() => {\r\n    divRef.current && setDoesFlowOver(divRef.current.scrollHeight > divRef.current.offsetHeight + clippablePixels || maxHeight < divRef.current.offsetHeight);\r\n  }, [maxHeight, text, breakpoint]);\r\n\r\n  return (\r\n    <div className={classNames(styles.collapsibleText)}>\r\n      <p\r\n        ref={divRef}\r\n        id=\"collapsible-content\"\r\n        className={classNames(styles.textContainer, className, { [styles.collapsed]: !expanded && doesFlowOver })}\r\n        style={{ maxHeight: expanded ? divRef.current.scrollHeight : maxHeight }}\r\n      >\r\n        {text}\r\n      </p>\r\n      {doesFlowOver && (\r\n        <IconButton\r\n          aria-label={ariaLabel}\r\n          aria-expanded={expanded}\r\n          aria-controls=\"collapsible-content\"\r\n          className={classNames(styles.chevron, { [styles.expanded]: expanded })}\r\n          onClick={() => setExpanded(!expanded)}\r\n        >\r\n          <Icon icon={ChevronRight} />\r\n        </IconButton>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CollapsibleText;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport TruncatedText from '../TruncatedText/TruncatedText';\r\nimport Image from '../Image/Image';\r\nimport CollapsibleText from '../CollapsibleText/CollapsibleText';\r\n\r\nimport styles from './VideoDetails.module.scss';\r\n\r\ntype Props = {\r\n  title: string;\r\n  description: string;\r\n  primaryMetadata: React.ReactNode;\r\n  secondaryMetadata?: React.ReactNode;\r\n  image?: string;\r\n  startWatchingButton: React.ReactNode;\r\n  shareButton: React.ReactNode;\r\n  favoriteButton?: React.ReactNode;\r\n  trailerButton?: React.ReactNode;\r\n  children: React.ReactNode;\r\n};\r\n\r\nconst VideoDetails: React.VFC<Props> = ({\r\n  title,\r\n  description,\r\n  primaryMetadata,\r\n  secondaryMetadata,\r\n  image,\r\n  startWatchingButton,\r\n  shareButton,\r\n  favoriteButton,\r\n  trailerButton,\r\n  children,\r\n}) => {\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const isMobile = breakpoint === Breakpoint.xs;\r\n  const alt = ''; // intentionally empty for a11y, because adjacent text alternative\r\n\r\n  return (\r\n    <div data-testid={testId('cinema-layout')}>\r\n      <header className={styles.video} data-testid={testId('video-details')} id=\"video-details\">\r\n        <div className={classNames(styles.main, styles.mainPadding)}>\r\n          <Image className={styles.poster} image={image} alt={alt} width={1280} />\r\n          <div className={styles.posterFade} />\r\n          <div className={styles.info}>\r\n            <h1 className={styles.title}>{title}</h1>\r\n            <div className={styles.metaContainer}>\r\n              <div className={styles.primaryMetadata}>{primaryMetadata}</div>\r\n              {secondaryMetadata && <div className={styles.secondaryMetadata}>{secondaryMetadata}</div>}\r\n            </div>\r\n            {isMobile ? (\r\n              <CollapsibleText text={description} className={styles.description} />\r\n            ) : (\r\n              <TruncatedText text={description} maximumLines={12} className={styles.description} />\r\n            )}\r\n            <div className={styles.buttonBar}>\r\n              {startWatchingButton}\r\n              {trailerButton}\r\n              {favoriteButton}\r\n              {shareButton}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoDetails;\r\n","import React from 'react';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport CollapsibleText from '../CollapsibleText/CollapsibleText';\r\nimport TruncatedText from '../TruncatedText/TruncatedText';\r\n\r\nimport styles from './VideoDetailsInline.module.scss';\r\n\r\ntype Props = {\r\n  title: string | React.ReactNode;\r\n  description: string;\r\n  primaryMetadata: React.ReactNode;\r\n  shareButton: React.ReactNode;\r\n  favoriteButton: React.ReactNode;\r\n  trailerButton: React.ReactNode;\r\n  live?: boolean;\r\n};\r\n\r\nconst VideoDetailsInline: React.FC<Props> = ({ title, description, primaryMetadata, shareButton, favoriteButton, trailerButton }) => {\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const isMobile = breakpoint === Breakpoint.xs;\r\n\r\n  const TitleComponent = typeof title === 'string' ? 'h1' : 'div';\r\n\r\n  return (\r\n    <div className={styles.details} data-testid={testId('video-details-inline')}>\r\n      <TitleComponent className={styles.title}>{title}</TitleComponent>\r\n      <div className={styles.inlinePlayerMetadata}>\r\n        <div className={styles.primaryMetadata}>{primaryMetadata}</div>\r\n        {trailerButton}\r\n        {favoriteButton}\r\n        {shareButton}\r\n      </div>\r\n      {isMobile ? (\r\n        <CollapsibleText text={description} className={styles.description} />\r\n      ) : (\r\n        <TruncatedText text={description} maximumLines={12} className={styles.description} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoDetailsInline;\r\n","import React, { memo, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Link } from 'react-router-dom';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { formatDurationTag, formatLocalizedDateTime, formatSeriesMetaString } from '@jwp/ott-common/src/utils/formatting';\r\nimport { isLiveChannel, isSeries } from '@jwp/ott-common/src/utils/media';\r\nimport { MediaStatus } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport Lock from '@jwp/ott-theme/assets/icons/lock.svg?react';\r\nimport Today from '@jwp/ott-theme/assets/icons/today.svg?react';\r\n\r\nimport Image from '../Image/Image';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './VideoListItem.module.scss';\r\n\r\ntype VideoListItemProps = {\r\n  onHover?: () => void;\r\n  item: PlaylistItem;\r\n  progress?: number;\r\n  loading?: boolean;\r\n  isActive?: boolean;\r\n  activeLabel?: string;\r\n  isLocked?: boolean;\r\n  url: string;\r\n};\r\n\r\nfunction VideoListItem({ onHover, progress, activeLabel, item, url, loading = false, isActive = false, isLocked = true }: VideoListItemProps): JSX.Element {\r\n  const { title, duration, seasonNumber, episodeNumber, cardImage: image, mediaStatus, scheduledStart } = item;\r\n\r\n  const {\r\n    t,\r\n    i18n: { language },\r\n  } = useTranslation('common');\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n  const posterImageClassNames = classNames(styles.posterImage, {\r\n    [styles.visible]: imageLoaded,\r\n  });\r\n\r\n  const isSeriesItem = isSeries(item);\r\n  const isLive = mediaStatus === MediaStatus.LIVE || isLiveChannel(item);\r\n  const isScheduled = mediaStatus === MediaStatus.SCHEDULED;\r\n\r\n  const renderTag = () => {\r\n    if (loading || !title) return null;\r\n\r\n    if (isSeriesItem) {\r\n      return <div className={styles.tag}>{t('video:series')}</div>;\r\n    } else if (episodeNumber) {\r\n      return <div className={styles.tag}>{formatSeriesMetaString(seasonNumber, episodeNumber)}</div>;\r\n    } else if (duration) {\r\n      return <div className={styles.tag}>{formatDurationTag(duration)}</div>;\r\n    } else if (isLive) {\r\n      return <div className={classNames(styles.tag, styles.live)}>{t('live')}</div>;\r\n    } else if (isScheduled) {\r\n      return (\r\n        <div className={styles.tag}>\r\n          <Icon icon={Today} className={styles.scheduled} />\r\n          {t('scheduled')}\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Link role=\"button\" to={url} className={styles.listItem} onMouseEnter={onHover} tabIndex={0} data-testid={testId(title)}>\r\n      <div className={styles.titleContainer}>\r\n        <h3 className={styles.title}>{title}</h3>\r\n        {!!scheduledStart && <div className={styles.scheduledStart}>{formatLocalizedDateTime(scheduledStart, language)}</div>}\r\n      </div>\r\n      <div className={styles.poster}>\r\n        <Image className={posterImageClassNames} image={image} onLoad={() => setImageLoaded(true)} width={320} alt=\"\" />\r\n        <div className={styles.tags}>\r\n          {isLocked && (\r\n            <div className={classNames(styles.tag, styles.lock)} aria-label={t('card_lock')}>\r\n              <Icon icon={Lock} />\r\n            </div>\r\n          )}\r\n          {renderTag()}\r\n        </div>\r\n        {isActive && <div className={styles.activeLabel}>{activeLabel}</div>}\r\n        {progress ? (\r\n          <div className={styles.progressContainer}>\r\n            <div className={styles.progressBar} style={{ width: `${Math.round(progress * 100)}%` }} />\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    </Link>\r\n  );\r\n}\r\n\r\nexport default memo(VideoListItem);\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport InfiniteScroll from 'react-infinite-scroller';\r\nimport type { AccessModel } from '@jwp/ott-common/types/config';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { isLocked } from '@jwp/ott-common/src/utils/entitlements';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport VideoListItem from '../VideoListItem/VideoListItem';\r\nimport InfiniteScrollLoader from '../InfiniteScrollLoader/InfiniteScrollLoader';\r\n\r\nimport styles from './VideoList.module.scss';\r\n\r\ntype Props = {\r\n  playlist?: Playlist;\r\n  header?: React.ReactNode;\r\n  watchHistory?: { [key: string]: number };\r\n  isLoading: boolean;\r\n  activeMediaId?: string;\r\n  activeLabel?: string;\r\n  className?: string;\r\n  accessModel: AccessModel;\r\n  isLoggedIn: boolean;\r\n  hasSubscription: boolean;\r\n  hasMore?: boolean;\r\n  loadMore?: () => void;\r\n  onListItemHover?: (item: PlaylistItem) => void;\r\n  getUrl: (item: PlaylistItem) => string;\r\n};\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-function\r\nconst defaultLoadMore = () => {};\r\n\r\nfunction VideoList({\r\n  playlist,\r\n  header,\r\n  onListItemHover,\r\n  isLoading = false,\r\n  watchHistory,\r\n  activeMediaId,\r\n  activeLabel,\r\n  className,\r\n  accessModel,\r\n  isLoggedIn,\r\n  hasSubscription,\r\n  hasMore,\r\n  loadMore = defaultLoadMore,\r\n  getUrl,\r\n}: Props) {\r\n  return (\r\n    <div className={classNames(styles.container, !!className && className)} data-testid={testId('video-list')}>\r\n      {!!header && header}\r\n      <div className={styles.content}>\r\n        <InfiniteScroll\r\n          element=\"ul\"\r\n          pageStart={0}\r\n          loadMore={loadMore ?? defaultLoadMore}\r\n          hasMore={hasMore ?? false}\r\n          className={styles.list}\r\n          loader={<InfiniteScrollLoader key=\"loader\" />}\r\n          useWindow={false}\r\n        >\r\n          {playlist?.playlist?.map((playlistItem: PlaylistItem) => (\r\n            <li key={playlistItem.mediaid}>\r\n              <VideoListItem\r\n                url={getUrl(playlistItem)}\r\n                progress={watchHistory ? watchHistory[playlistItem.mediaid] : undefined}\r\n                onHover={() => onListItemHover && onListItemHover(playlistItem)}\r\n                loading={isLoading}\r\n                isActive={activeMediaId === playlistItem.mediaid}\r\n                activeLabel={activeLabel}\r\n                isLocked={isLocked(accessModel, isLoggedIn, hasSubscription, playlistItem)}\r\n                item={playlistItem}\r\n              />\r\n            </li>\r\n          ))}\r\n        </InfiniteScroll>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default VideoList;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { AccessModel } from '@jwp/ott-common/types/config';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport CardGrid from '../CardGrid/CardGrid';\r\nimport Filter from '../Filter/Filter';\r\nimport VideoDetails from '../VideoDetails/VideoDetails';\r\nimport VideoDetailsInline from '../VideoDetailsInline/VideoDetailsInline';\r\nimport VideoList from '../VideoList/VideoList';\r\n\r\nimport styles from './VideoLayout.module.scss';\r\n\r\ntype FilterProps = {\r\n  filterMetadata?: React.ReactNode;\r\n  filters?: (string | { label: string; value: string })[];\r\n  currentFilter?: string;\r\n  defaultFilterLabel?: string;\r\n  setFilter?: (value: string) => void;\r\n};\r\n\r\ntype LoadMoreProps = {\r\n  hasMore?: boolean;\r\n  loadMore?: () => void;\r\n};\r\n\r\ntype VideoDetailsProps = {\r\n  title: string;\r\n  description: string;\r\n  image?: string;\r\n  primaryMetadata: React.ReactNode;\r\n  secondaryMetadata?: React.ReactNode;\r\n  shareButton: React.ReactNode;\r\n  favoriteButton: React.ReactNode;\r\n  trailerButton: React.ReactNode;\r\n  startWatchingButton: React.ReactNode;\r\n  live?: boolean;\r\n};\r\n\r\ntype VideoListProps = {\r\n  relatedTitle?: string;\r\n  onItemHover?: (item: PlaylistItem) => void;\r\n  watchHistory?: { [key: string]: number };\r\n  activeMediaId?: string;\r\n  activeLabel?: string;\r\n  getURL: (item: PlaylistItem) => string;\r\n};\r\n\r\ntype Props = {\r\n  inlineLayout: boolean;\r\n  player: React.ReactNode;\r\n  isLoading: boolean;\r\n  accessModel: AccessModel;\r\n  isLoggedIn: boolean;\r\n  hasSubscription: boolean;\r\n  children?: React.ReactNode;\r\n  item?: PlaylistItem;\r\n  playlist?: Playlist;\r\n} & FilterProps &\r\n  VideoDetailsProps &\r\n  VideoListProps &\r\n  LoadMoreProps;\r\n\r\nconst VideoLayout: React.FC<Props> = ({\r\n  inlineLayout,\r\n  player,\r\n  playlist,\r\n  accessModel,\r\n  isLoading,\r\n  isLoggedIn,\r\n  item,\r\n  hasSubscription,\r\n  // video details\r\n  title,\r\n  description,\r\n  image,\r\n  primaryMetadata,\r\n  secondaryMetadata,\r\n  shareButton,\r\n  favoriteButton,\r\n  startWatchingButton,\r\n  trailerButton,\r\n  // list\r\n  relatedTitle,\r\n  watchHistory,\r\n  activeLabel,\r\n  // filters\r\n  filters,\r\n  setFilter,\r\n  filterMetadata,\r\n  currentFilter = '',\r\n  defaultFilterLabel = '',\r\n  children,\r\n  // load more\r\n  hasMore,\r\n  loadMore,\r\n  getURL,\r\n}) => {\r\n  const breakpoint = useBreakpoint();\r\n  const isTablet = breakpoint === Breakpoint.sm || breakpoint === Breakpoint.md;\r\n  // only show the filters when there are two or more filters\r\n  const hasFilters = filters && filters.length > 1;\r\n  const showFilters = hasFilters && setFilter;\r\n\r\n  const renderFilters = (forceDropdown: boolean) => (\r\n    <div className={classNames(styles.filters, { [styles.filtersInline]: inlineLayout })}>\r\n      {!!filterMetadata && inlineLayout && <span className={styles.filterMetadata}>{filterMetadata}</span>}\r\n      {showFilters && (\r\n        <Filter name=\"season\" value={currentFilter} defaultLabel={defaultFilterLabel} options={filters} setValue={setFilter} forceDropdown={forceDropdown} />\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  const renderRelatedVideos = (grid = true) => {\r\n    if (!playlist) return null;\r\n\r\n    return grid ? (\r\n      <>\r\n        <div className={classNames(styles.relatedVideosGrid, { [styles.inlineLayout]: inlineLayout })}>\r\n          <h2 className={styles.relatedVideosGridTitle}>{relatedTitle || '\\u00A0'}</h2>\r\n          {hasFilters && renderFilters(inlineLayout)}\r\n        </div>\r\n        <CardGrid\r\n          playlist={playlist}\r\n          isLoading={isLoading}\r\n          watchHistory={watchHistory}\r\n          accessModel={accessModel}\r\n          isLoggedIn={isLoggedIn}\r\n          currentCardItem={item}\r\n          currentCardLabel={activeLabel}\r\n          hasSubscription={hasSubscription}\r\n          hasMore={hasMore}\r\n          loadMore={loadMore}\r\n          getUrl={getURL}\r\n        />\r\n      </>\r\n    ) : (\r\n      <div className={styles.relatedVideosList}>\r\n        <VideoList\r\n          header={\r\n            <div className={styles.relatedVideosListHeader}>\r\n              {title && <h2 className={styles.relatedVideosListTitle}>{relatedTitle}</h2>}\r\n              {hasFilters && renderFilters(true)}\r\n            </div>\r\n          }\r\n          activeMediaId={item?.mediaid}\r\n          activeLabel={activeLabel}\r\n          playlist={playlist}\r\n          watchHistory={watchHistory}\r\n          isLoading={isLoading}\r\n          accessModel={accessModel}\r\n          isLoggedIn={isLoggedIn}\r\n          hasSubscription={hasSubscription}\r\n          hasMore={hasMore}\r\n          loadMore={loadMore}\r\n          getUrl={getURL}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (inlineLayout) {\r\n    return (\r\n      <div className={styles.videoInlineLayout} data-testid={testId('inline-layout')}>\r\n        <div className={styles.player}>{player}</div>\r\n        <div className={styles.videoDetailsInline}>\r\n          <VideoDetailsInline\r\n            title={secondaryMetadata || title}\r\n            live={item?.duration === 0}\r\n            description={description}\r\n            primaryMetadata={primaryMetadata}\r\n            shareButton={shareButton}\r\n            favoriteButton={favoriteButton}\r\n            trailerButton={trailerButton}\r\n          />\r\n        </div>\r\n        {renderRelatedVideos(isTablet)}\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <VideoDetails\r\n      title={title}\r\n      description={description}\r\n      image={image}\r\n      startWatchingButton={startWatchingButton}\r\n      favoriteButton={favoriteButton}\r\n      trailerButton={trailerButton}\r\n      shareButton={shareButton}\r\n      primaryMetadata={primaryMetadata}\r\n      secondaryMetadata={secondaryMetadata}\r\n    >\r\n      {playlist && <section className={styles.relatedVideos}>{renderRelatedVideos(true)}</section>}\r\n      {children}\r\n      {player}\r\n    </VideoDetails>\r\n  );\r\n};\r\n\r\nexport default VideoLayout;\r\n","import React, { type CSSProperties, type ReactNode } from 'react';\r\n\r\nimport Animation, { type Status } from '../Animation';\r\n\r\ntype Props = {\r\n  className?: string;\r\n  open?: boolean;\r\n  duration?: number;\r\n  delay?: number;\r\n  children?: ReactNode;\r\n  keepMounted?: boolean;\r\n  onOpenAnimationEnd?: () => void;\r\n  onCloseAnimationEnd?: () => void;\r\n};\r\n\r\nconst Fade: React.FC<Props> = ({ className, open = true, duration = 250, delay = 0, onOpenAnimationEnd, onCloseAnimationEnd, keepMounted, children }) => {\r\n  const seconds = duration / 1000;\r\n  const transition = `opacity ${seconds}s ease-in-out`;\r\n\r\n  const createStyle = (status: Status): CSSProperties => ({\r\n    transition,\r\n    opacity: status === 'opening' || status === 'open' ? 1 : 0,\r\n    willChange: 'opacity',\r\n  });\r\n\r\n  return (\r\n    <Animation\r\n      className={className}\r\n      createStyle={(status: Status) => createStyle(status)}\r\n      open={open}\r\n      duration={duration}\r\n      delay={delay}\r\n      onOpenAnimationEnd={onOpenAnimationEnd}\r\n      onCloseAnimationEnd={onCloseAnimationEnd}\r\n      keepMounted={keepMounted}\r\n    >\r\n      {children}\r\n    </Animation>\r\n  );\r\n};\r\n\r\nexport default Fade;\r\n","import { useCallback, useEffect, useLayoutEffect, useRef } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport WatchHistoryController from '@jwp/ott-common/src/controllers/WatchHistoryController';\r\n\r\nimport useEventCallback from './useEventCallback';\r\n\r\ntype QueuedProgress = {\r\n  item: PlaylistItem;\r\n  seriesItem?: PlaylistItem;\r\n  progress: number;\r\n  timestamp: number;\r\n};\r\n\r\nconst PROGRESSIVE_SAVE_INTERVAL = 300_000; // 5 minutes\r\n\r\n/**\r\n * The `useWatchHistoryListener` hook has the responsibility to save the players watch progress on key moments.\r\n *\r\n * __The problem:__\r\n *\r\n * There are multiple events that trigger a save. This results in duplicate (unnecessary) saves and API calls. Another\r\n * problem is that some events are triggered when the `item` to update has changed. For example, when clicking a media\r\n * item in the \"Related shelf\". This causes the wrong item to be saved in the watch history.\r\n *\r\n * __The solution:__\r\n *\r\n * This hook listens to the player time update event and queues a watch history entry with the current progress and\r\n * item. When this needs to be saved, the queue is used to look up the last progress and item and save it when\r\n * necessary. The queue is then cleared to prevent duplicate saves and API calls.\r\n */\r\nexport const useWatchHistoryListener = (player: jwplayer.JWPlayer | undefined, item: PlaylistItem, seriesItem?: PlaylistItem) => {\r\n  const queuedWatchProgress = useRef<QueuedProgress | null>(null);\r\n  const watchHistoryController = getModule(WatchHistoryController);\r\n\r\n  // config\r\n  const { features } = useConfigStore((s) => s.config);\r\n  const continueWatchingList = features?.continueWatchingList;\r\n  const watchHistoryEnabled = !!continueWatchingList;\r\n\r\n  // maybe store the watch progress when we have a queued watch progress\r\n  const maybeSaveWatchProgress = useCallback(() => {\r\n    if (!watchHistoryEnabled || !queuedWatchProgress.current) return;\r\n\r\n    const { item, seriesItem, progress } = queuedWatchProgress.current;\r\n\r\n    // save the queued watch progress\r\n    watchHistoryController.saveItem(item, seriesItem, progress);\r\n\r\n    // clear the queue\r\n    queuedWatchProgress.current = null;\r\n  }, [watchHistoryEnabled, watchHistoryController]);\r\n\r\n  // update the queued watch progress on each time update event\r\n  const handleTimeUpdate = useEventCallback((event: jwplayer.TimeParam) => {\r\n    // live streams have a negative duration, we ignore these for now\r\n    if (event.duration < 0) return;\r\n\r\n    const progress = Number((event.position / event.duration).toFixed(5));\r\n\r\n    if (!isNaN(progress) && isFinite(progress)) {\r\n      queuedWatchProgress.current = {\r\n        item,\r\n        seriesItem,\r\n        progress,\r\n        timestamp: queuedWatchProgress.current?.timestamp || Date.now(),\r\n      };\r\n\r\n      // save the progress when we haven't done so in the last X minutes\r\n      if (Date.now() - queuedWatchProgress.current.timestamp > PROGRESSIVE_SAVE_INTERVAL) {\r\n        maybeSaveWatchProgress();\r\n      }\r\n    }\r\n  });\r\n\r\n  // listen for certain player events\r\n  useEffect(() => {\r\n    if (!player || !watchHistoryEnabled) return;\r\n\r\n    player.on('time', handleTimeUpdate);\r\n    player.on('pause', maybeSaveWatchProgress);\r\n    player.on('complete', maybeSaveWatchProgress);\r\n    player.on('remove', maybeSaveWatchProgress);\r\n\r\n    return () => {\r\n      player.off('time', handleTimeUpdate);\r\n      player.off('pause', maybeSaveWatchProgress);\r\n      player.off('complete', maybeSaveWatchProgress);\r\n      player.off('remove', maybeSaveWatchProgress);\r\n    };\r\n  }, [player, watchHistoryEnabled, maybeSaveWatchProgress, handleTimeUpdate]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      // store watch progress on unmount and when the media item changes\r\n      maybeSaveWatchProgress();\r\n    };\r\n  }, [item?.mediaid, maybeSaveWatchProgress]);\r\n\r\n  // add event listeners for unload and visibility change to ensure the latest watch progress is saved\r\n  useLayoutEffect(() => {\r\n    const visibilityListener = () => document.visibilityState === 'hidden' && maybeSaveWatchProgress();\r\n\r\n    window.addEventListener('pagehide', maybeSaveWatchProgress);\r\n    window.addEventListener('visibilitychange', visibilityListener);\r\n\r\n    return () => {\r\n      window.removeEventListener('pagehide', maybeSaveWatchProgress);\r\n      window.removeEventListener('visibilitychange', visibilityListener);\r\n    };\r\n  }, [maybeSaveWatchProgress]);\r\n};\r\n","import { useMemo } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { VideoProgressMinMax } from '@jwp/ott-common/src/constants';\r\n\r\nimport { useWatchHistoryListener } from './useWatchHistoryListener';\r\n\r\nexport const useWatchHistory = (player: jwplayer.JWPlayer | undefined, item: PlaylistItem, seriesItem?: PlaylistItem) => {\r\n  // config\r\n  const { features } = useConfigStore((s) => s.config);\r\n  const continueWatchingList = features?.continueWatchingList;\r\n  const watchHistoryEnabled = !!continueWatchingList;\r\n\r\n  // watch history listener\r\n  useWatchHistoryListener(player, item, seriesItem);\r\n\r\n  // watch History\r\n  const watchHistoryItem = useWatchHistoryStore((state) => (!!item && watchHistoryEnabled ? state.getItem(item) : undefined));\r\n\r\n  // calculate the `startTime` of the current item based on the watch progress\r\n  return useMemo(() => {\r\n    const videoProgress = watchHistoryItem?.progress;\r\n\r\n    if (videoProgress && videoProgress > VideoProgressMinMax.Min && videoProgress < VideoProgressMinMax.Max) {\r\n      return videoProgress * item.duration;\r\n    }\r\n\r\n    // start at the beginning of the video (only for VOD content)\r\n    return 0;\r\n  }, [item.duration, watchHistoryItem?.progress]);\r\n};\r\n","import type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport useEventCallback from './useEventCallback';\r\n\r\nexport const usePlaylistItemCallback = (startDateTime?: string | null, endDateTime?: string | null) => {\r\n  const applyLiveStreamOffset = (item: PlaylistItem) => {\r\n    if (!startDateTime) return item;\r\n\r\n    // The timeParam can either be just a start date like `2022-08-08T20:00:00` (to extend DVR) or a range like\r\n    // `2022-08-08T20:00:00-2022-08-08T22:00:00` to select a VOD from the live stream.\r\n    const timeParam = [startDateTime, endDateTime].filter(Boolean).join('-');\r\n\r\n    return {\r\n      ...item,\r\n      allSources: undefined, // `allSources` need to be cleared otherwise JW Player will use those instead\r\n      sources: item.sources.map((source) => ({\r\n        ...source,\r\n        file: createURL(source.file, {\r\n          t: timeParam,\r\n        }),\r\n      })),\r\n    };\r\n  };\r\n\r\n  return useEventCallback(async (item: PlaylistItem) => {\r\n    return applyLiveStreamOffset(item);\r\n  });\r\n};\r\n","import { useQuery } from 'react-query';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { createURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nconst CACHE_TIME = 60 * 1000 * 20;\r\n\r\n/**\r\n * @deprecated Use adScheduleUrls.xml form the config instead.\r\n */\r\nconst useLegacyStandaloneAds = ({ adScheduleId, enabled }: { adScheduleId: string | null | undefined; enabled: boolean }) => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const { isLoading, data } = useQuery(['ad-schedule', adScheduleId], async () => apiService.getAdSchedule(adScheduleId), {\r\n    enabled: enabled && !!adScheduleId,\r\n    cacheTime: CACHE_TIME,\r\n    staleTime: CACHE_TIME,\r\n  });\r\n\r\n  return {\r\n    isLoading,\r\n    data,\r\n  };\r\n};\r\n\r\nexport const useAds = ({ mediaId }: { mediaId: string }) => {\r\n  const { adSchedule: adScheduleId, adScheduleUrls } = useConfigStore((s) => s.config);\r\n\r\n  // adScheduleUrls.xml prop exists when ad-config is attached to the App Config\r\n  const useAppBasedFlow = !!adScheduleUrls?.xml;\r\n\r\n  const { data: adSchedule, isLoading: isAdScheduleLoading } = useLegacyStandaloneAds({ adScheduleId, enabled: !useAppBasedFlow });\r\n  const adConfig = {\r\n    client: 'vast',\r\n    schedule: createURL(adScheduleUrls?.xml || '', {\r\n      media_id: mediaId,\r\n    }),\r\n  };\r\n\r\n  return {\r\n    isLoading: useAppBasedFlow ? false : isAdScheduleLoading,\r\n    data: useAppBasedFlow ? adConfig : adSchedule,\r\n  };\r\n};\r\n","import { useQuery } from 'react-query';\r\nimport type { GetPlaylistParams } from '@jwp/ott-common/types/playlist';\r\nimport type { GetMediaParams } from '@jwp/ott-common/types/media';\r\nimport type { EntitlementType } from '@jwp/ott-common/types/entitlement';\r\nimport GenericEntitlementService from '@jwp/ott-common/src/services/GenericEntitlementService';\r\nimport JWPEntitlementService from '@jwp/ott-common/src/services/JWPEntitlementService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { isTruthyCustomParamValue } from '@jwp/ott-common/src/utils/common';\r\n\r\nconst useContentProtection = <T>(\r\n  type: EntitlementType,\r\n  id: string | undefined,\r\n  callback: (token?: string, drmPolicyId?: string) => Promise<T | undefined>,\r\n  params: GetPlaylistParams | GetMediaParams = {},\r\n  enabled: boolean = true,\r\n  placeholderData?: T,\r\n) => {\r\n  const genericEntitlementService = getModule(GenericEntitlementService);\r\n  const jwpEntitlementService = getModule(JWPEntitlementService);\r\n\r\n  const { configId, signingConfig, contentProtection, jwp, urlSigning } = useConfigStore(({ config }) => ({\r\n    configId: config.id,\r\n    signingConfig: config.contentSigningService,\r\n    contentProtection: config.contentProtection,\r\n    jwp: config.integrations.jwp,\r\n    urlSigning: isTruthyCustomParamValue(config?.custom?.urlSigning),\r\n  }));\r\n  const host = signingConfig?.host;\r\n  const drmPolicyId = contentProtection?.drm?.defaultPolicyId ?? signingConfig?.drmPolicyId;\r\n  const signingEnabled = !!urlSigning || !!host || (!!drmPolicyId && !host);\r\n\r\n  const { data: token, isLoading } = useQuery(\r\n    ['token', type, id, params],\r\n    async () => {\r\n      // if provider is not JWP\r\n      if (!!id && !!host) {\r\n        const accountController = getModule(AccountController);\r\n        const authData = await accountController.getAuthData();\r\n        const { host, drmPolicyId } = signingConfig;\r\n\r\n        return genericEntitlementService.getMediaToken(host, id, authData?.jwt, params, drmPolicyId);\r\n      }\r\n      // if provider is JWP\r\n      if (jwp && configId && !!id && signingEnabled) {\r\n        return jwpEntitlementService.getJWPMediaToken(configId, id);\r\n      }\r\n    },\r\n    { enabled: signingEnabled && enabled && !!id, keepPreviousData: false, staleTime: 15 * 60 * 1000 },\r\n  );\r\n\r\n  const queryResult = useQuery<T | undefined>([type, id, params, token], async () => callback(token, drmPolicyId), {\r\n    enabled: !!id && enabled && (!signingEnabled || !!token),\r\n    placeholderData: id ? placeholderData : undefined,\r\n    retry: 2,\r\n    retryDelay: 1000,\r\n    keepPreviousData: false,\r\n  });\r\n\r\n  return {\r\n    ...queryResult,\r\n    isLoading: isLoading || queryResult.isLoading,\r\n  };\r\n};\r\n\r\nexport default useContentProtection;\r\n","import { useEffect, useState } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\n\r\nimport useContentProtection from './useContentProtection';\r\n\r\nexport default function useProtectedMedia(item: PlaylistItem) {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const [isGeoBlocked, setIsGeoBlocked] = useState(false);\r\n  const contentProtectionQuery = useContentProtection('media', item.mediaid, (token, drmPolicyId) => apiService.getMediaById(item.mediaid, token, drmPolicyId));\r\n\r\n  useEffect(() => {\r\n    const m3u8 = contentProtectionQuery.data?.sources.find((source) => source.file.indexOf('.m3u8') !== -1);\r\n    if (m3u8) {\r\n      fetch(m3u8.file, { method: 'HEAD' }).then((response) => {\r\n        response.status === 403 && setIsGeoBlocked(true);\r\n      });\r\n    }\r\n  }, [contentProtectionQuery.data]);\r\n\r\n  return {\r\n    ...contentProtectionQuery,\r\n    isGeoBlocked,\r\n  };\r\n}\r\n","import { useEffect, useState } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport env from '@jwp/ott-common/src/env';\r\nimport type { Jwpltx } from '@jwp/ott-common/types/jwpltx';\r\n\r\nconst useOttAnalytics = (item?: PlaylistItem, feedId: string = '') => {\r\n  const analyticsToken = useConfigStore((s) => s.config.analyticsToken);\r\n  const user = useAccountStore((state) => state.user);\r\n  const { config } = useConfigStore((s) => s);\r\n\r\n  // ott app user id (oaid)\r\n  const oaid: number | undefined = user?.id ? Number(user.id) : undefined;\r\n  // app config id (oiid)\r\n  const oiid = config?.id;\r\n  // app version number (av)\r\n  const av = env.APP_VERSION;\r\n\r\n  const [player, setPlayer] = useState<jwplayer.JWPlayer | null>(null);\r\n\r\n  useEffect(() => {\r\n    const jwpltx = 'jwpltx' in window ? (window.jwpltx as Jwpltx) : undefined;\r\n\r\n    if (!jwpltx || !analyticsToken || !player || !item) {\r\n      return;\r\n    }\r\n\r\n    const timeHandler = ({ position, duration }: jwplayer.TimeParam) => {\r\n      jwpltx.time(position, duration);\r\n    };\r\n\r\n    const seekHandler = ({ offset }: jwplayer.SeekParam) => {\r\n      // TODO: according to JWPlayer typings, the seek param doesn't contain a `duration` property, but it actually does\r\n      jwpltx.seek(offset, player.getDuration());\r\n    };\r\n\r\n    const seekedHandler = () => {\r\n      jwpltx.seeked();\r\n    };\r\n\r\n    const playlistItemHandler = () => {\r\n      if (!analyticsToken) return;\r\n\r\n      if (!item) {\r\n        return;\r\n      }\r\n\r\n      jwpltx.ready(analyticsToken, window.location.hostname, feedId, item.mediaid, item.title, oaid, oiid, av);\r\n    };\r\n\r\n    const completeHandler = () => {\r\n      jwpltx.complete();\r\n    };\r\n\r\n    const adImpressionHandler = () => {\r\n      jwpltx.adImpression();\r\n    };\r\n\r\n    player.on('playlistItem', playlistItemHandler);\r\n    player.on('complete', completeHandler);\r\n    player.on('time', timeHandler);\r\n    player.on('seek', seekHandler);\r\n    player.on('seeked', seekedHandler);\r\n    player.on('adImpression', adImpressionHandler);\r\n\r\n    return () => {\r\n      // Fire remaining seconds / minutes watched\r\n      jwpltx.remove();\r\n      player.off('playlistItem', playlistItemHandler);\r\n      player.off('complete', completeHandler);\r\n      player.off('time', timeHandler);\r\n      player.off('seek', seekHandler);\r\n      player.off('seeked', seekedHandler);\r\n      player.off('adImpression', adImpressionHandler);\r\n    };\r\n  }, [player, item, analyticsToken, feedId, oaid, oiid, av]);\r\n\r\n  return setPlayer;\r\n};\r\n\r\nexport default useOttAnalytics;\r\n","import { useAccountStore } from '../stores/AccountStore';\r\nimport { useConfigStore } from '../stores/ConfigStore';\r\nimport { useProfileStore } from '../stores/ProfileStore';\r\nimport type { PlaylistItem, Source } from '../../types/playlist';\r\n\r\nexport const attachAnalyticsParams = (item: PlaylistItem) => {\r\n  // @todo pass these as params instead of reading the stores\r\n  const { config } = useConfigStore.getState();\r\n  const { user } = useAccountStore.getState();\r\n  const { profile } = useProfileStore.getState();\r\n\r\n  const { sources, mediaid } = item;\r\n\r\n  const userId = user?.id;\r\n  const profileId = profile?.id;\r\n  const isJwIntegration = !!config?.integrations?.jwp;\r\n\r\n  sources.map((source: Source) => {\r\n    const url = new URL(source.file);\r\n\r\n    const mediaId = mediaid.toLowerCase();\r\n    const sourceUrl = url.href.toLowerCase();\r\n\r\n    // Attach user_id and profile_id only for VOD and BCL SaaS Live Streams\r\n    const isVOD = sourceUrl === `https://cdn.jwplayer.com/manifests/${mediaId}.m3u8`;\r\n    const isBCL = sourceUrl === `https://content.jwplatform.com/live/broadcast/${mediaId}.m3u8`;\r\n\r\n    if ((isVOD || isBCL) && userId) {\r\n      url.searchParams.set('user_id', userId);\r\n\r\n      if (isJwIntegration && profileId) {\r\n        url.searchParams.set('profile_id', profileId);\r\n      }\r\n    }\r\n\r\n    source.file = url.toString();\r\n  });\r\n};\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport type { AdSchedule } from '@jwp/ott-common/types/ad-schedule';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { deepCopy } from '@jwp/ott-common/src/utils/collection';\r\nimport { logDev, testId } from '@jwp/ott-common/src/utils/common';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport useOttAnalytics from '@jwp/ott-hooks-react/src/useOttAnalytics';\r\nimport { attachAnalyticsParams } from '@jwp/ott-common/src/utils/analytics';\r\nimport env from '@jwp/ott-common/src/env';\r\n\r\nimport type { JWPlayer } from '../../../types/jwplayer';\r\nimport { addScript } from '../../utils/dom';\r\n\r\nimport styles from './Player.module.scss';\r\n\r\ntype Props = {\r\n  feedId?: string;\r\n  item: PlaylistItem;\r\n  startTime?: number;\r\n  autostart?: boolean;\r\n  adsData?: AdSchedule;\r\n  onReady?: (player?: JWPlayer) => void;\r\n  onPlay?: () => void;\r\n  onPause?: () => void;\r\n  onComplete?: () => void;\r\n  onUserActive?: () => void;\r\n  onUserInActive?: () => void;\r\n  onBeforePlay?: () => void;\r\n  onFirstFrame?: () => void;\r\n  onRemove?: () => void;\r\n  onNext?: () => void;\r\n  onPlaylistItem?: () => void;\r\n  onPlaylistItemCallback?: (item: PlaylistItem) => Promise<undefined | PlaylistItem>;\r\n};\r\n\r\nconst Player: React.FC<Props> = ({\r\n  item,\r\n  adsData,\r\n  onReady,\r\n  onPlay,\r\n  onPause,\r\n  onComplete,\r\n  onUserActive,\r\n  onUserInActive,\r\n  onBeforePlay,\r\n  onFirstFrame,\r\n  onRemove,\r\n  onPlaylistItem,\r\n  onPlaylistItemCallback,\r\n  onNext,\r\n  feedId,\r\n  startTime = 0,\r\n  autostart,\r\n}: Props) => {\r\n  const playerElementRef = useRef<HTMLDivElement>(null);\r\n  const playerRef = useRef<JWPlayer>();\r\n  const loadingRef = useRef(false);\r\n  const [libLoaded, setLibLoaded] = useState(!!window.jwplayer);\r\n  const startTimeRef = useRef(startTime);\r\n\r\n  const setPlayer = useOttAnalytics(item, feedId);\r\n\r\n  const { settings } = useConfigStore((s) => s);\r\n\r\n  const playerId = settings.playerId;\r\n  const playerLicenseKey = settings.playerLicenseKey;\r\n\r\n  const handleBeforePlay = useEventCallback(onBeforePlay);\r\n  const handlePlay = useEventCallback(onPlay);\r\n  const handlePause = useEventCallback(onPause);\r\n  const handleComplete = useEventCallback(onComplete);\r\n  const handleUserActive = useEventCallback(onUserActive);\r\n  const handleUserInactive = useEventCallback(onUserInActive);\r\n  const handleFirstFrame = useEventCallback(() => {\r\n    // a11y: auto focus to play/pause button\r\n    const playerContainer = playerRef.current?.getContainer();\r\n    const playPauseButton = playerContainer?.querySelector(\r\n      '.jw-controlbar [aria-label=\"Play\"], .jw-button-container [aria-label=\"Pause\"]',\r\n    ) as HTMLDivElement | null;\r\n    playPauseButton?.focus();\r\n\r\n    onFirstFrame?.();\r\n  });\r\n  const handleRemove = useEventCallback(onRemove);\r\n  const handlePlaylistItem = useEventCallback(onPlaylistItem);\r\n  const handlePlaylistItemCallback = useEventCallback(onPlaylistItemCallback);\r\n  const handleNextClick = useEventCallback(onNext);\r\n  const handleReady = useEventCallback(() => onReady && onReady(playerRef.current));\r\n\r\n  const attachEvents = useCallback(() => {\r\n    playerRef.current?.on('ready', handleReady);\r\n    playerRef.current?.on('beforePlay', handleBeforePlay);\r\n    playerRef.current?.on('complete', handleComplete);\r\n    playerRef.current?.on('play', handlePlay);\r\n    playerRef.current?.on('pause', handlePause);\r\n    playerRef.current?.on('userActive', handleUserActive);\r\n    playerRef.current?.on('userInactive', handleUserInactive);\r\n    playerRef.current?.on('firstFrame', handleFirstFrame);\r\n    playerRef.current?.on('remove', handleRemove);\r\n    playerRef.current?.on('playlistItem', handlePlaylistItem);\r\n    playerRef.current?.on('nextClick', handleNextClick);\r\n    playerRef.current?.setPlaylistItemCallback(handlePlaylistItemCallback);\r\n  }, [\r\n    handleReady,\r\n    handleBeforePlay,\r\n    handleComplete,\r\n    handlePlay,\r\n    handlePause,\r\n    handleUserActive,\r\n    handleUserInactive,\r\n    handleFirstFrame,\r\n    handleRemove,\r\n    handlePlaylistItem,\r\n    handleNextClick,\r\n    handlePlaylistItemCallback,\r\n  ]);\r\n\r\n  const detachEvents = useCallback(() => {\r\n    playerRef.current?.off('ready');\r\n    playerRef.current?.off('beforePlay');\r\n    playerRef.current?.off('complete');\r\n    playerRef.current?.off('play');\r\n    playerRef.current?.off('pause');\r\n    playerRef.current?.off('userActive');\r\n    playerRef.current?.off('userInactive');\r\n    playerRef.current?.off('firstFrame');\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!window.jwplayer && !loadingRef.current) {\r\n      loadingRef.current = true;\r\n\r\n      const scriptUrl = `${env.APP_API_BASE_URL}/libraries/${playerId}.js`;\r\n\r\n      addScript(scriptUrl).then(() => {\r\n        setLibLoaded(true);\r\n        loadingRef.current = false;\r\n      });\r\n    }\r\n  }, [playerId]);\r\n\r\n  useEffect(() => {\r\n    // Update the startTimeRef each time the startTime changes\r\n    startTimeRef.current = startTime;\r\n  }, [startTime]);\r\n\r\n  useEffect(() => {\r\n    const loadPlaylist = () => {\r\n      if (!item || !playerRef.current) {\r\n        return;\r\n      }\r\n\r\n      const currentItem = playerRef.current?.getPlaylistItem() as unknown as PlaylistItem | null;\r\n\r\n      // We already loaded this item\r\n      if (currentItem && currentItem.mediaid === item.mediaid) {\r\n        logDev('Calling loadPlaylist with the same item, check the dependencies');\r\n        return;\r\n      }\r\n\r\n      // Update autostart parameter\r\n      if (typeof autostart !== 'undefined') {\r\n        playerRef.current?.setConfig({ autostart });\r\n      }\r\n\r\n      // Load new item\r\n      playerRef.current.load([deepCopy({ ...item, starttime: startTimeRef.current, feedid: feedId })]);\r\n    };\r\n\r\n    const initializePlayer = () => {\r\n      if (!window.jwplayer || !playerElementRef.current) return;\r\n\r\n      playerRef.current = window.jwplayer(playerElementRef.current) as JWPlayer;\r\n\r\n      // Inject user_id and profile_id into the CDN analytics\r\n      // @todo this currently depends on stores\r\n      attachAnalyticsParams(item);\r\n\r\n      // Player options are untyped\r\n      const playerOptions: { [key: string]: unknown } = {\r\n        advertising: {\r\n          ...adsData,\r\n          // Beta feature\r\n          showCountdown: true,\r\n        },\r\n        timeSlider: {\r\n          showAdMarkers: false,\r\n        },\r\n        aspectratio: false,\r\n        controls: true,\r\n        displaytitle: false,\r\n        displayHeading: false,\r\n        displaydescription: false,\r\n        floating: {\r\n          mode: 'never',\r\n        },\r\n        height: '100%',\r\n        mute: false,\r\n        playbackRateControls: true,\r\n        pipIcon: 'disabled',\r\n        playlist: [deepCopy({ ...item, starttime: startTimeRef.current, feedid: feedId })],\r\n        repeat: false,\r\n        cast: {},\r\n        stretching: 'uniform',\r\n        width: '100%',\r\n      };\r\n\r\n      // Only set the autostart parameter when it is defined or it will override the player.defaults autostart setting\r\n      if (typeof autostart !== 'undefined') {\r\n        playerOptions.autostart = autostart;\r\n      }\r\n\r\n      // Set the license key if provided\r\n      if (playerLicenseKey) {\r\n        playerOptions.key = playerLicenseKey;\r\n      }\r\n\r\n      playerRef.current.setup(playerOptions);\r\n\r\n      setPlayer(playerRef.current);\r\n      attachEvents();\r\n    };\r\n\r\n    if (playerRef.current) {\r\n      return loadPlaylist();\r\n    }\r\n\r\n    if (libLoaded) {\r\n      initializePlayer();\r\n    }\r\n  }, [libLoaded, item, detachEvents, attachEvents, playerId, setPlayer, autostart, adsData, playerLicenseKey, feedId]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (playerRef.current) {\r\n        // Detaching events before component unmount\r\n        detachEvents();\r\n        playerRef.current.remove();\r\n      }\r\n    };\r\n  }, [detachEvents]);\r\n\r\n  return (\r\n    <div className={styles.container} data-testid={testId('player-container')}>\r\n      <div ref={playerElementRef} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Player;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport styles from './PlayerError.module.scss';\r\n\r\nexport enum PlayerErrorState {\r\n  GEO_BLOCKED = 'GEO_BLOCKED',\r\n}\r\n\r\ntype Props = {\r\n  error: keyof typeof PlayerErrorState;\r\n};\r\n\r\nconst PlayerError: React.FC<Props> = () => {\r\n  const { t } = useTranslation('video');\r\n  return (\r\n    <div className={styles.error}>\r\n      <h2 className={styles.title}>{t('player_error.geo_blocked_title')}</h2>\r\n      <p>{t('player_error.geo_blocked_description')}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlayerError;\r\n","import React, { useCallback, useState } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useWatchHistory } from '@jwp/ott-hooks-react/src/useWatchHistory';\r\nimport { usePlaylistItemCallback } from '@jwp/ott-hooks-react/src/usePlaylistItemCallback';\r\nimport { useAds } from '@jwp/ott-hooks-react/src/useAds';\r\nimport useProtectedMedia from '@jwp/ott-hooks-react/src/useProtectedMedia';\r\n\r\nimport type { JWPlayer } from '../../../types/jwplayer';\r\nimport Player from '../../components/Player/Player';\r\nimport LoadingOverlay from '../../components/LoadingOverlay/LoadingOverlay';\r\nimport PlayerError, { PlayerErrorState } from '../../components/PlayerError/PlayerError';\r\n\r\ntype Props = {\r\n  item: PlaylistItem;\r\n  seriesItem?: PlaylistItem;\r\n  onPlay?: () => void;\r\n  onPause?: () => void;\r\n  onComplete?: () => void;\r\n  onClose?: () => void;\r\n  onUserActive?: () => void;\r\n  onUserInActive?: () => void;\r\n  onNext?: () => void;\r\n  feedId?: string;\r\n  liveStartDateTime?: string | null;\r\n  liveEndDateTime?: string | null;\r\n  liveFromBeginning?: boolean;\r\n  autostart?: boolean;\r\n};\r\n\r\nconst PlayerContainer: React.FC<Props> = ({\r\n  item,\r\n  seriesItem,\r\n  feedId,\r\n  onPlay,\r\n  onPause,\r\n  onComplete,\r\n  onUserActive,\r\n  onUserInActive,\r\n  onNext,\r\n  liveEndDateTime,\r\n  liveFromBeginning,\r\n  liveStartDateTime,\r\n  autostart,\r\n}: Props) => {\r\n  // data\r\n  const { data: adsData, isLoading: isAdsLoading } = useAds({ mediaId: item?.mediaid });\r\n  const { data: playableItem, isLoading, isGeoBlocked } = useProtectedMedia(item);\r\n  // state\r\n  const [playerInstance, setPlayerInstance] = useState<JWPlayer>();\r\n\r\n  // watch history\r\n  const startTime = useWatchHistory(playerInstance, item, seriesItem);\r\n\r\n  // player events\r\n  const handleReady = useCallback((player?: JWPlayer) => {\r\n    setPlayerInstance(player);\r\n  }, []);\r\n\r\n  const handleFirstFrame = useCallback(() => {\r\n    // when playing a livestream, the first moment we can seek to the beginning of the DVR range is after the\r\n    // firstFrame event.\r\n    // @todo this doesn't seem to work 100% out of the times. Confirm with player team if this is the best approach.\r\n    if (liveFromBeginning) {\r\n      playerInstance?.seek(0);\r\n    }\r\n  }, [liveFromBeginning, playerInstance]);\r\n\r\n  const handlePlaylistItemCallback = usePlaylistItemCallback(liveStartDateTime, liveEndDateTime);\r\n\r\n  if (!playableItem || isLoading || isAdsLoading) {\r\n    return <LoadingOverlay inline />;\r\n  }\r\n\r\n  if (isGeoBlocked) {\r\n    return <PlayerError error={PlayerErrorState.GEO_BLOCKED} />;\r\n  }\r\n\r\n  return (\r\n    <Player\r\n      feedId={feedId}\r\n      item={playableItem}\r\n      adsData={adsData}\r\n      onReady={handleReady}\r\n      onFirstFrame={handleFirstFrame}\r\n      onPlay={onPlay}\r\n      onPause={onPause}\r\n      onComplete={onComplete}\r\n      onUserActive={onUserActive}\r\n      onUserInActive={onUserInActive}\r\n      onNext={onNext}\r\n      onPlaylistItemCallback={handlePlaylistItemCallback}\r\n      startTime={startTime}\r\n      autostart={autostart}\r\n    />\r\n  );\r\n};\r\n\r\nexport default PlayerContainer;\r\n","import React from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport Lock from '@jwp/ott-theme/assets/icons/lock.svg?react';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\n\r\nimport Image from '../../components/Image/Image';\r\nimport Fade from '../../components/Animation/Fade/Fade';\r\nimport Button from '../../components/Button/Button';\r\nimport PlayerContainer from '../PlayerContainer/PlayerContainer';\r\nimport Icon from '../../components/Icon/Icon';\r\n\r\nimport styles from './InlinePlayer.module.scss';\r\n\r\ntype Props = {\r\n  item: PlaylistItem;\r\n  seriesItem?: PlaylistItem;\r\n  onPlay?: () => void;\r\n  onPause?: () => void;\r\n  onComplete?: () => void;\r\n  feedId?: string;\r\n  liveStartDateTime?: string | null;\r\n  liveEndDateTime?: string | null;\r\n  liveFromBeginning?: boolean;\r\n  startWatchingButton: React.ReactNode;\r\n  isLoggedIn: boolean;\r\n  isEntitled: boolean;\r\n  playable?: boolean;\r\n  autostart?: boolean;\r\n  hasMediaOffers?: boolean;\r\n};\r\n\r\nconst InlinePlayer: React.FC<Props> = ({\r\n  item,\r\n  seriesItem,\r\n  onPlay,\r\n  onPause,\r\n  onComplete,\r\n  feedId,\r\n  liveStartDateTime,\r\n  liveEndDateTime,\r\n  liveFromBeginning,\r\n  startWatchingButton,\r\n  isLoggedIn,\r\n  isEntitled,\r\n  autostart,\r\n  playable = true,\r\n  hasMediaOffers,\r\n}: Props) => {\r\n  const siteName = useConfigStore((s) => s.config.siteName);\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const loginButtonClickHandler = () => {\r\n    navigate(modalURLFromLocation(location, 'login'));\r\n  };\r\n\r\n  const buyLabel = hasMediaOffers ? t('video:buy_to_start_watching') : t('video:sign_up_to_start_watching');\r\n\r\n  return (\r\n    <div className={styles.inlinePlayer}>\r\n      <Fade open={!playable || !isEntitled}>\r\n        <div className={styles.paywall}>\r\n          <Image className={styles.poster} image={item.backgroundImage} alt={item.title} width={1280} />\r\n          {!isEntitled && (\r\n            <>\r\n              <Icon icon={Lock} className={styles.lock} />\r\n              <h2 className={styles.title}>{buyLabel}</h2>\r\n              <span className={styles.text}>{t('account:choose_offer.watch_this_on_platform', { siteName })}</span>\r\n              {startWatchingButton}\r\n              {!isLoggedIn && <Button onClick={loginButtonClickHandler} label={t('common:sign_in')} />}\r\n            </>\r\n          )}\r\n        </div>\r\n      </Fade>\r\n      {isEntitled && playable && (\r\n        <PlayerContainer\r\n          item={item}\r\n          seriesItem={seriesItem}\r\n          feedId={feedId}\r\n          autostart={autostart}\r\n          onPlay={onPlay}\r\n          onPause={onPause}\r\n          onComplete={onComplete}\r\n          liveEndDateTime={liveEndDateTime}\r\n          liveFromBeginning={liveFromBeginning}\r\n          liveStartDateTime={liveStartDateTime}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InlinePlayer;\r\n","import * as React from \"react\";\nconst SvgPlay = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M8,5.14V19.14L19,12.14L8,5.14Z\" }));\nexport default SvgPlay;\n","import React, { useCallback, useEffect, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useCheckoutStore } from '@jwp/ott-common/src/stores/CheckoutStore';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport Play from '@jwp/ott-theme/assets/icons/play.svg?react';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\n\r\nimport Button from '../../components/Button/Button';\r\nimport Icon from '../../components/Icon/Icon';\r\n\r\nimport styles from './StartWatchingButton.module.scss';\r\n\r\ntype Props = {\r\n  item: PlaylistItem;\r\n  playUrl?: string;\r\n  disabled?: boolean;\r\n  onClick?: () => void;\r\n};\r\n\r\nconst StartWatchingButton: React.VFC<Props> = ({ item, playUrl, disabled = false, onClick }) => {\r\n  const { t } = useTranslation('video');\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const breakpoint = useBreakpoint();\r\n\r\n  // account\r\n  const accessModel = useConfigStore((state) => state.accessModel);\r\n  const user = useAccountStore((state) => state.user);\r\n  const isLoggedIn = !!user;\r\n\r\n  // watch history\r\n  const watchHistoryItem = useWatchHistoryStore((state) => item && state.getItem(item));\r\n  const videoProgress = watchHistoryItem?.progress;\r\n\r\n  // entitlement\r\n  const setRequestedMediaOffers = useCheckoutStore((s) => s.setRequestedMediaOffers);\r\n  const { isEntitled, mediaOffers } = useEntitlement(item);\r\n  const hasMediaOffers = !!mediaOffers.length;\r\n\r\n  const startWatchingLabel = useMemo((): string => {\r\n    if (isEntitled) return typeof videoProgress === 'number' ? t('continue_watching') : t('start_watching');\r\n    if (hasMediaOffers) return t('buy');\r\n    if (!isLoggedIn) return t('sign_up_to_start_watching');\r\n\r\n    return t('complete_your_subscription');\r\n  }, [isEntitled, isLoggedIn, hasMediaOffers, videoProgress, t]);\r\n\r\n  const handleStartWatchingClick = useCallback(() => {\r\n    if (isEntitled) {\r\n      if (onClick) {\r\n        onClick();\r\n        return;\r\n      }\r\n      return playUrl && navigate(playUrl);\r\n    }\r\n    if (!isLoggedIn) return navigate(modalURLFromLocation(location, 'create-account'));\r\n    if (hasMediaOffers) return navigate(modalURLFromLocation(location, 'choose-offer'));\r\n\r\n    return navigate('/u/payments');\r\n  }, [isEntitled, playUrl, navigate, isLoggedIn, location, hasMediaOffers, onClick]);\r\n\r\n  useEffect(() => {\r\n    // set the TVOD mediaOffers in the checkout store\r\n    setRequestedMediaOffers(mediaOffers);\r\n\r\n    return () => setRequestedMediaOffers([]);\r\n  }, [mediaOffers, setRequestedMediaOffers]);\r\n\r\n  // the user can't purchase access in an AVOD platform due to missing configuration, so we hide the button\r\n  if (accessModel === ACCESS_MODEL.AVOD && !isEntitled) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Button\r\n      color=\"primary\"\r\n      variant=\"contained\"\r\n      size=\"large\"\r\n      label={startWatchingLabel}\r\n      startIcon={isEntitled ? <Icon icon={Play} /> : undefined}\r\n      onClick={handleStartWatchingClick}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n      disabled={disabled}\r\n    >\r\n      {videoProgress ? (\r\n        <div className={styles.progressRail}>\r\n          <div className={styles.progress} style={{ width: `${videoProgress * 100}%` }} />\r\n        </div>\r\n      ) : null}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default StartWatchingButton;\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport ArrowLeft from '@jwp/ott-theme/assets/icons/arrow_left.svg?react';\r\n\r\nimport IconButton from '../../components/IconButton/IconButton';\r\nimport PlayerContainer from '../PlayerContainer/PlayerContainer';\r\nimport Fade from '../../components/Animation/Fade/Fade';\r\nimport Icon from '../../components/Icon/Icon';\r\nimport Modal from '../../components/Modal/Modal';\r\n\r\nimport styles from './Cinema.module.scss';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  item: PlaylistItem;\r\n  seriesItem?: PlaylistItem;\r\n  onPlay?: () => void;\r\n  onPause?: () => void;\r\n  onComplete?: () => void;\r\n  onClose?: () => void;\r\n  onNext?: () => void;\r\n  feedId?: string;\r\n  title: string;\r\n  primaryMetadata: React.ReactNode;\r\n  secondaryMetadata?: React.ReactNode;\r\n  liveStartDateTime?: string | null;\r\n  liveEndDateTime?: string | null;\r\n  liveFromBeginning?: boolean;\r\n};\r\n\r\nconst Cinema: React.FC<Props> = ({\r\n  open,\r\n  item,\r\n  seriesItem,\r\n  title,\r\n  primaryMetadata,\r\n  secondaryMetadata,\r\n  onPlay,\r\n  onPause,\r\n  onComplete,\r\n  onClose,\r\n  onNext,\r\n  feedId,\r\n  liveStartDateTime,\r\n  liveEndDateTime,\r\n  liveFromBeginning,\r\n}: Props) => {\r\n  const { t } = useTranslation();\r\n\r\n  // state\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [overlayHasFocus, setOverlayHasFocus] = useState(false);\r\n  const [userActive, setUserActive] = useState(true);\r\n\r\n  const handlePlay = useCallback(() => {\r\n    setIsPlaying(true);\r\n    onPlay && onPlay();\r\n  }, [onPlay]);\r\n\r\n  const handlePause = useCallback(() => {\r\n    setIsPlaying(false);\r\n    onPause && onPause();\r\n  }, [onPause]);\r\n\r\n  const handleComplete = useCallback(() => {\r\n    onComplete && onComplete();\r\n  }, [onComplete]);\r\n\r\n  const handleNext = useCallback(() => {\r\n    onNext && onNext();\r\n  }, [onNext]);\r\n\r\n  const handleUserActive = useCallback(() => setUserActive(true), []);\r\n  const handleUserInactive = useCallback(() => setUserActive(false), []);\r\n\r\n  // effects\r\n  useEffect(() => {\r\n    if (open) setUserActive(true);\r\n  }, [open]);\r\n\r\n  return (\r\n    <Modal open={open} animationContainerClassName={styles.cinemaContainer} onClose={onClose} aria-label={t('videoplayer')}>\r\n      <div className={styles.cinema}>\r\n        <Fade className={styles.overlayFade} open={!isPlaying || userActive || overlayHasFocus} keepMounted>\r\n          <div className={styles.playerOverlay} onFocus={() => setOverlayHasFocus(true)} onBlur={() => setOverlayHasFocus(false)}>\r\n            <div className={styles.playerContent}>\r\n              <IconButton aria-label={t('common:back')} onClick={onClose} className={styles.backButton}>\r\n                <Icon icon={ArrowLeft} />\r\n              </IconButton>\r\n              <div>\r\n                <h1 className={styles.title}>{title}</h1>\r\n                <div className={styles.metaContainer}>\r\n                  {secondaryMetadata && <div className={styles.secondaryMetadata}>{secondaryMetadata}</div>}\r\n                  <div className={styles.primaryMetadata}>{primaryMetadata}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </Fade>\r\n        <PlayerContainer\r\n          item={item}\r\n          seriesItem={seriesItem}\r\n          feedId={feedId}\r\n          autostart={true}\r\n          onPlay={handlePlay}\r\n          onPause={handlePause}\r\n          onComplete={handleComplete}\r\n          onUserActive={handleUserActive}\r\n          onUserInActive={handleUserInactive}\r\n          onNext={handleNext}\r\n          liveEndDateTime={liveEndDateTime}\r\n          liveFromBeginning={liveFromBeginning}\r\n          liveStartDateTime={liveStartDateTime}\r\n        />\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default Cinema;\r\n","import React, { useCallback, useState } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\n\r\nimport Modal from '../../components/Modal/Modal';\r\nimport Player from '../../components/Player/Player';\r\nimport ModalCloseButton from '../../components/ModalCloseButton/ModalCloseButton';\r\nimport Fade from '../../components/Animation/Fade/Fade';\r\n\r\nimport styles from './TrailerModal.module.scss';\r\n\r\ntype Props = {\r\n  item?: PlaylistItem | null;\r\n  title: string;\r\n  open: boolean;\r\n  onClose: () => void;\r\n};\r\n\r\nconst TrailerModal: React.FC<Props> = ({ item, open, title, onClose }) => {\r\n  const [isPlaying, setIsPlaying] = useState<boolean>(false);\r\n  const [userActive, setUserActive] = useState(true);\r\n\r\n  const handlePlay = useCallback(() => setIsPlaying(true), []);\r\n  const handlePause = useCallback(() => setIsPlaying(false), []);\r\n  const handleUserActive = useCallback(() => setUserActive(true), []);\r\n  const handleUserInactive = useCallback(() => setUserActive(false), []);\r\n\r\n  if (!item) return null;\r\n\r\n  return (\r\n    <Modal open={open} onClose={onClose} aria-labelledby=\"trailer-modal-title\" centered>\r\n      <div className={styles.container}>\r\n        <Player\r\n          item={item}\r\n          onPlay={handlePlay}\r\n          onPause={handlePause}\r\n          onComplete={onClose}\r\n          onUserActive={handleUserActive}\r\n          onUserInActive={handleUserInactive}\r\n          autostart\r\n        />\r\n        <Fade open={!isPlaying || userActive} keepMounted>\r\n          <div className={styles.playerOverlay}>\r\n            <h1 id=\"trailer-modal-title\" className={styles.title}>\r\n              {title}\r\n            </h1>\r\n          </div>\r\n          <ModalCloseButton onClick={onClose} />\r\n        </Fade>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default TrailerModal;\r\n","import * as React from \"react\";\nconst SvgShare = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M18,16.08C17.24,16.08 16.56,16.38 16.04,16.85L8.91,12.7C8.96,12.47 9,12.24 9,12C9,11.76 8.96,11.53 8.91,11.3L15.96,7.19C16.5,7.69 17.21,8 18,8A3,3 0 0,0 21,5A3,3 0 0,0 18,2A3,3 0 0,0 15,5C15,5.24 15.04,5.47 15.09,5.7L8.04,9.81C7.5,9.31 6.79,9 6,9A3,3 0 0,0 3,12A3,3 0 0,0 6,15C6.79,15 7.5,14.69 8.04,14.19L15.16,18.34C15.11,18.55 15.08,18.77 15.08,19C15.08,20.61 16.39,21.91 18,21.91C19.61,21.91 20.92,20.61 20.92,19A2.92,2.92 0 0,0 18,16.08Z\" }));\nexport default SvgShare;\n","export const copyToClipboard = (value: string): void => {\r\n  const focusedElement = document.activeElement as HTMLElement;\r\n  const inputElement = document.createElement('input');\r\n  inputElement.style.zIndex = '-10';\r\n  inputElement.style.position = 'absolute';\r\n  inputElement.style.left = '-1000';\r\n  inputElement.value = value;\r\n  document.body.appendChild(inputElement);\r\n  inputElement.select();\r\n  document.execCommand('copy');\r\n  inputElement.blur();\r\n  document.body.removeChild(inputElement);\r\n  focusedElement?.focus();\r\n};\r\n","import React, { useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Check from '@jwp/ott-theme/assets/icons/check.svg?react';\r\nimport Share from '@jwp/ott-theme/assets/icons/share.svg?react';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport { copyToClipboard } from '../../utils/clipboard';\r\nimport Button from '../Button/Button';\r\nimport Icon from '../Icon/Icon';\r\n\r\ntype Props = {\r\n  title: string;\r\n  description: string;\r\n  url: string;\r\n};\r\n\r\nconst ShareButton = ({ title, description, url }: Props) => {\r\n  const { t } = useTranslation();\r\n  const breakpoint = useBreakpoint();\r\n  const [hasShared, setHasShared] = useState<boolean>(false);\r\n\r\n  const onShareClick = async () => {\r\n    if (typeof navigator.share === 'function') {\r\n      await navigator.share({ title, text: description, url });\r\n      return;\r\n    }\r\n\r\n    copyToClipboard(window.location.href);\r\n    setHasShared(true);\r\n    setTimeout(() => setHasShared(false), 2000);\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      label={hasShared ? t('video:copied_url') : t('video:share')}\r\n      startIcon={hasShared ? <Icon icon={Check} /> : <Icon icon={Share} />}\r\n      onClick={onShareClick}\r\n      active={hasShared}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n    />\r\n  );\r\n};\r\n\r\nexport default ShareButton;\r\n","import * as React from \"react\";\nconst SvgFavoriteBorder = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M12.1,18.55L12,18.65L11.89,18.55C7.14,14.24 4,11.39 4,8.5C4,6.5 5.5,5 7.5,5C9.04,5 10.54,6 11.07,7.36H12.93C13.46,6 14.96,5 16.5,5C18.5,5 20,6.5 20,8.5C20,11.39 16.86,14.24 12.1,18.55M16.5,3C14.76,3 13.09,3.81 12,5.08C10.91,3.81 9.24,3 7.5,3C4.42,3 2,5.41 2,8.5C2,12.27 5.4,15.36 10.55,20.03L12,21.35L13.45,20.03C18.6,15.36 22,12.27 22,8.5C22,5.41 19.58,3 16.5,3Z\" }));\nexport default SvgFavoriteBorder;\n","import React, { useCallback, useEffect } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { useFavoritesStore } from '@jwp/ott-common/src/stores/FavoritesStore';\r\nimport FavoritesController from '@jwp/ott-common/src/controllers/FavoritesController';\r\nimport Favorite from '@jwp/ott-theme/assets/icons/favorite.svg?react';\r\nimport FavoriteBorder from '@jwp/ott-theme/assets/icons/favorite_border.svg?react';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport Button from '../../components/Button/Button';\r\nimport Alert from '../../components/Alert/Alert';\r\nimport Icon from '../../components/Icon/Icon';\r\n\r\ntype Props = {\r\n  item: PlaylistItem;\r\n};\r\n\r\nconst FavoriteButton: React.VFC<Props> = ({ item }) => {\r\n  const { t } = useTranslation();\r\n  const breakpoint = useBreakpoint();\r\n  const favoritesController = getModule(FavoritesController);\r\n\r\n  const { isFavorite, clearWarning, warning } = useFavoritesStore((state) => ({\r\n    isFavorite: !!item && state.hasItem(item),\r\n    clearWarning: state.clearWarning,\r\n    warning: state.warning,\r\n  }));\r\n\r\n  const onFavoriteButtonClick = useCallback(async () => {\r\n    await favoritesController.toggleFavorite(item);\r\n  }, [item, favoritesController]);\r\n\r\n  useEffect(() => {\r\n    // clear warning on unmount (probably by navigating away from the page using the back button)\r\n    return () => clearWarning();\r\n  }, [clearWarning]);\r\n\r\n  return (\r\n    <>\r\n      <Button\r\n        label={t('video:favorite')}\r\n        aria-label={t('video:favorite')}\r\n        startIcon={isFavorite ? <Icon icon={Favorite} /> : <Icon icon={FavoriteBorder} />}\r\n        onClick={onFavoriteButtonClick}\r\n        aria-pressed={isFavorite}\r\n        color={isFavorite ? 'primary' : 'default'}\r\n        fullWidth={breakpoint < Breakpoint.md}\r\n      />\r\n      <Alert open={warning !== null} message={warning} onClose={clearWarning} />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default FavoriteButton;\r\n","import Spinner from '../../components/Spinner/Spinner';\r\n\r\nimport styles from './Loading.module.scss';\r\n\r\nconst Loading = () => {\r\n  return (\r\n    <div className={styles.loading}>\r\n      <Spinner />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Loading;\r\n","import React from 'react';\r\n\r\nimport styles from './VideoMetaData.module.scss';\r\n\r\ntype Props = {\r\n  attributes: string[];\r\n  separator?: string;\r\n};\r\n\r\nconst VideoMetaData: React.FC<Props> = ({ attributes, separator = '•' }: Props) => {\r\n  return (\r\n    <div>\r\n      {attributes.map((value, index) => (\r\n        <React.Fragment key={value}>\r\n          <span>{value}</span>\r\n          {index < attributes.length - 1 && (\r\n            <span className={styles.separator} aria-hidden=\"true\">\r\n              {separator}\r\n            </span>\r\n          )}\r\n        </React.Fragment>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoMetaData;\r\n","/**\r\n * Seconds to ISO8601 duration or date string\r\n * TODO: use date-fns to replace this util\r\n */\r\nexport function secondsToISO8601(input: number, timeOnly: boolean = false): string {\r\n  if (!input) {\r\n    return '';\r\n  }\r\n\r\n  const date = new Date(input ? input * 1000 : 0);\r\n  const hours = date.getUTCHours();\r\n  const minutes = date.getUTCMinutes();\r\n  const seconds = date.getUTCSeconds();\r\n\r\n  if (!timeOnly) {\r\n    return date.toISOString();\r\n  }\r\n\r\n  let isoString = 'PT';\r\n  if (hours > 0) isoString += hours + 'H';\r\n  if (minutes > 0) isoString += minutes + 'M';\r\n  if (seconds > 0) isoString += seconds + 'S';\r\n\r\n  return isoString;\r\n}\r\n\r\nexport const is12HourClock = () => {\r\n  const date = new Date(Date.UTC(2022, 6, 20, 18, 0, 0));\r\n  return /am|pm/.test(date.toLocaleTimeString());\r\n};\r\n","import i18next from 'i18next';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { EpisodeMetadata } from '@jwp/ott-common/types/series';\r\nimport { legacySeriesURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { secondsToISO8601 } from '@jwp/ott-common/src/utils/datetime';\r\n\r\n/**\r\n * Get an array of options for a season filter\r\n */\r\nexport const getFiltersFromSeries = (playlist: Playlist | undefined): { value: string; label: string }[] => {\r\n  // Old series doesn't have sorting supported and just aggregates all episodes in one playlist\r\n  // So we need to sort the playlist manually based on the selected filter (season).\r\n  return (playlist?.playlist || [])\r\n    .reduce((filters, item) => {\r\n      if (filters.some((el) => el?.value === item?.seasonNumber)) {\r\n        return filters;\r\n      }\r\n\r\n      return filters.concat(\r\n        item.seasonNumber ? [{ label: i18next.t('video:season_number_filter_template', { seasonNumber: item.seasonNumber }), value: item.seasonNumber }] : [],\r\n      );\r\n    }, [] as { value: string; label: string }[])\r\n    .slice()\r\n    .sort();\r\n};\r\n\r\n/**\r\n * Get a playlist with episodes based on the selected filter\r\n */\r\nexport const filterSeries = (playlist: Playlist | undefined, filter: string | undefined): Playlist | undefined => {\r\n  if (!playlist) return;\r\n\r\n  if (filter === '') return playlist;\r\n\r\n  return {\r\n    ...playlist,\r\n    // Filter episodes manually for the old flow where our playlists includes all episodes with all seasons\r\n    playlist: playlist.playlist.filter(({ seasonNumber }) => seasonNumber === filter),\r\n  };\r\n};\r\n\r\nexport const getNextItem = (episode: PlaylistItem | undefined, seriesPlaylist: Playlist | undefined): PlaylistItem | undefined => {\r\n  if (!episode || !seriesPlaylist) return;\r\n\r\n  // For the old flow we already have all the episodes and seasons so we just need to find them in the array\r\n  const index = seriesPlaylist?.playlist?.findIndex(({ mediaid }) => mediaid === episode.mediaid);\r\n\r\n  return seriesPlaylist?.playlist?.[index + 1];\r\n};\r\n\r\n/** Get a total amount of episodes in a season */\r\nexport const getEpisodesInSeason = (episode: PlaylistItem | undefined, seriesPlaylist: Playlist | undefined) => {\r\n  if (!seriesPlaylist) return;\r\n\r\n  return seriesPlaylist.playlist.filter((i) => i.seasonNumber === episode?.seasonNumber)?.length;\r\n};\r\n\r\nexport const generateLegacySeriesMetadata = (seriesPlaylist: Playlist, seriesId: string | undefined) => {\r\n  // Use playlist for old flow and media id for a new flow\r\n  const seriesCanonical = `${window.location.origin}/s/${seriesId}`;\r\n\r\n  return {\r\n    '@type': 'TVSeries',\r\n    '@id': seriesCanonical,\r\n    name: seriesPlaylist.title,\r\n    numberOfEpisodes: String(seriesPlaylist.playlist.length),\r\n    numberOfSeasons: String(\r\n      seriesPlaylist.playlist.reduce(function (list, playlistItem) {\r\n        return !playlistItem.seasonNumber || list.includes(playlistItem.seasonNumber) ? list : list.concat(playlistItem.seasonNumber);\r\n      }, [] as string[]).length,\r\n    ),\r\n  };\r\n};\r\n\r\nexport const generateLegacyEpisodeJSONLD = (\r\n  seriesPlaylist: Playlist,\r\n  episode: PlaylistItem | undefined,\r\n  episodeMetadata: EpisodeMetadata | undefined,\r\n  seriesId: string,\r\n) => {\r\n  const episodeCanonical = `${window.location.origin}${legacySeriesURL({ episodeId: episode?.mediaid, seriesId })}`;\r\n  const seriesMetadata = generateLegacySeriesMetadata(seriesPlaylist, seriesId);\r\n\r\n  if (!episode) {\r\n    return JSON.stringify(seriesMetadata);\r\n  }\r\n\r\n  return JSON.stringify({\r\n    '@context': 'http://schema.org/',\r\n    '@type': 'TVEpisode',\r\n    '@id': episodeCanonical,\r\n    episodeNumber: episodeMetadata?.episodeNumber,\r\n    seasonNumber: episodeMetadata?.seasonNumber,\r\n    name: episode.title,\r\n    uploadDate: secondsToISO8601(episode.pubdate),\r\n    partOfSeries: seriesMetadata,\r\n  });\r\n};\r\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { createPlaylistMetadata, createVideoMetadata } from '@jwp/ott-common/src/utils/metadata';\r\nimport { formatSeriesMetaString } from '@jwp/ott-common/src/utils/formatting';\r\nimport { legacySeriesURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\nimport usePlaylist from '@jwp/ott-hooks-react/src/usePlaylist';\r\nimport PlayTrailer from '@jwp/ott-theme/assets/icons/play_trailer.svg?react';\r\n\r\nimport VideoLayout from '../../components/VideoLayout/VideoLayout';\r\nimport InlinePlayer from '../../containers/InlinePlayer/InlinePlayer';\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\nimport StartWatchingButton from '../../containers/StartWatchingButton/StartWatchingButton';\r\nimport Cinema from '../../containers/Cinema/Cinema';\r\nimport TrailerModal from '../../containers/TrailerModal/TrailerModal';\r\nimport ShareButton from '../../components/ShareButton/ShareButton';\r\nimport FavoriteButton from '../../containers/FavoriteButton/FavoriteButton';\r\nimport Button from '../../components/Button/Button';\r\nimport Loading from '../Loading/Loading';\r\nimport Icon from '../../components/Icon/Icon';\r\nimport VideoMetaData from '../../components/VideoMetaData/VideoMetaData';\r\n\r\nimport { filterSeries, generateLegacyEpisodeJSONLD, getEpisodesInSeason, getFiltersFromSeries, getNextItem } from './utils';\r\n\r\nconst LegacySeries = () => {\r\n  const breakpoint = useBreakpoint();\r\n  const { t } = useTranslation('video');\r\n  const [playTrailer, setPlayTrailer] = useState<boolean>(false);\r\n\r\n  // Navigation\r\n  const navigate = useNavigate();\r\n  const params = useParams();\r\n  const seriesId = params.id || '';\r\n  const play = useQueryParam('play') === '1';\r\n  const feedId = useQueryParam('r');\r\n  const episodeId = useQueryParam('e');\r\n\r\n  // Main data\r\n  const { isLoading: isSeriesPlaylistLoading, data: seriesPlaylist, isError: isPlaylistError } = usePlaylist(seriesId, {}, true, false);\r\n  const { isLoading: isEpisodeLoading, data: episode } = useMedia(episodeId || '');\r\n  const { isLoading: isTrailerLoading, data: trailerItem } = useMedia(episode?.trailerId || '');\r\n\r\n  const episodeMetadata = useMemo(() => ({ episodeNumber: episode?.episodeNumber || '0', seasonNumber: episode?.seasonNumber || '0' }), [episode]);\r\n\r\n  // Whether we show series or episode information. For old series flow we only have access to the playlist\r\n  const selectedItem = episode || seriesPlaylist;\r\n  const selectedItemImage = (selectedItem?.image as string) || '';\r\n\r\n  // Config\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const { features, siteName, custom } = config;\r\n  const isFavoritesEnabled: boolean = Boolean(features?.favoritesList);\r\n  const inlineLayout = Boolean(custom?.inlinePlayer);\r\n\r\n  // Filters\r\n  const filters = useMemo(() => getFiltersFromSeries(seriesPlaylist), [seriesPlaylist]);\r\n  const [seasonFilter, setSeasonFilter] = useState<string | undefined>(undefined);\r\n\r\n  const firstEpisode = useMemo(() => seriesPlaylist?.playlist?.[0], [seriesPlaylist]);\r\n  const filteredPlaylist = useMemo(() => filterSeries(seriesPlaylist, seasonFilter), [seriesPlaylist, seasonFilter]);\r\n  const episodesInSeason = getEpisodesInSeason(episode, seriesPlaylist);\r\n  const nextItem = useMemo(() => getNextItem(episode, seriesPlaylist), [episode, seriesPlaylist]);\r\n\r\n  // Watch history\r\n  const watchHistoryDictionary = useWatchHistoryStore((state) => state.getDictionaryWithEpisodes());\r\n\r\n  // User, entitlement\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n  const { isEntitled, mediaOffers } = useEntitlement(episode || firstEpisode);\r\n  const hasMediaOffers = !!mediaOffers.length;\r\n  const isLoggedIn = !!user;\r\n  const hasSubscription = !!subscription;\r\n\r\n  // Handlers\r\n  const goBack = () => episode && navigate(legacySeriesURL({ episodeId: episode.mediaid, seriesId, play: false, playlistId: feedId }));\r\n  const getUrl = (toEpisode: PlaylistItem) => {\r\n    return seriesPlaylist ? legacySeriesURL({ episodeId: toEpisode.mediaid, seriesId, play: false, playlistId: feedId }) : '';\r\n  };\r\n\r\n  const handleComplete = useCallback(async () => {\r\n    navigate(legacySeriesURL({ episodeId: nextItem?.mediaid, seriesId, play: !!nextItem, playlistId: feedId }));\r\n  }, [navigate, nextItem, seriesId, feedId]);\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n    (document.querySelector('#video-details button') as HTMLElement)?.focus();\r\n  }, [episode]);\r\n\r\n  useEffect(() => {\r\n    if (isSeriesPlaylistLoading || isEpisodeLoading) {\r\n      return;\r\n    }\r\n\r\n    if (seasonFilter === undefined) {\r\n      setSeasonFilter(parseInt(episodeMetadata?.seasonNumber, 10) ? episodeMetadata?.seasonNumber : filters?.[0]?.value || '');\r\n    }\r\n  }, [episodeMetadata, seasonFilter, isSeriesPlaylistLoading, isEpisodeLoading, filters]);\r\n\r\n  // UI\r\n  const isLoading = isSeriesPlaylistLoading || isEpisodeLoading;\r\n  if (isLoading) return <Loading />;\r\n  if (isPlaylistError || !seriesPlaylist || !selectedItem || !firstEpisode) return <ErrorPage title={t('series_error')} />;\r\n\r\n  const pageTitle = `${selectedItem.title} - ${siteName}`;\r\n  const pageDescription = selectedItem?.description || '';\r\n  const canonicalUrl = `${window.location.origin}${legacySeriesURL({ episodeId: episode?.mediaid, seriesId })}`;\r\n  const backgroundImage = (selectedItem.backgroundImage as string) || undefined;\r\n\r\n  const primaryMetadata = episode ? (\r\n    <VideoMetaData attributes={createVideoMetadata(episode, t('video:total_episodes', { count: seriesPlaylist?.playlist?.length }))} />\r\n  ) : (\r\n    <VideoMetaData attributes={createPlaylistMetadata(seriesPlaylist, t('video:total_episodes', { count: seriesPlaylist?.playlist?.length }))} />\r\n  );\r\n  const secondaryMetadata = episodeMetadata && episode && (\r\n    <>\r\n      <strong>{formatSeriesMetaString(episodeMetadata.seasonNumber, episodeMetadata.episodeNumber)}</strong> - {episode.title}\r\n    </>\r\n  );\r\n  const filterMetadata =\r\n    episodeMetadata &&\r\n    ` ${t('video:season')} ${episodeMetadata.seasonNumber}/${filters?.length} - ${t('video:episode')} ${episodeMetadata.episodeNumber}/${episodesInSeason}`;\r\n  const shareButton = <ShareButton title={selectedItem?.title} description={pageDescription} url={canonicalUrl} />;\r\n  const startWatchingButton = (\r\n    <StartWatchingButton\r\n      key={episodeId} // necessary to fix autofocus on TalkBack\r\n      item={episode || firstEpisode}\r\n      playUrl={legacySeriesURL({ episodeId: episode?.mediaid || firstEpisode?.mediaid, seriesId, play: true, playlistId: feedId })}\r\n    />\r\n  );\r\n\r\n  // For the old series approach we mark episodes as favorite items. New approach is applied to the series\r\n  const favoriteButton = isFavoritesEnabled && <FavoriteButton item={episode || firstEpisode} />;\r\n  const trailerButton = (!!trailerItem || isTrailerLoading) && (\r\n    <Button\r\n      label={t('video:trailer')}\r\n      aria-label={t('video:watch_trailer')}\r\n      startIcon={<Icon icon={PlayTrailer} />}\r\n      onClick={() => setPlayTrailer(true)}\r\n      active={playTrailer}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n      disabled={!trailerItem}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"description\" content={pageDescription} />\r\n        <meta property=\"og:description\" content={pageDescription} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta property=\"og:type\" content={episode ? 'video.episode' : 'video.series'} />\r\n        {selectedItemImage && <meta property=\"og:image\" content={selectedItemImage?.replace(/^https:/, 'http:')} />}\r\n        {selectedItemImage && <meta property=\"og:image:secure_url\" content={selectedItemImage?.replace(/^http:/, 'https:')} />}\r\n        {selectedItemImage && <meta property=\"og:image:width\" content={selectedItemImage ? '720' : ''} />}\r\n        {selectedItemImage && <meta property=\"og:image:height\" content={selectedItemImage ? '406' : ''} />}\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n        <meta name=\"twitter:description\" content={pageDescription} />\r\n        {selectedItemImage && <meta name=\"twitter:image\" content={selectedItemImage} />}\r\n        <meta property=\"og:video\" content={canonicalUrl.replace(/^https:/, 'http:')} />\r\n        <meta property=\"og:video:secure_url\" content={canonicalUrl.replace(/^http:/, 'https:')} />\r\n        <meta property=\"og:video:type\" content=\"text/html\" />\r\n        <meta property=\"og:video:width\" content=\"1280\" />\r\n        <meta property=\"og:video:height\" content=\"720\" />\r\n        {selectedItem.tags\r\n          ? String(selectedItem.tags)\r\n              .split(',')\r\n              .map((tag: string) => <meta property=\"og:video:tag\" content={tag} key={tag} />)\r\n          : null}\r\n        {seriesPlaylist && selectedItem ? (\r\n          <script type=\"application/ld+json\">{generateLegacyEpisodeJSONLD(seriesPlaylist, episode, episodeMetadata, seriesId)}</script>\r\n        ) : null}\r\n      </Helmet>\r\n      <VideoLayout\r\n        item={episode}\r\n        title={selectedItem.title}\r\n        description={pageDescription}\r\n        inlineLayout={inlineLayout}\r\n        primaryMetadata={primaryMetadata}\r\n        secondaryMetadata={secondaryMetadata}\r\n        image={backgroundImage}\r\n        shareButton={shareButton}\r\n        favoriteButton={favoriteButton}\r\n        trailerButton={trailerButton}\r\n        startWatchingButton={startWatchingButton}\r\n        isLoading={isLoading}\r\n        accessModel={accessModel}\r\n        isLoggedIn={isLoggedIn}\r\n        hasSubscription={hasSubscription}\r\n        playlist={filteredPlaylist}\r\n        relatedTitle={inlineLayout ? selectedItem.title : t('episodes')}\r\n        setFilter={setSeasonFilter}\r\n        currentFilter={seasonFilter}\r\n        defaultFilterLabel={t('all_seasons')}\r\n        activeLabel={t('current_episode')}\r\n        watchHistory={watchHistoryDictionary}\r\n        filterMetadata={filterMetadata}\r\n        filters={filters}\r\n        getURL={getUrl}\r\n        player={\r\n          inlineLayout && (episode || firstEpisode) ? (\r\n            <InlinePlayer\r\n              isLoggedIn={isLoggedIn}\r\n              item={episode || firstEpisode}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n              startWatchingButton={startWatchingButton}\r\n              isEntitled={isEntitled}\r\n              hasMediaOffers={hasMediaOffers}\r\n              autostart={play || undefined}\r\n            />\r\n          ) : (\r\n            <Cinema\r\n              open={play && isEntitled}\r\n              onClose={goBack}\r\n              item={episode || firstEpisode}\r\n              title={episode?.title || firstEpisode.title}\r\n              primaryMetadata={primaryMetadata}\r\n              secondaryMetadata={secondaryMetadata}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n            />\r\n          )\r\n        }\r\n      />\r\n      {episode && <TrailerModal item={trailerItem} title={`${episode.title} - Trailer`} open={playTrailer} onClose={() => setPlayTrailer(false)} />}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default LegacySeries;\r\n","import type { Playlist, PlaylistItem } from '../../types/playlist';\r\n\r\nimport { isContentType } from './common';\r\n\r\ntype ScreenPredicate<T> = (data?: T) => boolean;\r\n\r\ntype ScreenDefinition<T, C> = {\r\n  predicate: ScreenPredicate<T>;\r\n  component: C;\r\n};\r\n\r\nexport class ScreenMap<T extends Playlist | PlaylistItem, C> {\r\n  private defaultScreen?: C = undefined;\r\n  private definitions: ScreenDefinition<T, C>[] = [];\r\n\r\n  register(component: C, predicate: ScreenPredicate<T>) {\r\n    this.definitions.push({ component, predicate });\r\n  }\r\n\r\n  registerByContentType(component: C, contentType: string) {\r\n    this.register(component, (data) => !!data && isContentType(data, contentType));\r\n  }\r\n\r\n  registerDefault(component: C) {\r\n    this.defaultScreen = component;\r\n  }\r\n\r\n  getScreen(data?: T): C {\r\n    const screen = this.definitions.find(({ predicate }) => predicate(data))?.component;\r\n\r\n    if (screen) {\r\n      return screen;\r\n    }\r\n\r\n    if (!this.defaultScreen) {\r\n      throw new Error('Default screen not defined');\r\n    }\r\n\r\n    return this.defaultScreen;\r\n  }\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { Helmet } from 'react-helmet';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport MarkdownComponent from '../../../../components/MarkdownComponent/MarkdownComponent';\r\n\r\nimport styles from './MediaStaticPage.module.scss';\r\n\r\nconst MediaStaticPage: ScreenComponent<PlaylistItem> = ({ data }) => {\r\n  const { config } = useConfigStore(({ config }) => ({ config }), shallow);\r\n  const { siteName } = config;\r\n  const pageTitle = `${data.title} - ${siteName}`;\r\n  const canonicalUrl = data ? `${window.location.origin}${mediaURL({ media: data })}` : window.location.href;\r\n\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n  }, [data.mediaid]);\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n      </Helmet>\r\n      <div className={styles.mediaStaticPage}>\r\n        <MarkdownComponent markdownString={data.markdown || data.description} />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MediaStaticPage;\r\n","import type { PlaylistItem } from '../../types/playlist';\r\nimport type { EpisodeMetadata, Series } from '../../types/series';\r\n\r\nimport { mediaURL } from './urlFormatting';\r\nimport { secondsToISO8601 } from './datetime';\r\n\r\nexport const generateMovieJSONLD = (item: PlaylistItem, origin: string) => {\r\n  const movieCanonical = `${origin}${mediaURL({ media: item })}`;\r\n\r\n  return JSON.stringify({\r\n    '@context': 'http://schema.org/',\r\n    '@type': 'VideoObject',\r\n    '@id': movieCanonical,\r\n    name: item.title,\r\n    description: item.description,\r\n    duration: secondsToISO8601(item.duration, true),\r\n    thumbnailUrl: item.image,\r\n    uploadDate: secondsToISO8601(item.pubdate),\r\n  });\r\n};\r\n\r\nexport const generateSeriesMetadata = (series: Series, media: PlaylistItem, seriesId: string, origin: string) => {\r\n  // Use playlist for old flow and media id for a new flow\r\n  const seriesCanonical = `${origin}/m/${seriesId}`;\r\n\r\n  return {\r\n    '@type': 'TVSeries',\r\n    '@id': seriesCanonical,\r\n    name: media.title,\r\n    numberOfEpisodes: String(series?.episode_count || 0),\r\n    numberOfSeasons: String(series?.season_count || 0),\r\n  };\r\n};\r\n\r\nexport const generateEpisodeJSONLD = (\r\n  series: Series,\r\n  media: PlaylistItem,\r\n  origin: string,\r\n  episode: PlaylistItem | undefined,\r\n  episodeMetadata: EpisodeMetadata | undefined,\r\n) => {\r\n  const episodeCanonical = `${origin}/m/${series.series_id}?e=${episode?.mediaid}`;\r\n  const seriesMetadata = generateSeriesMetadata(series, media, series.series_id, origin);\r\n\r\n  if (!episode) {\r\n    return JSON.stringify(seriesMetadata);\r\n  }\r\n\r\n  return JSON.stringify({\r\n    '@context': 'http://schema.org/',\r\n    '@type': 'TVEpisode',\r\n    '@id': episodeCanonical,\r\n    episodeNumber: episodeMetadata?.episodeNumber || '0',\r\n    seasonNumber: episodeMetadata?.seasonNumber || '0',\r\n    name: episode.title,\r\n    uploadDate: secondsToISO8601(episode.pubdate),\r\n    partOfSeries: seriesMetadata,\r\n  });\r\n};\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { createVideoMetadata } from '@jwp/ott-common/src/utils/metadata';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { generateMovieJSONLD } from '@jwp/ott-common/src/utils/structuredData';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\nimport usePlaylist from '@jwp/ott-hooks-react/src/usePlaylist';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport PlayTrailer from '@jwp/ott-theme/assets/icons/play_trailer.svg?react';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport VideoLayout from '../../../../components/VideoLayout/VideoLayout';\r\nimport StartWatchingButton from '../../../../containers/StartWatchingButton/StartWatchingButton';\r\nimport Cinema from '../../../../containers/Cinema/Cinema';\r\nimport TrailerModal from '../../../../containers/TrailerModal/TrailerModal';\r\nimport ShareButton from '../../../../components/ShareButton/ShareButton';\r\nimport FavoriteButton from '../../../../containers/FavoriteButton/FavoriteButton';\r\nimport Button from '../../../../components/Button/Button';\r\nimport InlinePlayer from '../../../../containers/InlinePlayer/InlinePlayer';\r\nimport Icon from '../../../../components/Icon/Icon';\r\nimport VideoMetaData from '../../../../components/VideoMetaData/VideoMetaData';\r\n\r\nconst MediaMovie: ScreenComponent<PlaylistItem> = ({ data, isLoading }) => {\r\n  const { t } = useTranslation('video');\r\n\r\n  const [playTrailer, setPlayTrailer] = useState<boolean>(false);\r\n  const breakpoint = useBreakpoint();\r\n\r\n  // Routing\r\n  const navigate = useNavigate();\r\n\r\n  const params = useParams();\r\n  const id = params.id || '';\r\n  const play = useQueryParam('play') === '1';\r\n  const feedId = useQueryParam('r');\r\n\r\n  // Config\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const { siteName, features, custom } = config;\r\n\r\n  const isFavoritesEnabled: boolean = Boolean(features?.favoritesList);\r\n  const inlineLayout = Boolean(custom?.inlinePlayer);\r\n\r\n  // Media\r\n  const { isLoading: isTrailerLoading, data: trailerItem } = useMedia(data?.trailerId || '');\r\n  const { isLoading: isPlaylistLoading, data: playlist } = usePlaylist(features?.recommendationsPlaylist || '', { related_media_id: id });\r\n\r\n  // User, entitlement\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n  const { isEntitled, mediaOffers } = useEntitlement(data);\r\n  const hasMediaOffers = !!mediaOffers.length;\r\n\r\n  // Handlers\r\n  const goBack = () => data && navigate(mediaURL({ media: data, playlistId: feedId, play: false }));\r\n  const getUrl = (item: PlaylistItem) => mediaURL({ media: item, playlistId: features?.recommendationsPlaylist });\r\n\r\n  const handleComplete = useCallback(() => {\r\n    if (!id || !playlist) return;\r\n\r\n    const index = playlist.playlist.findIndex(({ mediaid }) => mediaid === id);\r\n    const nextItem = playlist.playlist[index + 1];\r\n\r\n    return nextItem && navigate(mediaURL({ media: nextItem, playlistId: features?.recommendationsPlaylist, play: true }));\r\n  }, [id, playlist, navigate, features?.recommendationsPlaylist]);\r\n\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n    (document.querySelector('#video-details button') as HTMLElement)?.focus();\r\n  }, [id]);\r\n\r\n  // UI\r\n  const pageTitle = `${data.title} - ${siteName}`;\r\n  const canonicalUrl = data ? `${window.location.origin}${mediaURL({ media: data })}` : window.location.href;\r\n\r\n  const primaryMetadata = <VideoMetaData attributes={createVideoMetadata(data)} />;\r\n  const shareButton = <ShareButton title={data.title} description={data.description} url={canonicalUrl} />;\r\n  const startWatchingButton = (\r\n    <StartWatchingButton\r\n      key={id} // necessary to fix autofocus on TalkBack\r\n      item={data}\r\n      playUrl={mediaURL({ media: data, playlistId: feedId, play: true })}\r\n    />\r\n  );\r\n\r\n  const favoriteButton = isFavoritesEnabled && <FavoriteButton item={data} />;\r\n  const trailerButton = (!!trailerItem || isTrailerLoading) && (\r\n    <Button\r\n      label={t('video:trailer')}\r\n      aria-label={t('video:watch_trailer')}\r\n      startIcon={<Icon icon={PlayTrailer} />}\r\n      onClick={() => setPlayTrailer(true)}\r\n      active={playTrailer}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n      disabled={!trailerItem}\r\n    />\r\n  );\r\n\r\n  const isLoggedIn = !!user;\r\n  const hasSubscription = !!subscription;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"description\" content={data.description} />\r\n        <meta property=\"og:description\" content={data.description} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta property=\"og:type\" content=\"video.other\" />\r\n        {data.image && <meta property=\"og:image\" content={data.image?.replace(/^https:/, 'http:')} />}\r\n        {data.image && <meta property=\"og:image:secure_url\" content={data.image?.replace(/^http:/, 'https:')} />}\r\n        <meta property=\"og:image:width\" content={data.image ? '720' : ''} />\r\n        <meta property=\"og:image:height\" content={data.image ? '406' : ''} />\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n        <meta name=\"twitter:description\" content={data.description} />\r\n        <meta name=\"twitter:image\" content={data.image} />\r\n        <meta property=\"og:video\" content={canonicalUrl.replace(/^https:/, 'http:')} />\r\n        <meta property=\"og:video:secure_url\" content={canonicalUrl.replace(/^http:/, 'https:')} />\r\n        <meta property=\"og:video:type\" content=\"text/html\" />\r\n        <meta property=\"og:video:width\" content=\"1280\" />\r\n        <meta property=\"og:video:height\" content=\"720\" />\r\n        {data.tags?.split(',').map((tag) => (\r\n          <meta property=\"og:video:tag\" content={tag} key={tag} />\r\n        ))}\r\n        {data ? <script type=\"application/ld+json\">{generateMovieJSONLD(data, window.location.origin)}</script> : null}\r\n      </Helmet>\r\n      <VideoLayout\r\n        item={data}\r\n        inlineLayout={inlineLayout}\r\n        isLoading={isLoading || isPlaylistLoading}\r\n        accessModel={accessModel}\r\n        isLoggedIn={isLoggedIn}\r\n        hasSubscription={hasSubscription}\r\n        title={data.title}\r\n        description={data.description}\r\n        image={data.backgroundImage}\r\n        primaryMetadata={primaryMetadata}\r\n        shareButton={shareButton}\r\n        favoriteButton={favoriteButton}\r\n        trailerButton={trailerButton}\r\n        startWatchingButton={startWatchingButton}\r\n        playlist={playlist}\r\n        relatedTitle={playlist?.title}\r\n        getURL={getUrl}\r\n        activeLabel={t('current_video')}\r\n        player={\r\n          inlineLayout ? (\r\n            <InlinePlayer\r\n              isLoggedIn={isLoggedIn}\r\n              item={data}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n              startWatchingButton={startWatchingButton}\r\n              isEntitled={isEntitled}\r\n              hasMediaOffers={hasMediaOffers}\r\n              autostart={play || undefined}\r\n            />\r\n          ) : (\r\n            <Cinema\r\n              open={play && isEntitled}\r\n              onClose={goBack}\r\n              item={data}\r\n              title={data.title}\r\n              primaryMetadata={primaryMetadata}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n              onNext={handleComplete}\r\n            />\r\n          )\r\n        }\r\n      />\r\n      <TrailerModal item={trailerItem} title={`${data.title} - Trailer`} open={playTrailer} onClose={() => setPlayTrailer(false)} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default MediaMovie;\r\n","import type { EpisodeMetadata, Series } from '../../types/series';\r\n\r\n/**\r\n * Get an array of options for a season filter\r\n */\r\nexport const getFiltersFromSeries = (series: Series | undefined): { label: string; value: string }[] => {\r\n  return series && 'seasons' in series\r\n    ? series.seasons.map((season) => ({ label: season.season_title || String(season.season_number), value: String(season.season_number) }))\r\n    : [];\r\n};\r\n\r\n/** Get a total amount of episodes in a season */\r\nexport const getEpisodesInSeason = (episodeMetadata: EpisodeMetadata | undefined, series: Series | undefined) => {\r\n  return (series?.seasons || []).find((el) => el.season_number === Number(episodeMetadata?.seasonNumber))?.episode_count;\r\n};\r\n","import { useQuery, type UseQueryResult } from 'react-query';\r\nimport type { Series } from '@jwp/ott-common/types/series';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport type { ApiError } from '@jwp/ott-common/src/utils/api';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\n\r\nexport const useSeries = (\r\n  seriesId: string | undefined,\r\n): {\r\n  data: Series | undefined;\r\n  error: ApiError | null;\r\n  isLoading: boolean;\r\n} => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  // Try to get new series flow data\r\n  const { data, isLoading, error }: UseQueryResult<Series, ApiError> = useQuery(\r\n    ['series', seriesId],\r\n    async () => {\r\n      const series = await apiService.getSeries(seriesId || '');\r\n\r\n      return series;\r\n    },\r\n    {\r\n      enabled: !!seriesId,\r\n      staleTime: STALE_TIME,\r\n      cacheTime: CACHE_TIME,\r\n      // Don't retry when we got a not found error from either series or media item request (prevent unneeded requests)\r\n      // Both errors mean that old series flow should be used\r\n      retry: (failureCount, error: ApiError) => error.code !== 404 && failureCount < 2,\r\n    },\r\n  );\r\n\r\n  return { data, isLoading, error };\r\n};\r\n","import { useInfiniteQuery } from 'react-query';\r\nimport type { EpisodesWithPagination } from '@jwp/ott-common/types/series';\r\nimport type { Pagination } from '@jwp/ott-common/types/pagination';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\n\r\nconst getNextPageParam = (pagination: Pagination) => {\r\n  const { page, page_limit, total } = pagination;\r\n\r\n  // In case there are no more episodes in a season to fetch\r\n  if (page_limit * page >= total) {\r\n    return undefined;\r\n  }\r\n\r\n  return page;\r\n};\r\n\r\nexport const useEpisodes = (\r\n  seriesId: string | undefined,\r\n  seasonNumber: string | undefined,\r\n  options: { enabled: boolean },\r\n): {\r\n  data: EpisodesWithPagination[];\r\n  hasNextPage: boolean;\r\n  fetchNextPage: (params?: { pageParam?: number }) => void;\r\n  isLoading: boolean;\r\n} => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const {\r\n    data,\r\n    fetchNextPage,\r\n    isLoading,\r\n    hasNextPage = false,\r\n  } = useInfiniteQuery(\r\n    [seriesId, seasonNumber],\r\n    async ({ pageParam = 0 }) => {\r\n      if (Number(seasonNumber)) {\r\n        // Get episodes from a selected season using pagination\r\n        const season = await apiService.getSeasonWithEpisodes({ seriesId, seasonNumber: Number(seasonNumber), pageOffset: pageParam });\r\n\r\n        return { pagination: season.pagination, episodes: season.episodes };\r\n      } else {\r\n        // Get episodes from a selected series using pagination\r\n        const data = await apiService.getEpisodes({ seriesId, pageOffset: pageParam });\r\n        return data;\r\n      }\r\n    },\r\n    {\r\n      getNextPageParam: (lastPage) => getNextPageParam(lastPage?.pagination),\r\n      enabled: options.enabled,\r\n      staleTime: STALE_TIME,\r\n      cacheTime: CACHE_TIME,\r\n    },\r\n  );\r\n\r\n  return {\r\n    data: data?.pages || [],\r\n    isLoading,\r\n    fetchNextPage,\r\n    hasNextPage,\r\n  };\r\n};\r\n","import { useQuery } from 'react-query';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\n\r\nexport const useSeriesLookup = (mediaId: string | undefined) => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const { isLoading, data } = useQuery(\r\n    ['seriesLookup', mediaId],\r\n    async () => {\r\n      if (!mediaId) {\r\n        return;\r\n      }\r\n\r\n      // get all series for the given media id\r\n      const data = await apiService.getSeriesByMediaIds([mediaId]);\r\n      // get first series for the requested episode\r\n      const firstSeries = data?.[mediaId]?.[0];\r\n\r\n      return firstSeries;\r\n    },\r\n    { staleTime: STALE_TIME, cacheTime: CACHE_TIME, enabled: !!mediaId },\r\n  );\r\n\r\n  return {\r\n    isLoading,\r\n    data,\r\n  };\r\n};\r\n","import { useQuery } from 'react-query';\r\nimport type { Series } from '@jwp/ott-common/types/series';\r\nimport ApiService from '@jwp/ott-common/src/services/ApiService';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { CACHE_TIME, STALE_TIME } from '@jwp/ott-common/src/constants';\r\n\r\nexport const useNextEpisode = ({ series, episodeId }: { series: Series | undefined; episodeId: string | undefined }) => {\r\n  const apiService = getModule(ApiService);\r\n\r\n  const { isLoading, data } = useQuery(\r\n    ['next-episode', series?.series_id, episodeId],\r\n    async () => {\r\n      const item = await apiService.getEpisodes({ seriesId: series?.series_id, pageLimit: 1, afterId: episodeId });\r\n\r\n      return item?.episodes?.[0];\r\n    },\r\n    { staleTime: STALE_TIME, cacheTime: CACHE_TIME, enabled: !!(series?.series_id && episodeId) },\r\n  );\r\n\r\n  return {\r\n    isLoading,\r\n    data,\r\n  };\r\n};\r\n","import React, { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { Navigate, useLocation } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useWatchHistoryStore } from '@jwp/ott-common/src/stores/WatchHistoryStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { generateEpisodeJSONLD } from '@jwp/ott-common/src/utils/structuredData';\r\nimport { getEpisodesInSeason, getFiltersFromSeries } from '@jwp/ott-common/src/utils/series';\r\nimport { createVideoMetadata } from '@jwp/ott-common/src/utils/metadata';\r\nimport { formatSeriesMetaString } from '@jwp/ott-common/src/utils/formatting';\r\nimport { buildLegacySeriesUrlFromMediaItem, mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { VideoProgressMinMax } from '@jwp/ott-common/src/constants';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\nimport { useSeries } from '@jwp/ott-hooks-react/src/series/useSeries';\r\nimport { useEpisodes } from '@jwp/ott-hooks-react/src/series/useEpisodes';\r\nimport { useSeriesLookup } from '@jwp/ott-hooks-react/src/series/useSeriesLookup';\r\nimport { useNextEpisode } from '@jwp/ott-hooks-react/src/series/useNextEpisode';\r\nimport PlayTrailer from '@jwp/ott-theme/assets/icons/play_trailer.svg?react';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport ErrorPage from '../../../../components/ErrorPage/ErrorPage';\r\nimport StartWatchingButton from '../../../../containers/StartWatchingButton/StartWatchingButton';\r\nimport InlinePlayer from '../../../../containers/InlinePlayer/InlinePlayer';\r\nimport VideoLayout from '../../../../components/VideoLayout/VideoLayout';\r\nimport Cinema from '../../../../containers/Cinema/Cinema';\r\nimport TrailerModal from '../../../../containers/TrailerModal/TrailerModal';\r\nimport ShareButton from '../../../../components/ShareButton/ShareButton';\r\nimport FavoriteButton from '../../../../containers/FavoriteButton/FavoriteButton';\r\nimport Button from '../../../../components/Button/Button';\r\nimport Loading from '../../../Loading/Loading';\r\nimport Icon from '../../../../components/Icon/Icon';\r\nimport VideoMetaData from '../../../../components/VideoMetaData/VideoMetaData';\r\nimport { createURLFromLocation } from '../../../../utils/location';\r\n\r\nconst MediaSeries: ScreenComponent<PlaylistItem> = ({ data: seriesMedia }) => {\r\n  const breakpoint = useBreakpoint();\r\n  const { t } = useTranslation('video');\r\n  const [playTrailer, setPlayTrailer] = useState<boolean>(false);\r\n\r\n  // Navigation\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const seriesId = seriesMedia.mediaid;\r\n  const play = searchParams.get('play') === '1';\r\n  const feedId = searchParams.get('r');\r\n  const episodeId = searchParams.get('e');\r\n\r\n  // Main data\r\n  const { isLoading: isSeriesDataLoading, data: series, error: seriesError } = useSeries(seriesId);\r\n  const { isLoading: isEpisodeLoading, data: episode } = useMedia(episodeId || '');\r\n  const { isLoading: isTrailerLoading, data: trailerItem } = useMedia(episode?.trailerId || '');\r\n  const { data: episodeInSeries, isLoading: isSeriesDictionaryLoading } = useSeriesLookup(episode?.mediaid);\r\n\r\n  // Whether we show series or episode information\r\n  const selectedItem = (episode || seriesMedia) as PlaylistItem;\r\n\r\n  // Config\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const { features, siteName, custom } = config;\r\n  const isFavoritesEnabled: boolean = Boolean(features?.favoritesList);\r\n  const inlineLayout = Boolean(custom?.inlinePlayer);\r\n\r\n  // Filters\r\n  const filters = useMemo(() => getFiltersFromSeries(series), [series]);\r\n  const [seasonFilter, setSeasonFilter] = useState<string | undefined>(undefined);\r\n\r\n  // Season / episodes data\r\n  const {\r\n    data: episodes,\r\n    fetchNextPage: fetchNextEpisodes,\r\n    hasNextPage: hasNextEpisodesPage,\r\n  } = useEpisodes(seriesId, seasonFilter, { enabled: seasonFilter !== undefined && !!series });\r\n\r\n  const firstEpisode = useMemo(() => episodes?.[0]?.episodes?.[0], [episodes]);\r\n  const episodeMetadata = useMemo(\r\n    () =>\r\n      episodeInSeries && {\r\n        episodeNumber: episodeInSeries?.episode_number ? String(episodeInSeries.episode_number) : '',\r\n        seasonNumber: episodeInSeries?.season_number ? String(episodeInSeries.season_number) : '',\r\n      },\r\n    [episodeInSeries],\r\n  );\r\n  const playlist = useMemo(\r\n    () => ({\r\n      title: seriesMedia.title,\r\n      description: seriesMedia.description,\r\n      feedid: series?.series_id,\r\n      playlist: episodes?.flatMap((e) => e.episodes) || [],\r\n    }),\r\n    [seriesMedia, series, episodes],\r\n  );\r\n\r\n  const episodesInSeason = getEpisodesInSeason(episodeMetadata, series);\r\n  const { data: nextItem } = useNextEpisode({ series, episodeId: episode?.mediaid || firstEpisode?.mediaid });\r\n\r\n  // Watch history\r\n  const watchHistoryArray = useWatchHistoryStore((state) => state.watchHistory);\r\n  const watchHistoryDictionary = useWatchHistoryStore((state) => state.getDictionaryWithEpisodes());\r\n  const episodeInProgress = watchHistoryArray.find(\r\n    (episode) => episode?.seriesId === seriesId && episode.progress > VideoProgressMinMax.Min && episode.progress < VideoProgressMinMax.Max,\r\n  );\r\n\r\n  // User, entitlement\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n  const { isEntitled, mediaOffers } = useEntitlement(episode || firstEpisode);\r\n  const hasMediaOffers = !!mediaOffers.length;\r\n\r\n  const isLoggedIn = !!user;\r\n  const hasSubscription = !!subscription;\r\n\r\n  const location = useLocation();\r\n  const getURL = (toEpisode: PlaylistItem) => {\r\n    return createURLFromLocation(location, { e: toEpisode.mediaid });\r\n  };\r\n\r\n  // Handlers\r\n  const goBack = useCallback(() => {\r\n    setSearchParams({ ...searchParams, e: episode?.mediaid, r: feedId || '' });\r\n  }, [setSearchParams, searchParams, episode, feedId]);\r\n\r\n  const handleComplete = useCallback(async () => {\r\n    setSearchParams({ ...searchParams, e: (nextItem || episode)?.mediaid, r: feedId || '', play: nextItem ? '1' : '0' });\r\n  }, [setSearchParams, nextItem, episode, feedId, searchParams]);\r\n\r\n  const handleInlinePlay = useCallback(async () => {\r\n    if (!episode) {\r\n      setSearchParams({ ...searchParams, e: firstEpisode?.mediaid, r: feedId || '', play: '1' });\r\n    }\r\n  }, [setSearchParams, firstEpisode, feedId, episode, searchParams]);\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n    (document.querySelector('#video-details button') as HTMLElement)?.focus();\r\n  }, [episode]);\r\n\r\n  useEffect(() => {\r\n    if (episodeInProgress && !searchParams.get('e')) {\r\n      setSearchParams({ ...searchParams, e: episodeInProgress.mediaid, r: feedId || '' }, { replace: true });\r\n    }\r\n  }, [episodeInProgress, setSearchParams, searchParams, feedId]);\r\n\r\n  useEffect(() => {\r\n    if (isSeriesDataLoading || isEpisodeLoading || isSeriesDictionaryLoading) {\r\n      return;\r\n    }\r\n\r\n    // No episode is selected, filter is not set\r\n    if (!episodeId && seasonFilter === undefined) {\r\n      setSeasonFilter(filters[0]?.value || '');\r\n      return;\r\n    }\r\n\r\n    // Select a corresponding season for an episode\r\n    if (seasonFilter === undefined && episodeMetadata) {\r\n      setSeasonFilter(episodeMetadata.seasonNumber);\r\n    }\r\n  }, [episodeMetadata, seasonFilter, isSeriesDataLoading, isEpisodeLoading, isSeriesDictionaryLoading, filters, episodeId]);\r\n\r\n  const startWatchingButton = useMemo(\r\n    () => (\r\n      <StartWatchingButton\r\n        key={episodeId} // necessary to fix autofocus on TalkBack\r\n        item={episode || firstEpisode}\r\n        onClick={() => {\r\n          setSearchParams({ ...searchParams, e: (episode || firstEpisode).mediaid, r: feedId || '', play: '1' }, { replace: true });\r\n        }}\r\n      />\r\n    ),\r\n    [episodeId, episode, firstEpisode, setSearchParams, searchParams, feedId],\r\n  );\r\n\r\n  // UI\r\n  const isLoading = isSeriesDataLoading || isSeriesDictionaryLoading || isEpisodeLoading;\r\n\r\n  if (isLoading) return <Loading />;\r\n\r\n  // Legacy series is used\r\n  if (seriesError?.code === 404) {\r\n    const url = buildLegacySeriesUrlFromMediaItem(seriesMedia, play, feedId);\r\n\r\n    return <Navigate to={url} replace />;\r\n  }\r\n\r\n  if (!seriesMedia || !series) return <ErrorPage title={t('series_error')} />;\r\n\r\n  const pageTitle = `${selectedItem.title} - ${siteName}`;\r\n  const canonicalUrl = `${window.location.origin}${mediaURL({ media: seriesMedia, episodeId: episode?.mediaid })}`;\r\n\r\n  const primaryMetadata = <VideoMetaData attributes={createVideoMetadata(selectedItem, t('video:total_episodes', { count: series.episode_count }))} />;\r\n  const secondaryMetadata = episodeMetadata && episode && (\r\n    <>\r\n      <strong>{formatSeriesMetaString(episodeMetadata.seasonNumber, episodeMetadata.episodeNumber)}</strong> - {episode.title}\r\n    </>\r\n  );\r\n  const filterMetadata =\r\n    episodeMetadata &&\r\n    ` ${t('video:season')} ${episodeMetadata.seasonNumber}/${filters?.length} - ${t('video:episode')} ${episodeMetadata.episodeNumber}/${episodesInSeason}`;\r\n  const shareButton = <ShareButton title={selectedItem?.title} description={selectedItem.description} url={canonicalUrl} />;\r\n\r\n  // For the old series approach we mark episodes as favorite items. New approach is applied to the series\r\n  const favoriteButton = isFavoritesEnabled && <FavoriteButton item={seriesMedia || firstEpisode} />;\r\n  const trailerButton = (!!trailerItem || isTrailerLoading) && (\r\n    <Button\r\n      label={t('video:trailer')}\r\n      aria-label={t('video:watch_trailer')}\r\n      startIcon={<Icon icon={PlayTrailer} />}\r\n      onClick={() => setPlayTrailer(true)}\r\n      active={playTrailer}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n      disabled={!trailerItem}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"description\" content={selectedItem.description} />\r\n        <meta property=\"og:description\" content={selectedItem.description} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta property=\"og:type\" content={episode ? 'video.episode' : 'video.series'} />\r\n        {selectedItem.image && <meta property=\"og:image\" content={selectedItem.image?.replace(/^https:/, 'http:')} />}\r\n        {selectedItem.image && <meta property=\"og:image:secure_url\" content={selectedItem.image?.replace(/^http:/, 'https:')} />}\r\n        {selectedItem.image && <meta property=\"og:image:width\" content={selectedItem.image ? '720' : ''} />}\r\n        {selectedItem.image && <meta property=\"og:image:height\" content={selectedItem.image ? '406' : ''} />}\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n        <meta name=\"twitter:description\" content={selectedItem.description} />\r\n        <meta name=\"twitter:image\" content={selectedItem.image} />\r\n        <meta property=\"og:video\" content={canonicalUrl.replace(/^https:/, 'http:')} />\r\n        <meta property=\"og:video:secure_url\" content={canonicalUrl.replace(/^http:/, 'https:')} />\r\n        <meta property=\"og:video:type\" content=\"text/html\" />\r\n        <meta property=\"og:video:width\" content=\"1280\" />\r\n        <meta property=\"og:video:height\" content=\"720\" />\r\n        {selectedItem.tags?.split(',').map((tag: string) => (\r\n          <meta property=\"og:video:tag\" content={tag} key={tag} />\r\n        ))}\r\n        {selectedItem ? (\r\n          <script type=\"application/ld+json\">{generateEpisodeJSONLD(series, seriesMedia, window.location.origin, episode, episodeMetadata)}</script>\r\n        ) : null}\r\n      </Helmet>\r\n      <VideoLayout\r\n        item={selectedItem}\r\n        title={inlineLayout ? selectedItem.title : seriesMedia.title}\r\n        description={selectedItem.description || seriesMedia.description}\r\n        inlineLayout={inlineLayout}\r\n        primaryMetadata={primaryMetadata}\r\n        secondaryMetadata={secondaryMetadata}\r\n        image={selectedItem.backgroundImage}\r\n        shareButton={shareButton}\r\n        favoriteButton={favoriteButton}\r\n        trailerButton={trailerButton}\r\n        startWatchingButton={startWatchingButton}\r\n        isLoading={isLoading}\r\n        accessModel={accessModel}\r\n        isLoggedIn={isLoggedIn}\r\n        hasSubscription={hasSubscription}\r\n        playlist={playlist}\r\n        relatedTitle={inlineLayout ? seriesMedia.title : t('episodes')}\r\n        getURL={getURL}\r\n        setFilter={setSeasonFilter}\r\n        currentFilter={seasonFilter}\r\n        defaultFilterLabel={t('all_seasons')}\r\n        activeLabel={t('current_episode')}\r\n        watchHistory={watchHistoryDictionary}\r\n        filterMetadata={filterMetadata}\r\n        filters={filters}\r\n        hasMore={hasNextEpisodesPage}\r\n        loadMore={fetchNextEpisodes}\r\n        player={\r\n          inlineLayout && (episode || firstEpisode) ? (\r\n            <InlinePlayer\r\n              isLoggedIn={isLoggedIn}\r\n              item={episode || firstEpisode}\r\n              seriesItem={seriesMedia}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n              onPlay={handleInlinePlay}\r\n              startWatchingButton={startWatchingButton}\r\n              isEntitled={isEntitled}\r\n              hasMediaOffers={hasMediaOffers}\r\n              autostart={play || undefined}\r\n            />\r\n          ) : (\r\n            <Cinema\r\n              open={play && isEntitled}\r\n              onClose={goBack}\r\n              item={episode || firstEpisode}\r\n              seriesItem={seriesMedia}\r\n              title={seriesMedia.title}\r\n              primaryMetadata={primaryMetadata}\r\n              secondaryMetadata={secondaryMetadata}\r\n              onComplete={handleComplete}\r\n              feedId={feedId ?? undefined}\r\n            />\r\n          )\r\n        }\r\n      />\r\n      {episode && <TrailerModal item={trailerItem} title={`${episode.title} - Trailer`} open={playTrailer} onClose={() => setPlayTrailer(false)} />}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default MediaSeries;\r\n","import { Navigate } from 'react-router-dom';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { liveChannelsURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport Loading from '../../../Loading/Loading';\r\nimport MediaMovie from '../MediaMovie/MediaMovie';\r\n\r\nconst MediaLiveChannel: ScreenComponent<PlaylistItem> = ({ data, isLoading }) => {\r\n  const liveChannelsId = data.liveChannelsId;\r\n\r\n  if (isLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  // this live channel is part of a live channels (TV Guide) page\r\n  if (liveChannelsId) {\r\n    return <Navigate to={liveChannelsURL(liveChannelsId, data.mediaid)} replace={true}></Navigate>;\r\n  }\r\n\r\n  // this live channel is \"just\" a media item\r\n  return <MediaMovie data={data} isLoading={isLoading} />;\r\n};\r\n\r\nexport default MediaLiveChannel;\r\n","import { Navigate } from 'react-router';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { buildLegacySeriesUrlFromMediaItem, mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { useSeriesLookup } from '@jwp/ott-hooks-react/src/series/useSeriesLookup';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport Loading from '../../../Loading/Loading';\r\n\r\n/**\r\n * This media series episode screen is used to redirect an episode item to the series page.\r\n */\r\nconst MediaEpisode: ScreenComponent<PlaylistItem> = ({ data: media, isLoading: isMediaLoading }) => {\r\n  const mediaId = media.mediaid;\r\n  const [searchParams] = useSearchParams();\r\n\r\n  const play = searchParams.get('play') === '1';\r\n  const feedId = searchParams.get('r');\r\n\r\n  const { data: episodeInSeries, isLoading: isSeriesIdLoading } = useSeriesLookup(media.mediaid);\r\n  const { isLoading: isSeriesMediaLoading, data: seriesMedia } = useMedia(episodeInSeries?.series_id || '');\r\n\r\n  // Prevent rendering multiple times when we are loading data\r\n  if (isMediaLoading || isSeriesIdLoading || isSeriesMediaLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  if (!episodeInSeries) {\r\n    return <Navigate to={buildLegacySeriesUrlFromMediaItem(media, play, feedId)} replace />;\r\n  }\r\n\r\n  // Use media episode item for legacy series flow\r\n  return <Navigate to={mediaURL({ episodeId: mediaId, media: seriesMedia as PlaylistItem, play, playlistId: feedId })} replace />;\r\n};\r\n\r\nexport default MediaEpisode;\r\n","import type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { isLiveEvent, isPlayable } from '@jwp/ott-common/src/utils/liveEvent';\r\n\r\nexport function useLiveEvent(media: PlaylistItem) {\r\n  return {\r\n    isLiveEvent: isLiveEvent(media),\r\n    isPlayable: isPlayable(media),\r\n  };\r\n}\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './Tag.module.scss';\r\n\r\ntype TagProps = {\r\n  className?: string;\r\n  isLive?: boolean;\r\n  children?: React.ReactNode;\r\n  size?: 'normal' | 'large';\r\n};\r\n\r\nconst Tag: React.FC<TagProps> = ({ children, className, isLive = false, size = 'normal' }: TagProps) => {\r\n  return (\r\n    <div\r\n      className={classNames(className, styles.tag, styles[size], {\r\n        [styles.live]: isLive,\r\n      })}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Tag;\r\n","import { useTranslation } from 'react-i18next';\r\nimport { MediaStatus } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport Today from '@jwp/ott-theme/assets/icons/today.svg?react';\r\n\r\nimport Tag from '../Tag/Tag';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './StatusIcon.module.scss';\r\n\r\ntype Props = {\r\n  mediaStatus?: MediaStatus;\r\n};\r\n\r\nexport default function StatusIcon({ mediaStatus }: Props) {\r\n  const { t } = useTranslation('video');\r\n\r\n  if (mediaStatus === MediaStatus.SCHEDULED || mediaStatus === MediaStatus.VOD) {\r\n    return <Icon icon={Today} className={styles.icon} />;\r\n  } else if (mediaStatus === MediaStatus.LIVE) {\r\n    return (\r\n      <Tag isLive className={styles.icon}>\r\n        {t('live')}\r\n      </Tag>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n","import React, { useCallback, useEffect, useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router';\r\nimport { Helmet } from 'react-helmet';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { MediaStatus } from '@jwp/ott-common/src/utils/liveEvent';\r\nimport { createLiveEventMetadata } from '@jwp/ott-common/src/utils/metadata';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { generateMovieJSONLD } from '@jwp/ott-common/src/utils/structuredData';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\nimport { useLiveEvent } from '@jwp/ott-hooks-react/src/useLiveEvent';\r\nimport usePlaylist from '@jwp/ott-hooks-react/src/usePlaylist';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\nimport PlayTrailer from '@jwp/ott-theme/assets/icons/play_trailer.svg?react';\r\nimport useQueryParam from '@jwp/ott-ui-react/src/hooks/useQueryParam';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport VideoLayout from '../../../../components/VideoLayout/VideoLayout';\r\nimport StartWatchingButton from '../../../../containers/StartWatchingButton/StartWatchingButton';\r\nimport Cinema from '../../../../containers/Cinema/Cinema';\r\nimport TrailerModal from '../../../../containers/TrailerModal/TrailerModal';\r\nimport ShareButton from '../../../../components/ShareButton/ShareButton';\r\nimport FavoriteButton from '../../../../containers/FavoriteButton/FavoriteButton';\r\nimport Button from '../../../../components/Button/Button';\r\nimport InlinePlayer from '../../../../containers/InlinePlayer/InlinePlayer';\r\nimport StatusIcon from '../../../../components/StatusIcon/StatusIcon';\r\nimport VideoMetaData from '../../../../components/VideoMetaData/VideoMetaData';\r\nimport Icon from '../../../../components/Icon/Icon';\r\n\r\nconst MediaEvent: ScreenComponent<PlaylistItem> = ({ data: media, isLoading }) => {\r\n  const { t, i18n } = useTranslation('video');\r\n\r\n  const [playTrailer, setPlayTrailer] = useState<boolean>(false);\r\n  const breakpoint = useBreakpoint();\r\n\r\n  // Routing\r\n  const navigate = useNavigate();\r\n\r\n  const params = useParams();\r\n  const id = params.id || '';\r\n  const play = useQueryParam('play') === '1';\r\n  const playlistId = useQueryParam('r');\r\n\r\n  // Config\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n  const { siteName, features, custom } = config;\r\n\r\n  const isFavoritesEnabled: boolean = Boolean(features?.favoritesList);\r\n  const inlineLayout = Boolean(custom?.inlinePlayer);\r\n\r\n  // Media\r\n  const { isLoading: isTrailerLoading, data: trailerItem } = useMedia(media?.trailerId || '');\r\n  const { isLoading: isPlaylistLoading, data: playlist } = usePlaylist(playlistId || '');\r\n\r\n  // Event\r\n  const liveEvent = useLiveEvent(media);\r\n\r\n  // User, entitlement\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n  const { isEntitled, mediaOffers } = useEntitlement(media);\r\n  const hasMediaOffers = !!mediaOffers.length;\r\n\r\n  // Handlers\r\n  const goBack = () => media && navigate(mediaURL({ media, playlistId, play: false }));\r\n  const getUrl = (item: PlaylistItem) => mediaURL({ media: item, playlistId });\r\n\r\n  const handleComplete = useCallback(() => {\r\n    if (!id || !playlist) return;\r\n\r\n    const index = playlist.playlist.findIndex(({ mediaid }) => mediaid === id);\r\n    const nextItem = playlist.playlist[index + 1];\r\n\r\n    if (nextItem.mediaStatus === MediaStatus.SCHEDULED) {\r\n      return;\r\n    }\r\n\r\n    return nextItem && navigate(mediaURL({ media: nextItem, playlistId, play: true }));\r\n  }, [id, playlist, navigate, playlistId]);\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n    (document.querySelector('#video-details button') as HTMLElement)?.focus();\r\n  }, [id]);\r\n\r\n  // UI\r\n  const pageTitle = `${media.title} - ${siteName}`;\r\n  const canonicalUrl = media ? `${window.location.origin}${mediaURL({ media: media })}` : window.location.href;\r\n\r\n  const primaryMetadata = (\r\n    <>\r\n      <StatusIcon mediaStatus={media.mediaStatus} />\r\n      <VideoMetaData attributes={createLiveEventMetadata(media, i18n.language)} />\r\n    </>\r\n  );\r\n\r\n  const shareButton = <ShareButton title={media.title} description={media.description} url={canonicalUrl} />;\r\n  const startWatchingButton = (\r\n    <StartWatchingButton\r\n      key={id} // necessary to fix autofocus on TalkBack\r\n      item={media}\r\n      playUrl={mediaURL({ media, playlistId, play: true })}\r\n      disabled={!liveEvent.isPlayable}\r\n    />\r\n  );\r\n\r\n  const favoriteButton = isFavoritesEnabled && <FavoriteButton item={media} />;\r\n  const trailerButton = (!!trailerItem || isTrailerLoading) && (\r\n    <Button\r\n      label={t('video:trailer')}\r\n      aria-label={t('video:watch_trailer')}\r\n      startIcon={<Icon icon={PlayTrailer} />}\r\n      onClick={() => setPlayTrailer(true)}\r\n      active={playTrailer}\r\n      fullWidth={breakpoint < Breakpoint.md}\r\n      disabled={!trailerItem}\r\n    />\r\n  );\r\n\r\n  const isLoggedIn = !!user;\r\n  const hasSubscription = !!subscription;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"description\" content={media.description} />\r\n        <meta property=\"og:description\" content={media.description} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta property=\"og:type\" content=\"video.other\" />\r\n        {media.image && <meta property=\"og:image\" content={media.image?.replace(/^https:/, 'http:')} />}\r\n        {media.image && <meta property=\"og:image:secure_url\" content={media.image?.replace(/^http:/, 'https:')} />}\r\n        <meta property=\"og:image:width\" content={media.image ? '720' : ''} />\r\n        <meta property=\"og:image:height\" content={media.image ? '406' : ''} />\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n        <meta name=\"twitter:description\" content={media.description} />\r\n        <meta name=\"twitter:image\" content={media.image} />\r\n        <meta property=\"og:video\" content={canonicalUrl.replace(/^https:/, 'http:')} />\r\n        <meta property=\"og:video:secure_url\" content={canonicalUrl.replace(/^http:/, 'https:')} />\r\n        <meta property=\"og:video:type\" content=\"text/html\" />\r\n        <meta property=\"og:video:width\" content=\"1280\" />\r\n        <meta property=\"og:video:height\" content=\"720\" />\r\n        {media.tags?.split(',').map((tag) => (\r\n          <meta property=\"og:video:tag\" content={tag} key={tag} />\r\n        ))}\r\n        {media ? <script type=\"application/ld+json\">{generateMovieJSONLD(media, window.location.origin)}</script> : null}\r\n      </Helmet>\r\n      <VideoLayout\r\n        item={media}\r\n        inlineLayout={inlineLayout}\r\n        isLoading={isLoading || isPlaylistLoading}\r\n        accessModel={accessModel}\r\n        isLoggedIn={isLoggedIn}\r\n        hasSubscription={hasSubscription}\r\n        title={media.title}\r\n        description={media.description}\r\n        image={media.backgroundImage}\r\n        primaryMetadata={primaryMetadata}\r\n        shareButton={shareButton}\r\n        favoriteButton={favoriteButton}\r\n        trailerButton={trailerButton}\r\n        startWatchingButton={startWatchingButton}\r\n        playlist={playlist}\r\n        relatedTitle={playlist?.title}\r\n        getURL={getUrl}\r\n        activeLabel={t('current_video')}\r\n        player={\r\n          inlineLayout ? (\r\n            <InlinePlayer\r\n              isLoggedIn={isLoggedIn}\r\n              item={media}\r\n              onComplete={handleComplete}\r\n              feedId={playlistId ?? undefined}\r\n              startWatchingButton={startWatchingButton}\r\n              isEntitled={isEntitled}\r\n              hasMediaOffers={hasMediaOffers}\r\n              autostart={liveEvent.isPlayable && (play || undefined)}\r\n              playable={liveEvent.isPlayable}\r\n            />\r\n          ) : (\r\n            <Cinema\r\n              open={play && isEntitled}\r\n              onClose={goBack}\r\n              item={media}\r\n              title={media.title}\r\n              primaryMetadata={primaryMetadata}\r\n              onComplete={handleComplete}\r\n              feedId={playlistId ?? undefined}\r\n              onNext={handleComplete}\r\n            />\r\n          )\r\n        }\r\n      />\r\n      <TrailerModal item={trailerItem} title={`${media.title} - Trailer`} open={playTrailer} onClose={() => setPlayTrailer(false)} />\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport default MediaEvent;\r\n","import { useParams } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport React from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { isEpisode, isLegacySeriesFlow } from '@jwp/ott-common/src/utils/media';\r\nimport { CONTENT_TYPE } from '@jwp/ott-common/src/constants';\r\nimport { ScreenMap } from '@jwp/ott-common/src/utils/ScreenMap';\r\nimport useMedia from '@jwp/ott-hooks-react/src/useMedia';\r\n\r\nimport type { ScreenComponent } from '../../../types/screens';\r\nimport Loading from '../Loading/Loading';\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\n\r\nimport MediaStaticPage from './mediaScreens/MediaStaticPage/MediaStaticPage';\r\nimport MediaMovie from './mediaScreens/MediaMovie/MediaMovie';\r\nimport MediaSeries from './mediaScreens/MediaSeries/MediaSeries';\r\nimport MediaLiveChannel from './mediaScreens/MediaLiveChannel/MediaLiveChannel';\r\nimport MediaEpisode from './mediaScreens/MediaEpisode/MediaEpisode';\r\nimport MediaEvent from './mediaScreens/MediaEvent/MediaEvent';\r\n\r\nexport const mediaScreenMap = new ScreenMap<PlaylistItem, ScreenComponent<PlaylistItem>>();\r\n\r\n// Register media screens\r\nmediaScreenMap.registerByContentType(MediaSeries, CONTENT_TYPE.series);\r\nmediaScreenMap.registerByContentType(MediaEpisode, CONTENT_TYPE.episode);\r\nmediaScreenMap.registerByContentType(MediaLiveChannel, CONTENT_TYPE.liveChannel);\r\nmediaScreenMap.registerByContentType(MediaEvent, CONTENT_TYPE.liveEvent);\r\nmediaScreenMap.registerByContentType(MediaStaticPage, CONTENT_TYPE.page);\r\nmediaScreenMap.registerDefault(MediaMovie);\r\n\r\n// Register legacy series and episode screens when `contentType` is missing\r\nmediaScreenMap.register(MediaEpisode, (item) => !!item && isEpisode(item));\r\nmediaScreenMap.register(MediaSeries, (item) => !!item && isLegacySeriesFlow(item));\r\n\r\nconst MediaScreenRouter = () => {\r\n  const params = useParams();\r\n  const id = params.id || '';\r\n  const { isLoading, isFetching, error, data } = useMedia(id);\r\n  const { t } = useTranslation('error');\r\n\r\n  if (isLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  if (error || !data) {\r\n    return <ErrorPage title={t('video_not_found')} />;\r\n  }\r\n\r\n  const MediaScreen = mediaScreenMap.getScreen(data);\r\n\r\n  return <MediaScreen data={data} isLoading={isFetching} />;\r\n};\r\n\r\nexport default MediaScreenRouter;\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Helmet } from 'react-helmet';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport type { Playlist, PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { filterPlaylist, getFiltersFromConfig } from '@jwp/ott-common/src/utils/collection';\r\nimport { mediaURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport CardGrid from '../../../../components/CardGrid/CardGrid';\r\nimport Filter from '../../../../components/Filter/Filter';\r\n\r\nimport styles from './PlaylistGrid.module.scss';\r\n\r\nconst PlaylistGrid: ScreenComponent<Playlist> = ({ data, isLoading }) => {\r\n  const { config, accessModel } = useConfigStore(({ config, accessModel }) => ({ config, accessModel }), shallow);\r\n\r\n  const [filter, setFilter] = useState<string>('');\r\n\r\n  const categories = getFiltersFromConfig(config, data.feedid);\r\n  const filteredPlaylist = useMemo(() => filterPlaylist(data, filter), [data, filter]);\r\n  const shouldShowFilter = Boolean(categories.length);\r\n\r\n  // User\r\n  const { user, subscription } = useAccountStore(({ user, subscription }) => ({ user, subscription }), shallow);\r\n\r\n  useEffect(() => {\r\n    // reset filter when the playlist id changes\r\n    setFilter('');\r\n  }, [data.feedid]);\r\n\r\n  const pageTitle = `${data.title} - ${config.siteName}`;\r\n\r\n  const getUrl = (playlistItem: PlaylistItem) => mediaURL({ media: playlistItem, playlistId: playlistItem.feedid });\r\n\r\n  return (\r\n    <div className={styles.playlist}>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n      </Helmet>\r\n      <div className={styles.main}>\r\n        <header className={styles.header}>\r\n          <h1>{data.title}</h1>\r\n          {shouldShowFilter && <Filter name=\"genre\" value={filter} defaultLabel=\"All\" options={categories} setValue={setFilter} />}\r\n        </header>\r\n        <CardGrid\r\n          getUrl={getUrl}\r\n          playlist={filteredPlaylist}\r\n          accessModel={accessModel}\r\n          isLoggedIn={!!user}\r\n          hasSubscription={!!subscription}\r\n          isLoading={isLoading}\r\n          headingLevel={2}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlaylistGrid;\r\n","import { isAfter, isFuture, isPast, subHours } from 'date-fns';\r\n\r\nimport type { EpgChannel, EpgProgram } from '../../types/epg';\r\n\r\n/**\r\n * Returns true when the program is currently live e.g. the startTime is before now and the endTime is after now\r\n */\r\nexport const programIsLive = (program: EpgProgram) => {\r\n  const startTime = new Date(program.startTime);\r\n  const endTime = new Date(program.endTime);\r\n\r\n  return isPast(startTime) && isFuture(endTime);\r\n};\r\n\r\n/**\r\n * Returns true when the program is finished.\r\n */\r\nexport const programIsVod = (program: EpgProgram) => {\r\n  const endTime = new Date(program.endTime);\r\n\r\n  return isPast(endTime);\r\n};\r\n\r\n/**\r\n * Returns true when the program is watchable from the beginning. This is when the startTime is within the live stream\r\n * archive length.\r\n */\r\nexport const programIsFullyWatchable = (program: EpgProgram, liveStreamCatchupHours = 8) => {\r\n  const startTime = new Date(program.startTime);\r\n  const maxStartTime = subHours(new Date(), liveStreamCatchupHours);\r\n\r\n  return isAfter(startTime, maxStartTime);\r\n};\r\n\r\n/**\r\n * Get the live program of the given channel\r\n */\r\nexport const getLiveProgram = (channel: EpgChannel) => {\r\n  return channel.programs.find(programIsLive);\r\n};\r\n","import { useQuery } from 'react-query';\r\nimport { useCallback, useEffect, useState } from 'react';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\nimport type { EpgChannel, EpgProgram } from '@jwp/ott-common/types/epg';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport { getLiveProgram, programIsLive } from '@jwp/ott-common/src/utils/epg';\r\nimport { LIVE_CHANNELS_REFETCH_INTERVAL } from '@jwp/ott-common/src/constants';\r\nimport EpgController from '@jwp/ott-common/src/controllers/EpgController';\r\n\r\n/**\r\n * This hook fetches the schedules for the given list of playlist items and manages the current channel and program.\r\n *\r\n * It automatically selects the initial channel (or first channel) and currently live program. It also updates the\r\n * program information when the current program is not live anymore.\r\n *\r\n * The `enableAutoUpdate` argument can be used to ignore the auto update mechanism. For example, when playing a live\r\n * program from the beginning, we don't want to update the program information in the middle of the program.\r\n *\r\n * @todo The `enableAutoUpdate` mechanism has a drawback, when used the program information will not be updated anymore.\r\n *       Meaning that when watching a program from the beginning, it will hold the current program until the user clicks\r\n *       on a different program. This can be solved when we implement syncing the stream PDT with the schedule. Then the\r\n *       program information will be reactive based on the current time in the stream.\r\n */\r\nconst useLiveChannels = ({\r\n  playlist,\r\n  initialChannelId,\r\n  enableAutoUpdate = true,\r\n}: {\r\n  playlist: PlaylistItem[];\r\n  initialChannelId: string | undefined;\r\n  enableAutoUpdate?: boolean;\r\n}) => {\r\n  const epgController = getModule(EpgController);\r\n\r\n  const { data: channels = [] } = useQuery(['schedules', ...playlist.map(({ mediaid }) => mediaid)], () => epgController.getSchedules(playlist), {\r\n    refetchInterval: LIVE_CHANNELS_REFETCH_INTERVAL,\r\n  });\r\n\r\n  const [autoUpdate, setAutoUpdate] = useState(enableAutoUpdate);\r\n  const [channel, setChannel] = useState<EpgChannel | undefined>();\r\n  const [program, setProgram] = useState<EpgProgram | undefined>();\r\n\r\n  // this effect updates the program when watching the live stream and the next program starts\r\n  useEffect(() => {\r\n    if (!autoUpdate || !enableAutoUpdate) return;\r\n\r\n    const intervalId = window.setInterval(() => channel && setProgram(getLiveProgram(channel)), 5_000);\r\n\r\n    return () => clearInterval(intervalId);\r\n  }, [channel, autoUpdate, enableAutoUpdate]);\r\n\r\n  // auto select initial channel (fallback to first channel) and program when the data is loaded\r\n  // update channel and program state with the latest data\r\n  useEffect(() => {\r\n    const selectedChannel = channels.find(({ id }) => id === initialChannelId) || channels[0];\r\n\r\n    // auto select first channel when no channel is selected\r\n    if (!channel && selectedChannel) {\r\n      setChannel(selectedChannel);\r\n\r\n      // auto select live program\r\n      setProgram(getLiveProgram(selectedChannel));\r\n    }\r\n\r\n    // update the current channel with the updated data\r\n    if (channel) {\r\n      const updatedChannel = channels.find(({ id }) => id === channel.id);\r\n\r\n      // find the current program in the updated data\r\n      let updatedProgram = program && updatedChannel?.programs.find(({ id }) => id === program?.id);\r\n\r\n      // if the program doesn't exist, use the live program\r\n      if (!updatedProgram && updatedChannel) {\r\n        updatedProgram = getLiveProgram(updatedChannel);\r\n      }\r\n\r\n      // update channel with potential updated programs\r\n      setChannel(updatedChannel);\r\n      setProgram(updatedProgram);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [channels]);\r\n\r\n  // update the selected channel and optionally the program\r\n  const setActiveChannel = useCallback(\r\n    (id: string, programId?: string) => {\r\n      const channel = channels?.find((channel) => channel.id === id);\r\n\r\n      // early return when no channel was found\r\n      if (!channel) {\r\n        return;\r\n      }\r\n\r\n      // select the found program or live program when no programId is given\r\n      const program = programId ? channel.programs.find((program) => program.id === programId) : getLiveProgram(channel);\r\n\r\n      setChannel(channel);\r\n      setProgram(program);\r\n\r\n      // enable auto update when there is no program information or when the program is live\r\n      // when the user clicks on a VOD item, we don't want to update the information automatically\r\n      setAutoUpdate(!program || programIsLive(program));\r\n    },\r\n    [channels],\r\n  );\r\n\r\n  return {\r\n    channel,\r\n    channels,\r\n    program,\r\n    setActiveChannel,\r\n  };\r\n};\r\n\r\nexport default useLiveChannels;\r\n","import { useEffect, useState } from 'react';\r\nimport type { EpgProgram } from '@jwp/ott-common/types/epg';\r\nimport { programIsFullyWatchable, programIsLive, programIsVod } from '@jwp/ott-common/src/utils/epg';\r\n\r\n/**\r\n * This hook returns memoized program state variables that change based on the given program and the current time.\r\n * For example, the live and VOD states, toggle when the program is not live anymore.\r\n */\r\nconst useLiveProgram = ({ program, catchupHours }: { program: EpgProgram | undefined; catchupHours: number | undefined }) => {\r\n  const [isLive, setIsLive] = useState(false);\r\n  const [isVod, setIsVod] = useState(false);\r\n  const [isWatchableFromBeginning, setIsWatchableFromBeginning] = useState(false);\r\n\r\n  // update when the program changes\r\n  useEffect(() => {\r\n    const calculateStatus = () => {\r\n      setIsLive(!!program && programIsLive(program));\r\n      setIsVod(!!program && programIsVod(program));\r\n      setIsWatchableFromBeginning(!!program && programIsFullyWatchable(program, catchupHours));\r\n    };\r\n\r\n    // recalculate the program status every 5 seconds\r\n    const intervalId = setInterval(calculateStatus, 5_000);\r\n\r\n    // immediately update the program status when the program changes\r\n    calculateStatus();\r\n\r\n    return () => clearInterval(intervalId);\r\n  }, [catchupHours, program]);\r\n\r\n  return {\r\n    isLive,\r\n    isVod,\r\n    isWatchableFromBeginning,\r\n  };\r\n};\r\n\r\nexport default useLiveProgram;\r\n","import { useMemo } from 'react';\r\nimport { useEpg } from 'planby';\r\nimport { startOfDay, startOfToday, startOfTomorrow } from 'date-fns';\r\nimport type { EpgChannel, EpgProgram } from '@jwp/ott-common/types/epg';\r\nimport { is12HourClock } from '@jwp/ott-common/src/utils/datetime';\r\n\r\nconst isBaseTimeFormat = is12HourClock();\r\n\r\nexport const formatChannel = ({ id, channelLogoImage, backgroundImage }: EpgChannel) => ({\r\n  uuid: id,\r\n  logo: channelLogoImage,\r\n  channelLogoImage: channelLogoImage,\r\n  backgroundImage: backgroundImage,\r\n});\r\n\r\nexport const formatProgram = (channelId: string, { id, title, cardImage, backgroundImage, description, endTime, startTime }: EpgProgram) => ({\r\n  channelUuid: channelId,\r\n  id: id,\r\n  title: title,\r\n  image: cardImage || '',\r\n  // programs have the same cardImage/backgroundImage (different API)\r\n  cardImage: cardImage || '',\r\n  backgroundImage: backgroundImage || '',\r\n  description: description || '',\r\n  till: endTime,\r\n  since: startTime,\r\n});\r\n\r\n/**\r\n * Return the Planby EPG props for the given channels\r\n */\r\nconst usePlanByEpg = ({\r\n  channels,\r\n  sidebarWidth,\r\n  itemHeight,\r\n  highlightColor,\r\n  backgroundColor,\r\n}: {\r\n  channels: EpgChannel[];\r\n  sidebarWidth: number;\r\n  itemHeight: number;\r\n  highlightColor?: string | null;\r\n  backgroundColor?: string | null;\r\n}) => {\r\n  const [epgChannels, epgPrograms] = useMemo(() => {\r\n    return [channels.map(formatChannel), channels.flatMap((channel) => channel.programs.map((program) => formatProgram(channel.id, program)))];\r\n  }, [channels]);\r\n\r\n  const theme = useMemo(() => makeTheme(highlightColor, backgroundColor), [highlightColor, backgroundColor]);\r\n\r\n  // this mechanism updates the EPG component range when leaving the page open for a longer period\r\n  // the useEpg hook doesn't accept a formatted date and re-renders when not memoize the start and end dates\r\n  // @todo ideally we want to render the schedule X hours before and after the current time, but this doesn't work (yet)\r\n  //       in the Planby component. E.g. `[subHours(new Date(), 12), addHours(new Date(), 12)]`. The `date` dependency\r\n  //       must also be changed to update every hour instead of daily.\r\n  const date = startOfToday().toJSON();\r\n  const [startDate, endDate] = useMemo(() => [startOfDay(new Date(date)), startOfTomorrow()], [date]);\r\n\r\n  return useEpg({\r\n    channels: epgChannels,\r\n    epg: epgPrograms,\r\n    dayWidth: 7200,\r\n    sidebarWidth,\r\n    itemHeight,\r\n    isSidebar: true,\r\n    isTimeline: true,\r\n    isLine: true,\r\n    isBaseTimeFormat,\r\n    startDate,\r\n    endDate,\r\n    theme,\r\n  });\r\n};\r\n\r\n// Theme configuration for the Planby EPG with only the colors set that are used\r\n// Fixed values are used because the default highlightColor and backgroundColor are only available in SCSS\r\nexport const makeTheme = (primaryColor?: string | null, backgroundColor?: string | null) => ({\r\n  primary: {\r\n    600: backgroundColor || '#141523',\r\n    900: backgroundColor || '#141523',\r\n  },\r\n  grey: {\r\n    300: primaryColor || '#fff',\r\n  },\r\n  white: primaryColor || '#fff',\r\n  green: {\r\n    300: primaryColor || '#fff',\r\n  },\r\n  loader: {\r\n    teal: '',\r\n    purple: '',\r\n    pink: '',\r\n    bg: '',\r\n  },\r\n  scrollbar: {\r\n    border: '',\r\n    thumb: {\r\n      bg: '',\r\n    },\r\n  },\r\n  gradient: {\r\n    blue: {\r\n      300: '',\r\n      600: '',\r\n      900: '',\r\n    },\r\n  },\r\n  text: {\r\n    grey: {\r\n      300: '',\r\n      500: '',\r\n    },\r\n  },\r\n  timeline: {\r\n    divider: {\r\n      bg: '',\r\n    },\r\n  },\r\n});\r\n\r\nexport default usePlanByEpg;\r\n","import React from 'react';\r\nimport type { Channel } from 'planby';\r\nimport classNames from 'classnames';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport Image from '../Image/Image';\r\n\r\nimport styles from './EpgChannelItem.module.scss';\r\n\r\ntype Props = {\r\n  channel: Channel;\r\n  channelItemWidth: number;\r\n  sidebarWidth: number;\r\n  onClick?: (channel: Channel) => void;\r\n  isActive: boolean;\r\n  title: string;\r\n};\r\n\r\nconst EpgChannelItem: React.VFC<Props> = ({ channel, channelItemWidth, sidebarWidth, onClick, isActive, title }) => {\r\n  const { position, uuid, channelLogoImage } = channel;\r\n  const style = { top: position.top, height: position.height, width: sidebarWidth };\r\n\r\n  return (\r\n    <div className={styles.epgChannelBox} style={style}>\r\n      <div\r\n        className={classNames(styles.epgChannel, { [styles.active]: isActive })}\r\n        style={{ width: channelItemWidth }}\r\n        onClick={() => onClick && onClick(channel)}\r\n        data-testid={testId(uuid)}\r\n        role=\"button\"\r\n      >\r\n        <Image className={styles.epgChannelLogo} image={channelLogoImage} alt={title} width={320} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EpgChannelItem;\r\n","import React from 'react';\r\nimport { useProgram, type Program } from 'planby';\r\nimport classNames from 'classnames';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport styles from './EpgProgramItem.module.scss';\r\n\r\ntype Props = {\r\n  program: Program;\r\n  onClick?: (program: Program) => void;\r\n  isActive: boolean;\r\n  compact: boolean;\r\n  disabled: boolean;\r\n  isBaseTimeFormat: boolean;\r\n};\r\n\r\nconst ProgramItem: React.VFC<Props> = ({ program, onClick, isActive, compact, disabled, isBaseTimeFormat }) => {\r\n  const {\r\n    styles: { position },\r\n    formatTime,\r\n    set12HoursTimeFormat,\r\n    isLive,\r\n    isMinWidth,\r\n  } = useProgram({\r\n    program,\r\n    isBaseTimeFormat,\r\n  });\r\n\r\n  const { t } = useTranslation('common');\r\n  const { data } = program;\r\n  const { image, title, since, till } = data;\r\n\r\n  const sinceTime = formatTime(since, set12HoursTimeFormat()).toLowerCase();\r\n  const tillTime = formatTime(till, set12HoursTimeFormat()).toLowerCase();\r\n\r\n  const showImage = !compact && isMinWidth;\r\n  const showLiveTagInImage = !compact && isMinWidth && isLive;\r\n  const alt = ''; // intentionally empty for a11y, because adjacent text alternative\r\n\r\n  return (\r\n    <div className={styles.epgProgramBox} style={position} onClick={() => onClick && onClick(program)}>\r\n      <div\r\n        className={classNames(styles.epgProgram, {\r\n          [styles.selected]: isActive,\r\n          [styles.live]: isLive,\r\n          [styles.disabled]: disabled,\r\n        })}\r\n        style={{ width: styles.width }}\r\n        data-testid={testId(program.data.id)}\r\n      >\r\n        {showImage && <img className={styles.epgProgramImage} src={image} alt={alt} />}\r\n        {showLiveTagInImage && <div className={styles.epgLiveTag}>{t('live')}</div>}\r\n        <div className={styles.epgProgramContent}>\r\n          {compact && isLive && <div className={styles.epgLiveTag}>{t('live')}</div>}\r\n          <h2 className={styles.epgProgramTitle}>{title}</h2>\r\n          <span className={styles.epgProgramText}>\r\n            {sinceTime} - {tillTime}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProgramItem;\r\n","import React from 'react';\r\nimport { useTimeline } from 'planby';\r\n\r\nimport styles from './EpgTimeline.module.scss';\r\n\r\ntype Props = {\r\n  isBaseTimeFormat: boolean;\r\n  isSidebar: boolean;\r\n  dayWidth: number;\r\n  hourWidth: number;\r\n  numberOfHoursInDay: number;\r\n  offsetStartHoursRange: number;\r\n  sidebarWidth: number;\r\n};\r\n\r\nconst EpgTimeline: React.VFC<Props> = ({ isBaseTimeFormat, dayWidth, hourWidth, numberOfHoursInDay, offsetStartHoursRange, isSidebar, sidebarWidth }) => {\r\n  const { time, dividers, formatTime } = useTimeline(numberOfHoursInDay, isBaseTimeFormat);\r\n\r\n  const renderDividers = () => dividers.map((_, index) => <div className={styles.timelineDivider} key={index} style={{ marginRight: hourWidth / 4 }} />);\r\n\r\n  const renderTime = (index: number) => (\r\n    <div className={styles.timelineBox} key={index} style={{ width: hourWidth }}>\r\n      <time className={styles.timelineTime}>{formatTime(index + offsetStartHoursRange).toLowerCase()}</time>\r\n      <div className={styles.timelineDividers}>{renderDividers()}</div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className={styles.timelineContainer} style={{ width: dayWidth, left: isSidebar ? sidebarWidth : 0 }}>\r\n      {time.map((_, index) => renderTime(index))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EpgTimeline;\r\n","import { Epg as EpgContainer, Layout } from 'planby';\r\nimport React, { useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { isBefore, subHours } from 'date-fns';\r\nimport type { EpgChannel, EpgProgram } from '@jwp/ott-common/types/epg';\r\nimport type { Config } from '@jwp/ott-common/types/config';\r\nimport usePlanByEpg from '@jwp/ott-hooks-react/src/usePlanByEpg';\r\nimport ChevronRight from '@jwp/ott-theme/assets/icons/chevron_right.svg?react';\r\nimport ChevronLeft from '@jwp/ott-theme/assets/icons/chevron_left.svg?react';\r\nimport useBreakpoint, { Breakpoint } from '@jwp/ott-ui-react/src/hooks/useBreakpoint';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Button from '../Button/Button';\r\nimport EpgChannelItem from '../EpgChannel/EpgChannelItem';\r\nimport EpgProgramItem from '../EpgProgramItem/EpgProgramItem';\r\nimport EpgTimeline from '../EpgTimeline/EpgTimeline';\r\nimport Spinner from '../Spinner/Spinner';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './Epg.module.scss';\r\n\r\ntype Props = {\r\n  channels: EpgChannel[];\r\n  onChannelClick: (channelId: string) => void;\r\n  onProgramClick: (programId: string, channelId: string) => void;\r\n  selectedChannel: EpgChannel | undefined;\r\n  program: EpgProgram | undefined;\r\n  config: Config;\r\n};\r\n\r\nexport default function Epg({ channels, selectedChannel, onChannelClick, onProgramClick, program, config }: Props) {\r\n  const breakpoint = useBreakpoint();\r\n  const { t } = useTranslation('common');\r\n\r\n  const isMobile = breakpoint < Breakpoint.sm;\r\n  const sidebarWidth = isMobile ? 70 : 184;\r\n  // the subtracted value is used for spacing in the sidebar\r\n  const channelItemWidth = isMobile ? sidebarWidth - 10 : sidebarWidth - 24;\r\n  const itemHeight = isMobile ? 80 : 106;\r\n\r\n  // Epg\r\n  const { highlightColor, backgroundColor } = config.styling;\r\n  const { getEpgProps, getLayoutProps, onScrollToNow, onScrollLeft, onScrollRight } = usePlanByEpg({\r\n    channels,\r\n    sidebarWidth,\r\n    itemHeight,\r\n    highlightColor,\r\n    backgroundColor,\r\n  });\r\n  const catchupHoursDict = useMemo(() => Object.fromEntries(channels.map((channel) => [channel.id, channel.catchupHours])), [channels]);\r\n  const titlesDict = useMemo(() => Object.fromEntries(channels.map((channel) => [channel.id, channel.title])), [channels]);\r\n\r\n  return (\r\n    <div className={styles.epg}>\r\n      <div className={styles.timelineControl}>\r\n        <Button className={styles.timelineNowButton} variant=\"contained\" label={t('now')} color=\"primary\" onClick={onScrollToNow} size=\"small\" />\r\n        <IconButton className={styles.leftControl} aria-label={t('slide_left')} onClick={() => onScrollLeft()}>\r\n          <Icon icon={ChevronLeft} />\r\n        </IconButton>\r\n        <IconButton className={styles.rightControl} aria-label={t('slide_right')} onClick={() => onScrollRight()}>\r\n          <Icon icon={ChevronRight} />\r\n        </IconButton>\r\n      </div>\r\n      <EpgContainer {...getEpgProps()} loader={<Spinner className={styles.epgSpinner} />}>\r\n        <Layout\r\n          {...getLayoutProps()}\r\n          renderTimeline={(props) => <EpgTimeline {...props} />}\r\n          renderChannel={({ channel: epgChannel }) => (\r\n            <EpgChannelItem\r\n              key={epgChannel.uuid}\r\n              channel={epgChannel}\r\n              channelItemWidth={channelItemWidth}\r\n              sidebarWidth={sidebarWidth}\r\n              onClick={(toChannel) => {\r\n                onChannelClick(toChannel.uuid);\r\n                onScrollToNow();\r\n              }}\r\n              title={titlesDict[epgChannel.uuid] || ''}\r\n              isActive={selectedChannel?.id === epgChannel.uuid}\r\n            />\r\n          )}\r\n          renderProgram={({ program: programItem, isBaseTimeFormat }) => {\r\n            const catchupHours = catchupHoursDict[programItem.data.channelUuid];\r\n            const disabled = isBefore(new Date(programItem.data.since), subHours(new Date(), catchupHours));\r\n\r\n            return (\r\n              <EpgProgramItem\r\n                key={programItem.data.id}\r\n                program={programItem}\r\n                disabled={disabled}\r\n                onClick={(program) => !disabled && onProgramClick(program.data.id, program.data.channelUuid)}\r\n                isActive={program?.id === programItem.data.id}\r\n                compact={isMobile}\r\n                isBaseTimeFormat={isBaseTimeFormat}\r\n              />\r\n            );\r\n          }}\r\n        />\r\n      </EpgContainer>\r\n    </div>\r\n  );\r\n}\r\n","import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Helmet } from 'react-helmet';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { differenceInSeconds, format } from 'date-fns';\r\nimport type { Playlist } from '@jwp/ott-common/types/playlist';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { formatDurationTag } from '@jwp/ott-common/src/utils/formatting';\r\nimport { createURL, liveChannelsURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { generateMovieJSONLD } from '@jwp/ott-common/src/utils/structuredData';\r\nimport useLiveChannels from '@jwp/ott-hooks-react/src/useLiveChannels';\r\nimport useEntitlement from '@jwp/ott-hooks-react/src/useEntitlement';\r\nimport useLiveProgram from '@jwp/ott-hooks-react/src/useLiveProgram';\r\nimport Play from '@jwp/ott-theme/assets/icons/play.svg?react';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport Epg from '../../../../components/Epg/Epg';\r\nimport ShareButton from '../../../../components/ShareButton/ShareButton';\r\nimport StartWatchingButton from '../../../../containers/StartWatchingButton/StartWatchingButton';\r\nimport Cinema from '../../../../containers/Cinema/Cinema';\r\nimport Button from '../../../../components/Button/Button';\r\nimport Tag from '../../../../components/Tag/Tag';\r\nimport Loading from '../../../Loading/Loading';\r\nimport VideoDetails from '../../../../components/VideoDetails/VideoDetails';\r\nimport Icon from '../../../../components/Icon/Icon';\r\nimport VideoMetaData from '../../../../components/VideoMetaData/VideoMetaData';\r\n\r\nimport styles from './PlaylistLiveChannels.module.scss';\r\n\r\nconst PlaylistLiveChannels: ScreenComponent<Playlist> = ({ data: { feedid, playlist } }) => {\r\n  const { t } = useTranslation('epg');\r\n\r\n  // Config\r\n  const { config } = useConfigStore(({ config }) => ({ config }), shallow);\r\n  const { siteName } = config;\r\n\r\n  // Routing\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const searchParams = useMemo(() => new URLSearchParams(location.search), [location.search]);\r\n  const play = searchParams.get('play') === '1';\r\n  const channelId = searchParams.get('channel') ?? undefined;\r\n  const liveStartDateTime = searchParams.get('start');\r\n  const liveEndDateTime = searchParams.get('end');\r\n  const liveFromBeginning = searchParams.get('beginning') === '1';\r\n  const goBack = () => feedid && navigate(liveChannelsURL(feedid, channelId));\r\n\r\n  // EPG data\r\n  const [initialChannelId] = useState(channelId);\r\n  const { channels, channel, program, setActiveChannel } = useLiveChannels({ playlist, initialChannelId, enableAutoUpdate: !liveFromBeginning });\r\n  const { isLive, isVod, isWatchableFromBeginning } = useLiveProgram({ program, catchupHours: channel?.catchupHours });\r\n\r\n  // Media item\r\n  const channelMediaItem = useMemo(() => playlist.find(({ mediaid }) => channel?.id === mediaid), [channel?.id, playlist]);\r\n  const { isEntitled } = useEntitlement(channelMediaItem);\r\n\r\n  const videoDetails = useMemo(() => {\r\n    if (program) {\r\n      return {\r\n        title: program.title,\r\n        description: program.description || '',\r\n        image: program.backgroundImage,\r\n        canWatch: isLive || (isVod && isWatchableFromBeginning),\r\n        canWatchFromBeginning: isEntitled && isLive && isWatchableFromBeginning,\r\n      };\r\n    }\r\n\r\n    return {\r\n      title: channel?.title || '',\r\n      description: channel?.description || '',\r\n      image: channel?.backgroundImage,\r\n      canWatch: true,\r\n      canWatchFromBeginning: false,\r\n    };\r\n  }, [channel?.backgroundImage, channel?.description, channel?.title, isEntitled, isLive, isVod, isWatchableFromBeginning, program]);\r\n\r\n  const primaryMetadata = useMemo(() => {\r\n    if (!channel) {\r\n      return '';\r\n    }\r\n\r\n    if (!program) {\r\n      return <Tag isLive>{t('common:live')}</Tag>;\r\n    }\r\n\r\n    const startTime = new Date(program.startTime);\r\n    const endTime = new Date(program.endTime);\r\n    const durationInSeconds = differenceInSeconds(endTime, startTime);\r\n    const duration = formatDurationTag(durationInSeconds);\r\n    const attributes = [t('on_channel', { name: channel.title }), duration].filter(Boolean);\r\n\r\n    return (\r\n      <>\r\n        <Tag className={styles.tag} isLive={isLive}>\r\n          {isLive ? t('common:live') : `${format(startTime, 'p')} - ${format(endTime, 'p')}`}\r\n        </Tag>\r\n        <VideoMetaData attributes={attributes} />\r\n      </>\r\n    );\r\n  }, [channel, isLive, program, t]);\r\n\r\n  // Handlers\r\n  const handleProgramClick = (programId: string, channelId: string) => {\r\n    setActiveChannel(channelId, programId);\r\n\r\n    // scroll to top when clicking a program\r\n    (document.scrollingElement || document.body).scroll({ top: 0, behavior: 'smooth' });\r\n  };\r\n\r\n  const handleChannelClick = (channelId: string) => {\r\n    setActiveChannel(channelId);\r\n  };\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    // update the channel id in URL\r\n    if (channel && feedid && channelId !== channel.id) {\r\n      navigate(liveChannelsURL(feedid, channel.id), { replace: true });\r\n    }\r\n  }, [navigate, feedid, channel, channelId]);\r\n\r\n  // Loading (channel and feedid must be defined)\r\n  if (!channel || !feedid) {\r\n    return <Loading />;\r\n  }\r\n\r\n  // SEO (for channels)\r\n  // const getUrl = (id: string) => liveChannelsURL(feedid, id);\r\n  const canonicalUrl = `${window.location.origin}${liveChannelsURL(feedid, channel.id)}`;\r\n  const pageTitle = `${channel.title} - ${siteName}`;\r\n\r\n  const shareButton = channelMediaItem ? (\r\n    <ShareButton title={channelMediaItem.title} description={channelMediaItem.description} url={window.location.href} />\r\n  ) : null;\r\n\r\n  // @todo: bring all props to liveChannelsURL, so that createURL isn't needed\r\n  const startWatchingButton = channelMediaItem ? (\r\n    <>\r\n      <StartWatchingButton\r\n        item={channelMediaItem}\r\n        playUrl={createURL(liveChannelsURL(feedid, channelId, true), {\r\n          start: isVod ? program?.startTime : undefined,\r\n          end: isVod ? program?.endTime : undefined,\r\n        })}\r\n        disabled={!videoDetails.canWatch}\r\n      />\r\n      {videoDetails.canWatchFromBeginning && (\r\n        <Button\r\n          className={styles.catchupButton}\r\n          onClick={() =>\r\n            navigate(\r\n              createURL(liveChannelsURL(feedid || '', channelId, true), {\r\n                start: program?.startTime,\r\n                beginning: 1,\r\n              }),\r\n            )\r\n          }\r\n          label={t('start_from_beginning')}\r\n          startIcon={<Icon icon={Play} />}\r\n        />\r\n      )}\r\n    </>\r\n  ) : null;\r\n\r\n  return (\r\n    <>\r\n      <Helmet>\r\n        <title>{pageTitle}</title>\r\n        <link rel=\"canonical\" href={canonicalUrl} />\r\n        <meta name=\"description\" content={channelMediaItem?.description} />\r\n        <meta property=\"og:description\" content={channelMediaItem?.description} />\r\n        <meta property=\"og:title\" content={pageTitle} />\r\n        <meta property=\"og:type\" content=\"video.other\" />\r\n        {channelMediaItem?.image && <meta property=\"og:image\" content={channelMediaItem.image?.replace(/^https:/, 'http:')} />}\r\n        {channelMediaItem?.image && <meta property=\"og:image:secure_url\" content={channelMediaItem.image?.replace(/^http:/, 'https:')} />}\r\n        <meta property=\"og:image:width\" content={channelMediaItem?.image ? '720' : ''} />\r\n        <meta property=\"og:image:height\" content={channelMediaItem?.image ? '406' : ''} />\r\n        <meta name=\"twitter:title\" content={pageTitle} />\r\n        <meta name=\"twitter:description\" content={channelMediaItem?.description} />\r\n        <meta name=\"twitter:image\" content={channelMediaItem?.image} />\r\n        <meta property=\"og:video\" content={canonicalUrl.replace(/^https:/, 'http:')} />\r\n        <meta property=\"og:video:secure_url\" content={canonicalUrl.replace(/^http:/, 'https:')} />\r\n        <meta property=\"og:video:type\" content=\"text/html\" />\r\n        <meta property=\"og:video:width\" content=\"1280\" />\r\n        <meta property=\"og:video:height\" content=\"720\" />\r\n        {channelMediaItem?.tags?.split(',').map((tag) => (\r\n          <meta property=\"og:video:tag\" content={tag} key={tag} />\r\n        ))}\r\n        {channelMediaItem ? <script type=\"application/ld+json\">{generateMovieJSONLD(channelMediaItem, window.location.origin)}</script> : null}\r\n      </Helmet>\r\n      <VideoDetails\r\n        title={videoDetails.title}\r\n        description={videoDetails.description}\r\n        image={videoDetails.image}\r\n        startWatchingButton={startWatchingButton}\r\n        shareButton={shareButton}\r\n        primaryMetadata={primaryMetadata}\r\n      >\r\n        {channelMediaItem && (\r\n          <Cinema\r\n            open={play && isEntitled}\r\n            onClose={goBack}\r\n            item={channelMediaItem}\r\n            title={videoDetails.title}\r\n            primaryMetadata={primaryMetadata}\r\n            feedId={feedid}\r\n            liveStartDateTime={liveStartDateTime}\r\n            liveEndDateTime={liveEndDateTime}\r\n            liveFromBeginning={liveFromBeginning}\r\n          />\r\n        )}\r\n        <div className={styles.epgContainer}>\r\n          <Epg\r\n            channels={channels}\r\n            onChannelClick={handleChannelClick}\r\n            onProgramClick={handleProgramClick}\r\n            selectedChannel={channel}\r\n            program={program}\r\n            config={config}\r\n          />\r\n        </div>\r\n      </VideoDetails>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PlaylistLiveChannels;\r\n","import React from 'react';\r\nimport { useParams } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport type { Playlist } from '@jwp/ott-common/types/playlist';\r\nimport { CONTENT_TYPE } from '@jwp/ott-common/src/constants';\r\nimport { ScreenMap } from '@jwp/ott-common/src/utils/ScreenMap';\r\nimport usePlaylist from '@jwp/ott-hooks-react/src/usePlaylist';\r\n\r\nimport Loading from '../Loading/Loading';\r\nimport ErrorPage from '../../components/ErrorPage/ErrorPage';\r\nimport type { ScreenComponent } from '../../../types/screens';\r\n\r\nimport PlaylistGrid from './playlistScreens/PlaylistGrid/PlaylistGrid';\r\nimport PlaylistLiveChannels from './playlistScreens/PlaylistLiveChannels/PlaylistLiveChannels';\r\n\r\nexport const playlistScreenMap = new ScreenMap<Playlist, ScreenComponent<Playlist>>();\r\n\r\n// register playlist screens\r\nplaylistScreenMap.registerByContentType(PlaylistLiveChannels, CONTENT_TYPE.live);\r\nplaylistScreenMap.registerDefault(PlaylistGrid);\r\n\r\nconst PlaylistScreenRouter = () => {\r\n  const params = useParams();\r\n  const id = params.id || '';\r\n  const { isLoading, isFetching, error, data } = usePlaylist(id);\r\n  const { t } = useTranslation('error');\r\n\r\n  if (isLoading) {\r\n    return <Loading />;\r\n  }\r\n\r\n  if (error || !data) {\r\n    return <ErrorPage title={t('playlist_not_found')} />;\r\n  }\r\n\r\n  if (data.playlist.length === 0) {\r\n    return <ErrorPage title={t('empty_shelves_heading')} message={t('empty_shelves_description')} />;\r\n  }\r\n\r\n  const PlaylistScreen = playlistScreenMap.getScreen(data);\r\n\r\n  return <PlaylistScreen data={data} isLoading={isFetching} />;\r\n};\r\n\r\nexport default PlaylistScreenRouter;\r\n","import React, { type PropsWithChildren } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\ntype TypeHeader = 'static' | 'fixed';\r\n\r\ntype Props = {\r\n  headerType?: TypeHeader;\r\n  searchActive: boolean;\r\n};\r\n\r\nconst Header = ({ children, headerType = 'static', searchActive }: PropsWithChildren<Props>) => {\r\n  const headerClassName = classNames(styles.header, styles[headerType], {\r\n    [styles.searchActive]: searchActive,\r\n  });\r\n\r\n  return (\r\n    <header className={headerClassName}>\r\n      <div className={styles.container}>{children}</div>\r\n    </header>\r\n  );\r\n};\r\nexport default Header;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { IS_DEVELOPMENT_BUILD } from '@jwp/ott-common/src/utils/common';\r\n\r\nimport MarkdownComponent from '../MarkdownComponent/MarkdownComponent';\r\n\r\nimport styles from './Footer.module.scss';\r\n\r\ntype Props = {\r\n  text: string;\r\n};\r\n\r\nconst Footer: React.FC<Props> = ({ text }) => {\r\n  const chunks = text.split('|').map((chuck) => chuck.trim());\r\n  const footerContent = chunks.map((value, index) => <MarkdownComponent key={index} markdownString={value} inline tag={chunks.length > 1 ? 'li' : 'div'} />);\r\n  const wrapper = chunks.length > 1 ? <ul className={styles.list}>{footerContent}</ul> : footerContent;\r\n\r\n  return (\r\n    // The extra style below is just to fix the footer on mobile when the dev selector is shown\r\n    <footer className={classNames(styles.footer, { [styles.testFixMargin]: IS_DEVELOPMENT_BUILD })}>{wrapper}</footer>\r\n  );\r\n};\r\n\r\nexport default Footer;\r\n","import * as React from \"react\";\nconst SvgMenu = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M0 0h24v24H0V0z\", fill: \"none\" }), /* @__PURE__ */ React.createElement(\"path\", { d: \"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z\" }));\nexport default SvgMenu;\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Menu from '@jwp/ott-theme/assets/icons/menu.svg?react';\r\n\r\nimport Icon from '../Icon/Icon';\r\nimport IconButton from '../IconButton/IconButton';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\nconst HeaderMenu = ({ sideBarOpen, onClick }: { sideBarOpen: boolean; onClick: () => void }) => {\r\n  const { t } = useTranslation('menu');\r\n\r\n  return (\r\n    <div className={styles.menu}>\r\n      <IconButton className={styles.iconButton} aria-label={t('open_menu')} aria-expanded={sideBarOpen} onClick={onClick}>\r\n        <Icon icon={Menu} />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HeaderMenu;\r\n","import React from 'react';\r\n\r\nimport Button from '../Button/Button';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\ntype NavItem = {\r\n  label: string;\r\n  to: string;\r\n};\r\n\r\nconst HeaderNavigation = ({ navItems }: { navItems: NavItem[] }) => {\r\n  return (\r\n    <nav className={styles.nav}>\r\n      <ul>\r\n        {navItems.map((item, index) => (\r\n          <li key={index}>\r\n            <Button activeClassname={styles.navButton} label={item.label} to={item.to} variant=\"text\" />\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default HeaderNavigation;\r\n","import React, { useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport styles from './Logo.module.scss';\r\n\r\ntype Props = {\r\n  src: string;\r\n  alt?: string;\r\n  onLoad: () => void;\r\n};\r\n\r\ntype ImgRef = {\r\n  height?: number;\r\n  width?: number;\r\n};\r\n\r\nconst Logo: React.FC<Props> = ({ src, alt = 'logo', onLoad }: Props) => {\r\n  const [imgDimensions, updateImgDimensions] = useState<ImgRef>({ height: undefined, width: undefined });\r\n\r\n  const onLoadHandler = (event: React.SyntheticEvent<HTMLImageElement, Event>) => {\r\n    const { height, width } = event.currentTarget;\r\n    updateImgDimensions({ height, width });\r\n    onLoad();\r\n  };\r\n\r\n  return (\r\n    <Link to=\"/\">\r\n      <img className={styles.logo} alt={alt} src={src} height={imgDimensions.height} width={imgDimensions.width} onLoad={onLoadHandler} onError={onLoad} />\r\n    </Link>\r\n  );\r\n};\r\n\r\nexport default Logo;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport Logo from '../Logo/Logo';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\ntype Props = {\r\n  siteName?: string;\r\n  logoSrc?: string | null;\r\n  setLogoLoaded: (loaded: boolean) => void;\r\n};\r\n\r\nconst HeaderBrand = ({ siteName, logoSrc, setLogoLoaded }: Props) => {\r\n  const { t } = useTranslation('menu');\r\n\r\n  if (!logoSrc) return null;\r\n\r\n  return (\r\n    <div className={styles.brand}>\r\n      <Logo alt={t('logo_alt', { siteName })} src={logoSrc} onLoad={() => setLogoLoaded(true)} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HeaderBrand;\r\n","import React, { type PropsWithChildren } from 'react';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\nconst HeaderActions = ({ children }: PropsWithChildren) => {\r\n  return <div className={styles.actions}>{children}</div>;\r\n};\r\n\r\nexport default HeaderActions;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\nconst HeaderSkipLink = () => {\r\n  const { t } = useTranslation('menu');\r\n  return (\r\n    <a href=\"#content\" className={styles.skipToContent}>\r\n      {t('skip_to_content')}\r\n    </a>\r\n  );\r\n};\r\n\r\nexport default HeaderSkipLink;\r\n","import React, { type ReactNode } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Close from '@jwp/ott-theme/assets/icons/close.svg?react';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Icon from '../Icon/Icon';\r\nimport Modal, { type AnimationProps } from '../Modal/Modal';\r\nimport Slide from '../Animation/Slide/Slide';\r\n\r\nimport styles from './Sidebar.module.scss';\r\n\r\ntype SidebarProps = {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  children?: ReactNode;\r\n};\r\n\r\nconst SlideLeft = ({ children, ...props }: AnimationProps) => (\r\n  <Slide direction=\"left\" {...props}>\r\n    {children}\r\n  </Slide>\r\n);\r\n\r\nconst Sidebar: React.FC<SidebarProps> = ({ isOpen, onClose, children }) => {\r\n  const { t } = useTranslation('menu');\r\n\r\n  return (\r\n    <Modal open={isOpen} onClose={onClose} AnimationComponent={SlideLeft}>\r\n      <div className={styles.sidebar} id=\"sidebar\">\r\n        <div className={styles.heading}>\r\n          <IconButton onClick={onClose} aria-label={t('close_menu')}>\r\n            <Icon icon={Close} />\r\n          </IconButton>\r\n        </div>\r\n        <nav className={styles.group} onClick={onClose}>\r\n          {children}\r\n        </nav>\r\n      </div>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default Sidebar;\r\n","import React from 'react';\r\nimport { NavLink } from 'react-router-dom';\r\nimport classNames from 'classnames';\r\n\r\nimport styles from './MenuButton.module.scss';\r\n\r\ntype Props = {\r\n  label?: string;\r\n  to?: string;\r\n  onClick?: () => void;\r\n  onBlur?: () => void;\r\n  onFocus?: () => void;\r\n  tabIndex?: number;\r\n  active?: boolean;\r\n  startIcon?: React.ReactElement;\r\n  small?: boolean;\r\n} & React.AriaAttributes;\r\n\r\nconst MenuButton: React.FC<Props> = ({ label, to, onClick, onBlur, onFocus, tabIndex = 0, active = false, startIcon, small = false, ...rest }: Props) => {\r\n  const icon = startIcon ? <div className={styles.startIcon}>{startIcon}</div> : null;\r\n  const getClassName = (isActive: boolean) => classNames(styles.menuButton, { [styles.small]: small }, { [styles.active]: isActive });\r\n\r\n  if (to) {\r\n    return (\r\n      <NavLink\r\n        onBlur={onBlur}\r\n        onFocus={onFocus}\r\n        onClick={onClick}\r\n        className={({ isActive }) => getClassName(isActive || active)}\r\n        to={to}\r\n        tabIndex={tabIndex}\r\n        end\r\n      >\r\n        {icon}\r\n        <span className={styles.label}>{label}</span>\r\n      </NavLink>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div role=\"button\" onBlur={onBlur} onFocus={onFocus} className={getClassName(active)} onClick={onClick} tabIndex={tabIndex} {...rest}>\r\n      {icon}\r\n      <span className={styles.label}>{label}</span>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MenuButton;\r\n","import React, { useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useTranslation } from 'react-i18next';\r\nimport classNames from 'classnames';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport AccountCircle from '@jwp/ott-theme/assets/icons/account_circle.svg?react';\r\nimport Favorite from '@jwp/ott-theme/assets/icons/favorite.svg?react';\r\nimport BalanceWallet from '@jwp/ott-theme/assets/icons/balance_wallet.svg?react';\r\nimport Exit from '@jwp/ott-theme/assets/icons/exit.svg?react';\r\nimport { PATH_USER_ACCOUNT, PATH_USER_FAVORITES, PATH_USER_PAYMENTS } from '@jwp/ott-common/src/paths';\r\nimport type { Profile } from '@jwp/ott-common/types/profiles';\r\n\r\nimport styles from '../UserMenu/UserMenu.module.scss'; // TODO inherit styling\r\nimport MenuButton from '../MenuButton/MenuButton';\r\nimport Icon from '../Icon/Icon';\r\n\r\ntype Props = {\r\n  small?: boolean;\r\n  focusable: boolean;\r\n  showPaymentItems: boolean;\r\n  onButtonClick?: () => void;\r\n  titleId?: string;\r\n  currentProfile?: Profile | null;\r\n  favoritesEnabled?: boolean;\r\n};\r\n\r\nconst UserMenuNav = ({ showPaymentItems, small = false, onButtonClick, favoritesEnabled, focusable, titleId }: Props) => {\r\n  const { t } = useTranslation('user');\r\n  const navigate = useNavigate();\r\n  const accountController = getModule(AccountController);\r\n  const tabIndex = focusable ? 0 : -1;\r\n\r\n  const onLogout = useCallback(async () => {\r\n    if (onButtonClick) {\r\n      onButtonClick();\r\n    }\r\n\r\n    await accountController.logout();\r\n    navigate('/', { replace: true });\r\n  }, [onButtonClick, navigate, accountController]);\r\n\r\n  return (\r\n    <>\r\n      <h2 className={styles.sectionHeader} id={titleId}>\r\n        {t('nav.settings')}\r\n      </h2>\r\n      <ul className={styles.menuItems}>\r\n        <li>\r\n          <MenuButton\r\n            small={small}\r\n            onClick={onButtonClick}\r\n            to={PATH_USER_ACCOUNT}\r\n            label={t('nav.account')}\r\n            startIcon={<Icon icon={AccountCircle} />}\r\n            tabIndex={tabIndex}\r\n          />\r\n        </li>\r\n        {favoritesEnabled && (\r\n          <li>\r\n            <MenuButton\r\n              small={small}\r\n              onClick={onButtonClick}\r\n              to={PATH_USER_FAVORITES}\r\n              label={t('nav.favorites')}\r\n              startIcon={<Icon icon={Favorite} />}\r\n              tabIndex={tabIndex}\r\n            />\r\n          </li>\r\n        )}\r\n        {showPaymentItems && (\r\n          <li>\r\n            <MenuButton\r\n              small={small}\r\n              onClick={onButtonClick}\r\n              to={PATH_USER_PAYMENTS}\r\n              label={t('nav.payments')}\r\n              startIcon={<Icon icon={BalanceWallet} />}\r\n              tabIndex={tabIndex}\r\n            />\r\n          </li>\r\n        )}\r\n        <li className={classNames(styles.divider, { [styles.small]: small })}>\r\n          <MenuButton small={small} onClick={onLogout} label={t('nav.logout')} startIcon={<Icon icon={Exit} />} tabIndex={tabIndex} />\r\n        </li>\r\n      </ul>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default UserMenuNav;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { playlistURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport useOpaqueId from '@jwp/ott-hooks-react/src/useOpaqueId';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\n\r\nimport Button from '../../components/Button/Button';\r\nimport Sidebar from '../../components/Sidebar/Sidebar';\r\nimport MenuButton from '../../components/MenuButton/MenuButton';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\nimport UserMenuNav from '../../components/UserMenuNav/UserMenuNav';\r\n\r\nimport styles from './SidebarContainer.module.scss';\r\n\r\nconst SidebarUserActions = ({\r\n  sideBarOpen,\r\n  canLogin,\r\n  isLoggedIn,\r\n  favoritesEnabled,\r\n  onLoginClick,\r\n  onSignUpClick,\r\n}: {\r\n  sideBarOpen: boolean;\r\n  canLogin: boolean;\r\n  isLoggedIn: boolean;\r\n  favoritesEnabled: boolean;\r\n  onLoginClick: () => void;\r\n  onSignUpClick: () => void;\r\n}) => {\r\n  const { t } = useTranslation('menu');\r\n  const userMenuTitleId = useOpaqueId('usermenu-title');\r\n\r\n  if (!canLogin) return null;\r\n\r\n  return isLoggedIn ? (\r\n    <section aria-labelledby={userMenuTitleId}>\r\n      <UserMenuNav focusable={sideBarOpen} favoritesEnabled={favoritesEnabled} titleId={userMenuTitleId} showPaymentItems />\r\n    </section>\r\n  ) : (\r\n    <div className={styles.buttonContainer}>\r\n      <Button tabIndex={sideBarOpen ? 0 : -1} onClick={onLoginClick} label={t('sign_in')} fullWidth />\r\n      <Button tabIndex={sideBarOpen ? 0 : -1} variant=\"contained\" color=\"primary\" onClick={onSignUpClick} label={t('sign_up')} fullWidth />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst SidebarContainer = () => {\r\n  const { t } = useTranslation('common');\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const sideBarOpen = useUIStore((state) => state.sideBarOpen);\r\n  const {\r\n    config: { menu, features },\r\n    accessModel,\r\n  } = useConfigStore((state) => ({\r\n    config: state.config,\r\n    accessModel: state.accessModel,\r\n  }));\r\n  const isLoggedIn = useAccountStore(({ user }) => !!user);\r\n\r\n  const favoritesEnabled = !!features?.favoritesList;\r\n  const canLogin = accessModel !== ACCESS_MODEL.AVOD;\r\n\r\n  const closeSideBar = () => useUIStore.setState({ sideBarOpen: false });\r\n\r\n  const loginButtonClickHandler = () => {\r\n    navigate(modalURLFromLocation(location, 'login'));\r\n  };\r\n\r\n  const signUpButtonClickHandler = () => {\r\n    navigate(modalURLFromLocation(location, 'create-account'));\r\n  };\r\n\r\n  return (\r\n    <Sidebar isOpen={sideBarOpen} onClose={closeSideBar}>\r\n      <ul>\r\n        <li>\r\n          <MenuButton label={t('home')} to=\"/\" />\r\n        </li>\r\n        {menu.map((item) => (\r\n          <li key={item.contentId}>\r\n            <MenuButton label={item.label} to={playlistURL(item.contentId)} />\r\n          </li>\r\n        ))}\r\n      </ul>\r\n      <hr className={styles.separator} />\r\n      <SidebarUserActions\r\n        sideBarOpen={sideBarOpen}\r\n        favoritesEnabled={favoritesEnabled}\r\n        canLogin={canLogin}\r\n        isLoggedIn={isLoggedIn}\r\n        onLoginClick={loginButtonClickHandler}\r\n        onSignUpClick={signUpButtonClickHandler}\r\n      />\r\n    </Sidebar>\r\n  );\r\n};\r\n\r\nexport default SidebarContainer;\r\n","import { Helmet } from 'react-helmet';\r\nimport React from 'react';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst SiteMetadata = () => {\r\n  const { t } = useTranslation('common');\r\n  const { siteName, description } = useConfigStore(({ config }) => config, shallow);\r\n  const metaDescription = description || t('default_description');\r\n\r\n  return (\r\n    <Helmet>\r\n      <title>{siteName}</title>\r\n      <meta name=\"description\" content={metaDescription} />\r\n      <meta property=\"og:description\" content={metaDescription} />\r\n      <meta property=\"og:title\" content={siteName} />\r\n      <meta name=\"twitter:title\" content={siteName} />\r\n      <meta name=\"twitter:description\" content={metaDescription} />\r\n    </Helmet>\r\n  );\r\n};\r\n\r\nexport default SiteMetadata;\r\n","import * as React from \"react\";\nconst SvgSearch = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\" }));\nexport default SvgSearch;\n","import * as React from \"react\";\nconst SvgCancel = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { d: \"M9 1C4.58 1 1 4.58 1 9s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4 10.87L11.87 13 9 10.13 6.13 13 5 11.87 7.87 9 5 6.13 6.13 5 9 7.87 11.87 5 13 6.13 10.13 9 13 11.87z\" }));\nexport default SvgCancel;\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Search from '@jwp/ott-theme/assets/icons/search.svg?react';\r\nimport Cancel from '@jwp/ott-theme/assets/icons/cancel.svg?react';\r\n\r\nimport IconButton from '../IconButton/IconButton';\r\nimport Icon from '../Icon/Icon';\r\n\r\nimport styles from './SearchBar.module.scss';\r\n\r\nexport type Props = {\r\n  query?: string;\r\n  onQueryChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;\r\n  onClearButtonClick?: () => void;\r\n  onClose?: () => void;\r\n  inputRef?: React.MutableRefObject<HTMLInputElement>;\r\n};\r\n\r\nconst SearchBar: React.FC<Props> = ({ query, onQueryChange, onClearButtonClick, onClose, inputRef }: Props) => {\r\n  const { t } = useTranslation('search');\r\n  const handleSubmit = (event: React.ChangeEvent<HTMLFormElement>) => {\r\n    event.preventDefault();\r\n    inputRef?.current.focus(); // Force hide mobile keyboard\r\n    (document.querySelector('#content') as HTMLElement)?.focus();\r\n  };\r\n\r\n  return (\r\n    <div className={styles.searchBar}>\r\n      <Icon icon={Search} className={styles.icon} />\r\n      <form className={styles.searchForm} role=\"search\" onSubmit={handleSubmit}>\r\n        <label htmlFor=\"searchbar-input\" className=\"hidden\">\r\n          {t('search_bar.search_label')}\r\n        </label>\r\n        <input\r\n          className={styles.input}\r\n          id=\"searchbar-input\"\r\n          type=\"search\"\r\n          value={query}\r\n          onChange={onQueryChange}\r\n          onKeyDown={(event) => event.key === 'Escape' && onClose?.()}\r\n          placeholder={t('search_bar.search_placeholder')}\r\n          ref={inputRef}\r\n        />\r\n        {query ? (\r\n          <IconButton className={styles.clearButton} aria-label={t('search_bar.clear_search_label')} onClick={onClearButtonClick}>\r\n            <Icon icon={Cancel} />\r\n          </IconButton>\r\n        ) : null}\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\nexport default SearchBar;\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport IconButton, { type Props as IconButtonProps } from '../IconButton/IconButton';\r\n\r\nimport styles from './Header.module.scss';\r\n\r\nconst HeaderActionButton = ({ children, className, ...rest }: IconButtonProps) => {\r\n  return (\r\n    <IconButton className={classNames(styles.iconButton, className)} {...rest}>\r\n      {children}\r\n    </IconButton>\r\n  );\r\n};\r\n\r\nexport default HeaderActionButton;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { useLocation } from 'react-router';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { isTruthyCustomParamValue } from '@jwp/ott-common/src/utils/common';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\nimport SearchIcon from '@jwp/ott-theme/assets/icons/search.svg?react';\r\nimport CloseIcon from '@jwp/ott-theme/assets/icons/close.svg?react';\r\n\r\nimport Icon from '../../components/Icon/Icon';\r\nimport SearchBar from '../../components/SearchBar/SearchBar';\r\nimport useSearchQueryUpdater from '../../hooks/useSearchQueryUpdater';\r\nimport HeaderActionButton from '../../components/Header/HeaderActionButton';\r\n\r\nimport styles from './HeaderSearch.module.scss';\r\n\r\nconst HeaderSearch = () => {\r\n  const location = useLocation();\r\n  const searchInputRef = useRef<HTMLInputElement>(null) as React.MutableRefObject<HTMLInputElement>;\r\n\r\n  const config = useConfigStore(({ config }) => config);\r\n  const { features, custom } = config;\r\n\r\n  const { searchPlaylist } = features || {};\r\n  const hasAppContentSearch = isTruthyCustomParamValue(custom?.appContentSearch);\r\n  const searchEnabled = !!searchPlaylist || hasAppContentSearch;\r\n\r\n  const { searchQuery, searchActive } = useUIStore(\r\n    ({ searchQuery, searchActive, userMenuOpen, languageMenuOpen }) => ({\r\n      languageMenuOpen,\r\n      searchQuery,\r\n      searchActive,\r\n      userMenuOpen,\r\n    }),\r\n    shallow,\r\n  );\r\n  const { updateSearchQuery, resetSearchQuery } = useSearchQueryUpdater();\r\n\r\n  const closeSearchButtonClickHandler = () => {\r\n    resetSearchQuery();\r\n\r\n    useUIStore.setState({\r\n      searchActive: false,\r\n    });\r\n  };\r\n\r\n  const searchButtonClickHandler = () => {\r\n    useUIStore.setState({\r\n      searchActive: true,\r\n      preSearchPage: `${location.pathname}${location.search || ''}`,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (searchActive && searchInputRef.current) {\r\n      searchInputRef.current.focus();\r\n    }\r\n  }, [searchActive]);\r\n\r\n  if (!searchEnabled) return null;\r\n\r\n  return searchActive ? (\r\n    <div className={styles.searchContainer}>\r\n      <SearchBar\r\n        query={searchQuery}\r\n        onQueryChange={(event) => updateSearchQuery(event.target.value)}\r\n        onClearButtonClick={() => updateSearchQuery('')}\r\n        inputRef={searchInputRef}\r\n        onClose={closeSearchButtonClickHandler}\r\n      />\r\n      <HeaderActionButton aria-label=\"Close search\" onClick={closeSearchButtonClickHandler}>\r\n        <Icon icon={CloseIcon} />\r\n      </HeaderActionButton>\r\n    </div>\r\n  ) : (\r\n    <HeaderActionButton aria-label=\"Open search\" onClick={searchButtonClickHandler}>\r\n      <Icon icon={SearchIcon} />\r\n    </HeaderActionButton>\r\n  );\r\n};\r\n\r\nexport default HeaderSearch;\r\n","import * as React from \"react\";\nconst SvgLanguage = (props) => /* @__PURE__ */ React.createElement(\"svg\", { xmlns: \"http://www.w3.org/2000/svg\", viewBox: \"0 0 24 24\", ...props }, /* @__PURE__ */ React.createElement(\"path\", { fill: \"currentColor\", d: \"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z\" }));\nexport default SvgLanguage;\n","import React from 'react';\r\n\r\nimport styles from './Panel.module.scss';\r\n\r\ntype Props = {\r\n  id?: string;\r\n  children?: React.ReactNode;\r\n};\r\n\r\nconst Panel: React.FC<Props> = ({ children, ...rest }) => {\r\n  return (\r\n    <div className={styles.panel} {...rest}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Panel;\r\n","import React, { useEffect, useRef } from 'react';\r\n\r\ntype Prop = {\r\n  callback: () => void;\r\n  children: React.ReactElement;\r\n};\r\n\r\nconst DetectOutsideClick = ({ callback, children }: Prop) => {\r\n  const elementRef = useRef<HTMLDivElement>();\r\n\r\n  useEffect(() => {\r\n    const handleClick = (event: MouseEvent) => {\r\n      if (!elementRef.current || !(event.target instanceof Node)) {\r\n        return;\r\n      }\r\n\r\n      if (elementRef.current !== event.target && !elementRef.current?.contains(event.target)) {\r\n        callback();\r\n      }\r\n    };\r\n\r\n    setTimeout(() => document.addEventListener('click', handleClick), 1);\r\n\r\n    return () => document.removeEventListener('click', handleClick);\r\n  }, [callback]);\r\n\r\n  return React.cloneElement(children, {\r\n    ref: (node: HTMLDivElement) => {\r\n      elementRef.current = node;\r\n    },\r\n  });\r\n};\r\n\r\nexport default DetectOutsideClick;\r\n","import React, { type ReactNode } from 'react';\r\nimport classNames from 'classnames';\r\n\r\nimport DetectOutsideClick from '../DetectOutsideClick/DetectOutsideClick';\r\nimport Slide from '../Animation/Slide/Slide';\r\n\r\nimport styles from './Popover.module.scss';\r\n\r\ntype Props = {\r\n  children: ReactNode;\r\n  className?: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n};\r\n\r\nconst Popover: React.FC<Props> = ({ children, className, isOpen, onClose }: Props) => {\r\n  return (\r\n    <Slide open={isOpen} duration={250} direction=\"right\" style={{ position: 'relative' }}>\r\n      <DetectOutsideClick callback={onClose}>\r\n        <div className={classNames(styles.popover, className)}>{children}</div>\r\n      </DetectOutsideClick>\r\n    </Slide>\r\n  );\r\n};\r\n\r\nexport default Popover;\r\n","import type { LanguageDefinition } from '@jwp/ott-common/types/i18n';\r\nimport classNames from 'classnames';\r\nimport { type MouseEvent } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { testId } from '@jwp/ott-common/src/utils/common';\r\nimport Language from '@jwp/ott-theme/assets/icons/language.svg?react';\r\n\r\nimport Link from '../Link/Link';\r\nimport Panel from '../Panel/Panel';\r\nimport Popover from '../Popover/Popover';\r\nimport Icon from '../Icon/Icon';\r\nimport HeaderActionButton from '../Header/HeaderActionButton';\r\n\r\nimport styles from './LanguageMenu.module.scss';\r\n\r\ntype Props = {\r\n  onClick: (code: string) => void | null;\r\n  className?: string;\r\n  languages: LanguageDefinition[];\r\n  currentLanguage: LanguageDefinition | undefined;\r\n  languageMenuOpen: boolean;\r\n  openLanguageMenu: () => void;\r\n  closeLanguageMenu: () => void;\r\n};\r\n\r\nconst LanguageMenu = ({ onClick, className, languages, currentLanguage, languageMenuOpen, closeLanguageMenu, openLanguageMenu }: Props) => {\r\n  const { t } = useTranslation('menu');\r\n\r\n  const handleLanguageSelect = (event: MouseEvent<HTMLElement>, code: string) => {\r\n    event.preventDefault();\r\n    onClick && onClick(code);\r\n\r\n    closeLanguageMenu();\r\n  };\r\n\r\n  const handleMenuToggle = () => {\r\n    if (languageMenuOpen) {\r\n      closeLanguageMenu();\r\n    } else {\r\n      openLanguageMenu();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <HeaderActionButton\r\n        data-testid={testId('language-menu-button')}\r\n        aria-controls=\"language-panel\"\r\n        aria-expanded={languageMenuOpen}\r\n        aria-haspopup=\"menu\"\r\n        className={className}\r\n        aria-label={t('language_menu')}\r\n        onClick={handleMenuToggle}\r\n        onBlur={closeLanguageMenu}\r\n      >\r\n        <Icon icon={Language} />\r\n      </HeaderActionButton>\r\n      <Popover isOpen={languageMenuOpen} onClose={closeLanguageMenu}>\r\n        <Panel id=\"language-panel\">\r\n          <ul className={styles.menuItems}>\r\n            {languages.map(({ code, displayName }) => {\r\n              const isActive = currentLanguage?.code === code;\r\n              const menuItemClassname = classNames(styles.menuItem, { [styles.menuItemActive]: isActive });\r\n              return (\r\n                <li key={code} className={menuItemClassname} onClick={(event) => handleLanguageSelect(event, code)}>\r\n                  <Link onFocus={openLanguageMenu} onBlur={closeLanguageMenu} href=\"#\" aria-current={isActive}>\r\n                    {displayName}\r\n                  </Link>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        </Panel>\r\n      </Popover>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LanguageMenu;\r\n","import React, { useCallback, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\n\r\nimport LanguageMenu from '../../components/LanguageMenu/LanguageMenu';\r\n\r\nconst HeaderLanguageSwitcher = () => {\r\n  const { i18n } = useTranslation('menu');\r\n  const supportedLanguages = useConfigStore((state) => state.supportedLanguages);\r\n  const languageMenuOpen = useUIStore((state) => state.languageMenuOpen);\r\n\r\n  const openLanguageMenu = useCallback(() => useUIStore.setState({ languageMenuOpen: true }), []);\r\n  const closeLanguageMenu = useCallback(() => useUIStore.setState({ languageMenuOpen: false }), []);\r\n\r\n  const languageClickHandler = (code: string) => {\r\n    i18n.changeLanguage(code);\r\n  };\r\n\r\n  const currentLanguage = useMemo(() => supportedLanguages.find(({ code }) => code === i18n.language), [i18n.language, supportedLanguages]);\r\n\r\n  if (supportedLanguages.length < 2) return null;\r\n\r\n  return (\r\n    <LanguageMenu\r\n      openLanguageMenu={openLanguageMenu}\r\n      closeLanguageMenu={closeLanguageMenu}\r\n      languageMenuOpen={languageMenuOpen}\r\n      onClick={languageClickHandler}\r\n      languages={supportedLanguages}\r\n      currentLanguage={currentLanguage}\r\n    />\r\n  );\r\n};\r\n\r\nexport default HeaderLanguageSwitcher;\r\n","import styles from './ProfileCircle.module.scss';\r\n\r\ntype ProfileCircleProps = {\r\n  src: string;\r\n  alt: string;\r\n};\r\n\r\nconst ProfileCircle = ({ src, alt }: ProfileCircleProps) => <img className={styles.profileIcon} src={src} alt={alt} />;\r\n\r\nexport default ProfileCircle;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport AccountCircle from '@jwp/ott-theme/assets/icons/account_circle.svg?react';\r\nimport type { Profile } from '@jwp/ott-common/types/profiles';\r\n\r\nimport Icon from '../Icon/Icon';\r\nimport ProfileCircle from '../ProfileCircle/ProfileCircle';\r\nimport Popover from '../Popover/Popover';\r\nimport Panel from '../Panel/Panel';\r\nimport Button from '../Button/Button';\r\nimport UserMenuNav from '../UserMenuNav/UserMenuNav';\r\nimport HeaderActionButton from '../Header/HeaderActionButton';\r\n\r\nimport styles from './UserMenu.module.scss';\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onOpen: () => void;\r\n  onLoginButtonClick: () => void;\r\n  onSignUpButtonClick: () => void;\r\n  isLoggedIn: boolean;\r\n  favoritesEnabled: boolean;\r\n  profilesEnabled: boolean;\r\n  profile: Profile | null;\r\n  profiles: Profile[] | null;\r\n  profileLoading: boolean;\r\n  onSelectProfile: (params: { id: string; avatarUrl: string }) => void;\r\n};\r\n\r\nconst UserMenu = ({ isLoggedIn, favoritesEnabled, open, onClose, onOpen, onLoginButtonClick, onSignUpButtonClick, profilesEnabled, profile }: Props) => {\r\n  const { t } = useTranslation('menu');\r\n\r\n  if (!isLoggedIn) {\r\n    return (\r\n      <div className={styles.buttonContainer}>\r\n        <Button onClick={onLoginButtonClick} label={t('sign_in')} aria-haspopup=\"dialog\" />\r\n        <Button variant=\"contained\" color=\"primary\" onClick={onSignUpButtonClick} label={t('sign_up')} aria-haspopup=\"dialog\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <HeaderActionButton\r\n        aria-label={t('open_user_menu')}\r\n        aria-controls=\"menu_panel\"\r\n        aria-expanded={open}\r\n        aria-haspopup=\"menu\"\r\n        onClick={onOpen}\r\n        onBlur={onClose}\r\n      >\r\n        {profilesEnabled && profile ? <ProfileCircle src={profile.avatar_url} alt={profile.name || t('profile_icon')} /> : <Icon icon={AccountCircle} />}\r\n      </HeaderActionButton>\r\n      <Popover className={styles.popover} isOpen={open} onClose={onClose}>\r\n        <Panel id=\"menu_panel\">\r\n          <div onFocus={onOpen} onBlur={onClose}>\r\n            <UserMenuNav focusable={open} onButtonClick={onClose} showPaymentItems={true} currentProfile={profile} favoritesEnabled={favoritesEnabled} small />\r\n          </div>\r\n        </Panel>\r\n      </Popover>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UserMenu;\r\n","import React, { useCallback } from 'react';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { ACCESS_MODEL } from '@jwp/ott-common/src/constants';\r\nimport { useLocation, useNavigate } from 'react-router';\r\n\r\nimport UserMenu from '../../components/UserMenu/UserMenu';\r\nimport useBreakpoint, { Breakpoint } from '../../hooks/useBreakpoint';\r\nimport { modalURLFromLocation } from '../../utils/location';\r\n\r\nconst HeaderUserMenu = () => {\r\n  const breakpoint = useBreakpoint();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n\r\n  const userMenuOpen = useUIStore((state) => state.userMenuOpen);\r\n  const {\r\n    config: { features },\r\n    accessModel,\r\n  } = useConfigStore((state) => ({\r\n    config: state.config,\r\n    accessModel: state.accessModel,\r\n  }));\r\n  const isLoggedIn = useAccountStore(({ user }) => !!user);\r\n\r\n  const favoritesEnabled = !!features?.favoritesList;\r\n  const canLogin = accessModel !== ACCESS_MODEL.AVOD;\r\n\r\n  const openUserPanel = useCallback(() => useUIStore.setState({ userMenuOpen: true }), []);\r\n  const closeUserPanel = useCallback(() => useUIStore.setState({ userMenuOpen: false }), []);\r\n\r\n  const loginButtonClickHandler = () => navigate(modalURLFromLocation(location, 'login'));\r\n  const signUpButtonClickHandler = () => navigate(modalURLFromLocation(location, 'create-account'));\r\n\r\n  if (!canLogin || breakpoint <= Breakpoint.sm) return null;\r\n\r\n  return (\r\n    <UserMenu\r\n      open={userMenuOpen}\r\n      onOpen={openUserPanel}\r\n      onClose={closeUserPanel}\r\n      isLoggedIn={isLoggedIn}\r\n      favoritesEnabled={favoritesEnabled}\r\n      onLoginButtonClick={loginButtonClickHandler}\r\n      onSignUpButtonClick={signUpButtonClickHandler}\r\n      profilesEnabled={false}\r\n      profile={null}\r\n      profiles={[]}\r\n      profileLoading={false}\r\n      onSelectProfile={() => {}}\r\n    />\r\n  );\r\n};\r\n\r\nexport default HeaderUserMenu;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Outlet } from 'react-router';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\nimport { useConfigStore } from '@jwp/ott-common/src/stores/ConfigStore';\r\nimport { unicodeToChar } from '@jwp/ott-common/src/utils/common';\r\nimport { playlistURL } from '@jwp/ott-common/src/utils/urlFormatting';\r\nimport env from '@jwp/ott-common/src/env';\r\nimport { useUIStore } from '@jwp/ott-common/src/stores/UIStore';\r\n\r\nimport Header from '../../components/Header/Header';\r\nimport Footer from '../../components/Footer/Footer';\r\nimport HeaderMenu from '../../components/Header/HeaderMenu';\r\nimport HeaderNavigation from '../../components/Header/HeaderNavigation';\r\nimport HeaderBrand from '../../components/Header/HeaderBrand';\r\nimport HeaderActions from '../../components/Header/HeaderActions';\r\nimport HeaderSkipLink from '../../components/Header/HeaderSkipLink';\r\nimport SidebarContainer from '../SidebarContainer/SidebarContainer';\r\nimport SiteMetadata from '../SiteMetadata/SiteMetadata';\r\nimport HeaderSearch from '../HeaderSearch/HeaderSearch';\r\nimport HeaderLanguageSwitcher from '../HeaderLanguageSwitcher/HeaderLanguageSwitcher';\r\nimport HeaderUserMenu from '../HeaderUserMenu/HeaderUserMenu';\r\n\r\nimport styles from './Layout.module.scss';\r\n\r\nconst Layout = () => {\r\n  const { t } = useTranslation('common');\r\n\r\n  const { config } = useConfigStore(\r\n    ({ config, accessModel, supportedLanguages }) => ({\r\n      config,\r\n      accessModel,\r\n      supportedLanguages,\r\n    }),\r\n    shallow,\r\n  );\r\n  const { menu, assets, siteName, styling } = config;\r\n  const { footerText: configFooterText } = styling || {};\r\n  const footerText = configFooterText || unicodeToChar(env.APP_FOOTER_TEXT);\r\n\r\n  const { sideBarOpen, searchActive } = useUIStore((state) => ({\r\n    sideBarOpen: state.sideBarOpen,\r\n    searchActive: state.searchActive,\r\n  }));\r\n  const banner = assets.banner;\r\n\r\n  const openSideBar = () => useUIStore.setState({ sideBarOpen: true });\r\n\r\n  const navItems = [\r\n    { label: t('home'), to: '/' },\r\n    ...menu.map((item) => ({\r\n      label: item.label,\r\n      to: playlistURL(item.contentId),\r\n    })),\r\n  ];\r\n\r\n  const containerProps = { inert: sideBarOpen ? '' : undefined }; // inert is not yet officially supported in react\r\n\r\n  return (\r\n    <div className={styles.layout}>\r\n      <SiteMetadata />\r\n      <div {...containerProps}>\r\n        <Header searchActive={searchActive}>\r\n          <HeaderSkipLink />\r\n          <HeaderMenu sideBarOpen={sideBarOpen} onClick={openSideBar} />\r\n          <HeaderBrand siteName={siteName} logoSrc={banner} setLogoLoaded={() => undefined} />\r\n          <HeaderNavigation navItems={navItems} />\r\n          <HeaderActions>\r\n            <HeaderSearch />\r\n            <HeaderLanguageSwitcher />\r\n            <HeaderUserMenu />\r\n          </HeaderActions>\r\n        </Header>\r\n        <main id=\"content\" className={styles.main} tabIndex={-1}>\r\n          <Outlet />\r\n        </main>\r\n        {!!footerText && <Footer text={footerText} />}\r\n      </div>\r\n      <SidebarContainer />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","import { useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router';\r\nimport { getModule } from '@jwp/ott-common/src/modules/container';\r\nimport AccountController from '@jwp/ott-common/src/controllers/AccountController';\r\nimport { queryClient } from '@jwp/ott-ui-react/src/containers/QueryProvider/QueryProvider';\r\nimport { modalURLFromLocation } from '@jwp/ott-ui-react/src/utils/location';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport useEventCallback from '@jwp/ott-hooks-react/src/useEventCallback';\r\nimport type { AccountModals } from '@jwp/ott-ui-react/src/containers/AccountModal/AccountModal';\r\n\r\nenum NotificationsTypes {\r\n  ACCESS_REVOKED = 'access.revoked',\r\n  CARD_REQUIRES_ACTION = 'payment.card.requires.action',\r\n  CARD_FAILED = 'payment.card.failed',\r\n  CARD_SUCCESS = 'payment.card.success',\r\n  SUBSCRIBE_REQUIRES_ACTION = 'subscribe.requires.action',\r\n  FAILED = '.failed',\r\n  SUBSCRIBE_FAILED = 'subscribe.failed',\r\n  SUBSCRIBE_SUCCESS = 'subscribe.success',\r\n  ACCOUNT_LOGOUT = 'account.logout',\r\n}\r\n\r\nexport default function useNotifications() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const uuid = useAccountStore((s) => (typeof s.user?.uuid === 'string' ? s.user.uuid : undefined));\r\n\r\n  const accountController = getModule(AccountController);\r\n  const { hasNotifications } = accountController?.getFeatures() || {};\r\n\r\n  // use an eventCallback to prevent the `location` property being stale when used directly in the useEffect below\r\n  const navigateToModal = useEventCallback((path: keyof AccountModals | null, queryParams?: Record<string, string>) => {\r\n    navigate(modalURLFromLocation(location, path, queryParams));\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (!uuid || !hasNotifications) return;\r\n\r\n    accountController?.subscribeToNotifications({\r\n      uuid,\r\n      onMessage: async (message) => {\r\n        if (message) {\r\n          const notification = JSON.parse(message);\r\n\r\n          switch (notification.type) {\r\n            case NotificationsTypes.FAILED:\r\n            case NotificationsTypes.CARD_FAILED:\r\n            case NotificationsTypes.SUBSCRIBE_FAILED:\r\n              navigateToModal('payment-error', notification.resource?.message);\r\n              break;\r\n            case NotificationsTypes.CARD_SUCCESS:\r\n              await queryClient.invalidateQueries(['entitlements']);\r\n              navigateToModal(null); // close modal\r\n              break;\r\n            case NotificationsTypes.SUBSCRIBE_SUCCESS:\r\n              await accountController.reloadSubscriptions();\r\n              break;\r\n            case NotificationsTypes.ACCESS_REVOKED:\r\n              await accountController.reloadSubscriptions();\r\n              break;\r\n            case NotificationsTypes.CARD_REQUIRES_ACTION:\r\n            case NotificationsTypes.SUBSCRIBE_REQUIRES_ACTION:\r\n              window.location.href = notification.resource?.redirect_to_url;\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n        }\r\n      },\r\n    });\r\n  }, [accountController, hasNotifications, navigateToModal, uuid]);\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport { Navigate, useLocation } from 'react-router-dom';\r\nimport { Outlet } from 'react-router';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useAccountStore } from '@jwp/ott-common/src/stores/AccountStore';\r\nimport { shallow } from '@jwp/ott-common/src/utils/compare';\r\n\r\nimport useNotifications from '#src/hooks/useNotifications';\r\n\r\nconst RoutesContainer = () => {\r\n  const { i18n } = useTranslation();\r\n  const location = useLocation();\r\n\r\n  const userData = useAccountStore((s) => ({ loading: s.loading, user: s.user }), shallow);\r\n\r\n  // listen to websocket notifications\r\n  useNotifications();\r\n\r\n  // set/update lang html lang attribute\r\n  useEffect(() => {\r\n    document.documentElement.setAttribute('lang', i18n.language);\r\n  }, [i18n.language]);\r\n\r\n  // used for social logins\r\n  // @todo should users be redirected away from a page after login?\r\n  if (userData.user && !userData.loading && window.location.href.includes('#token')) {\r\n    return <Navigate to={{ ...location, hash: '' }} replace />; // component instead of hook to prevent extra re-renders\r\n  }\r\n\r\n  return <Outlet />;\r\n};\r\n\r\nexport default RoutesContainer;\r\n","import React from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Route, Routes } from 'react-router-dom';\r\nimport ErrorPage from '@jwp/ott-ui-react/src/components/ErrorPage/ErrorPage';\r\nimport RootErrorPage from '@jwp/ott-ui-react/src/components/RootErrorPage/RootErrorPage';\r\nimport About from '@jwp/ott-ui-react/src/pages/About/About';\r\nimport Home from '@jwp/ott-ui-react/src/pages/Home/Home';\r\nimport Search from '@jwp/ott-ui-react/src/pages/Search/Search';\r\nimport User from '@jwp/ott-ui-react/src/pages/User/User';\r\nimport LegacySeries from '@jwp/ott-ui-react/src/pages/LegacySeries/LegacySeries';\r\nimport MediaScreenRouter from '@jwp/ott-ui-react/src/pages/ScreenRouting/MediaScreenRouter';\r\nimport PlaylistScreenRouter from '@jwp/ott-ui-react/src/pages/ScreenRouting/PlaylistScreenRouter';\r\nimport Layout from '@jwp/ott-ui-react/src/containers/Layout/Layout';\r\nimport { PATH_ABOUT, PATH_LEGACY_SERIES, PATH_MEDIA, PATH_PLAYLIST, PATH_SEARCH, PATH_USER } from '@jwp/ott-common/src/paths';\r\n\r\nimport RoutesContainer from '#src/containers/RoutesContainer/RoutesContainer';\r\n\r\nexport default function AppRoutes() {\r\n  const { t } = useTranslation('error');\r\n\r\n  return (\r\n    <Routes>\r\n      <Route element={<RoutesContainer />}>\r\n        <Route element={<Layout />} errorElement={<RootErrorPage />}>\r\n          <Route index element={<Home />} />\r\n          <Route path={PATH_PLAYLIST} element={<PlaylistScreenRouter />} />\r\n          <Route path={PATH_MEDIA} element={<MediaScreenRouter />} />\r\n          <Route path={PATH_LEGACY_SERIES} element={<LegacySeries />} />\r\n          <Route path={PATH_SEARCH} element={<Search />} />\r\n          <Route path={PATH_USER} element={<User />} />\r\n          <Route path={PATH_ABOUT} element={<About />} />\r\n          <Route\r\n            path=\"/*\"\r\n            element={<ErrorPage title={t('notfound_error_heading', 'Not found')} message={t('notfound_error_description', \"This page doesn't exist.\")} />}\r\n          />\r\n        </Route>\r\n      </Route>\r\n    </Routes>\r\n  );\r\n}\r\n","import classNames from 'classnames';\r\nimport React from 'react';\r\n\r\nimport useBreakpoint, { Breakpoint } from '../../hooks/useBreakpoint';\r\nimport CollapsibleText from '../CollapsibleText/CollapsibleText';\r\nimport Image from '../Image/Image';\r\nimport TruncatedText from '../TruncatedText/TruncatedText';\r\n\r\nimport styles from './Hero.module.scss';\r\n\r\ntype Props = {\r\n  title: string;\r\n  description: string;\r\n  image?: string;\r\n};\r\n\r\nconst Hero = ({ title, description, image }: Props) => {\r\n  const breakpoint: Breakpoint = useBreakpoint();\r\n  const isMobile = breakpoint === Breakpoint.xs;\r\n  const alt = ''; // intentionally empty for a11y, because adjacent text alternative\r\n\r\n  return (\r\n    <div className={classNames(styles.hero, styles.heroPadding)}>\r\n      <Image className={styles.poster} image={image} width={1280} alt={alt} />\r\n      <div className={styles.posterFade} />\r\n      <div className={styles.info}>\r\n        <h1 className={styles.title}>{title}</h1>\r\n        {isMobile ? (\r\n          <CollapsibleText text={description} className={styles.description} />\r\n        ) : (\r\n          <TruncatedText text={description} maximumLines={8} className={styles.description} />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Hero;\r\n","import React, { useEffect, useMemo } from 'react';\r\nimport type { Content } from '@jwp/ott-common/types/config';\r\nimport type { PlaylistItem } from '@jwp/ott-common/types/playlist';\r\n\r\nimport type { ScreenComponent } from '../../../../../types/screens';\r\nimport ShelfList from '../../../../containers/ShelfList/ShelfList';\r\nimport Hero from '../../../../components/Hero/Hero';\r\n\r\nconst parsePlaylistIds = (input: unknown): Content[] => {\r\n  const playlistIds = typeof input === 'string' ? input.replace(/\\s+/g, '').split(',') : [];\r\n\r\n  return playlistIds.map((id) => ({ type: 'playlist', contentId: id }));\r\n};\r\n\r\nconst MediaHub: ScreenComponent<PlaylistItem> = ({ data }) => {\r\n  // Hub may specify multiple playlists as a CSV list of IDs or a single playlist\r\n  const rows = useMemo(() => parsePlaylistIds(data.playlists || data.playlist), [data.playlist, data.playlists]);\r\n\r\n  // Effects\r\n  useEffect(() => {\r\n    (document.scrollingElement || document.body).scroll({ top: 0 });\r\n    (document.querySelector('#video-details button') as HTMLElement)?.focus();\r\n  }, [data]);\r\n\r\n  return (\r\n    <header>\r\n      <Hero image={data.backgroundImage} title={data.title} description={data.description} />\r\n      <ShelfList rows={rows}></ShelfList>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default MediaHub;\r\n","import { CONTENT_TYPE } from '@jwp/ott-common/src/constants';\r\nimport { mediaScreenMap } from '@jwp/ott-ui-react/src/pages/ScreenRouting/MediaScreenRouter';\r\nimport MediaHub from '@jwp/ott-ui-react/src/pages/ScreenRouting/mediaScreens/MediaHub/MediaHub';\r\n\r\n/**\r\n * This file is used to add media and/or playlist screens.\r\n *\r\n * The most basic example is given below where a media screen is registered for the `hub` contentType. This means that\r\n * when navigating to the `/m/:id` page and the requested media item has `contentType: hub`, it will render the\r\n * `MediaHub` screen.\r\n *\r\n * In the application, screens are registered for the following contentTypes: Episode, Series and LiveChannel. When no\r\n * match is found, the default screen is used.\r\n *\r\n * To override the default media screen you can use:\r\n *\r\n * @example\r\n * mediaScreenMap.registerDefault(CustomMediaScreen);\r\n *\r\n * If you want to override the series contentType you can use:\r\n *\r\n * @example\r\n * mediaScreenMap.registerByContentType(CustomSeriesScreen, 'series');\r\n *\r\n * Or you want to use different parameters to select a screen, you can use the `register` method with a predicate\r\n * function. This predicate function must return `true` when it should be used.\r\n *\r\n * @example\r\n * mediaScreenMap.register(CustomMediaScreen, (item?: PlaylistItem) => item?.customParam === 'yes');\r\n *\r\n * If you want to override all screens and only use a single screen for all media items, you can register a screen\r\n * with a predicate that always returns `true`\r\n *\r\n * @example\r\n * mediaScreenMap.register(CustomMediaScreen, () => true);\r\n *\r\n * The same methods can be used for the `playlistScreenMap` that is exported from\r\n * {@link /src/pages/ScreenRouting/PlaylistScreenRouter.tsx}\r\n */\r\n\r\nexport default function registerCustomScreens() {\r\n  // Hub is an example screen for the media router\r\n  mediaScreenMap.registerByContentType(MediaHub, CONTENT_TYPE.hub);\r\n}\r\n","import { useLayoutEffect } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport type { Settings } from '@jwp/ott-common/types/settings';\r\nimport { CONFIG_QUERY_KEY } from '@jwp/ott-common/src/constants';\r\n\r\nexport function useTrackConfigKeyChange(settings: Settings | undefined, configSource: string | undefined) {\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n\r\n  // Update the query string to maintain the right params\r\n  useLayoutEffect(() => {\r\n    if (!settings) {\r\n      return;\r\n    }\r\n\r\n    // If there is no valid config source or the config source equals the default, remove the ?app-config= param\r\n    if (searchParams.has(CONFIG_QUERY_KEY) && (!configSource || configSource === settings?.defaultConfigSource)) {\r\n      setSearchParams(\r\n        (s) => {\r\n          s.delete(CONFIG_QUERY_KEY);\r\n\r\n          return s;\r\n        },\r\n        { replace: true },\r\n      );\r\n    }\r\n\r\n    // If the config source is not the default and the query string isn't set right, set the ?app-config= param\r\n    if (configSource && configSource !== settings?.defaultConfigSource && searchParams.get(CONFIG_QUERY_KEY) !== configSource) {\r\n      setSearchParams(\r\n        (s) => {\r\n          s.set(CONFIG_QUERY_KEY, configSource);\r\n          return s;\r\n        },\r\n        { replace: true },\r\n      );\r\n    }\r\n  }, [configSource, searchParams, setSearchParams, settings]);\r\n\r\n  return configSource;\r\n}\r\n","import React, { useEffect, useState, type FC, useCallback, useRef } from 'react';\r\nimport { IS_DEMO_MODE, IS_DEVELOPMENT_BUILD, IS_PREVIEW_MODE, IS_PROD_MODE } from '@jwp/ott-common/src/utils/common';\r\nimport ErrorPage from '@jwp/ott-ui-react/src/components/ErrorPage/ErrorPage';\r\nimport AccountModal from '@jwp/ott-ui-react/src/containers/AccountModal/AccountModal';\r\nimport DevConfigSelector from '@jwp/ott-ui-react/src/components/DevConfigSelector/DevConfigSelector';\r\nimport LoadingOverlay from '@jwp/ott-ui-react/src/components/LoadingOverlay/LoadingOverlay';\r\nimport { type BootstrapData, type OnReadyCallback, useBootstrapApp } from '@jwp/ott-hooks-react/src/useBootstrapApp';\r\nimport { setThemingVariables } from '@jwp/ott-ui-react/src/utils/theming';\r\nimport { addScript } from '@jwp/ott-ui-react/src/utils/dom';\r\nimport type { Config } from '@jwp/ott-common/types/config';\r\nimport { AppError } from '@jwp/ott-common/src/utils/error';\r\n\r\nimport DemoConfigDialog from '../../components/DemoConfigDialog/DemoConfigDialog';\r\nimport AppRoutes from '../AppRoutes/AppRoutes';\r\n\r\nimport registerCustomScreens from '#src/screenMapping';\r\nimport { useTrackConfigKeyChange } from '#src/hooks/useTrackConfigKeyChange';\r\n\r\nconst IS_DEMO_OR_PREVIEW = IS_DEMO_MODE || IS_PREVIEW_MODE;\r\n\r\nconst BootstrapError = ({ error }: { error: Error | AppError }) => {\r\n  if (error instanceof AppError) {\r\n    return <ErrorPage title={error.payload.title} message={error.payload.description} helpLink={error.payload.helpLink} error={error} />;\r\n  }\r\n  return <ErrorPage error={error} />;\r\n};\r\n\r\nconst ProdContentLoader = ({ query }: { query: BootstrapData }) => {\r\n  const { isLoading, error } = query;\r\n\r\n  if (isLoading) {\r\n    return <LoadingOverlay />;\r\n  }\r\n\r\n  if (error) {\r\n    return <BootstrapError error={error} />;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nconst DemoContentLoader = ({ query }: { query: BootstrapData }) => {\r\n  const { isLoading, error, data } = query;\r\n\r\n  // Show the spinner while loading except in demo mode (the demo config shows its own loading status)\r\n  if (!IS_DEMO_OR_PREVIEW && isLoading) {\r\n    return <LoadingOverlay />;\r\n  }\r\n\r\n  const { configSource } = data || {};\r\n\r\n  return (\r\n    <>\r\n      {/* Show the error page when error except in demo mode (the demo mode shows its own error) */}\r\n      {!IS_DEMO_OR_PREVIEW && error && <BootstrapError error={error} />}\r\n      {IS_DEMO_OR_PREVIEW && <DemoConfigDialog query={query} />}\r\n      {/* Config select control to improve testing experience */}\r\n      {(IS_DEVELOPMENT_BUILD || IS_PREVIEW_MODE) && <DevConfigSelector selectedConfig={configSource} />}\r\n    </>\r\n  );\r\n};\r\n\r\n// This is moved to a separate, parallel component to reduce rerenders\r\nconst RootLoader = ({ onReady }: { onReady: OnReadyCallback }) => {\r\n  const query = useBootstrapApp(window.location.href, onReady);\r\n\r\n  // Modify query string to add / remove app-config id\r\n  useTrackConfigKeyChange(query.data?.settings, query.data?.configSource);\r\n\r\n  return IS_PROD_MODE ? <ProdContentLoader query={query} /> : <DemoContentLoader query={query} />;\r\n};\r\n\r\nconst Root: FC = () => {\r\n  const analyticsLoadedRef = useRef(false);\r\n  const [isReady, setIsReady] = useState(false);\r\n\r\n  // Register custom screen mappings\r\n  useEffect(() => {\r\n    registerCustomScreens();\r\n  }, []);\r\n\r\n  const onReadyCallback = useCallback(async (config: Config | undefined) => {\r\n    // when the config is missing, the initialization failed\r\n    if (!config) {\r\n      return;\r\n    }\r\n\r\n    // because theming and analytics are specific to web, we configure it from here\r\n    // alternatively, we can use an events or specific callbacks or extend the AppController for each platform\r\n    setThemingVariables(config);\r\n\r\n    if (config.analyticsToken && !analyticsLoadedRef.current) {\r\n      await addScript('/jwpltx.js');\r\n      analyticsLoadedRef.current = true;\r\n    }\r\n\r\n    setIsReady(true);\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      {isReady && <AppRoutes />}\r\n      {isReady && <AccountModal />}\r\n      {/*This is moved to a separate, parallel component to reduce rerenders */}\r\n      <RootLoader onReady={onReadyCallback} />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Root;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { BrowserRouter } from 'react-router-dom';\r\nimport QueryProvider from '@jwp/ott-ui-react/src/containers/QueryProvider/QueryProvider';\r\nimport { ErrorPageWithoutTranslation } from '@jwp/ott-ui-react/src/components/ErrorPage/ErrorPage';\r\nimport LoadingOverlay from '@jwp/ott-ui-react/src/components/LoadingOverlay/LoadingOverlay';\r\nimport { AriaAnnouncerProvider } from '@jwp/ott-ui-react/src/containers/AnnouncementProvider/AnnoucementProvider';\r\n\r\nimport initI18n from './i18n/config';\r\nimport Root from './containers/Root/Root';\r\n\r\nimport './screenMapping';\r\nimport './styles/main.scss';\r\n\r\ninterface State {\r\n  isLoading: boolean;\r\n  error?: Error;\r\n}\r\n\r\nexport default function App() {\r\n  const [i18nState, seti18nState] = useState<State>({ isLoading: true });\r\n\r\n  useEffect(() => {\r\n    initI18n()\r\n      .then(() => seti18nState({ isLoading: false }))\r\n      .catch((e) => seti18nState({ isLoading: false, error: e as Error }));\r\n  }, []);\r\n\r\n  if (i18nState.isLoading) {\r\n    return <LoadingOverlay />;\r\n  }\r\n\r\n  if (i18nState.error) {\r\n    // Don't be tempted to translate these strings. If i18n fails to load, translations won't work anyhow\r\n    return (\r\n      <ErrorPageWithoutTranslation\r\n        title={'Unable to load translations'}\r\n        message={'Check your language settings and try again later. If the problem persists contact technical support.'}\r\n        error={i18nState.error}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <QueryProvider>\r\n      <BrowserRouter>\r\n        <AriaAnnouncerProvider>\r\n          <Root />\r\n        </AriaAnnouncerProvider>\r\n      </BrowserRouter>\r\n    </QueryProvider>\r\n  );\r\n}\r\n","export const attachAccessibilityListener = () => {\r\n  let isTabbing = false;\r\n\r\n  // when the user presses the Tab key, we add a `is-tabbing` className to the body element, so we can enable outline\r\n  // focus for keyboard users\r\n  document.addEventListener('keydown', (event) => {\r\n    if (event.key === 'Tab' && !isTabbing) {\r\n      isTabbing = true;\r\n      document.body.classList.add('is-tabbing');\r\n    }\r\n  });\r\n\r\n  // remove the `is-tabbing` className when the user uses a mouse again to interact with elements\r\n  document.addEventListener('mousedown', () => {\r\n    if (isTabbing) {\r\n      isTabbing = false;\r\n      document.body.classList.remove('is-tabbing');\r\n    }\r\n  });\r\n};\r\n","import 'virtual:polyfills';\r\nimport React from 'react';\r\nimport { createRoot } from 'react-dom/client';\r\nimport 'wicg-inert';\r\nimport { registerSW } from 'virtual:pwa-register';\r\nimport { configureEnv } from '@jwp/ott-common/src/env';\r\n\r\nimport './modules/register';\r\n\r\nimport App from './App';\r\n\r\nimport { attachAccessibilityListener } from '#src/utils/accessibility';\r\n\r\n// Collect env vars\r\nconfigureEnv({\r\n  APP_VERSION: import.meta.env.APP_VERSION,\r\n\r\n  APP_API_BASE_URL: import.meta.env.APP_API_BASE_URL,\r\n  APP_PLAYER_ID: import.meta.env.APP_PLAYER_ID,\r\n\r\n  APP_DEFAULT_CONFIG_SOURCE: import.meta.env.APP_DEFAULT_CONFIG_SOURCE,\r\n  APP_PLAYER_LICENSE_KEY: import.meta.env.APP_PLAYER_LICENSE_KEY,\r\n\r\n  APP_FOOTER_TEXT: import.meta.env.APP_FOOTER_TEXT,\r\n  APP_BODY_FONT: import.meta.env.APP_BODY_FONT,\r\n  APP_BODY_ALT_FONT: import.meta.env.APP_BODY_ALT_FONT,\r\n});\r\n\r\nattachAccessibilityListener();\r\n\r\nconst rootElement = document.getElementById('root');\r\n\r\nif (rootElement) {\r\n  const root = createRoot(rootElement);\r\n  root.render(<App />);\r\n} else {\r\n  console.info('Application - rootElement not found');\r\n}\r\n\r\nconst refresh = registerSW({\r\n  immediate: true,\r\n  onNeedRefresh: () => refresh(true),\r\n});\r\n"],"file":"assets/index-knuSdpEX.js"}